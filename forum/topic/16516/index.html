


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/16516/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:10:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Применение embedded controller для  управления устройствами
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/8/index.html">Блоги</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/25/index.html">Блоги</a> <span class="divider">/</span></li>
            
        
        
            <li>Применение embedded controller для  управления устройствами</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Применение embedded controller для  управления устройствами</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-174483"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/174483/index.html">#</a>
            5 лет, 11 месяцев назад
            
                (отредактировано
                
                    1 год, 7 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <strong>Применение embedded controller для  управления устройствами</strong><br /><br />Решился на написание еще одного опуса. Слышу возмущения — опять написал ерунду, чтобы показать себя..... но я уже не в том возрасте, чтобы писать для этой цели ….. как говорится жизнь на закате и писать только ради этогого …. это несеръезно да и не перед кем мне уже заискывать....<br />Как то уже упоминал, что программирование не моя стихия, не мое это …. а нравился мне всегда реверсинг, но сейчас уже не до него..... а покапаться в чем то похожем хочется ….. поэтому и родилась эта статья — покапать то покапался, но подумал, что может пригодится и другим...<br /><br /><strong>embedded controller</strong> - дословный перевод - встроенный контроллер, предназначен  для управления отдельными устройствами компьютера, наверное, точнее будет сказать для обработки отдельных ACPI-событий.<br />Embedded Controller имеет свой BIOS, который может хранится или в отдельном чипе или входить в состав системного BIOS.<br />В настоящее время увеличивается как количество разных типов компьютеров, так и количество операционных систем (ОС). Чисто теоретически, да и практически, просто не возможно добиться полной совместимости (в части управления устройствами/ACPI-событиями) всех существующих компьютеров и всех существующих ОС . Вот здесь то и возрастает роль embedded controller при управлении различными проблемными устройствами. И вполне возможно, что количество устройств/ACPI-событий, способных осуществлять свои функции управления посредством embedded controller будет со временем увеличиваться. В настоящее время этот перечень не велик и зависит от разработчиков — в разных типах ноутбуков этот перечень отличается. В основном это вентилятор (имеется практически во всех ноутбуках), в других ноутбуках включена функция управления подсветкой монитора и клавиатуры, включение/выключение некоторых устройств, например, Bluetooth и др.<br />Подробное описание всех возможных функций управления embedded controller Intel приведено в документе <a href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/controller-usage-low-power-designs-paper.pdf">Embedded Controller Usage in Low Power Embedded Designs</a><br /><strong>Цель данной статьи чисто ознакомительная</strong> - ознакомить пользователей Archlinux с возможносью управления определенных устройств компьютера через регистры embedded controller, все будет показно на примере вентилятора (как уже упоминал, возможность управления вентилятором имеется практически во всех типах ноутбуков).<br />В инете эту тему можно нагуглить, но в основном узконаправлено и все публикации посвящены большей частью скрипту acer_ec.pl , и как я понял идет переписывание  одной статьи, но в разных вариациях. Основопологающие принципы практически отсутствуют, имеются отдельные скупые заметки и то на иностранных языках. Одним словом общей картины нет ......... а потому и решил все свести в одно место. Просто в свое время пришлось очень долго все лопатить, да и доходить до некоторых вещей самому.....а пользователю, не имеющему опыта работы с байтами, с разными системами исчисления, слабо знающему другие языки копаться во всем этом будет довольно затруднительно.<br /><br />Но пора и приступать к экспериментам.....<br />Условно подход к управлению через embedded controller можно разбить на три способа — названия, конечно, не подходящие, но ничего подходящего не придумал.<br />1. <strong>Ручной</strong> (полностью под контролем пользователя - как говорится, все в твоих руках)<br />2. <strong>Полуавтоматический</strong> (практически совпадает с 1-ым способом, но для облегчения записи в регистры используется программа).<br />3. <strong>Автоматический</strong> (самый простой, даже не нужно загружать модуль, все за тебя продумали)<br /><br /><strong>1. Ручной способ управления.</strong><br /><br /><span style="color:red;"><strong>EDIT</strong>  - <strike>Сейчас модуль ec_sys встроен в ядро (CONFIG_ACPI_EC_DEBUGFS=y) и загружать его не нужно, но значение параметра <strong>write_support=N</strong>, и значит для записи в регистр нужно загрузиться с параметром write_support=1, точнее, <strong>ec_sys.write_support=1</strong></strike></span><br />Снова изменили .... стало как и прежде<br />zgrep CONFIG_ACPI_EC_DEBUGFS /proc/config.gz<br />CONFIG_ACPI_EC_DEBUGFS=m<br /><br />Управление осуществляется через модуль <strong>ec_sys</strong> , встроенный в ядро — этот модуль позволяет осуществлять операции чтения/записи в памяти (в регистры) embedded controller. Модуль в общем то предназначен для отладки -  <strong>CONFIG_ACPI_EC_DEBUGFS=m</strong> , но и для наших целей он тоже хорошо подходит.<br />- загружаем модуль - # <strong>modprobe ec_sys</strong><br />- проверяем - $ lsmod | grep ec_sys<br />ec_sys                 16384  0<br /> После загрузки модуля должна появиться директория    <strong>/sys/kernel/debug/ec</strong><br /><pre><code># ls /sys/kernel/debug/ec
ec0
# ls /sys/kernel/debug/ec/ec0
gpe  io  use_global_lock</code></pre>Но если просто загрузить модуль, без параметров, то в дальнейшем не возможно будет провести операции записи значений в регистры. За это отвечает параметр  <strong>write_support</strong>, который по умолчанию равен 0<br />$ <strong>modinfo ec_sys -p</strong><br /><strong>write_support:Dangerous, reboot and removal of battery may be needed. (bool)</strong><br />Для того чтобы можно было выполнять операции записи необходимо загрузить модуль с данным параметром, равным 1<br />Для начала, если модуль был загружен, выгружаем его, а потом загружаем по новой, с нужным параметром<br /># modprobe -r ec_sys<br /># modprobe ec_sys write_support=1<br />Но обращаю внимание на запись в строке parm<strong> Dangerous</strong>....  вот что пишут на этот счет …..<br /><pre><code>..... ec_sys module that provides a useful debugfs interface to allow one to read + write to the EC memory. Write support is enabled with the ec_sys module parameter &#39;write_support&#39; but it is generally discouraged as one may be poking data into memory may break things in an unpredictable manner, hence by default write support is disabled.</code></pre>Но это просто предупреждение ….. просто нужно быть внимательным … но если и ошибетесь, то особо страшного ничего не произойдет.<br />Если все выполнили правильно, то можно посмотреть таблицу значений данных, записанных в регистрах  embedded controller. Эти значения хранятся в бинарном файле <strong>/sys/kernel/debug/ec/ec0/io</strong>, посмотреть эти значения удобнее следующим способом<br /># <strong>od -Ax -t x1 /sys/kernel/debug/ec/ec0/io</strong><br /><pre><code>000000 d4 83 59 01 18 08 20 43 00 2c 31 9f 03 ff ff 00
000010 00 3a 00 ff ff ff ff ff ff ff ff ff ff ff ff ff
000020 ff ff 00 00 00 00 14 01 00 00 00 00 00 00 4a 4a
000030 00 00 14 00 00 23 2c 00 00 00 00 00 00 00 00 00
000040 00 00 00 10 00 00 00 00 00 00 00 00 00 00 00 00
000050 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
*
000080 00 00 04 01 01 01 00 14 0f 01 00 ff ff 01 00 00
000090 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0000a0 00 00 00 00 00 00 00 00 00 00 00 00 00 c8 00 00
0000b0 00 96 00 00 00 64 10 00 00 64 41 00 41 00 ff e0
0000c0 2e ff 00 00 ff ff ff aa aa ff ff 3f 28 00 00 00
0000d0 00 00 00 00 00 6b ff ff 02 ff ff ff ff ff ff ff
0000e0 74 0b ff 07 00 b4 00 01 01 00 04 00 ff ff ff 00
0000f0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000100</code></pre>Значения данных в регистрах записаны в 16-ричном виде и изменяются в пределах 00 - ff  (или 0 - 255 в 10-ричном исчислении). При этом чем меньше значение записанное в регистре, тем больше физическая величина реального значения контролируемого параметра (выразился непонятно, но дальше это будет понятно на примере).<br />Обозначение регистров — в  16-ричном виде удобно определять прямо по таблице  строка - столбец, …. в 10-ричной системе по порядковому номеру элемента в таблице (16 элементов в строке)......но при записи удобнее использовать номера регистров в 10-ричной системе, так как применяется команда dd.<br />Строки и столбцы нумеруются, согласно таблице,  0, 1, 2, 3 ... d, e, f<br />Пример. Регистры для моего вентилятора (у Вас будут другие). Как они определяются, опишу позже.<br /><strong>2E (46) — read<br />2F (47) — write</strong><br />В них записаны, как видно из таблицы, значения <strong>4a</strong> (74 в 10-ричной системе исчисления). Попробуем увеличить мощность вентилятора, а точнее запишем в регистр <strong>2F</strong> (47) значение <strong>3a</strong> (58).<br />Запись в регистры осуществляется следующей командой (пояснять не буду, вроде и так все понятно)<br /># <strong>echo -n -e &quot;\x3a&quot; | sudo dd of=&quot;/sys/kernel/debug/ec/ec0/io&quot; bs=1 seek=47 count=1 conv=notrunc 2&gt; /dev/null</strong><br />Ждем 2-3с, слышим, что звук увеличился и проверяем значение<br /># <strong>od -Ax -t x1 -j 47 -N 1 /sys/kernel/debug/ec/ec0/io</strong><br />0000<strong>2f</strong> <strong>3a</strong><br />Возвращаем обратно, т.е. устанавливаем значение <strong>4a</strong><br /># echo -n -e &quot;\x4a&quot; | sudo dd of=&quot;/sys/kernel/debug/ec/ec0/io&quot; bs=1 seek=47 count=1 conv=notrunc 2&gt; /dev/null<br />Слышим, что звук притих и проверяем<br /># od -Ax -t x1 -j 47 -N 1 /sys/kernel/debug/ec/ec0/io<br />0000<strong>2f</strong> <strong>4a</strong><br />Все работает и, как видим, ничего не попортили ….<br />Можно, в принципе, производить запись и такой командой<br />#<strong> printf &#39;\x3a&#39; | sudo dd of=&quot;/sys/kernel/debug/ec/ec0/io&quot; bs=1 seek=47 count=1 conv=notrunc 2&gt; /dev/null</strong><br /><br /><strong>2. Полуавтоматический способ управления.</strong><br />Основное отличие от 1 способа - использование готовой программы для упрощения  операций чтения/записи значений регистров  embedded controller . Программа работает только при наличии директории /sys/kernel/debug/ec …... т.е. загрузка модуля ec_sys с параметром write_support=1 обязательна.<br />Пробуем …....<br />1. Загружаем модуль ec_sys<br /># <strong>modprobe ec_sys write_support=1</strong><br />2. Скачиваем исходник программы ec_access.c<br /><strong>wget ftp://<a href="http://ftp.suse.com/pub/people/trenn/sources/ec/ec_access.c">ftp.suse.com/pub/people/trenn/sources/ec/ec_access.c</a></strong><br />3. Компилируем<br />$ <strong>gcc ~/ec_access.c -o ~/ec_access</strong><br />4. Читаем таблицу значений регистров<br /># <strong>~/ec_access -r</strong><br /><pre><code>     00  01  02  03  04  05  06  07  08  09  0A  0B  0C  0D  0E  0F
00:  52  0b  7d  01  18  08  20  43  00  2c  31  9f  03  ff  ff  00
10:  00  3c  00  ff  ff  ff  ff  ff  ff  ff  ff  ff  ff  ff  ff  ff
20:  ff  ff  00  00  00  00  14  01  00  00  00  00  00  00  4a  4a
30:  00  00  14  00  00  23  2c  00  00  00  00  00  00  00  00  00
40:  00  00  00  10  00  00  00  00  00  00  00  00  00  00  00  00
50:  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
60:  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
70:  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00
80:  00  00  04  01  01  01  00  14  0f  01  00  ff  ff  01  00  00
90:  00  01  00  00  00  00  00  00  00  00  00  00  00  00  00  00
A0:  00  00  00  00  00  00  00  00  00  00  00  00  00  c8  00  00
B0:  00  96  00  00  00  64  10  00  00  64  41  00  41  00  ff  e0
C0:  2e  ff  00  00  ff  ff  ff  aa  aa  ff  ff  3f  28  00  00  00
D0:  00  00  00  00  00  6b  ff  ff  02  ff  ff  ff  ff  ff  ff  ff
E0:  74  0b  ff  07  00  b4  00  00  01  00  04  00  ff  ff  ff  00
F0:  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00  00 </code></pre>Как видим очень удобная таблица и видим в регистре 2F знакомое значение 4a. Кстати значение регистра по этой таблице вычислять удобнее.<br />5. Попробуем изменить значение 4a на 3a , как это проделали в способе 1, и заметим, что это проще и все делается в 16-ричном исчислении<br /># <strong>~/ec_access -w 2F -v 3a</strong><br />Проверяем<br /># od -Ax -t x1 -j 47 -N 1 /sys/kernel/debug/ec/ec0/io<br />0000<strong>2f</strong> <strong>3a</strong><br />6. Возвращаем обратно и проверяем<br /># ~/ec_access -w 2F -v 4a<br /># od -Ax -t x1 -j 47 -N 1 /sys/kernel/debug/ec/ec0/io<br />0000<strong>2f</strong> <strong>4a</strong><br />Описания опций программы нет, но их, при желании, можно подсмотреть в исходниках.<br /><br /><strong>3. Автоматический способ управления.</strong><br />При использовании этого способа нам не нужно знать, что существует какой то модуль ec_sys т.е. не нужно заботиться ни о загрузке этого модуля ни о том, что у него имеется параметр  write_support .<br />А поэтому раз у меня этот модуль загружен, то я его выгружу<br /># modprobe -r ec_sys<br />И проверим - $ lsmod | grep ec_sys ….. пусто<br />Этот способ строится на скрипте <strong>acer_ec.pl</strong> , который специально разработали для ноутбука Acer. Насколько я понял в этом ноутбуке, используя  embedded controller, можно управлять не только мощностью вентилятора, но, как пишут, и подсветкой монитора и др. К сожалению данный тип ноутбука мне при работе ни разу не попадал и сказать об этом ничего не могу. Но этот скрипт я применял и на других ноутбуках ….. этот скрипт не привязан конкретно к ноутбуку Acer ….<br />Кстати, в инете по использованию embedded controller с применением этого скрипта, очень много информации — приводить не буду, кому интересно — найдет сам.<br />Пробуем.....<br />1. Скачиваем скрипт. Откуда я его скачал, уже не помню, но нашел на <a href="https://github.com/F0rth/acer_ec/blob/master/acer_ec.pl">GitHub</a> , сверил с имеющимся — и разницы не нашел.<br />2. Читаем таблицу<br /># <strong>perl acer_ec.pl regs</strong><br />Полный вывод не привожу — таблица похожа на таблицу способа 2, но значения регистров приведены в 10-ричном исчислении.<br />Привожу часть таблицы, в которой находятся регистры вентилятора<br />….............. 0E ….... 0F<br />10 …......... 255 …..255<br />20 …......... 75 …....<strong>74</strong><br />Замечу, что 75 — 0x4b , <strong>74</strong> — <strong>0x4a</strong><br />3. Пробуем изменить значение 4a на 3a , как это проделывали раньше<br /># <strong>sudo perl acer_ec.pl := 0x2F 0x3a</strong><br />REG[0x2f] == 0x4a<br />REG[0x2f] := 0x3a<br />REG[0x2f] == 0x4a<br />Проверяем<br /># perl acer_ec.pl regs<br />….............. 0E ….... 0F<br />10 …......... 255 …..255<br />20 …......... 58 …....<strong>58</strong><br />(<strong>58</strong> — <strong>0x3a</strong>)<br />4. Возвращаем все на место и проверяем<br /># perl acer_ec.pl := 0x2F 0x4a<br />REG[0x2f] == 0x3a<br />REG[0x2f] := 0x4a<br />REG[0x2f] == 0x3a<br /># perl acer_ec.pl regs<br />….............. 0E ….... 0F<br />10 …......... 255 …..255<br />20 …......... 75 …....<strong>74</strong><br /><br />Ну вот отработали все 3 способа, все работоспособны, а вот какой использовать — каждый решает сам...... безусловно, 3 способ самый простой.<br /><br /><strong>4. Ну и самое последнее — как же определить нужный регистр.</strong><br />Здесь конкретных рекомендаций нет, все зависит от ситуации и нужна смекалка.<br />Конечно, если параметр в Linux не управляется, то нужно заниматься определением регистра в Windows. Рекомендую для этих целей неплохую программу <strong>RW-Everything</strong>.<br />В этой программе много всяких приблуд, но выбираем <strong>EC</strong> (embedded controller), появится таблица регистров и их значений, аналогичная показанным выше. В этой таблице непрерывно меняются значения. Например, чтобы определить регистры, ответственные за события вентилятора, любой прогой, умеющей управлять мощностью вентилятора, например, NBFC - NoteBook FanControl,  увеличиваем/уменьшаем эту мощность и смотрим в каких регистрах происходит изменение (изменения будут происходит и в других регистрах, но все зависит от ваших действий и наблюдательности). Ну и, конечно, неплохо подстраховаться. Рекомендую     зайти на <a href="https://onedrive.live.com/?authkey=%21AFanCL5ciLnhsyU&amp;id=6C34BD33AC55CE36%21392&amp;cid=6C34BD33AC55CE36">сайт</a> и скачать FanControlConfig для своего ноутбука — этот конфиг является составной частью замечательной проги <strong>NBFC - NoteBook FanControl</strong> (имеется и для Windows и для Linux), а главное в этом конфиге указаны нужные регистры — например, для моего ноутбуках - привожу выдержки из этого конфига<br /><pre><code>&lt;FanControlConfig&gt;
&lt;UniqueId&gt;HP ProBook 4530s&lt;/UniqueId&gt;
&lt;NotebookModel&gt;HP ProBook 4530s&lt;/NotebookModel&gt;
&lt;ReadRegister&gt;46&lt;/ReadRegister&gt;
&lt;WriteRegister&gt;47&lt;/WriteRegister&gt;</code></pre>И как видим, это регистры 46 и 47, что в 16-ричном исчислении соответствует 2E и 2F.<br />Хочу отметить также, что в инете ходят готовые скрипты для управления вентилятором на основе  embedded controller -  управлять как известно, а потому далее необходимо только привязаться к температуре (реперные точки можно выбрать самому или взять из того же  FanControlConfig для нужного ноутбука). Ссылки на скрипты не даю, найти их в инете не сложно.<br /><br />В части подсветки монитора, если у кого входит в управление embedded controller, можно определить регистры и из Linux. Для чего<br />- загружаем модуль<br /># <strong>modprobe ec_sys</strong><br />- запускаем команду<br /># <strong>watch od -Ax -t x1 /sys/kernel/debug/ec/ec0/io</strong><br />и получаем динамическую, непрерывно меняющуюся таблицу значений регистров. Подсветку можно менять в Linux практически всегда, через <strong>xrandr</strong> …. и смотрим в каком регистре меняются цифирки ….<br />Вообщем нужен подход и определить регистр можно всегда.<br /><br />На этом заканчиваю …... и так написал много лишнего ….<br /><br />PS .... в <a href="../17699/index2679.html?page=1">этом</a> топике подметили, что скаченный скрипт acer_ec.pl не работает - а потому выкладываю свой, возможно я его и менял, уже не помню. Но этот, выложенный, работает точно.<br /><pre><code>#!/usr/bin/perl -w

# Copyright (C) 2007  Michael Kurz     michi.kurz (at) googlemail.com
# Copyright (C) 2007  Petr Tomasek     tomasek (#) etf,cuni,cz
# Copyright (C) 2007  Carlos Corbacho  cathectic (at) gmail.com
#
# Version 0.6.1 (2007-11-08)
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
require 5.004;

use strict;
use Fcntl;
use POSIX;
use File::Basename;

sub initialize_ioports
{
  sysopen (IOPORTS, &quot;/dev/port&quot;, O_RDWR)
    or die &quot;/dev/port: $!\n&quot;;
  binmode IOPORTS;
}

sub close_ioports
{
  close (IOPORTS)
    or print &quot;Warning: $!\n&quot;;
}
sub inb
{
  my ($res,$nrchars);
  sysseek IOPORTS, $_[0], 0 or return -1;
  $nrchars = sysread IOPORTS, $res, 1;
  return -1 if not defined $nrchars or $nrchars != 1;
  $res = unpack &quot;C&quot;,$res ;
  return $res;
}

# $_[0]: value to write
# $_[1]: port to write
# Returns: -1 on failure, 0 on success.
sub outb
{
  if ($_[0] &gt; 0xff)
  {
    my ($package, $filename, $line, $sub) = caller(1);
    print &quot;\n*** Called outb with value=$_[1] from line $line\n&quot;,
          &quot;*** (in $sub). PLEASE REPORT!\n&quot;,
          &quot;*** Terminating.\n&quot;;
    exit(-1);
  }
  my $towrite = pack &quot;C&quot;, $_[0];
  sysseek IOPORTS, $_[1], 0 or return -1;
  my $nrchars = syswrite IOPORTS, $towrite, 1;
  return -1 if not defined $nrchars or $nrchars != 1;
  return 0;
}

sub wait_write
{
	my $i = 0;
	while ((inb($_[0]) &amp; 0x02) &amp;&amp; ($i &lt; 10000)) {
		sleep(0.01);
		$i++;
	}
	return -($i == 10000);
}

sub wait_read
{
	my $i = 0;
	while (!(inb($_[0]) &amp; 0x01) &amp;&amp; ($i &lt; 10000)) {
		sleep(0.01);
		$i++;
	}
	return -($i == 10000);
}

sub wait_write_ec
{
	wait_write(0x66);
}

sub wait_read_ec
{
	wait_read(0x66);
}

sub send_ec
{
	if (!wait_write_ec()) { outb($_[0], 0x66); }
	if (!wait_write_ec()) { outb($_[1], 0x62); }
}

sub write_ec
{
	if (!wait_write_ec()) { outb(0x81, 0x66 ); }
	if (!wait_write_ec()) { outb($_[0], 0x62); }
	if (!wait_write_ec()) { outb($_[1], 0x62); }
}

sub read_ec
{
	if (!wait_write_ec()) { outb(0x80, 0x66 ); }
	if (!wait_write_ec()) { outb($_[0], 0x62); }
	if (!wait_read_ec())  { inb(0x62); }
}

sub write_kc
{
	if (!wait_write(0x64)) { outb($_[0], 0x64); }
	if (!wait_write(0x64)) { outb($_[1], 0x60); }
}

sub print_regs
{
	initialize_ioports();

	my @arr = (&quot;00&quot;,&quot;10&quot;,&quot;20&quot;,&quot;30&quot;,&quot;40&quot;,&quot;50&quot;,&quot;60&quot;,&quot;70&quot;,&quot;80&quot;,&quot;90&quot;,&quot;A0&quot;,&quot;B0&quot;,&quot;C0&quot;,&quot;D0&quot;,&quot;E0&quot;,&quot;F0&quot;, &quot;&quot;);

	my $i = 0;
	my $t = 0;
	print &quot;\n  \t00\t01\t02\t03\t04\t05\t06\t07\t|\t08\t09\t0A\t0B\t0C\t0D\t0E\t0F\n&quot;;
	print &quot;  \t__\t__\t__\t__\t__\t__\t__\t__\t|\t__\t__\t__\t__\t__\t__\t__\t__\n&quot;;
	print &quot;00 |\t&quot;;
	for ($i = 0; $i &lt; 256; $i++)
	{
		$t = read_ec($i);
		print $t;
		print &quot;\t&quot;;
		if ((($i + 1) % 8) == 0){
			if ((($i + 1) % 16) == 0) {
				if ($i != 255) { print &quot;\n$arr[(($i-(($i + 1) % 16)) / 16) + 1] |\t&quot;; }
			} else {
				print &quot;|\t&quot;;
			}
		}
	}

	print &quot;\n&quot;;

	close_ioports();
}

sub write_temp
{
	initialize_ioports();
	write_ec($_[0],$_[1]);
	close_ioports();
}

sub testnum
{
	my $i;
	for ($i = 0; $i&lt;256;$i++) {
		if ($_[0] eq &quot;$i&quot;) { return 1 };
	}
	return 0;
}

my $ii;

if (!$ARGV[0]){
        print &quot;wrong arguments!\n&quot;;
	print &quot;usage:\n&quot;;
	print &quot;\&#39;acer_ec regs\&#39; \t\t\t\tdumps all ec registers\n&quot;;
	print &quot;\&#39;acer_ec ledon\&#39; \t\t\t\tswitch on &#39;mail LED&#39; (WMID)\n&quot;;
	print &quot;\&#39;acer_ec ledoff\&#39; \t\t\t\tswitch off &#39;mail LED&#39; (WMID)\n&quot;;
	print &quot;\&#39;acer_ec getled\&#39; \t\t\t\tget &#39;mail LED&#39; status (WMID)\n&quot;;
	print &quot;\&#39;acer_ec getled2\&#39; \t\t\t\tget &#39;mail LED&#39; status(AMW0)\n&quot;;
	print &quot;\&#39;acer_ec getwireless\&#39; \t\t\t\tget &#39;wireless&#39; status (AMW0)\n&quot;;
	print &quot;\&#39;acer_ec gettouch\&#39; \t\t\t\tis the touchpad disabled?\n&quot;;
	print &quot;\&#39;acer_ec setfanthresh &lt;temp&gt;\&#39; \t\t\t\tset temperature threshhold to &lt;temp&gt;, DANGEROUS!\n&quot;;
	print &quot;\&#39;acer_ec getfanthresh\&#39; \t\t\t\tget temperature threshhold\n&quot;;
	print &quot;\&#39;acer_ec &lt;temp-number&gt; &lt;temperature&gt;\&#39; \tfor setting a temperature\n&quot;;
	print &quot;where &lt;temp-number&gt; is from 0-7, and &lt;temperture&gt; is from 0-255\n&quot;;
	print &quot;\&#39;acer_ec ?= &lt;reg&gt;\&#39; \t\tQuery register&#39;s value\n&quot;;
	print &quot;\&#39;acer_ec := &lt;reg&gt; &lt;val&gt;\&#39; \tSet register&#39;s value\n&quot;;
	print &quot;\&#39;acer_ec +f &lt;reg&gt; &lt;val&gt;\&#39; \tOr register&#39;s value with val (to set flags)\n&quot;;
	print &quot;\&#39;acer_ec -f &lt;reg&gt; &lt;val&gt;\&#39; \tAnd register&#39;s value with ~val (to clear flags)\n&quot;;
	print &quot;\&#39;forcekc\&#39; \tTry all possible values on writeable RAM of keyboard controller\n&quot;;
	print &quot;\&#39;kcw &lt;cmd&gt; &lt;val&gt;\&#39; \tWrite a command and a value to the keyboard controller\n&quot;;
} elsif ($ARGV[0] eq &quot;regs&quot;) {
	print_regs();
} elsif ($ARGV[0] eq &quot;getled&quot;) {
	# TM2490 only (WMID)
	initialize_ioports();
	if (read_ec(0x9f)&amp;0x01) {
		print &quot;Mail LED on\n&quot;;
	} else {
		print &quot;Mail LED off\n&quot;; }
	close_ioports();
} elsif ($ARGV[0] eq &quot;getled2&quot;) {
	# Aspire 5020 only (AMW0)
	initialize_ioports();
	if (read_ec(0x0A)&amp;0x80) {
		print &quot;Mail LED on\n&quot;;
	} else {
		print &quot;Mail LED off\n&quot;; }
	close_ioports();
} elsif ($ARGV[0] eq &quot;getwireless&quot;) {
	# Aspire 5020 only (AMW0)
	initialize_ioports();
	if (read_ec(0x0A)&amp;0x4) {
		print &quot;Wireless on\n&quot;;
	} else {
		print &quot;Wireless off\n&quot;; }
	close_ioports();
} elsif ($ARGV[0] eq &quot;gettouch&quot;) {
	# TM2490 only - needs testing
	initialize_ioports();
	if (read_ec(0x9e)&amp;0x08) {
		print &quot;touchpad disabled\n&quot;;
	} else {
		print &quot;touchpad enabled\n&quot;; }
	close_ioports();
} elsif ($ARGV[0] eq &quot;?=&quot;) {
	initialize_ioports();
	my $r = hex($ARGV[1]);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, read_ec($r));
	close_ioports();
} elsif ($ARGV[0] eq &quot;:=&quot;) {
	initialize_ioports();
	my $r = hex($ARGV[1]);
	my $f = hex($ARGV[2]);
	my $val = read_ec($r);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, $val);
	printf(&quot;REG[0x%02x] := 0x%02x\n&quot;, $r, $f);
        write_ec( $r, $f);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, read_ec($r));
	close_ioports();
} elsif ($ARGV[0] eq &quot;+f&quot;) {
	initialize_ioports();
	my $r = hex($ARGV[1]);
	my $f = hex($ARGV[2]);
	my $val = read_ec($r);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, $val);
	printf(&quot;REG[0x%02x] := 0x%02x\n&quot;, $r, $val | $f);
        write_ec( $r, $val | $f);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, read_ec($r));
	close_ioports();
} elsif ($ARGV[0] eq &quot;-f&quot;) {
	initialize_ioports();
	my $r = hex($ARGV[1]);
	my $f = hex($ARGV[2]);
	my $val = read_ec($r);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, $val);
	printf(&quot;REG[0x%02x] := 0x%02x\n&quot;, $r, $val &amp; ~$f);
        write_ec( $r, $val &amp; ~$f);
	printf(&quot;REG[0x%02x] == 0x%02x\n&quot;, $r, read_ec($r));
	close_ioports();
} elsif ($ARGV[0] eq &quot;ledon&quot;) {
	# TM2490 only - needs testing
	initialize_ioports();
	if (!wait_write(0x64)) { outb(0x59, 0x64); }
	if (!wait_write(0x64)) { outb(0x92,   0x60); }
	close_ioports();
} elsif ($ARGV[0] eq &quot;ledoff&quot;) {
	# TM2490 only - needs testing
	initialize_ioports();
	if (!wait_write(0x64)) { outb(0x59, 0x64); }
	if (!wait_write(0x64)) { outb(0x93,   0x60); }
	close_ioports();
} elsif ($ARGV[0] eq &quot;getfanthresh&quot;) {
	initialize_ioports();
	$ii=read_ec(0xa9);
	close_ioports();
        print &quot;Temperature threshhold: $ii (celsius)\n&quot;;
} elsif (($ARGV[0] eq &quot;setfanthresh&quot;) &amp;&amp; testnum($ARGV[1])) {
	write_temp(0xA9,$ARGV[1]);
} elsif ($ARGV[0] eq &quot;setbright&quot;) {
	# Aspire 5020 only (AMW0)
	if ($ARGV[1] &gt;= 0 &amp;&amp; $ARGV[1] &lt;= 15) {
		write_temp(0x83, $ARGV[1]);
	} else {
		print &quot;second argument must be a number between 0 and 15\n&quot;;
	}
} elsif ($ARGV[0] eq &quot;forcekc&quot;) {
	# Be smart - we only send the commands for writing to keyboard RAM
	initialize_ioports();
	my ($kbdata, $cont, $kbreg);
	for ($kbreg = 0x40; $kbreg &lt;= 0x5f; $kbreg++) {
		for ($kbdata = 0; $kbdata &lt; 256; $kbdata++) {
			write_kc($kbreg, $kbdata);

			print sprintf(&quot;%0#4x&quot;, $kbreg), &quot;, &quot;, sprintf(&quot;%0#4x&quot;, $kbdata), &quot;\n&quot;;
			print &quot;Continue? y/n: &quot;;
			$cont = &lt;STDIN&gt;;
			if ($cont eq &quot;n&quot;) {
				last;
			}
		}
	}
	close_ioports();
} elsif ($ARGV[0] eq &quot;kcw&quot;) {
	initialize_ioports();
	write_kc($ARGV[1], $ARGV[2]);
	close_ioports();
} else {
	print &quot;wrong arguments!\n&quot;;
}</code></pre><br />Дополнение.<br />После применения скрипта, точнее перевода управлением куллера из автоматического режима в ручной, этот режим таковым и останется до выключения компьютера (сброс только при выключении, при reboot может не сработать).<br />Чтобы перевести куллер снова в автоматический режим, нужно ввести соответствующее значение в соответствующий регистр. Смотреть  <a href="https://onedrive.live.com/?authkey=%21AFanCL5ciLnhsyU&amp;id=6C34BD33AC55CE36%21392&amp;cid=6C34BD33AC55CE36">здесь</a> для своего ноута.<br />Мой случай<br />записать в регистр <u>2F (регистр записи)</u> значение<strong> FF</strong><br /><strong>sudo perl acer_ec.pl := 0x2F 0xFF</strong><br />Использовал для этого информацию конфига для моего ноута, а точнее строку<br />&lt;FanSpeedResetValue&gt;<strong>255</strong>&lt;/FanSpeedResetValue&gt;
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-175067"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/ghost/index.html">
                <span class="post-username">ghost</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/175067/index.html">#</a>
            5 лет, 11 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/ghost/topics/index.html">
                    26
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/ghost/posts/index.html">
                    632
                </a>
            </div>
            <div>
                Участник с: 07 мая 2013
            </div>
            
        </td>
        <td class="post-content">
            основательно пишешь, продолжай в том же духе. vasek - в твоих блогах узнаю много интересного и полезного...
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-175504"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Sheykhnur/index.html">
                <span class="post-username">Sheykhnur</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/175504/index.html">#</a>
            5 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/d1/b6/d1b62754f45b5c4a783cd15c795c84b5.png" alt="Sheykhnur avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Sheykhnur/topics/index.html">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Sheykhnur/posts/index.html">
                    244
                </a>
            </div>
            <div>
                Участник с: 05 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vasek</em><br>опять написал ерунду, чтобы показать себя...</blockquote>Вот если бы все писали вот такую ерунду, насколько жить было бы легче! А статья действительно полезная. Таких статей — тех, которые по существу, всегда мало.
            
                
                    <div class="post-signature">
                        root@vpupkin# cat /dev/ass &gt; /dev/head
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-192973"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/192973/index.html">#</a>
            5 лет, 1 месяц назад
            
                (отредактировано
                
                    5 лет, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Сделал два дополнения<br />1) привел работающий скрипт acer_ec.pl<br />2) перевод управления куллером из ручного режима в автоматический из работающей системы, без выключения компьютера.<br /><br />Дополнения сделаны при обсуждении проблемы в этом <a href="../17699/index2679.html?page=1">топике</a>, <strong>за что благодарен всем, принимавшим  участие в обсуждении</strong>.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-210168"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/210168/index.html">#</a>
            3 года, 10 месяцев назад
            
                (отредактировано
                
                    3 года, 10 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <strong>Внес изменение</strong> - сейчас модуль <strong>ec_sys</strong> встроен в ядро<br /><strong>zgrep ACPI_EC /proc/config.gz</strong><br /><pre><code>CONFIG_ACPI_EC_DEBUGFS=y</code></pre>то есть модуль загружать не нужно, чтение значений регистров будет работать без загрузки модуля<br />Но значение параметра  write_support=N<br /><strong>sudo cat /sys/module/ec_sys/parametyers/write_support</strong><br />N<br />и чтобы выполнить запись в регистр нужно загрузиться с параметром write_support=1, точнее - <strong>ec_sys.write_support=1</strong>
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218632"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Morisson/index.html">
                <span class="post-username">Morisson</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218632/index.html">#</a>
            3 года, 2 месяца назад
            
                (отредактировано
                
                    3 года, 2 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fc/2a/fc2a5885cc81044b2e305ed013376ff2.png" alt="Morisson avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Morisson/topics/index.html">
                    18
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Morisson/posts/index.html">
                    1408
                </a>
            </div>
            <div>
                Участник с: 11 января 2017
            </div>
            
        </td>
        <td class="post-content">
            <a href="http://lostpic.net/image/rdOn"><img src="http://img16.lostpic.net/2019/07/03/0b4d6547095a42247119464e70f97bb6.th.png"></a><br />Верхний- до повышени оборотов<br />Нижний- после повышения..<br />Как найти эти чертовы регистры чтения и записи?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218633"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Morisson/index.html">
                <span class="post-username">Morisson</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218633/index.html">#</a>
            3 года, 2 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fc/2a/fc2a5885cc81044b2e305ed013376ff2.png" alt="Morisson avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Morisson/topics/index.html">
                    18
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Morisson/posts/index.html">
                    1408
                </a>
            </div>
            <div>
                Участник с: 11 января 2017
            </div>
            
        </td>
        <td class="post-content">
            Вроде как бы все нормально, но кулер останавливается только в районе ниже 40 градусов. Т.е. постоянно потихонечку тарахтит постоянно.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218635"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Morisson/index.html">
                <span class="post-username">Morisson</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218635/index.html">#</a>
            3 года, 2 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fc/2a/fc2a5885cc81044b2e305ed013376ff2.png" alt="Morisson avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Morisson/topics/index.html">
                    18
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Morisson/posts/index.html">
                    1408
                </a>
            </div>
            <div>
                Участник с: 11 января 2017
            </div>
            
        </td>
        <td class="post-content">
            Или может попробовать через DSDT, что вроде как даже полегче.. Только вот у себя секцию с вентилятором найти не могу
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218638"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218638/index.html">#</a>
            3 года, 2 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>Morisson</em><br>Или может попробовать через DSDT, что вроде как даже полегче.. Только вот у себя секцию с вентилятором найти не могу</blockquote>Если править DSDT, то нужно понять как устроено управление мощностью вентилятора. Есть несколько способов, например, динамическое изменение (как правило в случае отдельно установленного вентилятора), а есть и ступенчатое, как правило при установке одного вентилятора. У меня, например, стоит 3 спупени - при достижении верхней границы диапазона/ступени возрастает мощность вентилятора. Эти ступени можно грубо определить на слух.<br />Эти же ступени должны быть описаны и в DSDT, например, в моем случае верхняя граница одной из ступени 52 град.С (34 в 16-ричной системе)<br /><pre><code>Method (_TMP, 0, Serialized)  // _TMP: Temperature
            {
                Return (GDTP (0x34, 0x00))
            }</code></pre>Там же должны быть описаны trip_point температурные точки (посмотреть их можно в /sys/class/thermal/thermal_zone*).<br />Как то так - но давно не разбирался с этим, а потому многое уже и забылось, могу в чем то и ошибаться.<br /><br /><strong>PS</strong> - но можно еще применить и прогу для управления мощностью вентилятором, которая позволяет изменять значения температуры (как то приводил в одном из топиков)
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218639"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218639/index.html">#</a>
            3 года, 2 месяца назад
            
                (отредактировано
                
                    3 года, 2 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>Morisson</em><br>Верхний- до повышени оборотов<br />Нижний- после повышения..</blockquote>Посмотрел мельком и удивился - очень много измененных значений регистров. <u>С одной стороны  это и хорошо - многие параметры заведены на контролер</u>.<br />Смотреть доволно утомительно (плохо читается картинка), но если смотреть значения, которые изменились на много, то можно выделить следующие регистры<br /><strong>PS</strong> - не учитывал регистры, значения в которых увеличились (чем меньше значение в регистре, тем больше  значение параметра).<br /><pre><code> xx  -  yy (строка - столбец), в скобках значения до и после.
10 -  03 (245/53)
C0 - 02 (139/111)
D0 - 02 (136/65)
C0 - 06 (225/74)</code></pre>Но, имхо, вряд ли это то, что нужно. Рекомендую следующее<br />Сначала определиться с типом управления мощностью вентилятора (если ступенчато, то хорошо заметно на слух)<br />Лучше использовать не скрипт acer_ec.pl , а на прямую (системные значения) - лучше картинка и сразу в 16-ричном исчислении (у меня и hexdump и od прописаны в sudoers)<br /><pre><code>sudo od -Ax -t x1 /sys/kernel/debug/ec/ec0/io</code></pre>Фиксируем вывод при низкой температуре, увеличиваем температуру градусов до 60-65 и снова фиксируем и еще раз  увеличиваем температуру градусов до 80 и снова фиксируем.<br />Отбираем регистры, значения в которых существенно уменьшились.<br />А вот дальше можно и пощупать эти регистры в плотную, например, используя следующий скрипт (хоть замеры и идут в разное время, но кореляция хорошо заметна)<br /><strong>cat ~/TTT/TEST/bash/ec.sh</strong><br /><pre><code>#!/bin/bash
#
while true ; do
VAL_REG=$(sudo od -Ax -t x1 /sys/kernel/debug/ec/ec0/io | awk &#39;{print $16}&#39; | awk &#39;(NR == 3)&#39;)
Tsys=$(awk &#39;{ print $1/1000 }&#39; /sys/class/thermal/thermal_zone6/temp)
echo &quot;$VAL_REG  ...  $Tsys&quot;
sleep 1
done
#
exit 0</code></pre><strong>PS</strong> - awk &#39;{print $16}&#39; | awk &#39;(NR == 3)&#39; - проверяется регистр 2E, расположенный в 16 столбце и в 3 строке<br />Температуру повышал, используя утилиту<strong> stress</strong> - запускаю в одном терминале скрипт показаний регистра, в другом утилиту stress секунд на 15-20 (пример запуска приведен в stress --help)<br />Пример вывода скрипта (1-ая колонка - показания регистра, 2-ая колонка показания температуры)<br /><pre><code>4b  ...  53
4a  ...  67
4a  ...  68
4a  ...  68
4a  ...  69
44  ...  70
42  ...  70
41  ...  70
3e  ...  71
3c  ...  72
3b  ...  72
3c  ...  72
3c  ...  73
3b  ...  62</code></pre><br /><strong>PS</strong> - я 1-ый раз смотрел из винды (есть одна неплохая прога), меняя обороты вентилятора с помощью проги (для fan) - заметил несколько регистров. А дальше уже проверял их в Linux.<br /><br /><strong>EDIT 1</strong> - можно еще попробовать поставить из AUR <strong>nbfc</strong> - контроль/управление вентилятором на основе этих самых регистров. Когда то давно пытался с ней поэкспериментировать, но до конца так дело и не дошло, проще оказалось ручками, если знаешь регистры. Но вот не помню, есть ли там база данных этих регистров для разных ноутбуков или же вписываешь сам.<br /><strong>yay -Ss nbfc</strong><br /><u>aur/nbfc-git</u> 1.6.3.r9.g4699d17-1 (+2 0.55%)<br />    Cross-platform fan control service for notebooks (Development version)<br /><u>aur/nbfc</u> 1.6.3-1 (+6 0.78%)<br />    Cross-platform fan control service for notebooks (STABLE &amp; BETA releases)
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/indexc704.html?next=/forum/topic/16516/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/16516/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:10:57 GMT -->
</html>
