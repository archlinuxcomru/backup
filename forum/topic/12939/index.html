


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        [РЕШЕНО] Не работает TRIM на SSD
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    

    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/12/">Ядро и Железо</a> <span class="divider">/</span></li>
            
        
        
            <li>[РЕШЕНО] Не работает TRIM на SSD</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>[РЕШЕНО] Не работает TRIM на SSD</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127640"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/rec/">
                <span class="post-username">rec</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127640/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/59/e6/59e633eaa20e7c7212550c73859984bf.png" alt="rec avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/rec/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/rec/posts/">
                    86
                </a>
            </div>
            <div>
                Участник с: 24 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            На новом буке UH572 наблюдаю следующую картину:<br/>1. SSD-диск отформатирован в ext4 с параметром "-E discard"<br/>2. В /etc/fstab:<br/><div class="code"><pre># /dev/sdb2
UUID=dd49483f-f3a8-430f-bf51-56216d1b3c3d	/         	ext4      	rw,noatime,discard	0 1</pre></div>3. Вывод mount:<br/><div class="code"><pre>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ddafb2b2a99db9b8abb0bcbeb5b4b3b8">[email&#160;protected]</a> /]# mount | grep sd
...
/dev/sdb2 on / type ext4 (rw,noatime,discard,data=ordered)
...</pre></div><strong>НО:</strong><br/>Сделанный по этой <a href="http://techgage.com/article/enabling_and_testing_ssd_trim_support_under_linux/">ссылке</a> тест показывает не 0000, как должно быть, а цыферки:<br/><div class="code"><pre>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="05776a6a71456160736864666d6c6b60">[email&#160;protected]</a> /]# seq 1 1000 &gt; testfile
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bac8d5d5cefadedfccd7dbd9d2d3d4df">[email&#160;protected]</a> /]# hdparm --fibmap testfile
testfile:
 filesystem blocksize 4096, begins at LBA 2099200; assuming 512 byte sectors.
 byte_offset  begin_LBA    end_LBA    sectors
           0       -          -          -
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ceef3f3e8dcf8f9eaf1fdfff4f5f2f9">[email&#160;protected]</a> /]# hdparm --fibmap testfile
testfile:
 filesystem blocksize 4096, begins at LBA 2099200; assuming 512 byte sectors.
 byte_offset  begin_LBA    end_LBA    sectors
           0    2369544    2369551          8
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d6a4b9b9a296b2b3a0bbb7b5bebfb8b3">[email&#160;protected]</a> /]# sync
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c1b3aeaeb581a5a4b7aca0a2a9a8afa4">[email&#160;protected]</a> /]# hdparm --read-sector 2369544 /dev/sdb
/dev/sdb:
reading sector 2369544: succeeded
0a31 0a32 0a33 0a34 0a35 0a36 0a37 0a38
0a39 3031 310a 0a31 3231 310a 0a33 3431
310a 0a35 3631 310a 0a37 3831 310a 0a39
3032 320a 0a31 3232 320a 0a33 3432 320a
0a35 3632 320a 0a37 3832 320a 0a39 3033
330a 0a31 3233 330a 0a33 3433 330a 0a35
3633 330a 0a37 3833 330a 0a39 3034 340a
0a31 3234 340a 0a33 3434 340a 0a35 3634
340a 0a37 3834 340a 0a39 3035 350a 0a31
3235 350a 0a33 3435 350a 0a35 3635 350a
0a37 3835 350a 0a39 3036 360a 0a31 3236
360a 0a33 3436 360a 0a35 3636 360a 0a37
3836 360a 0a39 3037 370a 0a31 3237 370a
0a33 3437 370a 0a35 3637 370a 0a37 3837
370a 0a39 3038 380a 0a31 3238 380a 0a33
3438 380a 0a35 3638 380a 0a37 3838 380a
0a39 3039 390a 0a31 3239 390a 0a33 3439
390a 0a35 3639 390a 0a37 3839 390a 0a39
3031 0a30 3031 0a31 3031 0a32 3031 0a33
3031 0a34 3031 0a35 3031 0a36 3031 0a37
3031 0a38 3031 0a39 3131 0a30 3131 0a31
3131 0a32 3131 0a33 3131 0a34 3131 0a35
3131 0a36 3131 0a37 3131 0a38 3131 0a39
3231 0a30 3231 0a31 3231 0a32 3231 0a33
3231 0a34 3231 0a35 3231 0a36 3231 0a37
3231 0a38 3231 0a39 3331 0a30 3331 0a31
3331 0a32 3331 0a33 3331 0a34 3331 0a35
3331 0a36 3331 0a37 3331 0a38 3331 0a39
3431 0a30 3431 0a31 3431 0a32 3431 0a33
3431 0a34 3431 0a35 3431 0a36 3431 0a37
3431 0a38 3431 0a39 3531 0a30 3531 0a31
3531 0a32 3531 0a33 3531 0a34 3531 0a35
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="98eaf7f7ecd8fcfdeef5f9fbf0f1f6fd">[email&#160;protected]</a> /]# rm testfile
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d3a1bcbca793b7b6a5beb2b0bbbabdb6">[email&#160;protected]</a> /]# sync
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a0d2cfcfd4e0c4c5d6cdc1c3c8c9cec5">[email&#160;protected]</a> /]# hdparm --read-sector 2369544 /dev/sdb
/dev/sdb:
reading sector 2369544: succeeded
0a31 0a32 0a33 0a34 0a35 0a36 0a37 0a38
0a39 3031 310a 0a31 3231 310a 0a33 3431
310a 0a35 3631 310a 0a37 3831 310a 0a39
3032 320a 0a31 3232 320a 0a33 3432 320a
0a35 3632 320a 0a37 3832 320a 0a39 3033
330a 0a31 3233 330a 0a33 3433 330a 0a35
3633 330a 0a37 3833 330a 0a39 3034 340a
0a31 3234 340a 0a33 3434 340a 0a35 3634
340a 0a37 3834 340a 0a39 3035 350a 0a31
3235 350a 0a33 3435 350a 0a35 3635 350a
0a37 3835 350a 0a39 3036 360a 0a31 3236
360a 0a33 3436 360a 0a35 3636 360a 0a37
3836 360a 0a39 3037 370a 0a31 3237 370a
0a33 3437 370a 0a35 3637 370a 0a37 3837
370a 0a39 3038 380a 0a31 3238 380a 0a33
3438 380a 0a35 3638 380a 0a37 3838 380a
0a39 3039 390a 0a31 3239 390a 0a33 3439
390a 0a35 3639 390a 0a37 3839 390a 0a39
3031 0a30 3031 0a31 3031 0a32 3031 0a33
3031 0a34 3031 0a35 3031 0a36 3031 0a37
3031 0a38 3031 0a39 3131 0a30 3131 0a31
3131 0a32 3131 0a33 3131 0a34 3131 0a35
3131 0a36 3131 0a37 3131 0a38 3131 0a39
3231 0a30 3231 0a31 3231 0a32 3231 0a33
3231 0a34 3231 0a35 3231 0a36 3231 0a37
3231 0a38 3231 0a39 3331 0a30 3331 0a31
3331 0a32 3331 0a33 3331 0a34 3331 0a35
3331 0a36 3331 0a37 3331 0a38 3331 0a39
3431 0a30 3431 0a31 3431 0a32 3431 0a33
3431 0a34 3431 0a35 3431 0a36 3431 0a37
3431 0a38 3431 0a39 3531 0a30 3531 0a31
3531 0a32 3531 0a33 3531 0a34 3531 0a35</pre></div><br/>И теперь я не могу ни есть, ни спать, представляя, как изнашивается мой SSD. Подскажите, как активировать TRIM или, может быть, я неправильно тест делаю?<br/><br/>PS. SSD разбит на 2 раздела - sdb1 = /boot/efi и sdb2=/
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127647"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/elsonador/">
                <span class="post-username">elsonador</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127647/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/c4/74/c4744210be47d6c1692ba03d7d1a5b83.png" alt="elsonador avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/elsonador/topics/">
                    63
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/elsonador/posts/">
                    996
                </a>
            </div>
            <div>
                Участник с: 09 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Модель ноутбука и диска надо угадать?<br/><br/>Если что, <strong>UH572</strong> есть в нескольких вариантах.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127649"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/rec/">
                <span class="post-username">rec</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127649/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/59/e6/59e633eaa20e7c7212550c73859984bf.png" alt="rec avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/rec/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/rec/posts/">
                    86
                </a>
            </div>
            <div>
                Участник с: 24 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            Ultrabook Fujitsu LIFEBOOK UH572 (VFY:UH572MC7B2RU)<br/>и<br/>SanDisk SSD i100 32GB
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127653"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/elsonador/">
                <span class="post-username">elsonador</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127653/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/c4/74/c4744210be47d6c1692ba03d7d1a5b83.png" alt="elsonador avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/elsonador/topics/">
                    63
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/elsonador/posts/">
                    996
                </a>
            </div>
            <div>
                Участник с: 09 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <strong>TRIM</strong> вручную работает?<br/><br/>А именно, <strong>sudo fstrim -v /</strong>. Должно срезать всё свободное пространство. Если нет - проблема.<br/><br/>Если вручную действует, забить это в скрипт и выполнять время от времени по расписанию.<br/><br/><strike><strong>discard</strong>, по-моему, не действует совсем.</strike><br/>Гоню, отлично работает.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127659"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/rec/">
                <span class="post-username">rec</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127659/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/59/e6/59e633eaa20e7c7212550c73859984bf.png" alt="rec avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/rec/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/rec/posts/">
                    86
                </a>
            </div>
            <div>
                Участник с: 24 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            <div class="code"><pre>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bcced3d3c8fcd8d9cad1dddfd4d5d2d9">[email&#160;protected]</a> rec]# fstrim -v /
/: 26.9 GiB (28872544256 bytes) trimmed</pre></div>?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127661"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/elsonador/">
                <span class="post-username">elsonador</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127661/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/c4/74/c4744210be47d6c1692ba03d7d1a5b83.png" alt="elsonador avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/elsonador/topics/">
                    63
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/elsonador/posts/">
                    996
                </a>
            </div>
            <div>
                Участник с: 09 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Свободно сколько?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127662"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/User6260/">
                <span class="post-username">User6260</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127662/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fc/35/fc3531608457dc39b30d7737c0048977.png" alt="User6260 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/User6260/topics/">
                    1
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/User6260/posts/">
                    53
                </a>
            </div>
            <div>
                Участник с: 08 мая 2013
            </div>
            
        </td>
        <td class="post-content">
            А журналирование включено? Если журнал отключен на ext4, то автоматически TRIM работать не будет(год назад не работал) и пришлось добавлять по крону вызов fstrim. Может сейчас починили уже?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127665"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/rec/">
                <span class="post-username">rec</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127665/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/59/e6/59e633eaa20e7c7212550c73859984bf.png" alt="rec avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/rec/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/rec/posts/">
                    86
                </a>
            </div>
            <div>
                Участник с: 24 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>elsonador</em><br/>Свободно сколько?</blockquote>Вчера систему поставил, почти пусто везде:<br/><div class="code"><pre>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f1839e9e85b19594879c909299989f94">[email&#160;protected]</a> rec]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb2        29G  1.4G   26G   6% /</pre></div><br/><blockquote><em>User6260</em><br/>А журналирование включено? </blockquote>Да, включено:<br/><div class="code"><pre>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="75071a1a01351110031814161d1c1b10">[email&#160;protected]</a> rec]# dumpe2fs /dev/sdb2 | grep features
dumpe2fs 1.42.8 (20-Jun-2013)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Journal features:         journal_incompat_revoke</pre></div>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127788"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/nomad/">
                <span class="post-username">nomad</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127788/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/nomad/topics/">
                    6
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/nomad/posts/">
                    87
                </a>
            </div>
            <div>
                Участник с: 25 марта 2013
            </div>
            
        </td>
        <td class="post-content">
            В свое время использовал такой скрипт<br/><div class="code"><pre>#!/bin/bash
#
if [ $# -ne 3 ]; then
echo
echo "Usage: $0 "
echo
echo " is a temporary file for the test"
echo " is the file size in MB"
echo " is the device being tested, e.g. /dev/sda"
echo
echo "Example: $0 tempfile 5 /dev/sda"
echo
echo "This would run the test for /dev/sda creating a"
echo "temporary file named \"tempfile\" with 5 MB"
echo
exit 1
fi
FILE="$1"
SIZE=$2
DEVICE="$3"
# Create the temporary file
dd if=/dev/urandom of="$FILE" count=1 bs=${SIZE}M oflag=direct
sync
# Get the address of the first sector
hdparm --fibmap "$FILE"
SECTOR=`hdparm --fibmap "$FILE" | tail -n1 | awk '{ print $2; }'`
# Read the first sector prior to deletion
hdparm --read-sector $SECTOR "$DEVICE"
echo
echo "This is a sector of the file. It should have been successfully read"
echo "and show a bunch of random data."
echo
read -n 1 -p "Press any key to continue..."
# Delete the file and re-read the sector
rm -f $FILE
sync
echo
echo "File deleted. Sleeping for 120 seconds before re-reading the sector."
echo "If TRIM is working, you should see all 0s now."
sleep 5
hdparm --read-sector $SECTOR "$DEVICE"
echo
echo "If the sector isn't filled with 0s, something is wrong with your"
echo "configuration. Try googling for \"TRIM SSD Linux\"."
echo
exit 0</pre></div><br/>Сейчас запустил и получил такой вывод<br/><br/><div class="code"><pre><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="412f2e2c202501203322296c2524322a352e31">[email&#160;protected]</a>:~/docs $ sudo ./trim.sh tempfile 20 /dev/sda
1+0 записей получено
1+0 записей отправлено
 скопировано 20971520 байт (21 MB), 6,27998 c, 3,3 MB/c
tempfile:
 filesystem blocksize 4096, begins at LBA 63; assuming 512 byte sectors.
 byte_offset  begin_LBA    end_LBA    sectors
           0     360511     376894      16384
     8388608  145588287  145604670      16384
    16777216  145768511  145776702       8192
/dev/sda:
reading sector 145768511: FAILED: Input/output error
This is a sector of the file. It should have been successfully read
and show a bunch of random data.
Press any key to continue...
File deleted. Sleeping for 120 seconds before re-reading the sector.
If TRIM is working, you should see all 0s now.
/dev/sda:
reading sector 145768511: FAILED: Input/output error</pre></div><br/>Накрывается накопитель? О_о
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-127826"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/elsonador/">
                <span class="post-username">elsonador</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/127826/">#</a>
            8 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/c4/74/c4744210be47d6c1692ba03d7d1a5b83.png" alt="elsonador avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/elsonador/topics/">
                    63
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/elsonador/posts/">
                    996
                </a>
            </div>
            <div>
                Участник с: 09 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Если записать в этот сектор ноль, чтение работает?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/12939/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747b384c0f427b17',m:'bTE69H.kkVXY.CGLOLSxZbpX9Yc1eFJvWWm3oqQ8BvU-1662677192-0-AVabOjM3qU6D5GLwsb9Z5gOalKAo4YcbJEOSAiZY1ATOXCysPOdcjk8HD8q54VFoMrPF+25CRFsIOAQigIh2qTC7uKz+AhTSp067Ad1nC8N9iy+geeBTIPRMK0FlEOK29NLxtct3HAQnFV1EGfTmZr8=',s:[0xf55eda6a15,0x6247ce8534],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
