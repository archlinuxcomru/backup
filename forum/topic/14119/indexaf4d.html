


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        [РЕШЕНО] Как настроить отправку почты?
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/13/">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>[РЕШЕНО] Как настроить отправку почты?</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>[РЕШЕНО] Как настроить отправку почты?</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=4" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=5">5 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-144229"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/neobrave/">
                <span class="post-username">neobrave</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/144229/">#</a>
            7 лет, 10 месяцев назад
            
                (отредактировано
                
                    7 лет, 10 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/neobrave/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/neobrave/posts/">
                    64
                </a>
            </div>
            <div>
                Участник с: 22 октября 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>palpalych</em><br>поделитесь, ибо я профан, намучался, пока безрезультатно...<br />есть подозрения что корень проблем в настройках php</blockquote><br />Снаскоку сразу сам не нашел... Вот работающий пример, который был установлен еще на моих ранних сайтах (без какой либо cms). Настройка проста до безобразия. В каталог с файлом, где находится форма кидаем 2 файлика <strong>class.phpmailer.php</strong>, <strong>class.smtp.php</strong>.<br />Видел на гидхабе, но возможно они много что поменяли уже... Здесь 100% рабочие.<br /><strong>class.phpmailler.php</strong><br /><pre><code>&lt;?php
////////////////////////////////////////////////////
// PHPMailer - PHP email class
//
// Class for sending email using either
// sendmail, PHP mail(), or SMTP.  Methods are
// based upon the standard AspEmail(tm) classes.
//
// Copyright (C) 2001 - 2003  Brent R. Matzelle
//
// License: LGPL, see LICENSE
////////////////////////////////////////////////////

/**
 * PHPMailer - PHP email transport class
 * @package PHPMailer
 * @author Brent R. Matzelle
 * @copyright 2001 - 2003 Brent R. Matzelle
 */
class PHPMailer
{
    /////////////////////////////////////////////////
    // PUBLIC VARIABLES
    /////////////////////////////////////////////////

    /**
     * Email priority (1 = High, 3 = Normal, 5 = low).
     * @var int
     */
    var $Priority          = 3;

    /**
     * Sets the CharSet of the message.
     * @var string
     */
    var $CharSet           = &quot;windows-1251&quot;;

    /**
     * Sets the Content-type of the message.
     * @var string
     */
    var $ContentType        = &quot;text/plain&quot;;

    /**
     * Sets the Encoding of the message. Options for this are &quot;8bit&quot;,
     * &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.
     * @var string
     */
    var $Encoding          = &quot;8bit&quot;;

    /**
     * Holds the most recent mailer error message.
     * @var string
     */
    var $ErrorInfo         = &quot;&quot;;

    /**
     * Sets the From email address for the message.
     * @var string
     */
    var $From               = &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="acdec3c3d8ecc0c3cfcdc0c4c3dfd8">[email&#160;protected]</a>&quot;;

    /**
     * Sets the From name of the message.
     * @var string
     */
    var $FromName           = &quot;Root User&quot;;

    /**
     * Sets the Sender email (Return-Path) of the message.  If not empty,
     * will be sent via -f to sendmail or as &#39;MAIL FROM&#39; in smtp mode.
     * @var string
     */
    var $Sender            = &quot;&quot;;

    /**
     * Sets the Subject of the message.
     * @var string
     */
    var $Subject           = &quot;&quot;;

    /**
     * Sets the Body of the message.  This can be either an HTML or text body.
     * If HTML then run IsHTML(true).
     * @var string
     */
    var $Body               = &quot;&quot;;

    /**
     * Sets the text-only body of the message.  This automatically sets the
     * email to multipart/alternative.  This body can be read by mail
     * clients that do not have HTML email capability such as mutt. Clients
     * that can read HTML will view the normal Body.
     * @var string
     */
    var $AltBody           = &quot;&quot;;

    /**
     * Sets word wrapping on the body of the message to a given number of
     * characters.
     * @var int
     */
    var $WordWrap          = 0;

    /**
     * Method to send mail: (&quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;).
     * @var string
     */
    var $Mailer            = &quot;mail&quot;;

    /**
     * Sets the path of the sendmail program.
     * @var string
     */
    var $Sendmail          = &quot;/usr/sbin/sendmail&quot;;

    /**
     * Path to PHPMailer plugins.  This is now only useful if the SMTP class
     * is in a different directory than the PHP include path.
     * @var string
     */
    var $PluginDir         = &quot;&quot;;

    /**
     *  Holds PHPMailer version.
     *  @var string
     */
    var $Version           = &quot;1.73&quot;;

    /**
     * Sets the email address that a reading confirmation will be sent.
     * @var string
     */
    var $ConfirmReadingTo  = &quot;&quot;;

    /**
     *  Sets the hostname to use in Message-Id and Received headers
     *  and as default HELO string. If empty, the value returned
     *  by SERVER_NAME is used or &#39;localhost.localdomain&#39;.
     *  @var string
     */
    var $Hostname          = &quot;&quot;;

    /////////////////////////////////////////////////
    // SMTP VARIABLES
    /////////////////////////////////////////////////

    /**
     *  Sets the SMTP hosts.  All hosts must be separated by a
     *  semicolon.  You can also specify a different port
     *  for each host by using this format: [hostname:port]
     *  (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).
     *  Hosts will be tried in order.
     *  @var string
     */
    var $Host        = &quot;localhost&quot;;

    /**
     *  Sets the default SMTP server port.
     *  @var int
     */
    var $Port        = 25;

    /**
     *  Sets the SMTP HELO of the message (Default is $Hostname).
     *  @var string
     */
    var $Helo        = &quot;&quot;;

    /**
     *  Sets SMTP authentication. Utilizes the Username and Password variables.
     *  @var bool
     */
    var $SMTPAuth     = false;

    /**
     *  Sets SMTP username.
     *  @var string
     */
    var $Username     = &quot;&quot;;

    /**
     *  Sets SMTP password.
     *  @var string
     */
    var $Password     = &quot;&quot;;

    /**
     *  Sets the SMTP server timeout in seconds. This function will not
     *  work with the win32 version.
     *  @var int
     */
    var $Timeout      = 10;

    /**
     *  Sets SMTP class debugging on or off.
     *  @var bool
     */
    var $SMTPDebug    = false;

    /**
     * Prevents the SMTP connection from being closed after each mail
     * sending.  If this is set to true then to close the connection
     * requires an explicit call to SmtpClose().
     * @var bool
     */
    var $SMTPKeepAlive = false;

    /**#@+
     * @access private
     */
    var $smtp            = NULL;
    var $to              = array();
    var $cc              = array();
    var $bcc             = array();
    var $ReplyTo         = array();
    var $attachment      = array();
    var $CustomHeader    = array();
    var $message_type    = &quot;&quot;;
    var $boundary        = array();
    var $language        = array();
    var $error_count     = 0;
    var $LE              = &quot;\n&quot;;
    /**#@-*/

    /////////////////////////////////////////////////
    // VARIABLE METHODS
    /////////////////////////////////////////////////

    /**
     * Sets message type to HTML.
     * @param bool $bool
     * @return void
     */
    function IsHTML($bool) {
        if($bool == true)
            $this-&gt;ContentType = &quot;text/html&quot;;
        else
            $this-&gt;ContentType = &quot;text/plain&quot;;
    }

    /**
     * Sets Mailer to send message using SMTP.
     * @return void
     */
    function IsSMTP() {
        $this-&gt;Mailer = &quot;smtp&quot;;
    }

    /**
     * Sets Mailer to send message using PHP mail() function.
     * @return void
     */
    function IsMail() {
        $this-&gt;Mailer = &quot;mail&quot;;
    }

    /**
     * Sets Mailer to send message using the $Sendmail program.
     * @return void
     */
    function IsSendmail() {
        $this-&gt;Mailer = &quot;sendmail&quot;;
    }

    /**
     * Sets Mailer to send message using the qmail MTA.
     * @return void
     */
    function IsQmail() {
        $this-&gt;Sendmail = &quot;/var/qmail/bin/sendmail&quot;;
        $this-&gt;Mailer = &quot;sendmail&quot;;
    }
    /////////////////////////////////////////////////
    // RECIPIENT METHODS
    /////////////////////////////////////////////////

    /**
     * Adds a &quot;To&quot; address.
     * @param string $address
     * @param string $name
     * @return void
     */
    function AddAddress($address, $name = &quot;&quot;) {
        $cur = count($this-&gt;to);
        $this-&gt;to[$cur][0] = trim($address);
        $this-&gt;to[$cur][1] = $name;
    }

    /**
     * Adds a &quot;Cc&quot; address. Note: this function works
     * with the SMTP mailer on win32, not with the &quot;mail&quot;
     * mailer.
     * @param string $address
     * @param string $name
     * @return void
    */
    function AddCC($address, $name = &quot;&quot;) {
        $cur = count($this-&gt;cc);
        $this-&gt;cc[$cur][0] = trim($address);
        $this-&gt;cc[$cur][1] = $name;
    }

    /**
     * Adds a &quot;Bcc&quot; address. Note: this function works
     * with the SMTP mailer on win32, not with the &quot;mail&quot;
     * mailer.
     * @param string $address
     * @param string $name
     * @return void
     */
    function AddBCC($address, $name = &quot;&quot;) {
        $cur = count($this-&gt;bcc);
        $this-&gt;bcc[$cur][0] = trim($address);
        $this-&gt;bcc[$cur][1] = $name;
    }

    /**
     * Adds a &quot;Reply-to&quot; address.
     * @param string $address
     * @param string $name
     * @return void
     */
    function AddReplyTo($address, $name = &quot;&quot;) {
        $cur = count($this-&gt;ReplyTo);
        $this-&gt;ReplyTo[$cur][0] = trim($address);
        $this-&gt;ReplyTo[$cur][1] = $name;
    }
    /////////////////////////////////////////////////
    // MAIL SENDING METHODS
    /////////////////////////////////////////////////

    /**
     * Creates message and assigns Mailer. If the message is
     * not sent successfully then it returns false.  Use the ErrorInfo
     * variable to view description of the error.
     * @return bool
     */
    function Send() {
        $header = &quot;&quot;;
        $body = &quot;&quot;;
        $result = true;

        if((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1)
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;provide_address&quot;));
            return false;
        }

        // Set whether the message is multipart/alternative
        if(!empty($this-&gt;AltBody))
            $this-&gt;ContentType = &quot;multipart/alternative&quot;;

        $this-&gt;error_count = 0; // reset errors
        $this-&gt;SetMessageType();
        $header .= $this-&gt;CreateHeader();
        $body = $this-&gt;CreateBody();

        if($body == &quot;&quot;) { return false; }

        // Choose the mailer
        switch($this-&gt;Mailer)
        {
            case &quot;sendmail&quot;:
                $result = $this-&gt;SendmailSend($header, $body);
                break;
            case &quot;mail&quot;:
                $result = $this-&gt;MailSend($header, $body);
                break;
            case &quot;smtp&quot;:
                $result = $this-&gt;SmtpSend($header, $body);
                break;
            default:
            $this-&gt;SetError($this-&gt;Mailer . $this-&gt;Lang(&quot;mailer_not_supported&quot;));
                $result = false;
                break;
        }

        return $result;
    }

    /**
     * Sends mail using the $Sendmail program.
     * @access private
     * @return bool
     */
    function SendmailSend($header, $body) {
        if ($this-&gt;Sender != &quot;&quot;)
            $sendmail = sprintf(&quot;%s -oi -f %s -t&quot;, $this-&gt;Sendmail, $this-&gt;Sender);
        else
            $sendmail = sprintf(&quot;%s -oi -t&quot;, $this-&gt;Sendmail);

        if(<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="604120">[email&#160;protected]</a>$mail = popen($sendmail, &quot;w&quot;))
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
            return false;
        }

        fputs($mail, $header);
        fputs($mail, $body);

        $result = pclose($mail) &gt;&gt; 8 &amp; 0xFF;
        if($result != 0)
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
            return false;
        }

        return true;
    }

    /**
     * Sends mail using the PHP mail() function.
     * @access private
     * @return bool
     */
    function MailSend($header, $body) {
        $to = &quot;&quot;;
        for($i = 0; $i &lt; count($this-&gt;to); $i++)
        {
            if($i != 0) { $to .= &quot;, &quot;; }
            $to .= $this-&gt;to[$i][0];
        }

        if ($this-&gt;Sender != &quot;&quot; &amp;&amp; strlen(ini_get(&quot;safe_mode&quot;))&lt; 1)
        {
            $old_from = ini_get(&quot;sendmail_from&quot;);
            ini_set(&quot;sendmail_from&quot;, $this-&gt;Sender);
            $params = sprintf(&quot;-oi -f %s&quot;, $this-&gt;Sender);
            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body,
                        $header, $params);
        }
        else
            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body, $header);

        if (isset($old_from))
            ini_set(&quot;sendmail_from&quot;, $old_from);

        if(!$rt)
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;instantiate&quot;));
            return false;
        }

        return true;
    }

    /**
     * Sends mail via SMTP using PhpSMTP (Author:
     * Chris Ryan).  Returns bool.  Returns false if there is a
     * bad MAIL FROM, RCPT, or DATA input.
     * @access private
     * @return bool
     */
    function SmtpSend($header, $body) {
        include_once($this-&gt;PluginDir . &quot;class.smtp.php&quot;);
        $error = &quot;&quot;;
        $bad_rcpt = array();

        if(!$this-&gt;SmtpConnect())
            return false;

        $smtp_from = ($this-&gt;Sender == &quot;&quot;) ? $this-&gt;From : $this-&gt;Sender;
        if(!$this-&gt;smtp-&gt;Mail($smtp_from))
        {
            $error = $this-&gt;Lang(&quot;from_failed&quot;) . $smtp_from;
            $this-&gt;SetError($error);
            $this-&gt;smtp-&gt;Reset();
            return false;
        }

        // Attempt to send attach all recipients
        for($i = 0; $i &lt; count($this-&gt;to); $i++)
        {
            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;to[$i][0]))
                $bad_rcpt[] = $this-&gt;to[$i][0];
        }
        for($i = 0; $i &lt; count($this-&gt;cc); $i++)
        {
            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;cc[$i][0]))
                $bad_rcpt[] = $this-&gt;cc[$i][0];
        }
        for($i = 0; $i &lt; count($this-&gt;bcc); $i++)
        {
            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;bcc[$i][0]))
                $bad_rcpt[] = $this-&gt;bcc[$i][0];
        }

        if(count($bad_rcpt) &gt; 0) // Create error message
        {
            for($i = 0; $i &lt; count($bad_rcpt); $i++)
            {
                if($i != 0) { $error .= &quot;, &quot;; }
                $error .= $bad_rcpt[$i];
            }
            $error = $this-&gt;Lang(&quot;recipients_failed&quot;) . $error;
            $this-&gt;SetError($error);
            $this-&gt;smtp-&gt;Reset();
            return false;
        }

        if(!$this-&gt;smtp-&gt;Data($header . $body))
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;data_not_accepted&quot;));
            $this-&gt;smtp-&gt;Reset();
            return false;
        }
        if($this-&gt;SMTPKeepAlive == true)
            $this-&gt;smtp-&gt;Reset();
        else
            $this-&gt;SmtpClose();

        return true;
    }

    /**
     * Initiates a connection to an SMTP server.  Returns false if the
     * operation failed.
     * @access private
     * @return bool
     */
    function SmtpConnect() {
        if($this-&gt;smtp == NULL) { $this-&gt;smtp = new SMTP(); }

        $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug;
        $hosts = explode(&quot;;&quot;, $this-&gt;Host);
        $index = 0;
        $connection = ($this-&gt;smtp-&gt;Connected());

        // Retry while there is no connection
        while($index &lt; count($hosts) &amp;&amp; $connection == false)
        {
            if(strstr($hosts[$index], &quot;:&quot;))
                list($host, $port) = explode(&quot;:&quot;, $hosts[$index]);
            else
            {
                $host = $hosts[$index];
                $port = $this-&gt;Port;
            }

            if($this-&gt;smtp-&gt;Connect($host, $port, $this-&gt;Timeout))
            {
                if ($this-&gt;Helo != &#39;&#39;)
                    $this-&gt;smtp-&gt;Hello($this-&gt;Helo);
                else
                    $this-&gt;smtp-&gt;Hello($this-&gt;ServerHostname());

                if($this-&gt;SMTPAuth)
                {
                    if(!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username,
                                                  $this-&gt;Password))
                    {
                        $this-&gt;SetError($this-&gt;Lang(&quot;authenticate&quot;));
                        $this-&gt;smtp-&gt;Reset();
                        $connection = false;
                    }
                }
                $connection = true;
            }
            $index++;
        }
        if(!$connection)
            $this-&gt;SetError($this-&gt;Lang(&quot;connect_host&quot;));

        return $connection;
    }

    /**
     * Closes the active SMTP session if one exists.
     * @return void
     */
    function SmtpClose() {
        if($this-&gt;smtp != NULL)
        {
            if($this-&gt;smtp-&gt;Connected())
            {
                $this-&gt;smtp-&gt;Quit();
                $this-&gt;smtp-&gt;Close();
            }
        }
    }

    /**
     * Sets the language for all class error messages.  Returns false
     * if it cannot load the language file.  The default language type
     * is English.
     * @param string $lang_type Type of language (e.g. Portuguese: &quot;br&quot;)
     * @param string $lang_path Path to the language file directory
     * @access public
     * @return bool
     */
    function SetLanguage($lang_type, $lang_path = &quot;language/&quot;) {
        if(file_exists($lang_path.&#39;phpmailer.lang-&#39;.$lang_type.&#39;.php&#39;))
            include($lang_path.&#39;phpmailer.lang-&#39;.$lang_type.&#39;.php&#39;);
        else if(file_exists($lang_path.&#39;phpmailer.lang-en.php&#39;))
            include($lang_path.&#39;phpmailer.lang-en.php&#39;);
        else
        {
            $this-&gt;SetError(&quot;Could not load language file&quot;);
            return false;
        }
        $this-&gt;language = $PHPMAILER_LANG;

        return true;
    }

    /////////////////////////////////////////////////
    // MESSAGE CREATION METHODS
    /////////////////////////////////////////////////

    /**
     * Creates recipient headers.
     * @access private
     * @return string
     */
    function AddrAppend($type, $addr) {
        $addr_str = $type . &quot;: &quot;;
        $addr_str .= $this-&gt;AddrFormat($addr[0]);
        if(count($addr) &gt; 1)
        {
            for($i = 1; $i &lt; count($addr); $i++)
                $addr_str .= &quot;, &quot; . $this-&gt;AddrFormat($addr[$i]);
        }
        $addr_str .= $this-&gt;LE;

        return $addr_str;
    }

    /**
     * Formats an address correctly.
     * @access private
     * @return string
     */
    function AddrFormat($addr) {
        if(empty($addr[1]))
            $formatted = $addr[0];
        else
        {
            $formatted = $this-&gt;EncodeHeader($addr[1], &#39;phrase&#39;) . &quot; &lt;&quot; .
                         $addr[0] . &quot;&gt;&quot;;
        }

        return $formatted;
    }

    /**
     * Wraps message for use with mailers that do not
     * automatically perform wrapping and for quoted-printable.
     * Original written by philippe.
     * @access private
     * @return string
     */
    function WrapText($message, $length, $qp_mode = false) {
        $soft_break = ($qp_mode) ? sprintf(&quot; =%s&quot;, $this-&gt;LE) : $this-&gt;LE;

        $message = $this-&gt;FixEOL($message);
        if (substr($message, -1) == $this-&gt;LE)
            $message = substr($message, 0, -1);

        $line = explode($this-&gt;LE, $message);
        $message = &quot;&quot;;
        for ($i=0 ;$i &lt; count($line); $i++)
        {
          $line_part = explode(&quot; &quot;, $line[$i]);
          $buf = &quot;&quot;;
          for ($e = 0; $e&lt;count($line_part); $e++)
          {
              $word = $line_part[$e];
              if ($qp_mode and (strlen($word) &gt; $length))
              {
                $space_left = $length - strlen($buf) - 1;
                if ($e != 0)
                {
                    if ($space_left &gt; 20)
                    {
                        $len = $space_left;
                        if (substr($word, $len - 1, 1) == &quot;=&quot;)
                          $len--;
                        elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
                          $len -= 2;
                        $part = substr($word, 0, $len);
                        $word = substr($word, $len);
                        $buf .= &quot; &quot; . $part;
                        $message .= $buf . sprintf(&quot;=%s&quot;, $this-&gt;LE);
                    }
                    else
                    {
                        $message .= $buf . $soft_break;
                    }
                    $buf = &quot;&quot;;
                }
                while (strlen($word) &gt; 0)
                {
                    $len = $length;
                    if (substr($word, $len - 1, 1) == &quot;=&quot;)
                        $len--;
                    elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
                        $len -= 2;
                    $part = substr($word, 0, $len);
                    $word = substr($word, $len);

                    if (strlen($word) &gt; 0)
                        $message .= $part . sprintf(&quot;=%s&quot;, $this-&gt;LE);
                    else
                        $buf = $part;
                }
              }
              else
              {
                $buf_o = $buf;
                $buf .= ($e == 0) ? $word : (&quot; &quot; . $word);

                if (strlen($buf) &gt; $length and $buf_o != &quot;&quot;)
                {
                    $message .= $buf_o . $soft_break;
                    $buf = $word;
                }
              }
          }
          $message .= $buf . $this-&gt;LE;
        }

        return $message;
    }

    /**
     * Set the body wrapping.
     * @access private
     * @return void
     */
    function SetWordWrap() {
        if($this-&gt;WordWrap &lt; 1)
            return;

        switch($this-&gt;message_type)
        {
           case &quot;alt&quot;:
              // fall through
           case &quot;alt_attachments&quot;:
              $this-&gt;AltBody = $this-&gt;WrapText($this-&gt;AltBody, $this-&gt;WordWrap);
              break;
           default:
              $this-&gt;Body = $this-&gt;WrapText($this-&gt;Body, $this-&gt;WordWrap);
              break;
        }
    }

    /**
     * Assembles message header.
     * @access private
     * @return string
     */
    function CreateHeader() {
        $result = &quot;&quot;;

        // Set the boundaries
        $uniq_id = md5(uniqid(time()));
        $this-&gt;boundary[1] = &quot;b1_&quot; . $uniq_id;
        $this-&gt;boundary[2] = &quot;b2_&quot; . $uniq_id;

        $result .= $this-&gt;HeaderLine(&quot;Date&quot;, $this-&gt;RFCDate());
        if($this-&gt;Sender == &quot;&quot;)
            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;From));
        else
            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;Sender));

        // To be created automatically by mail()
        if($this-&gt;Mailer != &quot;mail&quot;)
        {
            if(count($this-&gt;to) &gt; 0)
                $result .= $this-&gt;AddrAppend(&quot;To&quot;, $this-&gt;to);
            else if (count($this-&gt;cc) == 0)
                $result .= $this-&gt;HeaderLine(&quot;To&quot;, &quot;undisclosed-recipients:;&quot;);
            if(count($this-&gt;cc) &gt; 0)
                $result .= $this-&gt;AddrAppend(&quot;Cc&quot;, $this-&gt;cc);
        }

        $from = array();
        $from[0][0] = trim($this-&gt;From);
        $from[0][1] = $this-&gt;FromName;
        $result .= $this-&gt;AddrAppend(&quot;From&quot;, $from);

        // sendmail and mail() extract Bcc from the header before sending
        if((($this-&gt;Mailer == &quot;sendmail&quot;) || ($this-&gt;Mailer == &quot;mail&quot;)) &amp;&amp; (count($this-&gt;bcc) &gt; 0))
            $result .= $this-&gt;AddrAppend(&quot;Bcc&quot;, $this-&gt;bcc);

        if(count($this-&gt;ReplyTo) &gt; 0)
            $result .= $this-&gt;AddrAppend(&quot;Reply-to&quot;, $this-&gt;ReplyTo);

        // mail() sets the subject itself
        if($this-&gt;Mailer != &quot;mail&quot;)
            $result .= $this-&gt;HeaderLine(&quot;Subject&quot;, $this-&gt;EncodeHeader(trim($this-&gt;Subject)));

        $result .= sprintf(&quot;Message-ID: &lt;%<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b4c7f4">[email&#160;protected]</a>%s&gt;%s&quot;, $uniq_id, $this-&gt;ServerHostname(), $this-&gt;LE);
        $result .= $this-&gt;HeaderLine(&quot;X-Priority&quot;, $this-&gt;Priority);
        $result .= $this-&gt;HeaderLine(&quot;X-Mailer&quot;, &quot;PHPMailer [version &quot; . $this-&gt;Version . &quot;]&quot;);

        if($this-&gt;ConfirmReadingTo != &quot;&quot;)
        {
            $result .= $this-&gt;HeaderLine(&quot;Disposition-Notification-To&quot;,
                       &quot;&lt;&quot; . trim($this-&gt;ConfirmReadingTo) . &quot;&gt;&quot;);
        }

        // Add custom headers
        for($index = 0; $index &lt; count($this-&gt;CustomHeader); $index++)
        {
            $result .= $this-&gt;HeaderLine(trim($this-&gt;CustomHeader[$index][0]),
                       $this-&gt;EncodeHeader(trim($this-&gt;CustomHeader[$index][1])));
        }
        $result .= $this-&gt;HeaderLine(&quot;MIME-Version&quot;, &quot;1.0&quot;);

        switch($this-&gt;message_type)
        {
            case &quot;plain&quot;:
                $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $this-&gt;Encoding);
                $result .= sprintf(&quot;Content-Type: %s; charset=\&quot;%s\&quot;&quot;,
                                    $this-&gt;ContentType, $this-&gt;CharSet);
                break;
            case &quot;attachments&quot;:
                // fall through
            case &quot;alt_attachments&quot;:
                if($this-&gt;InlineImageExists())
                {
                    $result .= sprintf(&quot;Content-Type: %s;%s\ttype=\&quot;text/html\&quot;;%s\tboundary=\&quot;%s\&quot;%s&quot;,
                                    &quot;multipart/related&quot;, $this-&gt;LE, $this-&gt;LE,
                                    $this-&gt;boundary[1], $this-&gt;LE);
                }
                else
                {
                    $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/mixed;&quot;);
                    $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . &#39;&quot;&#39;);
                }
                break;
            case &quot;alt&quot;:
                $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/alternative;&quot;);
                $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . &#39;&quot;&#39;);
                break;
        }

        if($this-&gt;Mailer != &quot;mail&quot;)
            $result .= $this-&gt;LE.$this-&gt;LE;

        return $result;
    }

    /**
     * Assembles the message body.  Returns an empty string on failure.
     * @access private
     * @return string
     */
    function CreateBody() {
        $result = &quot;&quot;;

        $this-&gt;SetWordWrap();

        switch($this-&gt;message_type)
        {
            case &quot;alt&quot;:
                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;,
                                              &quot;text/plain&quot;, &quot;&quot;);
                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
                $result .= $this-&gt;LE.$this-&gt;LE;
                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;,
                                              &quot;text/html&quot;, &quot;&quot;);

                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
                $result .= $this-&gt;LE.$this-&gt;LE;

                $result .= $this-&gt;EndBoundary($this-&gt;boundary[1]);
                break;
            case &quot;plain&quot;:
                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
                break;
            case &quot;attachments&quot;:
                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, &quot;&quot;, &quot;&quot;);
                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
                $result .= $this-&gt;LE;

                $result .= $this-&gt;AttachAll();
                break;
            case &quot;alt_attachments&quot;:
                $result .= sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
                $result .= sprintf(&quot;Content-Type: %s;%s&quot; .
                                   &quot;\tboundary=\&quot;%s\&quot;%s&quot;,
                                   &quot;multipart/alternative&quot;, $this-&gt;LE,
                                   $this-&gt;boundary[2], $this-&gt;LE.$this-&gt;LE);

                // Create text body
                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;,
                                              &quot;text/plain&quot;, &quot;&quot;) . $this-&gt;LE;

                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
                $result .= $this-&gt;LE.$this-&gt;LE;

                // Create the HTML body
                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;,
                                              &quot;text/html&quot;, &quot;&quot;) . $this-&gt;LE;

                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
                $result .= $this-&gt;LE.$this-&gt;LE;

                $result .= $this-&gt;EndBoundary($this-&gt;boundary[2]);

                $result .= $this-&gt;AttachAll();
                break;
        }
        if($this-&gt;IsError())
            $result = &quot;&quot;;

        return $result;
    }

    /**
     * Returns the start of a message boundary.
     * @access private
     */
    function GetBoundary($boundary, $charSet, $contentType, $encoding) {
        $result = &quot;&quot;;
        if($charSet == &quot;&quot;) { $charSet = $this-&gt;CharSet; }
        if($contentType == &quot;&quot;) { $contentType = $this-&gt;ContentType; }
        if($encoding == &quot;&quot;) { $encoding = $this-&gt;Encoding; }

        $result .= $this-&gt;TextLine(&quot;--&quot; . $boundary);
        $result .= sprintf(&quot;Content-Type: %s; charset = \&quot;%s\&quot;&quot;,
                            $contentType, $charSet);
        $result .= $this-&gt;LE;
        $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $encoding);
        $result .= $this-&gt;LE;

        return $result;
    }

    /**
     * Returns the end of a message boundary.
     * @access private
     */
    function EndBoundary($boundary) {
        return $this-&gt;LE . &quot;--&quot; . $boundary . &quot;--&quot; . $this-&gt;LE;
    }

    /**
     * Sets the message type.
     * @access private
     * @return void
     */
    function SetMessageType() {
        if(count($this-&gt;attachment) &lt; 1 &amp;&amp; strlen($this-&gt;AltBody) &lt; 1)
            $this-&gt;message_type = &quot;plain&quot;;
        else
        {
            if(count($this-&gt;attachment) &gt; 0)
                $this-&gt;message_type = &quot;attachments&quot;;
            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &lt; 1)
                $this-&gt;message_type = &quot;alt&quot;;
            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &gt; 0)
                $this-&gt;message_type = &quot;alt_attachments&quot;;
        }
    }

    /**
     * Returns a formatted header line.
     * @access private
     * @return string
     */
    function HeaderLine($name, $value) {
        return $name . &quot;: &quot; . $value . $this-&gt;LE;
    }

    /**
     * Returns a formatted mail line.
     * @access private
     * @return string
     */
    function TextLine($value) {
        return $value . $this-&gt;LE;
    }

    /////////////////////////////////////////////////
    // ATTACHMENT METHODS
    /////////////////////////////////////////////////

    /**
     * Adds an attachment from a path on the filesystem.
     * Returns false if the file could not be found
     * or accessed.
     * @param string $path Path to the attachment.
     * @param string $name Overrides the attachment name.
     * @param string $encoding File encoding (see $Encoding).
     * @param string $type File extension (MIME) type.
     * @return bool
     */
    function AddAttachment($path, $name = &quot;&quot;, $encoding = &quot;base64&quot;,
                           $type = &quot;application/octet-stream&quot;) {
        if(<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ebfdef7ed">[email&#160;protected]</a>_file($path))
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
            return false;
        }

        $filename = basename($path);
        if($name == &quot;&quot;)
            $name = $filename;

        $cur = count($this-&gt;attachment);
        $this-&gt;attachment[$cur][0] = $path;
        $this-&gt;attachment[$cur][1] = $filename;
        $this-&gt;attachment[$cur][2] = $name;
        $this-&gt;attachment[$cur][3] = $encoding;
        $this-&gt;attachment[$cur][4] = $type;
        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
        $this-&gt;attachment[$cur][7] = 0;

        return true;
    }

    /**
     * Attaches all fs, string, and binary attachments to the message.
     * Returns an empty string on failure.
     * @access private
     * @return string
     */
    function AttachAll() {
        // Return text of body
        $mime = array();

        // Add all attachments
        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
        {
            // Check for string attachment
            $bString = $this-&gt;attachment[$i][5];
            if ($bString)
                $string = $this-&gt;attachment[$i][0];
            else
                $path = $this-&gt;attachment[$i][0];

            $filename    = $this-&gt;attachment[$i][1];
            $name        = $this-&gt;attachment[$i][2];
            $encoding    = $this-&gt;attachment[$i][3];
            $type        = $this-&gt;attachment[$i][4];
            $disposition = $this-&gt;attachment[$i][6];
            $cid         = $this-&gt;attachment[$i][7];

            $mime[] = sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
            $mime[] = sprintf(&quot;Content-Type: %s; name=\&quot;%s\&quot;%s&quot;, $type, $name, $this-&gt;LE);
            $mime[] = sprintf(&quot;Content-Transfer-Encoding: %s%s&quot;, $encoding, $this-&gt;LE);

            if($disposition == &quot;inline&quot;)
                $mime[] = sprintf(&quot;Content-ID: &lt;%s&gt;%s&quot;, $cid, $this-&gt;LE);

            $mime[] = sprintf(&quot;Content-Disposition: %s; filename=\&quot;%s\&quot;%s&quot;,
                              $disposition, $name, $this-&gt;LE.$this-&gt;LE);

            // Encode as string attachment
            if($bString)
            {
                $mime[] = $this-&gt;EncodeString($string, $encoding);
                if($this-&gt;IsError()) { return &quot;&quot;; }
                $mime[] = $this-&gt;LE.$this-&gt;LE;
            }
            else
            {
                $mime[] = $this-&gt;EncodeFile($path, $encoding);
                if($this-&gt;IsError()) { return &quot;&quot;; }
                $mime[] = $this-&gt;LE.$this-&gt;LE;
            }
        }

        $mime[] = sprintf(&quot;--%s--%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);

        return join(&quot;&quot;, $mime);
    }

    /**
     * Encodes attachment in requested format.  Returns an
     * empty string on failure.
     * @access private
     * @return string
     */
    function EncodeFile ($path, $encoding = &quot;base64&quot;) {
        if(<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="173657">[email&#160;protected]</a>$fd = fopen($path, &quot;rb&quot;))
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;file_open&quot;) . $path);
            return &quot;&quot;;
        }
        $magic_quotes = get_magic_quotes_runtime();
        set_magic_quotes_runtime(0);
        $file_buffer = fread($fd, filesize($path));
        $file_buffer = $this-&gt;EncodeString($file_buffer, $encoding);
        fclose($fd);
        set_magic_quotes_runtime($magic_quotes);

        return $file_buffer;
    }

    /**
     * Encodes string to requested format. Returns an
     * empty string on failure.
     * @access private
     * @return string
     */
    function EncodeString ($str, $encoding = &quot;base64&quot;) {
        $encoded = &quot;&quot;;
        switch(strtolower($encoding)) {
          case &quot;base64&quot;:
              // chunk_split is found in PHP &gt;= 3.0.6
              $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);
              break;
          case &quot;7bit&quot;:
          case &quot;8bit&quot;:
              $encoded = $this-&gt;FixEOL($str);
              if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
                $encoded .= $this-&gt;LE;
              break;
          case &quot;binary&quot;:
              $encoded = $str;
              break;
          case &quot;quoted-printable&quot;:
              $encoded = $this-&gt;EncodeQP($str);
              break;
          default:
              $this-&gt;SetError($this-&gt;Lang(&quot;encoding&quot;) . $encoding);
              break;
        }
        return $encoded;
    }

    /**
     * Encode a header string to best of Q, B, quoted or none.
     * @access private
     * @return string
     */
    function EncodeHeader ($str, $position = &#39;text&#39;) {
      $x = 0;

      switch (strtolower($position)) {
        case &#39;phrase&#39;:
          if (!preg_match(&#39;/[\200-\377]/&#39;, $str)) {
            // Can&#39;t use addslashes as we don&#39;t know what value has magic_quotes_sybase.
            $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);

            if (($str == $encoded) &amp;&amp; !preg_match(&#39;/[^A-Za-z0-9!#$%&amp;\&#39;*+\/=?^_`{|}~ -]/&#39;, $str))
              return ($encoded);
            else
              return (&quot;\&quot;$encoded\&quot;&quot;);
          }
          $x = preg_match_all(&#39;/[^\040\041\043-\133\135-\176]/&#39;, $str, $matches);
          break;
        case &#39;comment&#39;:
          $x = preg_match_all(&#39;/[()&quot;]/&#39;, $str, $matches);
          // Fall-through
        case &#39;text&#39;:
        default:
          $x += preg_match_all(&#39;/[\000-\010\013\014\016-\037\177-\377]/&#39;, $str, $matches);
          break;
      }

      if ($x == 0)
        return ($str);

      $maxlen = 75 - 7 - strlen($this-&gt;CharSet);
      // Try to select the encoding which should produce the shortest output
      if (strlen($str)/3 &lt; $x) {
        $encoding = &#39;B&#39;;
        $encoded = base64_encode($str);
        $maxlen -= $maxlen % 4;
        $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));
      } else {
        $encoding = &#39;Q&#39;;
        $encoded = $this-&gt;EncodeQ($str, $position);
        $encoded = $this-&gt;WrapText($encoded, $maxlen, true);
        $encoded = str_replace(&quot;=&quot;.$this-&gt;LE, &quot;\n&quot;, trim($encoded));
      }

      $encoded = preg_replace(&#39;/^(.*)$/m&#39;, &quot; =?&quot;.$this-&gt;CharSet.&quot;?$encoding?\\1?=&quot;, $encoded);
      $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));

      return $encoded;
    }

    /**
     * Encode string to quoted-printable.
     * @access private
     * @return string
     */
    function EncodeQP ($str) {
        $encoded = $this-&gt;FixEOL($str);
        if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
            $encoded .= $this-&gt;LE;

        // Replace every high ascii, control and = characters
        $encoded = preg_replace(&#39;/([\000-\010\013\014\016-\037\075\177-\377])/e&#39;,
                  &quot;&#39;=&#39;.sprintf(&#39;%02X&#39;, ord(&#39;\\1&#39;))&quot;, $encoded);
        // Replace every spaces and tabs when it&#39;s the last character on a line
        $encoded = preg_replace(&quot;/([\011\040])&quot;.$this-&gt;LE.&quot;/e&quot;,
                  &quot;&#39;=&#39;.sprintf(&#39;%02X&#39;, ord(&#39;\\1&#39;)).&#39;&quot;.$this-&gt;LE.&quot;&#39;&quot;, $encoded);

        // Maximum line length of 76 characters before CRLF (74 + space + &#39;=&#39;)
        $encoded = $this-&gt;WrapText($encoded, 74, true);

        return $encoded;
    }

    /**
     * Encode string to q encoding.
     * @access private
     * @return string
     */
    function EncodeQ ($str, $position = &quot;text&quot;) {
        // There should not be any EOL in the string
        $encoded = preg_replace(&quot;[\r\n]&quot;, &quot;&quot;, $str);

        switch (strtolower($position)) {
          case &quot;phrase&quot;:
            $encoded = preg_replace(&quot;/([^A-Za-z0-9!*+\/ -])/e&quot;, &quot;&#39;=&#39;.sprintf(&#39;%02X&#39;, ord(&#39;\\1&#39;))&quot;, $encoded);
            break;
          case &quot;comment&quot;:
            $encoded = preg_replace(&quot;/([\(\)\&quot;])/e&quot;, &quot;&#39;=&#39;.sprintf(&#39;%02X&#39;, ord(&#39;\\1&#39;))&quot;, $encoded);
          case &quot;text&quot;:
          default:
            // Replace every high ascii, control =, ? and _ characters
            $encoded = preg_replace(&#39;/([\000-\011\013\014\016-\037\075\077\137\177-\377])/e&#39;,
                  &quot;&#39;=&#39;.sprintf(&#39;%02X&#39;, ord(&#39;\\1&#39;))&quot;, $encoded);
            break;
        }

        // Replace every spaces to _ (more readable than =20)
        $encoded = str_replace(&quot; &quot;, &quot;_&quot;, $encoded);

        return $encoded;
    }

    /**
     * Adds a string or binary attachment (non-filesystem) to the list.
     * This method can be used to attach ascii or binary data,
     * such as a BLOB record from a database.
     * @param string $string String attachment data.
     * @param string $filename Name of the attachment.
     * @param string $encoding File encoding (see $Encoding).
     * @param string $type File extension (MIME) type.
     * @return void
     */
    function AddStringAttachment($string, $filename, $encoding = &quot;base64&quot;,
                                 $type = &quot;application/octet-stream&quot;) {
        // Append to $attachment array
        $cur = count($this-&gt;attachment);
        $this-&gt;attachment[$cur][0] = $string;
        $this-&gt;attachment[$cur][1] = $filename;
        $this-&gt;attachment[$cur][2] = $filename;
        $this-&gt;attachment[$cur][3] = $encoding;
        $this-&gt;attachment[$cur][4] = $type;
        $this-&gt;attachment[$cur][5] = true; // isString
        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
        $this-&gt;attachment[$cur][7] = 0;
    }

    /**
     * Adds an embedded attachment.  This can include images, sounds, and
     * just about any other document.  Make sure to set the $type to an
     * image type.  For JPEG images use &quot;image/jpeg&quot; and for GIF images
     * use &quot;image/gif&quot;.
     * @param string $path Path to the attachment.
     * @param string $cid Content ID of the attachment.  Use this to identify
     *        the Id for accessing the image in an HTML form.
     * @param string $name Overrides the attachment name.
     * @param string $encoding File encoding (see $Encoding).
     * @param string $type File extension (MIME) type.
     * @return bool
     */
    function AddEmbeddedImage($path, $cid, $name = &quot;&quot;, $encoding = &quot;base64&quot;,
                              $type = &quot;application/octet-stream&quot;) {

        if(<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5d7c1d342e">[email&#160;protected]</a>_file($path))
        {
            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
            return false;
        }

        $filename = basename($path);
        if($name == &quot;&quot;)
            $name = $filename;

        // Append to $attachment array
        $cur = count($this-&gt;attachment);
        $this-&gt;attachment[$cur][0] = $path;
        $this-&gt;attachment[$cur][1] = $filename;
        $this-&gt;attachment[$cur][2] = $name;
        $this-&gt;attachment[$cur][3] = $encoding;
        $this-&gt;attachment[$cur][4] = $type;
        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
        $this-&gt;attachment[$cur][6] = &quot;inline&quot;;
        $this-&gt;attachment[$cur][7] = $cid;

        return true;
    }

    /**
     * Returns true if an inline attachment is present.
     * @access private
     * @return bool
     */
    function InlineImageExists() {
        $result = false;
        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
        {
            if($this-&gt;attachment[$i][6] == &quot;inline&quot;)
            {
                $result = true;
                break;
            }
        }

        return $result;
    }

    /////////////////////////////////////////////////
    // MESSAGE RESET METHODS
    /////////////////////////////////////////////////

    /**
     * Clears all recipients assigned in the TO array.  Returns void.
     * @return void
     */
    function ClearAddresses() {
        $this-&gt;to = array();
    }

    /**
     * Clears all recipients assigned in the CC array.  Returns void.
     * @return void
     */
    function ClearCCs() {
        $this-&gt;cc = array();
    }

    /**
     * Clears all recipients assigned in the BCC array.  Returns void.
     * @return void
     */
    function ClearBCCs() {
        $this-&gt;bcc = array();
    }

    /**
     * Clears all recipients assigned in the ReplyTo array.  Returns void.
     * @return void
     */
    function ClearReplyTos() {
        $this-&gt;ReplyTo = array();
    }

    /**
     * Clears all recipients assigned in the TO, CC and BCC
     * array.  Returns void.
     * @return void
     */
    function ClearAllRecipients() {
        $this-&gt;to = array();
        $this-&gt;cc = array();
        $this-&gt;bcc = array();
    }

    /**
     * Clears all previously set filesystem, string, and binary
     * attachments.  Returns void.
     * @return void
     */
    function ClearAttachments() {
        $this-&gt;attachment = array();
    }

    /**
     * Clears all custom headers.  Returns void.
     * @return void
     */
    function ClearCustomHeaders() {
        $this-&gt;CustomHeader = array();
    }
    /////////////////////////////////////////////////
    // MISCELLANEOUS METHODS
    /////////////////////////////////////////////////

    /**
     * Adds the error message to the error container.
     * Returns void.
     * @access private
     * @return void
     */
    function SetError($msg) {
        $this-&gt;error_count++;
        $this-&gt;ErrorInfo = $msg;
    }

    /**
     * Returns the proper RFC 822 formatted date.
     * @access private
     * @return string
     */
    function RFCDate() {
        $tz = date(&quot;Z&quot;);
        $tzs = ($tz &lt; 0) ? &quot;-&quot; : &quot;+&quot;;
        $tz = abs($tz);
        $tz = ($tz/3600)*100 + ($tz%3600)/60;
        $result = sprintf(&quot;%s %s%04d&quot;, date(&quot;D, j M Y H:i:s&quot;), $tzs, $tz);

        return $result;
    }

    /**
     * Returns the appropriate server variable.  Should work with both
     * PHP 4.1.0+ as well as older versions.  Returns an empty string
     * if nothing is found.
     * @access private
     * @return mixed
     */
    function ServerVar($varName) {
        global $HTTP_SERVER_VARS;
        global $HTTP_ENV_VARS;

        if(!isset($_SERVER))
        {
            $_SERVER = $HTTP_SERVER_VARS;
            if(!isset($_SERVER[&quot;REMOTE_ADDR&quot;]))
                $_SERVER = $HTTP_ENV_VARS; // must be Apache
        }

        if(isset($_SERVER[$varName]))
            return $_SERVER[$varName];
        else
            return &quot;&quot;;
    }

    /**
     * Returns the server hostname or &#39;localhost.localdomain&#39; if unknown.
     * @access private
     * @return string
     */
    function ServerHostname() {
        if ($this-&gt;Hostname != &quot;&quot;)
            $result = $this-&gt;Hostname;
        elseif ($this-&gt;ServerVar(&#39;SERVER_NAME&#39;) != &quot;&quot;)
            $result = $this-&gt;ServerVar(&#39;SERVER_NAME&#39;);
        else
            $result = &quot;localhost.localdomain&quot;;

        return $result;
    }

    /**
     * Returns a message in the appropriate language.
     * @access private
     * @return string
     */
    function Lang($key) {
        if(count($this-&gt;language) &lt; 1)
            $this-&gt;SetLanguage(&quot;en&quot;); // set the default language

        if(isset($this-&gt;language[$key]))
            return $this-&gt;language[$key];
        else
            return &quot;Language string failed to load: &quot; . $key;
    }

    /**
     * Returns true if an error occurred.
     * @return bool
     */
    function IsError() {
        return ($this-&gt;error_count &gt; 0);
    }

    /**
     * Changes every end of line from CR or LF to CRLF.
     * @access private
     * @return string
     */
    function FixEOL($str) {
        $str = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $str);
        $str = str_replace(&quot;\r&quot;, &quot;\n&quot;, $str);
        $str = str_replace(&quot;\n&quot;, $this-&gt;LE, $str);
        return $str;
    }

    /**
     * Adds a custom header.
     * @return void
     */
    function AddCustomHeader($custom_header) {
        $this-&gt;CustomHeader[] = explode(&quot;:&quot;, $custom_header, 2);
    }
}

?&gt;</code></pre><br /><strong>class.smtp.php</strong><br /><pre><code>&lt;?php
////////////////////////////////////////////////////
// SMTP - PHP SMTP class
//
// Version 1.02
//
// Define an SMTP class that can be used to connect
// and communicate with any SMTP server. It implements
// all the SMTP functions defined in RFC821 except TURN.
//
// Author: Chris Ryan
//
// License: LGPL, see LICENSE
////////////////////////////////////////////////////

/**
 * SMTP is rfc 821 compliant and implements all the rfc 821 SMTP
 * commands except TURN which will always return a not implemented
 * error. SMTP also provides some utility methods for sending mail
 * to an SMTP server.
 * @package PHPMailer
 * @author Chris Ryan
 */
class SMTP
{
    /**
     *  SMTP server port
     *  @var int
     */
    var $SMTP_PORT = 25;

    /**
     *  SMTP reply line ending
     *  @var string
     */
    var $CRLF = &quot;\r\n&quot;;

    /**
     *  Sets whether debugging is turned on
     *  @var bool
     */
    var $do_debug;       # the level of debug to perform

    /**#@+
     * @access private
     */
    var $smtp_conn;      # the socket to the server
    var $error;          # error if any on the last call
    var $helo_rply;      # the reply the server sent to us for HELO
    /**#@-*/

    /**
     * Initialize the class so that the data is in a known state.
     * @access public
     * @return void
     */
    function SMTP() {
        $this-&gt;smtp_conn = 0;
        $this-&gt;error = null;
        $this-&gt;helo_rply = null;

        $this-&gt;do_debug = 0;
    }

    /*************************************************************
     *                    CONNECTION FUNCTIONS                  *
     ***********************************************************/

    /**
     * Connect to the server specified on the port specified.
     * If the port is not specified use the default SMTP_PORT.
     * If tval is specified then a connection will try and be
     * established with the server for that number of seconds.
     * If tval is not specified the default is 30 seconds to
     * try on the connection.
     *
     * SMTP CODE SUCCESS: 220
     * SMTP CODE FAILURE: 421
     * @access public
     * @return bool
     */
    function Connect($host,$port=0,$tval=30) {
        # set the error val to null so there is no confusion
        $this-&gt;error = null;

        # make sure we are __not__ connected
        if($this-&gt;connected()) {
            # ok we are connected! what should we do?
            # for now we will just give an error saying we
            # are already connected
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;Already connected to a server&quot;);
            return false;
        }

        if(empty($port)) {
            $port = $this-&gt;SMTP_PORT;
        }

        #connect to the smtp server
        $this-&gt;smtp_conn = fsockopen($host,    # the host of the server
                                     $port,    # the port to use
                                     $errno,   # error number if any
                                     $errstr,  # error message if any
                                     $tval);   # give up after ? secs
        # verify we connected properly
        if(empty($this-&gt;smtp_conn)) {
            $this-&gt;error = array(&quot;error&quot; =&gt; &quot;Failed to connect to server&quot;,
                                 &quot;errno&quot; =&gt; $errno,
                                 &quot;errstr&quot; =&gt; $errstr);
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: $errstr ($errno)&quot; . $this-&gt;CRLF;
            }
            return false;
        }

        # sometimes the SMTP server takes a little longer to respond
        # so we will give it a longer timeout for the first read
        // Windows still does not have support for this timeout function
        if(substr(PHP_OS, 0, 3) != &quot;WIN&quot;)
           socket_set_timeout($this-&gt;smtp_conn, $tval, 0);

        # get any announcement stuff
        $announce = $this-&gt;get_lines();

        # set the timeout  of any socket functions at 1/10 of a second
        //if(function_exists(&quot;socket_set_timeout&quot;))
        //   socket_set_timeout($this-&gt;smtp_conn, 0, 100000);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $announce;
        }

        return true;
    }

    /**
     * Performs SMTP authentication.  Must be run after running the
     * Hello() method.  Returns true if successfully authenticated.
     * @access public
     * @return bool
     */
    function Authenticate($username, $password) {
        // Start authentication
        fputs($this-&gt;smtp_conn,&quot;AUTH LOGIN&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($code != 334) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;AUTH not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        // Send encoded username
        fputs($this-&gt;smtp_conn, base64_encode($username) . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($code != 334) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;Username not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        // Send encoded password
        fputs($this-&gt;smtp_conn, base64_encode($password) . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($code != 235) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;Password not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        return true;
    }

    /**
     * Returns true if connected to a server otherwise false
     * @access private
     * @return bool
     */
    function Connected() {
        if(!empty($this-&gt;smtp_conn)) {
            $sock_status = socket_get_status($this-&gt;smtp_conn);
            if($sock_status[&quot;eof&quot;]) {
                # hmm this is an odd situation... the socket is
                # valid but we aren&#39;t connected anymore
                if($this-&gt;do_debug &gt;= 1) {
                    echo &quot;SMTP -&gt; NOTICE:&quot; . $this-&gt;CRLF .
                         &quot;EOF caught while checking if connected&quot;;
                }
                $this-&gt;Close();
                return false;
            }
            return true; # everything looks good
        }
        return false;
    }

    /**
     * Closes the socket and cleans up the state of the class.
     * It is not considered good to use this function without
     * first trying to use QUIT.
     * @access public
     * @return void
     */
    function Close() {
        $this-&gt;error = null; # so there is no confusion
        $this-&gt;helo_rply = null;
        if(!empty($this-&gt;smtp_conn)) {
            # close the connection and cleanup
            fclose($this-&gt;smtp_conn);
            $this-&gt;smtp_conn = 0;
        }
    }
    /***************************************************************
     *                        SMTP COMMANDS                       *
     *************************************************************/

    /**
     * Issues a data command and sends the msg_data to the server
     * finializing the mail transaction. $msg_data is the message
     * that is to be send with the headers. Each header needs to be
     * on a single line followed by a &lt;CRLF&gt; with the message headers
     * and the message body being seperated by and additional &lt;CRLF&gt;.
     *
     * Implements rfc 821: DATA &lt;CRLF&gt;
     *
     * SMTP CODE INTERMEDIATE: 354
     *     [data]
     *     &lt;CRLF&gt;.&lt;CRLF&gt;
     *     SMTP CODE SUCCESS: 250
     *     SMTP CODE FAILURE: 552,554,451,452
     * SMTP CODE FAILURE: 451,554
     * SMTP CODE ERROR  : 500,501,503,421
     * @access public
     * @return bool
     */
    function Data($msg_data) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Data() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;DATA&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 354) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;DATA command not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        # the server is ready to accept data!
        # according to rfc 821 we should not send more than 1000
        # including the CRLF
        # characters on a single line so we will break the data up
        # into lines by \r and/or \n then if needed we will break
        # each of those into smaller lines to fit within the limit.
        # in addition we will be looking for lines that start with
        # a period &#39;.&#39; and append and additional period &#39;.&#39; to that
        # line. NOTE: this does not count towards are limit.

        # normalize the line breaks so we know the explode works
        $msg_data = str_replace(&quot;\r\n&quot;,&quot;\n&quot;,$msg_data);
        $msg_data = str_replace(&quot;\r&quot;,&quot;\n&quot;,$msg_data);
        $lines = explode(&quot;\n&quot;,$msg_data);

        # we need to find a good way to determine is headers are
        # in the msg_data or if it is a straight msg body
        # currently I&#39;m assuming rfc 822 definitions of msg headers
        # and if the first field of the first line (&#39;:&#39; sperated)
        # does not contain a space then it _should_ be a header
        # and we can process all lines before a blank &quot;&quot; line as
        # headers.
        $field = substr($lines[0],0,strpos($lines[0],&quot;:&quot;));
        $in_headers = false;
        if(!empty($field) &amp;&amp; !strstr($field,&quot; &quot;)) {
            $in_headers = true;
        }

        $max_line_length = 998; # used below; set here for ease in change

        while(list(,$line) = @each($lines)) {
            $lines_out = null;
            if($line == &quot;&quot; &amp;&amp; $in_headers) {
                $in_headers = false;
            }
            # ok we need to break this line up into several
            # smaller lines
            while(strlen($line) &gt; $max_line_length) {
                $pos = strrpos(substr($line,0,$max_line_length),&quot; &quot;);

                # Patch to fix DOS attack
                if(!$pos) {
                    $pos = $max_line_length - 1;
                }

                $lines_out[] = substr($line,0,$pos);
                $line = substr($line,$pos + 1);
                # if we are processing headers we need to
                # add a LWSP-char to the front of the new line
                # rfc 822 on long msg headers
                if($in_headers) {
                    $line = &quot;\t&quot; . $line;
                }
            }
            $lines_out[] = $line;

            # now send the lines to the server
            while(list(,$line_out) = @each($lines_out)) {
                if(strlen($line_out) &gt; 0)
                {
                    if(substr($line_out, 0, 1) == &quot;.&quot;) {
                        $line_out = &quot;.&quot; . $line_out;
                    }
                }
                fputs($this-&gt;smtp_conn,$line_out . $this-&gt;CRLF);
            }
        }

        # ok all the message data has been sent so lets get this
        # over with aleady
        fputs($this-&gt;smtp_conn, $this-&gt;CRLF . &quot;.&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;DATA not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Expand takes the name and asks the server to list all the
     * people who are members of the _list_. Expand will return
     * back and array of the result or false if an error occurs.
     * Each value in the array returned has the format of:
     *     [ &lt;full-name&gt; &lt;sp&gt; ] &lt;path&gt;
     * The definition of &lt;path&gt; is defined in rfc 821
     *
     * Implements rfc 821: EXPN &lt;SP&gt; &lt;string&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE FAILURE: 550
     * SMTP CODE ERROR  : 500,501,502,504,421
     * @access public
     * @return string array
     */
    function Expand($name) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Expand() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;EXPN &quot; . $name . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;EXPN not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        # parse the reply and place in our array to return to user
        $entries = explode($this-&gt;CRLF,$rply);
        while(list(,$l) = @each($entries)) {
            $list[] = substr($l,4);
        }

        return $list;
    }

    /**
     * Sends the HELO command to the smtp server.
     * This makes sure that we and the server are in
     * the same known state.
     *
     * Implements from rfc 821: HELO &lt;SP&gt; &lt;domain&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE ERROR  : 500, 501, 504, 421
     * @access public
     * @return bool
     */
    function Hello($host=&quot;&quot;) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Hello() without being connected&quot;);
            return false;
        }

        # if a hostname for the HELO wasn&#39;t specified determine
        # a suitable one to send
        if(empty($host)) {
            # we need to determine some sort of appopiate default
            # to send to the server
            $host = &quot;localhost&quot;;
        }

        // Send extended hello first (RFC 2821)
        if(!$this-&gt;SendHello(&quot;EHLO&quot;, $host))
        {
            if(!$this-&gt;SendHello(&quot;HELO&quot;, $host))
                return false;
        }

        return true;
    }

    /**
     * Sends a HELO/EHLO command.
     * @access private
     * @return bool
     */
    function SendHello($hello, $host) {
        fputs($this-&gt;smtp_conn, $hello . &quot; &quot; . $host . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER: &quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; $hello . &quot; not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        $this-&gt;helo_rply = $rply;

        return true;
    }

    /**
     * Gets help information on the keyword specified. If the keyword
     * is not specified then returns generic help, ussually contianing
     * A list of keywords that help is available on. This function
     * returns the results back to the user. It is up to the user to
     * handle the returned data. If an error occurs then false is
     * returned with $this-&gt;error set appropiately.
     *
     * Implements rfc 821: HELP [ &lt;SP&gt; &lt;string&gt; ] &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 211,214
     * SMTP CODE ERROR  : 500,501,502,504,421
     * @access public
     * @return string
     */
    function Help($keyword=&quot;&quot;) {
        $this-&gt;error = null; # to avoid confusion

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Help() without being connected&quot;);
            return false;
        }

        $extra = &quot;&quot;;
        if(!empty($keyword)) {
            $extra = &quot; &quot; . $keyword;
        }

        fputs($this-&gt;smtp_conn,&quot;HELP&quot; . $extra . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 211 &amp;&amp; $code != 214) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;HELP not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        return $rply;
    }

    /**
     * Starts a mail transaction from the email address specified in
     * $from. Returns true if successful or false otherwise. If True
     * the mail transaction is started and then one or more Recipient
     * commands may be called followed by a Data command.
     *
     * Implements rfc 821: MAIL &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE SUCCESS: 552,451,452
     * SMTP CODE SUCCESS: 500,501,421
     * @access public
     * @return bool
     */
    function Mail($from) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Mail() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;MAIL FROM:&lt;&quot; . $from . &quot;&gt;&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;MAIL not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Sends the command NOOP to the SMTP server.
     *
     * Implements from rfc 821: NOOP &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE ERROR  : 500, 421
     * @access public
     * @return bool
     */
    function Noop() {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Noop() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;NOOP&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;NOOP not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Sends the quit command to the server and then closes the socket
     * if there is no error or the $close_on_error argument is true.
     *
     * Implements from rfc 821: QUIT &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 221
     * SMTP CODE ERROR  : 500
     * @access public
     * @return bool
     */
    function Quit($close_on_error=true) {
        $this-&gt;error = null; # so there is no confusion

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Quit() without being connected&quot;);
            return false;
        }

        # send the quit command to the server
        fputs($this-&gt;smtp_conn,&quot;quit&quot; . $this-&gt;CRLF);

        # get any good-bye messages
        $byemsg = $this-&gt;get_lines();

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $byemsg;
        }

        $rval = true;
        $e = null;

        $code = substr($byemsg,0,3);
        if($code != 221) {
            # use e as a tmp var cause Close will overwrite $this-&gt;error
            $e = array(&quot;error&quot; =&gt; &quot;SMTP server rejected quit command&quot;,
                       &quot;smtp_code&quot; =&gt; $code,
                       &quot;smtp_rply&quot; =&gt; substr($byemsg,4));
            $rval = false;
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $e[&quot;error&quot;] . &quot;: &quot; .
                         $byemsg . $this-&gt;CRLF;
            }
        }

        if(empty($e) || $close_on_error) {
            $this-&gt;Close();
        }

        return $rval;
    }

    /**
     * Sends the command RCPT to the SMTP server with the TO: argument of $to.
     * Returns true if the recipient was accepted false if it was rejected.
     *
     * Implements from rfc 821: RCPT &lt;SP&gt; TO:&lt;forward-path&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250,251
     * SMTP CODE FAILURE: 550,551,552,553,450,451,452
     * SMTP CODE ERROR  : 500,501,503,421
     * @access public
     * @return bool
     */
    function Recipient($to) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Recipient() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;RCPT TO:&lt;&quot; . $to . &quot;&gt;&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250 &amp;&amp; $code != 251) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;RCPT not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Sends the RSET command to abort and transaction that is
     * currently in progress. Returns true if successful false
     * otherwise.
     *
     * Implements rfc 821: RSET &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE ERROR  : 500,501,504,421
     * @access public
     * @return bool
     */
    function Reset() {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Reset() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;RSET&quot; . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;RSET failed&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }

        return true;
    }

    /**
     * Starts a mail transaction from the email address specified in
     * $from. Returns true if successful or false otherwise. If True
     * the mail transaction is started and then one or more Recipient
     * commands may be called followed by a Data command. This command
     * will send the message to the users terminal if they are logged
     * in.
     *
     * Implements rfc 821: SEND &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE SUCCESS: 552,451,452
     * SMTP CODE SUCCESS: 500,501,502,421
     * @access public
     * @return bool
     */
    function Send($from) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Send() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;SEND FROM:&quot; . $from . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;SEND not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Starts a mail transaction from the email address specified in
     * $from. Returns true if successful or false otherwise. If True
     * the mail transaction is started and then one or more Recipient
     * commands may be called followed by a Data command. This command
     * will send the message to the users terminal if they are logged
     * in and send them an email.
     *
     * Implements rfc 821: SAML &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE SUCCESS: 552,451,452
     * SMTP CODE SUCCESS: 500,501,502,421
     * @access public
     * @return bool
     */
    function SendAndMail($from) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                &quot;error&quot; =&gt; &quot;Called SendAndMail() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;SAML FROM:&quot; . $from . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;SAML not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * Starts a mail transaction from the email address specified in
     * $from. Returns true if successful or false otherwise. If True
     * the mail transaction is started and then one or more Recipient
     * commands may be called followed by a Data command. This command
     * will send the message to the users terminal if they are logged
     * in or mail it to them if they are not.
     *
     * Implements rfc 821: SOML &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE SUCCESS: 552,451,452
     * SMTP CODE SUCCESS: 500,501,502,421
     * @access public
     * @return bool
     */
    function SendOrMail($from) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                &quot;error&quot; =&gt; &quot;Called SendOrMail() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;SOML FROM:&quot; . $from . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;SOML not accepted from server&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return true;
    }

    /**
     * This is an optional command for SMTP that this class does not
     * support. This method is here to make the RFC821 Definition
     * complete for this class and __may__ be implimented in the future
     *
     * Implements from rfc 821: TURN &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250
     * SMTP CODE FAILURE: 502
     * SMTP CODE ERROR  : 500, 503
     * @access public
     * @return bool
     */
    function Turn() {
        $this-&gt;error = array(&quot;error&quot; =&gt; &quot;This method, TURN, of the SMTP &quot;.
                                        &quot;is not implemented&quot;);
        if($this-&gt;do_debug &gt;= 1) {
            echo &quot;SMTP -&gt; NOTICE: &quot; . $this-&gt;error[&quot;error&quot;] . $this-&gt;CRLF;
        }
        return false;
    }

    /**
     * Verifies that the name is recognized by the server.
     * Returns false if the name could not be verified otherwise
     * the response from the server is returned.
     *
     * Implements rfc 821: VRFY &lt;SP&gt; &lt;string&gt; &lt;CRLF&gt;
     *
     * SMTP CODE SUCCESS: 250,251
     * SMTP CODE FAILURE: 550,551,553
     * SMTP CODE ERROR  : 500,501,502,421
     * @access public
     * @return int
     */
    function Verify($name) {
        $this-&gt;error = null; # so no confusion is caused

        if(!$this-&gt;connected()) {
            $this-&gt;error = array(
                    &quot;error&quot; =&gt; &quot;Called Verify() without being connected&quot;);
            return false;
        }

        fputs($this-&gt;smtp_conn,&quot;VRFY &quot; . $name . $this-&gt;CRLF);

        $rply = $this-&gt;get_lines();
        $code = substr($rply,0,3);

        if($this-&gt;do_debug &gt;= 2) {
            echo &quot;SMTP -&gt; FROM SERVER:&quot; . $this-&gt;CRLF . $rply;
        }

        if($code != 250 &amp;&amp; $code != 251) {
            $this-&gt;error =
                array(&quot;error&quot; =&gt; &quot;VRFY failed on name &#39;$name&#39;&quot;,
                      &quot;smtp_code&quot; =&gt; $code,
                      &quot;smtp_msg&quot; =&gt; substr($rply,4));
            if($this-&gt;do_debug &gt;= 1) {
                echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] .
                         &quot;: &quot; . $rply . $this-&gt;CRLF;
            }
            return false;
        }
        return $rply;
    }

    /*******************************************************************
     *                       INTERNAL FUNCTIONS                       *
     ******************************************************************/

    /**
     * Read in as many lines as possible
     * either before eof or socket timeout occurs on the operation.
     * With SMTP we can tell if we have more lines to read if the
     * 4th character is &#39;-&#39; symbol. If it is a space then we don&#39;t
     * need to read anything else.
     * @access private
     * @return string
     */
    function get_lines() {
        $data = &quot;&quot;;
        while($str = fgets($this-&gt;smtp_conn,515)) {
            if($this-&gt;do_debug &gt;= 4) {
                echo &quot;SMTP -&gt; get_lines(): \$data was \&quot;$data\&quot;&quot; .
                         $this-&gt;CRLF;
                echo &quot;SMTP -&gt; get_lines(): \$str is \&quot;$str\&quot;&quot; .
                         $this-&gt;CRLF;
            }
            $data .= $str;
            if($this-&gt;do_debug &gt;= 4) {
                echo &quot;SMTP -&gt; get_lines(): \$data is \&quot;$data\&quot;&quot; . $this-&gt;CRLF;
            }
            # if the 4th character is a space then we are done reading
            # so just break the loop
            if(substr($str,3,1) == &quot; &quot;) { break; }
        }
        return $data;
    }

}
 ?&gt;
</code></pre><br />А в сам файл, где будет располагаться форма, вставляем следующее (адаптируйте под себя)<br /><pre><code>&lt;form action=&quot;&quot; method=post enctype=&quot;multipart/form-data&quot;&gt;
&lt;div align=&quot;center&quot;&gt;
              &lt;p&gt;&lt;br /&gt;
                  &lt;font class=&quot;menu&quot;&gt;Full Name:*&lt;/font&gt;&lt;br /&gt;
                  &lt;input type=&quot;text&quot; name=&quot;name&quot; size=&quot;40&quot;&gt;
                  &lt;br /&gt;
                  &lt;font class=&quot;menu&quot;&gt;Contact Telephone Number:&lt;/font&gt;&lt;br /&gt;
                  &lt;input type=&quot;text&quot; name=&quot;tel&quot; size=&quot;40&quot;&gt;
                  &lt;br /&gt;
                  &lt;font class=&quot;menu&quot;&gt;Contact E-mail:*&lt;/font&gt;&lt;br /&gt;
                  &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;40&quot;&gt;
                  &lt;br /&gt;
                  &lt;font class=&quot;menu&quot;&gt;Subject:&lt;/font&gt;&lt;br /&gt;
                  &lt;input type=&quot;text&quot; name=&quot;title&quot; size=&quot;40&quot;&gt;
                  &lt;br /&gt;
                  &lt;font class=&quot;menu&quot;&gt;Message*&lt;/font&gt;&lt;br /&gt;
                 &lt;textarea rows=&quot;10&quot; name=&quot;mess&quot; cols=&quot;32&quot;&gt;&lt;/textarea&gt;
                 &lt;br /&gt;
          		  &lt;font class=&quot;menu&quot;&gt;Attach File:&lt;/font&gt;&lt;br /&gt;
                &lt;input name=&quot;attachfile&quot; type=&quot;file&quot; size=&quot;28&quot;&gt;
                &lt;br /&gt;
                 &lt;font class=&quot;menu&quot;&gt;Attach Image:&lt;/font&gt;&lt;br /&gt;
                &lt;input name=&quot;attachimage&quot; type=&quot;file&quot; size=&quot;28&quot;&gt;
                &lt;br /&gt;
                &lt;br /&gt;
                &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; name=&quot;submit&quot;&gt;
          &lt;/p&gt;
        &lt;/div&gt;
&lt;/form&gt;
&lt;font class=&quot;menu&quot;&gt;* Marked fields, which are necessarily for filling&lt;/font&gt;
&lt;?
}

function complete_mail() {
        // $_POST[&#39;title&#39;] содержит данные из поля &quot;Тема&quot;, trim() - убираем все лишние пробелы и переносы строк, htmlspecialchars() - преобразует специальные символы в HTML сущности, будем считать для того, чтобы простейшие попытки взломать наш сайт обломались, ну и  substr($_POST[&#39;title&#39;], 0, 1000) - урезаем текст до 1000 символов. Для переменных $_POST[&#39;mess&#39;], $_POST[&#39;name&#39;], $_POST[&#39;tel&#39;], $_POST[&#39;email&#39;] все аналогично
        $_POST[&#39;title&#39;] =  substr(htmlspecialchars(trim($_POST[&#39;title&#39;])), 0, 1000);
        $_POST[&#39;mess&#39;] =  substr(htmlspecialchars(trim($_POST[&#39;mess&#39;])), 0, 1000000);
        $_POST[&#39;name&#39;] =  substr(htmlspecialchars(trim($_POST[&#39;name&#39;])), 0, 30);
        $_POST[&#39;tel&#39;] =  substr(htmlspecialchars(trim($_POST[&#39;tel&#39;])), 0, 30);
        $_POST[&#39;email&#39;] =  substr(htmlspecialchars(trim($_POST[&#39;email&#39;])), 0, 50);
        // если не заполнено поле &quot;Имя&quot; - показываем ошибку 0
        if (empty($_POST[&#39;name&#39;]))
             output_err(0);
        // если неправильно заполнено поле email - показываем ошибку 1
        if(!preg_match(&quot;/[0-9a-z_]<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="250e65">[email&#160;protected]</a>[0-9a-z_^\.]+\.[a-z]{2,3}/i&quot;, $_POST[&#39;email&#39;]))
             output_err(1);
        // если не заполнено поле &quot;Сообщение&quot; - показываем ошибку 2
        if(empty($_POST[&#39;mess&#39;]))
             output_err(2);
        // обратите внимание, теперь мы можем писать красивые письма, с помощью html тегов ;-)
        $mess = &#39;
&lt;b&gt;Full Name:&lt;/b&gt;&#39;.$_POST[&#39;name&#39;].&#39;&lt;br /&gt;
&lt;b&gt;Contact Telephone Number:&lt;/b&gt;&#39;.$_POST[&#39;tel&#39;].&#39;&lt;br /&gt;
&lt;b&gt;Contact E-mail:&lt;/b&gt;&#39;.$_POST[&#39;email&#39;].&#39;&lt;br /&gt;
&#39;.$_POST[&#39;mess&#39;];

        // подключаем файл класса для отправки почты
        require &#39;class.phpmailer.php&#39;;

        $mail = new PHPMailer();
        $mail-&gt;From = &#39;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="483b29242d3b082a3a213c2926262129653b2021383821262f662b2725">[email&#160;protected]</a>&#39;;      // от кого
        $mail-&gt;FromName = &#39;Contact Us&#39;;   // от кого
        $mail-&gt;AddAddress(&#39;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8efdefe2ebfdceecfce7faefe0e0e7efa3fde6e7fefee7e0e9a0ede1e3">[email&#160;protected]</a>&#39;, &#39;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1577667d7c655578747961747b70613b7b7061">[email&#160;protected]</a>&#39;); // кому - адрес, Имя
        $mail-&gt;IsHTML(true);        // выставляем формат письма HTML
        $mail-&gt;Subject = $_POST[&#39;title&#39;];  // тема письма

        // если был файл, то прикрепляем его к письму
        if(isset($_FILES[&#39;attachfile&#39;])) {
                 if($_FILES[&#39;attachfile&#39;][&#39;error&#39;] == 0){
                    $mail-&gt;AddAttachment($_FILES[&#39;attachfile&#39;][&#39;tmp_name&#39;], $_FILES[&#39;attachfile&#39;][&#39;name&#39;]);
                 }
        }
        // если было изображение, то прикрепляем его в виде картинки к телу письма.
        if(isset($_FILES[&#39;attachimage&#39;])) {
                 if($_FILES[&#39;attachimage&#39;][&#39;error&#39;] == 0){
                    if (!$mail-&gt;AddEmbeddedImage($_FILES[&#39;attachimage&#39;][&#39;tmp_name&#39;], &#39;my-attach&#39;, &#39;image.gif&#39;, &#39;base64&#39;, $_FILES[&#39;attachimage&#39;][&#39;type&#39;]))
                         die ($mail-&gt;ErrorInfo);
                    $mess .= &#39;The image:&lt;br /&gt;&lt;img border=&quot;0&quot; src=&quot;cid:my-attach&quot; border=0&gt;&lt;br /&gt;я показал как ее прикреплять, соответственно Вам осталось вставить ее в нужное место Вашего письма ;-) &#39;;
                 }
        }
        $mail-&gt;Body = $mess;

        // отправляем наше письмо
        if (!$mail-&gt;Send()) die (&#39;Mailer Error: &#39;.$mail-&gt;ErrorInfo);
        echo &#39;Thank you, your message was submitted&#39;;
}

function output_err($num)
{
    $err[0] = &#39;ERROR! Wrong Name.&#39;;
    $err[1] = &#39;ERROR! Wrong e-mail.&#39;;
    $err[2] = &#39;ERROR! No message to submit.&#39;;
    echo &#39;&lt;p&gt;&#39;.$err[$num].&#39;&lt;/p&gt;&#39;;
    show_form();
    exit();
}

if (!empty($_POST[&#39;submit&#39;])) complete_mail();
else show_form();
?&gt;</code></pre><br />Вот в принципе и все...
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-144277"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/palpalych/">
                <span class="post-username">palpalych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/144277/">#</a>
            7 лет, 10 месяцев назад
            
                (отредактировано
                
                    7 лет, 10 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/47/d0/47d0dfe31100e02907f5e9bb71c76f86.png" alt="palpalych avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/palpalych/topics/">
                    89
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/palpalych/posts/">
                    1126
                </a>
            </div>
            <div>
                Участник с: 09 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>neobrave</em><br>Вот в принципе и все...</blockquote>спасибо, но чета как то многовато, у меня всего 5 строк, которые благодаря exim работают, осталось проверку прикрутить...
            
                
                    <div class="post-signature">
                        Арчи ~]$ ...as always want ready-made solutions that would make even tastier
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-144279"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/neobrave/">
                <span class="post-username">neobrave</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/144279/">#</a>
            7 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/neobrave/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/neobrave/posts/">
                    64
                </a>
            </div>
            <div>
                Участник с: 22 октября 2013
            </div>
            
        </td>
        <td class="post-content">
            Exim зато сам далеко не 5 строк. То, что я выше выложил - полнофунциональный SMTP сервер в 2-х маленьких файликах. Проверку легче всего прикручивать с помощью JS. (Если сайт на CMS - наверняка есть уже встроенная проверка (с подсветкой +100500), наилучший вариант ей и воспользоваться, чтобы не плодить велосипедов.<br /><br />Если нет то <a href="http://htmlweb.ru/java/example/test_form.php">вот</a> образец (пример) реализации.<br /><br />Всего доброго
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-144311"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/palpalych/">
                <span class="post-username">palpalych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/144311/">#</a>
            7 лет, 10 месяцев назад
            
                (отредактировано
                
                    7 лет, 10 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/47/d0/47d0dfe31100e02907f5e9bb71c76f86.png" alt="palpalych avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/palpalych/topics/">
                    89
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/palpalych/posts/">
                    1126
                </a>
            </div>
            <div>
                Участник с: 09 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            для смс уведомлений хотелось что-то из буржуйских продвинутых сервисов, нет доверия отечественным, итог API Twilio, цена смс-ки 1 цент, помучился с моим то знанием буржуйского...
            
                
                    <div class="post-signature">
                        Арчи ~]$ ...as always want ready-made solutions that would make even tastier
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-145318"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/palpalych/">
                <span class="post-username">palpalych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/145318/">#</a>
            7 лет, 9 месяцев назад
            
                (отредактировано
                
                    7 лет, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/47/d0/47d0dfe31100e02907f5e9bb71c76f86.png" alt="palpalych avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/palpalych/topics/">
                    89
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/palpalych/posts/">
                    1126
                </a>
            </div>
            <div>
                Участник с: 09 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            короче переустановил VDS, видимо где-то чего-то забыл, <strong>Exim</strong> перестал работать, вопрос что для exima должно прописываться в php.ini, может пользователь должен в группах состоять? права где выставить нужно? как его обратно прикрутить?<br />самое интересное что *.php &quot;срабатывает&quot;(я так понимаю возвращает true раз появляется сообщение об отправке ), а письма не приходят...<br />а как можно узнать может дело не в Exim...<br /><pre><code>~]$ php mail.php
PHP Notice:  Undefined index: name in /home/archie/www/<a href="http://site.ru/mail.php">site.ru/mail.php</a> on line 3
PHP Notice:  Undefined index: tel in /home/archie/www/<a href="http://site.ru/mail.php">site.ru/mail.php</a> on line 4
PHP Notice:  Undefined index: mail in /home/archie/www/<a href="http://site.ru/mail.php">site.ru/mail.php</a> on line 5
PHP Warning:  mail(/var/log/php_mail.log): failed to open stream: Permission denied in /home/archie/www/<a href="http://site.ru/mail.php">site.ru/mail.php</a> on line 10
2014-12-07 02:39:17 1XxOwX-00003G-7W Failed to create spool file /var/spool/exim/input//1XxOwX-00003G-7W-D: Permission denied
2014-12-07 02:39:17 1XxOwX-00003G-7W Failed to create spool file /var/spool/exim/input//1XxOwX-00003G-7W-D: Permission denied
2014-12-07 02:39:17 1XxOwX-00003G-7W Failed to create spool file /var/spool/exim/input//1XxOwX-00003G-7W-D: Permission denied
</code></pre><br /><pre><code>&lt;?php

$name = mb_substr(stripslashes(preg_replace(&#39;/[-`~!#$%^&amp;*()_=+\\\\|\\/\\[\\]{};: &quot;\&#39;,&lt;&gt;?]+/&#39;, &#39;&#39;, (string)$_POST[&#39;name&#39;])), 0, 10,&#39;UTF-8&#39;);
$phone = trim(preg_replace(&#39;/[-`~!#$%^&amp;*()_=+\\\\|\\/\\[\\]{};: &quot;\&#39;,&lt;&gt;?]+/&#39;, &#39;&#39;, (string)$_POST[&#39;tel&#39;]));
$mes = mb_substr(stripslashes(preg_replace(&#39;/[-`~!#$%^&amp;*()_=+\\\\|\\/\\[\\]{};:&quot;\&#39;,&lt;&gt;?]+/&#39;, &#39;&#39;, (string)$_POST[&#39;mail&#39;])), 0, 48,&#39;UTF-8&#39;);
$address = &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="761b171f1a36111b171f1a5815191b">[email&#160;protected]</a>&quot;;
$sub = $name.$phone;
$email = &#39;&lt;site.ru&gt;&#39;;

$send = mail ($address, $sub, $mes, &quot;Content-type:text/plain; charset = utf-8\r\nFrom:$email&quot;);
?&gt;</code></pre>
            
                
                    <div class="post-signature">
                        Арчи ~]$ ...as always want ready-made solutions that would make even tastier
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-145322"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/klay/">
                <span class="post-username">klay</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/145322/">#</a>
            7 лет, 9 месяцев назад
            
                (отредактировано
                
                    7 лет, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/74/c9/74c972ee8c86b980b618089b03f0b761.png" alt="klay avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/klay/topics/">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/klay/posts/">
                    67
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2012
            </div>
            
        </td>
        <td class="post-content">
            <pre><code>chmod u+x /var/spool/exim</code></pre>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-145326"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/palpalych/">
                <span class="post-username">palpalych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/145326/">#</a>
            7 лет, 9 месяцев назад
            
                (отредактировано
                
                    7 лет, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/47/d0/47d0dfe31100e02907f5e9bb71c76f86.png" alt="palpalych avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/palpalych/topics/">
                    89
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/palpalych/posts/">
                    1126
                </a>
            </div>
            <div>
                Участник с: 09 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>klay</em><br><pre><code>chmod u+x /var/spool/exim</code></pre></blockquote>не помогло<br />точно никаких групп создавать для юзера не надо?
            
                
                    <div class="post-signature">
                        Арчи ~]$ ...as always want ready-made solutions that would make even tastier
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-145328"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/palpalych/">
                <span class="post-username">palpalych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/145328/">#</a>
            7 лет, 9 месяцев назад
            
                (отредактировано
                
                    7 лет, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/47/d0/47d0dfe31100e02907f5e9bb71c76f86.png" alt="palpalych avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/palpalych/topics/">
                    89
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/palpalych/posts/">
                    1126
                </a>
            </div>
            <div>
                Участник с: 09 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            странно почему в прошлый раз все завелось с пол пинка а щас возникли проблемы?<br />нашел <a href="https://github.com/Exim/exim/wiki/Q0044">вот это</a>, осталось только сделать как написано, у меня не хватает мозгов это сделать...<br /><br />Переустановил и все заработало...<br />только все падает в спам и как в прошлый раз не лечится...<br /><br />если <a href="https://www.digitalocean.com/community/tutorials/how-to-setup-exim-spamassassin-clamd-and-dovecot-on-an-arch-linux-vps">как здесь</a> поставить spamassassin и/или dovecotот этого что-то измениться?
            
                
                    <div class="post-signature">
                        Арчи ~]$ ...as always want ready-made solutions that would make even tastier
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-145354"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/cucullus/">
                <span class="post-username">cucullus</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/145354/">#</a>
            7 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/3e/fc/3efc5087b47b238689d6b1152d129048.png" alt="cucullus avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/cucullus/topics/">
                    257
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/cucullus/posts/">
                    3438
                </a>
            </div>
            <div>
                Участник с: 06 июня 2007
            </div>
            
        </td>
        <td class="post-content">
            у меня вот так:<br /><pre><code>drwxrwx--- 5 root    exim  4096 Apr  7  2014 exim</code></pre>
            
                
                    <div class="post-signature">
                        такие дела.
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=4" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=5">5 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/14119/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747b53bc9bff9d98',m:'oiyBCV4n_xocq.hw00HBLi8VM_6QE80cQ1skROFE2XM-1662678316-0-AUZTwRYYrRYL9vyMiMiQJIVNQQ7yQE0XNykWDUOo5nwuplz6LBmhf9CDW97xLjbBe5d+zpim4SjcfEV4fI1upYfvKtWAXffdFAyeZSM747dVmc6n8MKYr4DKxtedHVWsqM9zMfYKpW0VrS1sC/SrXaU=',s:[0x010839761f,0xd4ecdae935],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
