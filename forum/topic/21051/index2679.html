


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/21051/?page=1 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:09:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        archi - набор скриптов для установки Arch linux
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/6/index.html">Разработка</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/21/index.html">Разработки арчеводов</a> <span class="divider">/</span></li>
            
        
        
            <li>archi - набор скриптов для установки Arch linux</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>archi - набор скриптов для установки Arch linux</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252001"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/ksandr/index.html">
                <span class="post-username">ksandr</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252001/index.html">#</a>
            9 месяцев, 2 недели назад
            
                (отредактировано
                
                    9 месяцев, 2 недели назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/ksandr/topics/index.html">
                    1
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/ksandr/posts/index.html">
                    3
                </a>
            </div>
            <div>
                Участник с: 02 апреля 2021
            </div>
            
        </td>
        <td class="post-content">
            Приветствую единомышленников.<br /><br />Хочу рассказать о своём проекте. archi - live-iso с графическим инсталлятором Arch linux.<br /><br />Условно проект можно разделить на две части:<br />- Профиль к archiso для создания образа iso.<br />- archi.py - скрипт на python для установки.<br /><br />На образе установлен графический режим по умолчанию(xfce4).<br />За основу взят профиль для официального образа.<br />Несколько дополнительный приложений включенных в образ:<br />- <a href="https://github.com/AdguardTeam/AdGuardHome">AdGuardHome</a> - локальный DNS сервер с настроенными правилами фильтрации.<br />- <a href="https://xn--80akicokc0aablc.xn--p1ai/о_продукте">Ассистент</a> - удалённый помощник.<br />archi.py для графического интерфейса используется библиотека TK.<br />Есть пару страничек документации в WiKi.<br /><br />ссылка репозитория на гитхаб - <a href="https://github.com/ksandronline/archi">https://github.com/ksandronline/archi</a><br /><br />p.s. После того как я написал ядро скрипта, нашёл много давно написанных решений.<br />Но тем не менее мне всё равно приятно иметь под рукой свой дистрибутив со своими настройками.<br /><br />И немного картинок:<br />1<br /><a href="https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-1.png">https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-1.png</a><br /><br />2<br /><a href="https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-2.png">https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-2.png</a><br /><br />3<br /><a href="https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-3.png">https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-3.png</a><br /><br />4<br /><a href="https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-4.png">https://raw.githubusercontent.com/ksandronline/archi/main/screenshots/screen-4.png</a>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252005"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/RusWolf/index.html">
                <span class="post-username">RusWolf</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252005/index.html">#</a>
            9 месяцев, 2 недели назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8a/00/8a00073bdfb852ab8504f1e6d4c044f4.png" alt="RusWolf avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/RusWolf/topics/index.html">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/RusWolf/posts/index.html">
                    2394
                </a>
            </div>
            <div>
                Участник с: 16 июля 2016
            </div>
            
        </td>
        <td class="post-content">
            <strong>ksandr</strong>, это всё хорошо, но не универсально.<br />Вот если бы был выбор, между разными DE для установки и выбора какие драйвера на видео ставить.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252034"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vadik/index.html">
                <span class="post-username">vadik</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252034/index.html">#</a>
            9 месяцев, 2 недели назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vadik/topics/index.html">
                    55
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vadik/posts/index.html">
                    5395
                </a>
            </div>
            <div>
                Участник с: 17 августа 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>ksandr</em><br>И немного картинок:</blockquote>Картинки удалил, оставил только ссылки.<br />Хотите показать картинки - используйте превьюшки, а не полноразмерные изображения.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252035"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Nebulosa/index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252035/index.html">#</a>
            9 месяцев, 2 недели назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Nebulosa/topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Nebulosa/posts/index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Очень не хватает, описания системы которая получится в результате: какая разметка диска, DE, файловая система. Также ограничения по использованию - если у меня, например, два диска или мне нужен дуалбут - как это сработает?..
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252399"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/ksandr/index.html">
                <span class="post-username">ksandr</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252399/index.html">#</a>
            9 месяцев, 1 неделя назад
            
                (отредактировано
                
                    9 месяцев, 1 неделя назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/ksandr/topics/index.html">
                    1
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/ksandr/posts/index.html">
                    3
                </a>
            </div>
            <div>
                Участник с: 02 апреля 2021
            </div>
            
        </td>
        <td class="post-content">
            <strong>Более подробнее описание профиля.</strong><br /><br />В официальный профиль Arch linux добавлены некоторые приложения и настройки.<br />Доп. приложения на диске.<br />- Xorg + XFCE4<br />- Браузеры Firefox и Chromium.<br />- Фильтрующий DNS-сервер AdGuardHome.<br />- Редактор Sublime 4.<br />- Антивирусы Clamav + rkhunter.<br />- Средство помощник для удалённого администрирования &quot;Ассистент&quot;.<br />- KDEconnect - для передачи файлов между смартфонами и компьютером.<br />- Список не полный есть ещё много повседневных программок.<br /><br />Настройки по умолчанию:<br />Настроена локализация на русский язык, согласно официальной документации.<br />Для настройки сети включён по умолчанию Network Manager и настроен на динамическое получение ИП-адресов.<br />В качестве DNS сервера указан локальный хост. (Рекомендации по этому вопросу есть на рабочем столе системы.)<br />Включён tigervnc.<br />Включён sshd.<br />Включён Avahi. ()<br /><br />Что убрано/отключено:<br />#reflector - Причины две: 1. Субъективная(НЕ нравиться). 2. Прописаны Российские зеркала по умолчанию.<br />#linux-atm - Что это такое?(Кому надо тот включит.)<br />#grml-zsh-config - настроена своя тема zsh.<br /><br />.<br /><strong>Более подробнее описание скрипта установки.</strong><br /><br />Скрипт разбит на несколько секций.<br />В первом разделе содержаться переменный с параметрами для настройки.<br />Во втором необходимые функции и самой первой arch_install()<br />Также есть раздел с функциями для GUI.<br /><br />Настройки по умолчанию я старался подбирать из расчёта на &quot;новичков&quot;, подробнее:<br /><br />Разбиение диска - на данный момент есть два варианта:<br />использовать весь диск.<br />использовать существующий раздел диска.<br /><br />При первом выборе.<br />По умолчанию форматирование производиться в btrfs.<br />диск разбивается на разделы: SWAP = ОЗУ<br />и всё остальное отдаётся под корневую систему.<br /><br />При выборе установки на существующий раздел.<br />Раздел не форматируется. Раздел просто монтируется и скрипт пытается установить на него систему.<br />При необходимости ручного разбиения диска, рекомендуется сначала использовать Gparted.<br />В интерфейсе есть кнопка для его запуска и ссылка на официальную документацию на русском языке.<br /><br />Переменная со списком устанавливаемых пакетов находится в самом начале скрипта, не заметить - не возможно.<br />Возможности выбирать пакеты из интерфейса нет.(пока)<br />Все пакеты устанавливаются из официальных репозиториев, кроме последней группы. Она устанавливается из специально созданного репозитория archi, они специально собраны в одном месте для удобства их редактировать.<br /><br />Установка Grub - есть три варианта: BIOS, UEFI, None. (None - не устанавливать.)<br /><br />Некоторые &quot;особенные&quot; настройки:<br />Включён по умолчанию: lightdm, и tigervnc. Настройки tigervnc взяты с официальной документации.(Можно подключиться к экрану выбора пользователей.)<br />Включён и настроен AdGuardHome, файл настроек тот же что и на live-iso.<br />Включён настроен Avahi. ()<br />Установлен pamac. Из пакета из доп. репозитория archi.<br /><br />Конфигурационный файл pacman.conf в готовой системы используется стандартный установленный pacman`ом по умолчанию.<br />Конфигурационный файл pacman.conf для установки системы используется /root/pacman.conf(отличается включенным репозиторием archi)<br /><br />GUI будет заменён. Сейчас используется библиотека TK будет скорее всего Qt.<br />Принцип работы GUI.<br />После нажатия кнопки установить, запускается процесс установки параллельным потоком. Высь вывод этого процесса записывается в лог-файл.<br />В интерфейс обычным tail выводиться содержимое этого лог-файла.<br /><u><strong>Самое важное!</strong></u><br />Различия между профилем и скриптом для установки.<br />Профиль создаётся для создания iso в качестве rescue диска. Тоесть в нём будет много коммуникационным программок и утилит.<br /><br />Скрипт для установки, устанавливает систему Arch linux с наименьшим необходимым, но достаточным списком пакетов.<br /><br />Списки пакетов и настройки, используемые в профиле и скрипте могут(Так оно и есть) отличаться.<br /><br />Основная задача: Создание удобной простой и интуитивно понятной системы, для создания собственного образа iso и скрипта для основной установки системы + пользовательские добавления.<br /><br />И вместо картинок несколько кусочков листинга скрипта установки:<br /><br /><pre><code>
def install_arch():
    prepare_disk()                          # Подготовка диска
    _run(pacstrap + [root_mount_path] + base_sys)    # Установка базовой системы
    basic_configure()                               # Конфигурирование базовой системы

    # Берём конфиг с iso для установки
    _run([&quot;cp&quot;, &quot;-v&quot;, &quot;/etc/pacman.conf&quot;, root_mount_path + &quot;/root/pacman.conf&quot;])
    # Копируем настройки пользователя по умолчанию
    _run([&quot;cp&quot;, &quot;-aT&quot;, &quot;/etc/skel/&quot;, root_mount_path + &quot;/etc/skel/&quot;])

    args = [&quot;useradd&quot;, &quot;--create-home&quot;, &quot;--password&quot;, cryptPassword(user_pass,&quot;md5&quot;), add_user]    # Добавляем пользователя
    _run(chroot + args)
    _run(chroot + [&quot;chmod&quot;, &quot;+x&quot;, &quot;-v&quot;, &quot;/home/&quot;+ add_user +&quot;/Desktop/*.desktop&quot;])

    args = [&quot;usermod&quot;, &quot;--password&quot;, cryptPassword(root_pass,&quot;md5&quot;), &quot;root&quot;]    # Меняем пароль для Root`а
    _run(chroot + args)
    _run([&quot;cp&quot;, &quot;-v&quot;, &quot;/etc/skel/.zshrc&quot;, root_mount_path + &quot;/root/.zshrc&quot;])
    fr_st_base_sys.configure(background=color3) # Первый пункт выполнен

    # Ядро
    if kernel_var.get() == 1:   linux = linux_std
    elif kernel_var.get() == 2: linux = linux_lts
    elif kernel_var.get() == 3: linux = linux_zen
    _run([&quot;cp&quot;, &quot;-v&quot;, &quot;/etc/default/grub&quot;, root_mount_path + &quot;/etc/default/grub&quot;])
    _run(chroot + pacman + kernel + linux)  # Установка ядра и загрузчика
    _run([&quot;mkdir&quot;, &quot;-v&quot;, root_mount_path + &quot;/boot/grub&quot;, root_mount_path + &quot;/boot/grub/themes&quot;])
    _run([&quot;cp&quot;, &quot;-aT&quot;, &quot;/root/grub/themes/&quot;, root_mount_path + &quot;/boot/grub/themes/&quot;])

    # Загрузчик
    if grub_var.get() == 1:
        while _run(chroot + [&quot;grub-install&quot;, &quot;/dev/&quot;+use_disk.get()]) &gt; 0:  # BIOS
            time.sleep(1)
        time.sleep(1)
    elif grub_var.get() == 2:
        while _run(chroot + [&quot;grub-install&quot;]) &gt; 0:  # UEFI
            time.sleep(1)
        time.sleep(1)
    elif grub_var.get() == 3:
        _show(&quot;Загрузчик не установлен.&quot;)

    grub_mkconfig = [&quot;grub-mkconfig&quot;, &quot;-o&quot;, &quot;/boot/grub/grub.cfg&quot;]
    while _run(chroot + grub_mkconfig) &gt; 0:
        time.sleep(1)
    time.sleep(1)

    fr_st_kernel.configure(background=color3)   # Второй пункт выполен

# Xorg
    _run(chroot + pacman + xorg)

    _write([lightdm_conf],               root_mount_path + &quot;/etc/lightdm/lightdm.conf&quot;)
    _write([lightdm_gtk_greeter_conf],   root_mount_path + &quot;/etc/lightdm/lightdm-gtk-greeter.conf&quot;)

    _write([xvnc_service],   root_mount_path + &quot;/etc/systemd/system/xvnc@.service&quot;)
    _write([xvnc_socket],    root_mount_path + &quot;/etc/systemd/system/xvnc.socket&quot;)

    _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;lightdm.service&quot;])
    fr_st_xorg.configure(background=color3)     # Третий пункт

# xfce4
    _run(chroot + pacman + xfce4)

    for dev in net_devs:        # Сетевые интерфейсы
        if net_devs[dev][&quot;tk_var_DHCP&quot;].get() == 1:
            wired_network = &quot;&quot;&quot;# DHCP
[connection]
id=LAN
uuid=28ffe244-9a09-3c28-8bea-4ce030028109
type=ethernet
interface-name={dev}
permissions=

[ethernet]
mac-address-blacklist=

[ipv4]
dns=127.0.0.1;
dns-search={domain}
ignore-auto-dns=true
method=auto

[ipv6]
addr-gen-mode=stable-privacy
dns-search=
method=auto

[proxy]
&quot;&quot;&quot;.format(dev=dev, domain=domain)
            _write([wired_network],root_mount_path + &quot;/etc/NetworkManager/system-connections/LAN.nmconnection&quot;)
        else:
            wired_network = &quot;&quot;&quot;# Статический ip-адрес
[connection]
id=LAN
uuid=28ffe244-9a09-3c28-8bea-4ce030028109
type=ethernet
interface-name={dev}
permissions=

[ethernet]
mac-address-blacklist=

[ipv4]
address1={ip},{gw}
dns={dns};
dns-search={domain}
ignore-auto-dns=true
method=auto

[ipv6]
addr-gen-mode=stable-privacy
dns-search=
method=auto

[proxy]
&quot;&quot;&quot;.format(dev=dev, ip=net_devs[dev][&quot;ent_ip&quot;].get(), gw=net_devs[dev][&quot;ent_gw&quot;].get(), dns=net_devs[dev][&quot;ent_dns&quot;].get(), domain=domain)
            _write([wired_network],root_mount_path + &quot;/etc/NetworkManager/system-connections/LAN.nmconnection&quot;)

    _run(chroot + [&quot;chmod&quot;, &quot;-v&quot;, &quot;600&quot;, &quot;/etc/NetworkManager/system-connections/LAN.nmconnection&quot;])
    if net_manager_default == &quot;networkmanager&quot;:
        _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;NetworkManager.service&quot;])
    fr_st_xfce4.configure(background=color3)

# Дополнения
    _run(chroot + pacman + utils)
    usermod = [&quot;usermod&quot;, &quot;--shell&quot;, &quot;/bin/zsh&quot;, &quot;root&quot;]    # Меняем шелл для Root`а
    _run(chroot + usermod)
    usermod = [&quot;usermod&quot;, &quot;--shell&quot;, &quot;/bin/zsh&quot;, add_user]    # Меняем шелл для юзера.
    _run(chroot + usermod)
    _run(chroot + [&quot;ln&quot;, &quot;-svf&quot;, &quot;/usr/share/doc/arch-wiki/html/ru&quot;, &quot;/home/&quot;+ add_user +&quot;/Desktop/Оффициальное WiKi локальная версия&quot;])
    _write([add_user, &quot;ALL=(ALL)&quot;, &quot;ALL&quot;], root_mount_path + &quot;/etc/sudoers.d/archi&quot;)  # Разрешаем юзеру sudo

    _write([nsswitch_conf], root_mount_path + &quot;/etc/nsswitch.conf&quot;)      # Настраиваем Avahi
    _write([avahi_vnc_service], root_mount_path + &quot;/etc/avahi/services/vnc.service&quot;)
    _write([avahi_ssh_service], root_mount_path + &quot;/etc/avahi/services/ssh.service&quot;)
    _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;avahi-daemon.service&quot;])
    _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;xvnc.socket&quot;])

    _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;sshd.service&quot;])       # Запускаем SSH сервер

    _write_end([default_pa], root_mount_path + &quot;/etc/pulse/default.pa&quot;)      # Настраиваем звук по сети.
    fr_st_utils.configure(background=color3)

# Pamac
    _run(chroot + pacman + pamac_aur)
    _write([pamac_conf],root_mount_path + &quot;/etc/pamac.conf&quot;)
    fr_st_pamac.configure(background=color3)

    _show(&quot;Пока из aur пакеты не собираются.&quot;)
    #_run(chroot + pamac + utils_aur)
    if TRUE:
        fr_st_utils_aur.configure(background=&quot;RED&quot;)
    else:
        fr_st_utils_aur.configure(background=color3)

# Шрифты
    _run(chroot + pacman + fonts)
    fr_st_fonts.configure(background=color3)

    _run(chroot + pacman + brows)
    fr_st_brows.configure(background=color3)

# Бонусы
    _run(chroot + pacman + custom)
    _run([&quot;cp&quot;, &quot;-v&quot;, &quot;/var/lib/adguardhome/AdGuardHome.yaml&quot;, root_mount_path + &quot;/var/lib/adguardhome/AdGuardHome.yaml&quot;])
    _run([&quot;mkdir&quot;, &quot;-v&quot;, root_mount_path + &quot;/etc/systemd/resolved.conf.d&quot;])
    _run([&quot;cp&quot;, &quot;-v&quot;, &quot;/etc/systemd/resolved.conf.d/adguardhome.conf&quot;, root_mount_path + &quot;/etc/systemd/resolved.conf.d/adguardhome.conf&quot;])
    _run(chroot + [&quot;/var/lib/adguardhome/AdGuardHome&quot;, &quot;-v&quot;, &quot;--service&quot;, &quot;install&quot;])

    fr_st_custom.configure(background=color3)

    _run([&quot;cp&quot;, &quot;-v&quot;, log_install, root_mount_path + &quot;/root/install.log&quot;])
    _run([&quot;umount&quot;, root_mount_path])
    time.sleep(1)

    _show(&quot;Установка Arch linux завершена.&quot;)
    _show(&quot;Лог-файл установки скопирован в /root/install.log&quot;)

</code></pre><br /><pre><code>
def prepare_disk():
    # Если BIOS: отступаем 1 Мб от начала диска, создаём swap = ОЗУ, на всём оставшемся создаём раздел для корневой системы.
    # Если UEFI: создаём FAT раздел на 512 Мб, создаём swap = ОЗУ, на всём оставшемся создаём раздел для корневой системы.
    if use_disk_or_partition.get() == 1:    # Использовать весь диск
        if use_disk.get():
            parted = [&quot;parted&quot;, &quot;--script&quot;, &quot;/dev/&quot;+use_disk.get()]
            mem_bytes = os.sysconf(&#39;SC_PAGE_SIZE&#39;) * os.sysconf(&#39;SC_PHYS_PAGES&#39;)
            mem_gib = mem_bytes/(1024.**3)
            mem_str = str(round(mem_gib))
            if grub_var.get() == 1:         # BIOS
                _run(parted + [&quot;mklabel&quot;, &quot;msdos&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;linux-swap&quot;, &quot;1MiB&quot;, mem_str+&quot;GiB&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;btrfs&quot;, mem_str+&quot;GiB&quot;, &quot;100%&quot;])

                _run([&quot;mkswap&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;1&quot;])
                mkfs_command = [&quot;mkfs.btrfs&quot;, &quot;-f&quot;]
                root_partition = [&quot;/dev/&quot;+use_disk.get()+&quot;2&quot;]
                _run(mkfs_command + root_partition)

                _run([&quot;swapon&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;1&quot;])
                _run([&quot;mount&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;2&quot;, root_mount_path])
            elif grub_var.get() == 2:       # UEFI
                _run(parted + [&quot;mklabel&quot;, &quot;gpt&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;fat32&quot;, &quot;1MiB&quot;, &quot;512MiB&quot;])
                _run(parted + [&quot;name&quot;, &quot;1&quot;, &quot;EFI&quot;])
                _run(parted + [&quot;set&quot;, &quot;1&quot;, &quot;esp&quot;, &quot;on&quot;])
                _run(parted + [&quot;set&quot;, &quot;1&quot;, &quot;boot&quot;, &quot;on&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;linux-swap&quot;, &quot;512MiB&quot;, mem_str+&quot;GiB&quot;])  # TODO Добавить к swap &quot;512MiB&quot;
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;btrfs&quot;, mem_str+&quot;GiB&quot;, &quot;100%&quot;])

                mkfs_command = [&quot;mkfs.fat&quot;, &quot;-F&quot;, &quot;32&quot;]
                uefi_partition = [&quot;/dev/&quot;+use_disk.get()+&quot;1&quot;]
                _run(mkfs_command + uefi_partition)
                uefi_mount = [&quot;mount&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;1&quot;, root_mount_path+&quot;/boot/efi&quot;]
                _run(uefi_mount)

                _run([&quot;mkswap&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;2&quot;])
                mkfs_command = [&quot;mkfs.btrfs&quot;, &quot;-f&quot;]
                root_partition = [&quot;/dev/&quot;+use_disk.get()+&quot;3&quot;]
                _run(mkfs_command + root_partition)

                _run([&quot;swapon&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;2&quot;])
                _run([&quot;mount&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;3&quot;, root_mount_path])
            elif grub_var.get() == 3:       # None
                _run(parted + [&quot;mklabel&quot;, &quot;msdos&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;linux-swap&quot;, &quot;1MiB&quot;, mem_str+&quot;GiB&quot;])
                _run(parted + [&quot;mkpart&quot;, &quot;primary&quot;, &quot;btrfs&quot;, mem_str+&quot;GiB&quot;, &quot;100%&quot;])

                _run([&quot;mkswap&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;1&quot;])
                mkfs_command = [&quot;mkfs.btrfs&quot;, &quot;-f&quot;]
                root_partition = [&quot;/dev/&quot;+use_disk.get()+&quot;2&quot;]
                _run(mkfs_command + root_partition)

                _run([&quot;swapon&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;1&quot;])
                _run([&quot;mount&quot;, &quot;/dev/&quot;+use_disk.get()+&quot;2&quot;, root_mount_path])
        else:
            _show(&quot;Необходимо выбрать диск.&quot;)
    elif use_disk_or_partition.get() == 2:  # Использовать выбранный раздел.
        if select_partition.get():
            mkfs_command = [&quot;mkfs.btrfs&quot;, &quot;-f&quot;, select_partition.get()]
            _run([&quot;mkfs.btrfs&quot;, &quot;-f&quot;, select_partition.get()])
            _run([&quot;mount&quot;, select_partition.get(), root_mount_path])
        else:
            _show(&quot;Необходимо выбрать раздел.&quot;)
</code></pre><br /><pre><code>
def basic_configure():
    # fstab
    _show(&quot;Генерируем файл /etc/fstab&quot;)
    genfstab_command = [&quot;genfstab&quot;, &quot;-U&quot;, root_mount_path]
    while _run(genfstab_command) &gt; 0:
        time.sleep(1)
    time.sleep(1)
    fstab = root_mount_path + &quot;/etc/fstab&quot;
    with open(fstab, &quot;w&quot;) as file:
        Popen(genfstab_command, stdout=file, encoding=&#39;utf-8&#39;, text=True).wait()

    # Locale
    locale_gen = &quot;&quot;&quot;
ru_RU.UTF-8 UTF-8
en_US.UTF-8 UTF-8
    &quot;&quot;&quot;
    _write([locale_gen],root_mount_path + &quot;/etc/locale.gen&quot;)
    while _run(chroot + [&quot;locale-gen&quot;]) &gt; 0:
        time.sleep(1)
    time.sleep(1)
    _write([&quot;LANG=ru_RU.UTF-8&quot;],root_mount_path + &quot;/etc/locale.conf&quot;)
    vconsole_conf = &quot;&quot;&quot;
KEYMAP=ru
FONT=cyr-sun16
    &quot;&quot;&quot;
    _write([vconsole_conf],root_mount_path + &quot;/etc/vconsole.conf&quot;)

    # Net
    hostname = entry_hostname.get()
    _write([hostname],root_mount_path + &quot;/etc/hostname&quot;)

    hosts = &quot;&quot;&quot;
127.0.0.1   localhost
127.0.0.1   {hostname}.local {hostname}
    &quot;&quot;&quot;.format(hostname=hostname)    # TODO Поменять ip
    _write([hosts],root_mount_path + &quot;/etc/hosts&quot;)

    for dev in net_devs:        # Сетевые интерфейсы
        if net_devs[dev][&quot;tk_var_DHCP&quot;].get() == 1:
            wired_network = &quot;&quot;&quot;# DHCP
[Match]
Name={dev}

[Network]
DHCP=yes
&quot;&quot;&quot;.format(dev=dev)
            _write([wired_network],root_mount_path + &quot;/etc/systemd/network/20-wired.network&quot;)
        else:
            wired_network = &quot;&quot;&quot;# Статический ip-адрес
[Match]
Name={dev}

[Network]
Address={ip}
Gateway={gw}
DNS={dns}
&quot;&quot;&quot;.format(dev=dev, ip=net_devs[dev][&quot;ent_ip&quot;].get(), gw=net_devs[dev][&quot;ent_gw&quot;].get(), dns=net_devs[dev][&quot;ent_dns&quot;].get())
            _write([wired_network],root_mount_path + &quot;/etc/systemd/network/20-wired.network&quot;)

    if net_manager_default == &quot;systemd&quot;:
        _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;systemd-networkd&quot;])
    _run(chroot + [&quot;systemctl&quot;, &quot;enable&quot;, &quot;systemd-resolved&quot;])

    resolv_conf = &quot;&quot;&quot;
nameserver 127.0.0.1
domain {domain}
    &quot;&quot;&quot;.format(domain=domain)
    _write([resolv_conf],root_mount_path + &quot;/etc/resolv.conf&quot;)

    # Time
    _run(chroot + [&quot;ln&quot;, &quot;-sfv&quot;, &quot;/usr/share/zoneinfo/&quot;+ array_tz[combo_tz.get()][1], &quot;/etc/localtime&quot;])
    _run(chroot + [&quot;hwclock&quot;, &quot;--systohc&quot;])
    _show(&quot;Часовой пояс: &quot;+ combo_tz.get()+ &quot; &quot;+ array_tz[combo_tz.get()][0])
</code></pre><br />p.s. to Admin/Moderator: Я очень редко пишу на форумах. На указанные мне ошибки буду обращать внимание и делать исправления.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252401"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252401/index.html">#</a>
            9 месяцев, 1 неделя назад
            
                (отредактировано
                
                    9 месяцев, 1 неделя назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>ksandr</em><br>Средство помощник для удалённого администрирования &quot;Ассистент&quot;.</blockquote><strong>vadik</strong>, товарища надо забанить для профилактики.
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252443"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vadik/index.html">
                <span class="post-username">vadik</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252443/index.html">#</a>
            9 месяцев, 1 неделя назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vadik/topics/index.html">
                    55
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vadik/posts/index.html">
                    5395
                </a>
            </div>
            <div>
                Участник с: 17 августа 2009
            </div>
            
        </td>
        <td class="post-content">
            <strong>indeviral</strong>, что не так (я действительно не в курсе)?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252445"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vs220/index.html">
                <span class="post-username">vs220</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252445/index.html">#</a>
            9 месяцев, 1 неделя назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vs220/topics/index.html">
                    22
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vs220/posts/index.html">
                    8070
                </a>
            </div>
            <div>
                Участник с: 16 августа 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vadik</em><br>что не так</blockquote>По умолчанию вроде ставится удаленный доступ, с какими конфигами не смотрел.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252446"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/zotkindm/index.html">
                <span class="post-username">zotkindm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252446/index.html">#</a>
            9 месяцев, 1 неделя назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/zotkindm/topics/index.html">
                    70
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/zotkindm/posts/index.html">
                    567
                </a>
            </div>
            <div>
                Участник с: 21 мая 2014
            </div>
            
        </td>
        <td class="post-content">
            Зачем это все? Если трудно установить, используй манджару, там все уже реализовано.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-252460"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/252460/index.html">#</a>
            9 месяцев, 1 неделя назад
            
                (отредактировано
                
                    9 месяцев, 1 неделя назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vadik</em><br>что не так</blockquote>ну эта проприетарная шляпа которая постоянно ломится на внешку(TeamViewer и т.п.)<br />может афтор конечно ничего плохого и не хочет... но желание добавить малоизвестные софт с таким функционалом, немножко настораживает.<br />тем более устанавливается это чудо из репозитория афтора.
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/index3609.html?next=/forum/topic/21051/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/21051/?page=1 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:09:49 GMT -->
</html>
