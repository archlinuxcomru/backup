


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/1054/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:13:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Удаление зависимостей юнитов systemd
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/2/index.html">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/23/index.html">Демоны и загрузка системы</a> <span class="divider">/</span></li>
            
        
        
            <li>Удаление зависимостей юнитов systemd</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Удаление зависимостей юнитов systemd</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10004"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10004/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            Насколько мне известно, существует относительно удобный способ частичного переопределения дистрибутивных юнитов путём включение их в свои через <strong>.include</strong> и последующего ДОБАВЛЕНИЯ параметров.<br/><br/>Однако, мне ещё ни разу не удалось им воспользоваться, хотя мне пришлось переопределить уже несколько юнитов.<br/>Причина – во всех случаях мне требовалось, кроме всего прочего, ОТМЕНИТЬ некоторые зависимости этих юнитов, но мне НЕизвестны способы ОТКЛЮЧАТЬ уже имеющиеся параметры, только добавлять новые.<br/><br/>Кто-нибудь знает, как это можно сделать?<br/>До сих пор я просто копировал файлы юнитов из <strong>/usr/lib/systemd/system/</strong> в <strong>/etc/systemd/system/</strong> и редактировал копии. Это работает, но мне не нравится перспектива в будущем заниматься ручной синхронизацией содержимого этих файлов в случае обновления.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10005"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10005/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Что-то подобное упомянуто в &ldquo;man systemd.unit&rdquo; сразу после таблицы спецификаторов:<br/><blockquote>If a unit file is empty (i.e. has the file size 0) or is symlinked to /dev/null its configuration will not be loaded and it appears with a load state of masked, and cannot be activated. Use this as an effective way to fully disable a unit, making it impossible to start it even manually.</blockquote>То есть, таким способом можно вообще выключить любой юнит.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10006"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10006/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            Спасибо за совет, но мне нужно не выключить юнит, а убрать у него некоторые лишние зависимости, чтобы запустить его раньше :)
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10007"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10007/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Для изменения порядка да, только Before=, After= и Requires=. Причем Requires= будет иметь приоритет перед After=, как я понял из того же мана.<br/>Пока только так&#8230;
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10008"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10008/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            Допустим, некоторые сетевые демоны являются серверами, а не клиентами, и для их запуска не требуется предварительная настройка сети, потому что они не будут сами ни к кому подключаться, а только ждать, когда подключатся к ним. Соответственно, для них них надо из After= убрать <strong>network.target</strong><br/><br/>Далее, у нас есть юниты, необходимые для запуска getty, то есть логина в консоли, но они зависят в том числе от <strong>remote-fs.target</strong> . Даже если у меня есть удалённо монтируемые каталоги, в моём случае они не требуются на самом деле для логина, если конечно, /home на монтируется тоже по сети.<br/>Юнит <strong>remote-fs.target</strong> вполне логично и ожидаемо будет готов не просто после готовности сети, но аж после завершения монтирования сетевых каталогов. Если нам не требуется для нормального логина ждать этого, то надо убрать у некоторых юнитов зависимости от <strong>remote-fs.target</strong><br/><br/>Пока я не нашел, как сделать это иначе, чем скопировав файлы юнитов целиком и исправив в них нужные строчки.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10009"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10009/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            При таком перфекционистском подходе, думаю, копирование юнитов единственное решение на данном этапе развития systemd. Хотя, как Вы заметили, не самое легкое при необходимости отслеживания изменений. Все таки, для большинства предлагаемая последовательность загрузки вполне приемлема.<br/>   Хочу сделать замечание относительно примера с сетевыми демонами: как раз тем сервисам, которые выступают в качестве серверов, необходимо наличие сети, т.к. биндинг портов для прослушивания подключений происходит к конкретным интерфейсам с ip адресами, которые при старте уже должны быть подняты. Например, если поднять named, а потом поднять еще один интерфейс, то named не станет слушать на этом новом интерфейсе без перезапуска демона. (Впрочем, уверен, что просто пример был приведен не совсем удачный.)
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10010"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10010/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br/>При таком перфекционистском подходе</blockquote>Какой уж тут перфекционистский подход? Главным достоинством systemd объявлена возможность одновременного запуска демонов, однако идущие &ldquo;из коробки&rdquo; юниты этого не обеспечивают, даже хуже – если в initcripts достаточно добавить @ перед именем демона в rc.conf, чтобы не ждать его готовности, то тут надо править юниты. В результате, к примеру, если у вас включён юнит для dhcpcd, то при отключённой сети вы будете ждать, пока истечёт таймаут, и только потом сможете добраться до логина. Борьба с этим не особенно похожа на перфекционизм, не так ли?<br/><br/><blockquote>Хочу сделать замечание относительно примера с сетевыми демонами: как раз тем сервисам, которые выступают в качестве серверов, необходимо наличие сети, т.к. биндинг портов для прослушивания подключений происходит к конкретным интерфейсам с ip адресами, которые при старте уже должны быть подняты. Например, если поднять named, а потом поднять еще один интерфейс, то named не станет слушать на этом новом интерфейсе без перезапуска демона. (Впрочем, уверен, что просто пример был приведен не совсем удачный.)</blockquote>В моём случае ни один демон-сервер не биндится к интерфейсам и конкретным айпи.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-10011"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Ostland/index.html">
                <span class="post-username">Ostland</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/10011/index.html">#</a>
            10 лет назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/eb/d2/ebd2103f330fc91a7a04926cbeafdedd.png" alt="Ostland avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/Ostland/topics/index.html">
                    34
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Ostland/posts/index.html">
                    389
                </a>
            </div>
            <div>
                Участник с: 22 сентября 2010
            </div>
            
        </td>
        <td class="post-content">
            Идеально будет, если этот вопрос вы зададите самому Поттерингу, например в <a href="https://plus.google.com/115547683951727699051/posts">гуглоплюсе</a>. Он там постоянно обитает, так что шанс на ответ очень высок.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/index5268.html?next=/forum/topic/1054/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/1054/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:13:42 GMT -->
</html>
