


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/19992/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:09:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Вызов hcd-&gt;driver-&gt;hub_control()
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/6/index.html">Разработка</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/19/index.html">Уголок разработчика</a> <span class="divider">/</span></li>
            
        
        
            <li>Вызов hcd-&gt;driver-&gt;hub_control()</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Вызов hcd-&gt;driver-&gt;hub_control()</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230923"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vikaig/index.html">
                <span class="post-username">vikaig</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230923/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vikaig/topics/index.html">
                    3
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vikaig/posts/index.html">
                    11
                </a>
            </div>
            <div>
                Участник с: 11 мая 2019
            </div>
            
        </td>
        <td class="post-content">
            Хочу вызвать вот этот участок кода с нужными мне аргументами <a href="https://github.com/torvalds/linux/blob/07c4b9e9f71aa4bc74009f710fc5a745e10981bf/drivers/usb/core/hcd.c#L682">https://github.com/torvalds/linux/blob/07c4b9e9f71aa4bc74009f710fc5a745e10981bf/drivers/usb/core/hcd.c#L682</a><br />Как это проще всего сделать? Судя по коду для этого есть интерфейс USB Request Block, но я в ядерной разработке так себе, мне бы пример, а желательно вообще из юзерспейса через write() в блочный девайс или что-то в этом роде
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230924"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230924/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vikaig</em><br>Как это проще всего сделать? Судя по коду для этого есть интерфейс USB Request Block</blockquote>Думаешь у нас тусуются разработчики, имеющие отношение к URB? … думаю вряд ли, они обычно тусуются на других форумах. Но имеются отдельные любопытные, имеющие отношение к  анализу дампов (usbdump, usbmon) блоков запроса USB, но их в большей степени интересует расшифровка этих запросов.<br />А потому интересно узнать, что тебя больше интересует разработка или обработка?<br />Если разработка, то маловероятно, что кто то что то посоветует конкретное. Начни с азов: <a href="https://www.kernel.org/doc/html/v4.15/driver-api/usb/URB.html">USB Request Block</a> … <a href="http://dmilvdv.narod.ru/Translate/LDD3/ldd_usb_urbs.html">Блоки запроса USB</a><br />А если обработка, то в этом случае структура/формат URB запросов хорошо документировано, но это похоже тебе не нужно.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230927"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230927/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <strong>vikaig</strong>, не дает мне покоя любопытство - если не секрет, что такое специфическое изобретаешь. Для стандартного вроде все имеется ... и вряд ли это связано с драйверами. USB/IP, что то связанное с пробросом, но здесь тоже имеется готовый инструмент, да и причем тут URB ... а потому и интересно - что же это такое будет.<br />Но, скорее всего, как всегда - думаешь о сложном, а окажется что то простое.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230929"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vikaig/index.html">
                <span class="post-username">vikaig</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230929/index.html">#</a>
            2 года, 3 месяца назад
            
                (отредактировано
                
                    2 года, 3 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vikaig/topics/index.html">
                    3
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vikaig/posts/index.html">
                    11
                </a>
            </div>
            <div>
                Участник с: 11 мая 2019
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vasek</em><br><blockquote><em>vikaig</em><br>Как это проще всего сделать? Судя по коду для этого есть интерфейс USB Request Block</blockquote>Думаешь у нас тусуются разработчики, имеющие отношение к URB? … думаю вряд ли, они обычно тусуются на других форумах. Но имеются отдельные любопытные, имеющие отношение к  анализу дампов (usbdump, usbmon) блоков запроса USB, но их в большей степени интересует расшифровка этих запросов.<br />А потому интересно узнать, что тебя больше интересует разработка или обработка?<br />Если разработка, то маловероятно, что кто то что то посоветует конкретное. Начни с азов: <a href="https://www.kernel.org/doc/html/v4.15/driver-api/usb/URB.html">USB Request Block</a> … <a href="http://dmilvdv.narod.ru/Translate/LDD3/ldd_usb_urbs.html">Блоки запроса USB</a><br />А если обработка, то в этом случае структура/формат URB запросов хорошо документировано, но это похоже тебе не нужно.</blockquote>Вроде форум по линю и раздел по разработке, так что как ни странно именно это и ожидал...<br />Интересует меня только разовая отправка управляющей команды драйверу USB хост контроллера чтоб проверить ее результат, сама разработка как-такова меня не интересует, задача чисто разовая, нужно просто проверить пропадет ли питание на USB порте при отправке команды ClearPortFeature(USB_PORT_FEAT_POWER), именно эту управляющую команду я нашел в документации к ядру по управлению энергопотреблением USB устройств, через sysfs ее как я понял нельзя отправить
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230931"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230931/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vikaig</em><br>нужно просто проверить <strong>пропадет ли питание на USB порте</strong> при отправке команды</blockquote>В принципе выражение отключить питание шины/порта USB не верное, фактически такое не возможно в принципе - под этим обычно понимается отключить устройство от шины/порта USB (програмно), но питание на шину подается всегда - просто прекращается общение устройства с шиной и это устройство как бы не видимо, оно отсутствует в выоде lsusb.<br />После того как выполнено подключение устройства к шине/порту USB, в дальнейшем это устройство постоянно находится в режиме ожидания.<br />Одни устройства периодически отправляют сигналы (запросы) хосту, а тот отвечает, даже если ничего не происходит, например, мой USB 3G modem при бездействии с периодичностью в 30с шлет запрос на hub, а тот отвечает, привожу URB запросы<br /><pre><code>ffff9a4f76193840 2330901147 S Bo:2:003:1 -115 14 = 7ec02109 3e000887 7231df56 427e
ffff9a4f76193840 2330901235 C Bo:2:003:1 0 14 &gt;
ffff9a4f74253c00 2330901627 C Bi:2:003:1 0 23 = 7eff7d23 c0217d2a 3e7d207d 287d207d 207d2543 27ba7e
ffff9a4f74253c00 2330901649 S Bi:2:003:1 -115 4096 &lt;</code></pre>А вот USB мышь ничего не отправляет в режиме бездействия, отправляет данные только при наличии событий/движений мыши<br /><pre><code>ffff9a4f749fd240 2042930506 C Ii:1:003:1 0:8 6 = 0100ff0f 0000
ffff9a4f749fd240 2042930594 S Ii:1:003:1 -115:8 6 &lt;
ffff9a4f749fd240 2042938415 C Ii:1:003:1 0:8 6 = 0100ff1f 0000
ffff9a4f749fd240 2042938496 S Ii:1:003:1 -115:8 6 &lt;</code></pre>Но это все упрощенно, в действительности все намного сложнее.Инициатором обмена всегда выступает хост. Устройство не может начать передачу данных по собственной инициативе. Хост поочередно (с интервалом в несколько милисекунд) опрашивает все подключенные устройства. Каждый раз, при опросе, устройство может получить данные от хоста и отправить данные хосту.<br />Да и забыл отметить, что устройство в целях эконмии энергии переводится в другой режим энергопотребления, но способно быстро приступить к своим прямым обязанностям.<br /><br />И если нужно смореть состояние USB устройства, то оно имеет, как бы это сказать, только 2 состояния<br />- подключено, прошло энумерацию, и видно в выводе lsusb<br />- не подключено, программно (физически воткнуто в порт), не видно в выоде lsusb.<br /><br /><strong>PS</strong> - Многое забыл, писал по памяти, возможно что то и на путал/ошибся ...
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230932"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vikaig/index.html">
                <span class="post-username">vikaig</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230932/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vikaig/topics/index.html">
                    3
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vikaig/posts/index.html">
                    11
                </a>
            </div>
            <div>
                Участник с: 11 мая 2019
            </div>
            
        </td>
        <td class="post-content">
            да я тоже так думал, но вот один человек утверждает, что пока он не заменил на ThinkPad свою древнюю убунту с древним ядом 2.6.34 на свежую версию, то у него в режиме сна не было питания на USB портах, а теперь на 5.4.0 присутствует, то есть таки есть какое-то управление
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230933"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230933/index.html">#</a>
            2 года, 3 месяца назад
            
                (отредактировано
                
                    2 года, 3 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Вот подумай, чтобы отключить питание какого то устройства, нужно физически разорвать цепь питания ... вопрос - неужели в цепи питания порта USB имеется какое то устройство, скажем просто, стоит рэле устройство, которое при подаче определенного сигнала разрывает цепь? - нет такого устройства.<br />А вот энергосбережение, разные состояния, имеется. Точно не помню, забылось, но раньше было подругому - в файлах устройств USB (в /sys/.../) был параметр autosuspend и что то еще там (не помню), который мог принимать несколько значений, а потом это изменилось, точнее упростилось (если не ошибаюсь, то сейчас всего 2 значения on и auto )  - лень копаться в архивах ............. а вообще лучше в этой части почитать <a href="https://www.mjmwired.net/kernel/Documentation/usb/power-management.txt">power-management</a><br /><br /><strong>PS</strong> - а вообще если есть желание узнать наверняка, то рекомендую обратиться к спецификации USB - правда она на английском и более 1000 страниц, но есть русский перевод (не полный) части, касающейся электрической части - там все подробно расписано.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230934"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230934/index.html">#</a>
            2 года, 3 месяца назад
            
                (отредактировано
                
                    2 года, 3 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Поднял старые записи<br /><u>БЫЛО в части power/level</u><br /><pre><code>This file contains one of three words: &quot;on&quot;, &quot;auto&quot;,or &quot;suspend&quot;.  You can write those words to the file to change the device&#39;s setting.
&quot;on&quot; means that the device should be resumed and autosuspend is not allowed.  (Of course, system suspends are still allowed.)
&quot;auto&quot; is the normal state in which the kernel is allowed to autosuspend and autoresume the device.
&quot;suspend&quot; means that the device should remain suspended, and autoresume is not allowed.  (But remote wakeup may still be allowed, since it is controlled separately by the power/wakeup attribute.)</code></pre><br /><u>СТАЛО в части power/level</u><br /><pre><code>This file contains one of two words: &quot;on&quot; or &quot;auto&quot;. You can write those words to the file to change the device&#39;s setting.
 &quot;on&quot; means that the device should be resumed and autosuspend is not allowed.  (Of course, system suspends are still allowed.)
 &quot;auto&quot; is the normal state in which the kernel is allowed to autosuspend and autoresume the device.
(In kernels up to 2.6.32, you could also specify &quot;suspend&quot;, meaning that the device should remain suspended and autoresume was not allowed. This setting is no longer supported.)</code></pre><br />Обрати внимание - раньше был параметр &quot;suspend&quot; - который означал, что <strong>устройство должно оставаться приостановленным, а автоматическое возобновление запрещено. Этот параметр больше не поддерживается</strong><br /><br /><strong>EDIT 1</strong> - по дефолту стоит <strong>auto</strong>, например для устройств на usb3 (usb mouse)<br />cat /sys/bus/usb/devices/usb3/power/level<br /><strong>auto</strong>
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230936"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230936/index.html">#</a>
            2 года, 3 месяца назад
            
                (отредактировано
                
                    2 года, 3 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Ну и если по существу вопроса (решил освежить в памяти эти запросы)<br /><pre><code>status = hcd-&gt;driver-&gt;hub_control (hcd,
            typeReq, wValue, wIndex,
            t0x0002buf, wLength);</code></pre><br />применительно к запросу Get Status поля запроса будут следующие<br /><pre><code>- bmRequestType (битовая маска) = 10000001
- bRequest = 0x00
- wValue = 0x0000
- wIndex = 0x0000
- wLength = 0x0002</code></pre>В ответ хост должен вернуть 2 байта в следующем формате:<br /><pre><code>бит 0 - Self Powered (режим питания устройства: 0 - питание от шины, 1 - от внешнего источника)
бит 1 - Remote Wakeup (реакция на сигнал пробуждения: 0 - устройство игнорирует сигнал пробуждения, 1-  устройство реагирует на этот сигнал)
бит 2 -15 - зарезервировано (не используются и должны содержать нули)</code></pre>... и в итоге, получив это ответ, не возможно, точнее нет такого понятия <u>есть питание или нет питания</u>, что еще раз доказывает, что если устройство подключено и прошло энумерацию, то оно постоянно находится в дежурном режиме и в любой момент готово принять запрос от хоста или передать ему. А вот в случае отсутствия питания, не возможно ни отправить запрос, ни получить ответ.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-230957"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vikaig/index.html">
                <span class="post-username">vikaig</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/230957/index.html">#</a>
            2 года, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vikaig/topics/index.html">
                    3
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vikaig/posts/index.html">
                    11
                </a>
            </div>
            <div>
                Участник с: 11 мая 2019
            </div>
            
        </td>
        <td class="post-content">
            Потратил всего пол часа времени и вышло это:<br /><pre><code>#include &lt;linux/module.h&gt;
#include &lt;linux/kernel.h&gt;
#include &lt;linux/usb.h&gt;
#include &lt;linux/usb/hcd.h&gt;

static int __init mod_init(void) {
    printk(&quot;mod_init();\n&quot;);

    mutex_lock(&amp;usb_bus_idr_lock);

    struct usb_bus *bus;
    int id;
    idr_for_each_entry(&amp;usb_bus_idr, bus, id) {
        struct usb_device *hub_dev = bus-&gt;root_hub;

        printk(&quot;USB Bus: %d\n&quot;, bus-&gt;busnum);
        printk(&quot;Vendor Id: %x, Product Id: %x\n&quot;,
            hub_dev-&gt;descriptor.idVendor, hub_dev-&gt;descriptor.idProduct);

        usb_lock_device(hub_dev);

        int port;
        struct usb_device *dev;
        usb_hub_for_each_child(hub_dev, port, dev) {
            printk(&quot;Child Vendor Id: %x, Product Id: %x\n&quot;,
                dev-&gt;descriptor.idVendor, dev-&gt;descriptor.idProduct);

            int ret = usb_control_msg(dev, usb_sndctrlpipe(dev, 0),
                USB_REQ_CLEAR_FEATURE, USB_RT_PORT, USB_PORT_FEAT_POWER, port,
                NULL, 0, 1000
            );

            if (ret &lt; 0) {
                printk(&quot;ret &lt; 0: %d&quot;, ret);
            }
        }

        usb_unlock_device(hub_dev);
    }

    mutex_unlock(&amp;usb_bus_idr_lock);
    return 0;
}

static void __exit mod_exit(void) {
    printk(&quot;mod_exit();\n&quot;);
}

module_init(mod_init);
module_exit(mod_exit);

MODULE_LICENSE(&quot;GPL&quot;);
</code></pre>Только вот у меня usb_control_msg() возвращает -EPIPE:<br /><blockquote>[108766.034483] mod_init();<br />[108766.034485] USB Bus: 1<br />[108766.034486] Vendor Id: 1234, Product Id: 2<br />[108766.034487] Child Vendor Id: 4123, Product Id: 2345<br />[108766.036371] ret &lt; 0: -32<br />[108766.036375] Child Vendor Id: 3534, Product Id: 56<br />[108767.059848] ret &lt; 0: -110<br />[108767.059853] USB Bus: 2<br />[108767.059857] Vendor Id: 1654, Product Id: 5</blockquote>В документации написано &quot;The pipe type specified in the URB doesn’t match the endpoint’s actual type.&quot;, есть у кого идеи как исправить?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/indexece0.html?next=/forum/topic/19992/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/19992/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:09:46 GMT -->
</html>
