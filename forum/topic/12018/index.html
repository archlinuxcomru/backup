


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/12018/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:28:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        [SOLVED] Указатели и динамические массивы в С
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/6/index.html">Разработка</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/19/index.html">Уголок разработчика</a> <span class="divider">/</span></li>
            
        
        
            <li>[SOLVED] Указатели и динамические массивы в С</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>[SOLVED] Указатели и динамические массивы в С</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115183"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/arcanis/index.html">
                <span class="post-username">arcanis</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115183/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8e/cd/8ecde9b9bf77f0b2a47300c7eb3d904f.png" alt="arcanis avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/arcanis/topics/index.html">
                    31
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/arcanis/posts/index.html">
                    1496
                </a>
            </div>
            <div>
                Участник с: 09 сентября 2012
            </div>
            
        </td>
        <td class="post-content">
            Есть тут спецы по сям?)<br/>Кусок кода:<br/><div class="code"><pre>  int *num_mol_agl;
  for (i=from; i&lt;to+1; i++)
  {
/* здесь рабочий блок, объявление каких то переменный, в т.ч. и num_mol */
    if (i == from)
    {
      agl = (int *) malloc (num_mol * num_mol * sizeof (int));
      connect = (int *) malloc (num_mol * num_mol * sizeof (int));
      num_mol_agl = (int *) malloc (num_mol * sizeof (int));
      stat = (int *) malloc (num_mol * sizeof (int));
      stat_all = (int *) malloc (num_mol * sizeof (int));
    }
/* продолжение */
  }
  num_mol_agl[num_mol-1] = num_mol;
  printf ("%i - %i\n", num_mol-1, num_mol_agl[num_mol-1]);
//   free memory
  free (agl);
  free (connect);
  free (coords);
  free (crit);
  free (label_mol);
//   memory crash here
  free (num_mol_agl);
//   free (stat);
//   free (stat_all);
  free (true_label_mol);
  free (type_atoms);
  return 0;</pre></div><br/>Теперь описание проблемы:<br/>Программа рабочая на 146%. Но крашится в конце на освобождении памяти для массивов (для любого из) <strong>num_mol_agl</strong>, <strong>stat</strong> и <strong>stat_all</strong> (те, что объявляются самые последние). Обращение к этим массивам (в т.ч. непосредственно перед free) осуществляется нормально. Но крашится( ЧЯДНТ?<br/><br/>PS <a href="http://pastebin.com/i0V1C57r">лог ошибки</a><br/>PPS <a href="http://pastebin.com/wfVQ6xH6">весь main</a> (многабукаф)
            
                
                    <div class="post-signature">
                        PGP <a href="http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;exact=on&amp;search=0x779CD2942629B7FA04AB8F172E89012331361F01">0x31361F01</a><br /><a href="https://repo.arcanis.me/">arcanisrepo</a>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115198"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115198/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Так как уже поздновато, давайте для начала с двумя очевидными возможными причинами разберемся:<br/><strong>1)</strong> Немного некрасиво выглядит блок выделения памяти внутри цикла for, но это больше касается стиля программирования, а не ошибка. Гораздо хуже, что <strong>не проверяется возвращаемое значение функции malloc</strong>, что бы убедиться, что память действительно выделена. То, что потом можно обращаться к членам массива, еще ни о чем не говорит.<br/><strong>2)</strong> В строке<br/><div class="code"><pre>printf ("%i - %i\n", num_mol-1, num_mol_agl[num_mol]);</pre></div>"num_mol_agl[<strong>num_mol</strong>]" обращается к памяти за границей динамической области. (Последний член должен быть <strong>num_mol-1</strong>). Возможно, эта попытка чтения за границей выделенной памяти провоцирует вылет.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115199"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/arcanis/index.html">
                <span class="post-username">arcanis</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115199/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8e/cd/8ecde9b9bf77f0b2a47300c7eb3d904f.png" alt="arcanis avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/arcanis/topics/index.html">
                    31
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/arcanis/posts/index.html">
                    1496
                </a>
            </div>
            <div>
                Участник с: 09 сентября 2012
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br/><strong>1)</strong> Немного некрасиво выглядит блок выделения памяти внутри цикла for, но это больше касается стиля программирования, а не ошибка. Гораздо хуже, что <strong>не проверяется возвращаемое значение функции malloc</strong>, что бы убедиться, что память действительно выделена. То, что потом можно обращаться к членам массива, еще ни о чем не говорит.</blockquote>1) согласен, что не красиво, но num_mol, необходимый для выделения памяти, определяется только в первой процедуре цикла (дальше он каждый раз переприсваивается, хотя числовое значение не изменяется). Хотя, конечно, можно ресайз сделать (в ближайшее время так и сделаю). В цикле на тестовых данных программа находится 1 раз (to==from).<br/>Насчет проверки, если честно, я плохо понял, что подразумевается. (num_mol_agl != NULL) возвращает true. Кстати, если выделить память под массив в самом начале (после определения переменных), то все равно крашится:<br/><div class="code"><pre>num_mol_agl = (int *) malloc (250 * sizeof (int));</pre></div>(num_mol = 250)<br/><blockquote><em>kurych</em><br/><strong>2)</strong> В строке "num_mol_agl[<strong>num_mol</strong>]" обращается к памяти за границей динамической области. (Последний член должен быть <strong>num_mol-1</strong>). Возможно, эта попытка чтения за границей выделенной памяти провоцирует вылет.</blockquote>2) извиняюсь, это было специально сделано таким образом (мне было любопытно, что изменится, если я вылезу за границу массива). При копировании сюда забыл исправить. Подредактирую первый пост, чтобы не вводить в заблуждение<br/>Специально вернул назад, попробовал. Сейчас там вот так<br/><div class="code"><pre>num_mol_agl[num_mol-1] = num_mol;
printf ("%i - %i\n", num_mol-1, num_mol_agl[num_mol-1]);</pre></div>вывод<br/><div class="code"><pre>249 - 250
/* текст ошибки */</pre></div><br/>Еще попробовал каждый раз в начале цикла выделять память (как показано выше в этом посте), в конце очищать - все равно краш (все другие упоминания, есно были убраны).
            
                
                    <div class="post-signature">
                        PGP <a href="http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;exact=on&amp;search=0x779CD2942629B7FA04AB8F172E89012331361F01">0x31361F01</a><br /><a href="https://repo.arcanis.me/">arcanisrepo</a>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115210"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/sirocco/index.html">
                <span class="post-username">sirocco</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115210/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/sirocco/topics/index.html">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/sirocco/posts/index.html">
                    2501
                </a>
            </div>
            <div>
                Участник с: 25 июля 2007
            </div>
            
        </td>
        <td class="post-content">
            Попробовать через valgrind?<br/><br/>А вообще - программа может крашиться из-за более раннего кода.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115213"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/arcanis/index.html">
                <span class="post-username">arcanis</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115213/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8e/cd/8ecde9b9bf77f0b2a47300c7eb3d904f.png" alt="arcanis avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/arcanis/topics/index.html">
                    31
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/arcanis/posts/index.html">
                    1496
                </a>
            </div>
            <div>
                Участник с: 09 сентября 2012
            </div>
            
        </td>
        <td class="post-content">
            изменил код с выделением памяти в начале программы:<br/><div class="code"><pre>num_mol_agl = (int *) malloc (2 * sizeof (int));
/* */</pre></div>и изменением размера в цикле for:<br/><div class="code"><pre>num_mol_agl = (int *) realloc (num_mol_agl, num_mol * sizeof (int));</pre></div>+ добавил проверку NULL (если верить ману в случае неудачи возвращается именно это значение):<br/><div class="code"><pre>if (num_mol_agl == NULL)
{
  printf ("Memory error (error code: 17)\n");
  return 17;
}</pre></div>ошибка не выпадает.<br/><br/>Проверил еще раз функции, в которых используется эта переменная - только либо присваивание, либо вызов значения
            
                
                    <div class="post-signature">
                        PGP <a href="http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;exact=on&amp;search=0x779CD2942629B7FA04AB8F172E89012331361F01">0x31361F01</a><br /><a href="https://repo.arcanis.me/">arcanisrepo</a>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115214"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/arcanis/index.html">
                <span class="post-username">arcanis</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115214/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8e/cd/8ecde9b9bf77f0b2a47300c7eb3d904f.png" alt="arcanis avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/arcanis/topics/index.html">
                    31
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/arcanis/posts/index.html">
                    1496
                </a>
            </div>
            <div>
                Участник с: 09 сентября 2012
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>sirocco</em><br/>Попробовать через valgrind?<br/><br/>А вообще - программа может крашиться из-за более раннего кода.</blockquote>че т там много букв, мне страшно)<br/><div class="code"><pre>valgrind -q --log-file=valgrind.log ./statgen -i oct-clb -s 1,1 -c 35.747,35.747,35.747 -a 1 -r 0-0:4.55 -o test.dat -l test.log -q</pre></div><a href="http://pastebin.com/4zGQ6E1c">valgrind.log</a><br/>(verbose не помещается =))<br/>видимо, интересует этот кусок:<br/><div class="code"><pre>==4529== Syscall param write(buf) points to uninitialised byte(s)
==4529==    at 0x520A1D0: __write_nocancel (in /usr/lib/libc-2.17.so)
==4529==    by 0x51A5352: _IO_file_write@@GLIBC_2.2.5 (in /usr/lib/libc-2.17.so)
==4529==    by 0x51A4A12: new_do_write (in /usr/lib/libc-2.17.so)
==4529==    by 0x51A6184: _IO_do_write@@GLIBC_2.2.5 (in /usr/lib/libc-2.17.so)
==4529==    by 0x51A5B1F: _IO_file_close_it@@GLIBC_2.2.5 (in /usr/lib/libc-2.17.so)
==4529==    by 0x519A567: fclose@@GLIBC_2.2.5 (in /usr/lib/libc-2.17.so)
==4529==    by 0x404E82: summary_statistic (in /home/arcanis/Documents/github/moldyn/stat_new/statgen)
==4529==    by 0x4020DA: main (in /home/arcanis/Documents/github/moldyn/stat_new/statgen)
==4529==  Address 0x4023089 is not stack'd, malloc'd or (recently) free'd</pre></div>только вот тут еще ругается на <strong>summary_statistic</strong>, который выглядит так:<br/><div class="code"><pre>int summary_statistic (char *filename, int step, int num_mol, const int *type_agl, const int *stat_all)</pre></div>(в этой функции только печать).<br/>До освобождения памяти стоит как раз эта функция, которая печатает в файл. она прорабатывается до конца без ошибок, т.е. падает именно на освобождении памяти. И именно конкретных 3х массивов (неважно где освобождать память).
            
                
                    <div class="post-signature">
                        PGP <a href="http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;exact=on&amp;search=0x779CD2942629B7FA04AB8F172E89012331361F01">0x31361F01</a><br /><a href="https://repo.arcanis.me/">arcanisrepo</a>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115217"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115217/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Еще эта строка смущает:<div class="code"><pre>
error = reading_coords (filename, type_inter, label_atom, cell, &amp;num_mol,
                            &amp;num_atoms, true_label_mol, label_mol, type_atoms, coords);</pre></div>Аргумент num_mol передается по ссылке и может быть изменен в функции. С первым возвращенным значением выделяется память при i==from. В других итерациях возвращенные значения num_mol могут быть другие, и манипуляции с элементами массивов могут выходить за границы динамических областей, т.к. вложенные циклы зависят от этой переменной. Плюс, не производится проверка успеха вызова reading_coords.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115218"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/sirocco/index.html">
                <span class="post-username">sirocco</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115218/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/sirocco/topics/index.html">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/sirocco/posts/index.html">
                    2501
                </a>
            </div>
            <div>
                Участник с: 25 июля 2007
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>arcanis</em><br/>че т там много букв, мне страшно)<br/></blockquote>Программа собрана, как <a href="http://valgrind.org/docs/manual/quick-start.html">советуют</a>, с -g -O0?<br/><br/><blockquote><em>arcanis</em><br/>До освобождения памяти стоит как раз эта функция, которая печатает в файл. она прорабатывается до конца без ошибок, т.е. падает именно на освобождении памяти. И именно конкретных 3х массивов (неважно где освобождать память).</blockquote>Интересно, а если забить на освобождение памяти? Вроде при завершении программы она должна автоматом освобождаться?<br/><br/><br/>Вариант - попробовать собрать clang-ом с <a href="https://code.google.com/p/address-sanitizer/wiki/AddressSanitizer">Address Sanitizer</a>.<br/><br/>На stackoverflow встречаются <a href="http://stackoverflow.com/questions/6761843/memory-error-with-free">подобные проблемы</a>.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115221"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/arcanis/index.html">
                <span class="post-username">arcanis</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115221/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8e/cd/8ecde9b9bf77f0b2a47300c7eb3d904f.png" alt="arcanis avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/arcanis/topics/index.html">
                    31
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/arcanis/posts/index.html">
                    1496
                </a>
            </div>
            <div>
                Участник с: 09 сентября 2012
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br/>Аргумент num_mol передается по ссылке и может быть изменен в функции. С первым возвращенным значением выделяется память при i==from. В других итерациях возвращенные значения num_mol могут быть другие, и манипуляции с элементами массивов могут выходить за границы динамических областей, т.к. вложенные циклы зависят от этой переменной. Плюс, не производится проверка успеха вызова reading_coords.</blockquote>так и задумано - он определяется именно в этой функции (вместе с большинством аргументов, которые передаются ссылками). То что он может быть изменен - да (в теории), но не задумано программой (и входными данными) априори. К тому же, как я говорил выше, для теста используется только 1 проход по циклу.<br/><blockquote><em>sirocco</em><br/>Программа собрана, как <a href="http://valgrind.org/docs/manual/quick-start.html">советуют</a>, с -g -O0?</blockquote>мм, неа. Пересобрал, вроде <a href="http://pastebin.com/7wucbuZx">вывод</a> не изменился. Ну бОльшая часть ругани там на вызовы типа:<br/><div class="code"><pre>a = atoi (&amp;string[n]);</pre></div>(к массивам, на которых крашится эти команды отношения не имеют - num_mol и num_mol_agl набираются "++", обнуление в начале есть)<br/><blockquote><em>sirocco</em><br/>Интересно, а если забить на освобождение памяти? Вроде при завершении программы она должна автоматом освобождаться?</blockquote>в этом плане да, я уже думал - все рабочее вроде как, утечки памяти быть не может здесь. Но вроде как уже самому интересно, что там не так. За ссылку спасибо, видел уже подобное, правда решений (объяснений) внятных так и не увидел
            
                
                    <div class="post-signature">
                        PGP <a href="http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;exact=on&amp;search=0x779CD2942629B7FA04AB8F172E89012331361F01">0x31361F01</a><br /><a href="https://repo.arcanis.me/">arcanisrepo</a>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-115222"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/kurych/index.html">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/115222/index.html">#</a>
            9 лет, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/kurych/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/kurych/posts/index.html">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Если временно собрать программу с закомментированным вызовом summary_statistic, ошибка все равно вылетает?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="index2679.html?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index4658.html?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/indexbcdc.html?next=/forum/topic/12018/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/12018/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:28:41 GMT -->
</html>
