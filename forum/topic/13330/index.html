


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Проблема с доступом к программной точке доступа
    </title>
    <link rel="shortcut icon" href="https://archlinuxcomru.github.io/backup/src/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    

    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://archlinuxcomru.github.io/backup/src/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/13/">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>Проблема с доступом к программной точке доступа</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Проблема с доступом к программной точке доступа</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133685"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bsm/">
                <span class="post-username">bsm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133685/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bsm/topics/">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bsm/posts/">
                    184
                </a>
            </div>
            <div>
                Участник с: 18 января 2012
            </div>
            
        </td>
        <td class="post-content">
            Здравствуйте. Пытаюсь использовать в качестве программной точки доступа Wi-Fi адаптор TP-Link TL-WN851ND. Что сделано: создан hostapd.conf-<br /><pre><code>
interface=wlp2s5
driver=nl80211
ssid=bsm_TestHostapd
hw_mode=g
channel=7
macaddr_acl=0
auth_algs=1
max_num_sta=5
wpa=3
wpa_passphrase=OpenOnePaly4
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP CCMP
rsn_pairwise=CCMP
ignore_broadcast_ssid=0
logger_syslog=-1
logger_syslog_level=3
logger_stdout=-1
logger_stdout_level=2
</code></pre>создан dhcpd.conf-<br /><pre><code>
ddns-update-style none;
option domain-name bsm_TestHostapd;
option domain-name-servers 192.168.0.6 ;

subnet 192.168.249.0 netmask 255.255.255.240 {
    option routers 192.168.249.1;
    range 192.168.249.2 192.168.249.14;
    option broadcast-address 192.168.249.15;

    default-lease-time 600;
    max-lease-time 7200;
    log-facility local7;
}
</code></pre>После инициализации  программной точки доступа имею:<br /><pre><code>
iw..
Interface wlp2s5
	ifindex 4
	wdev 0x1
	addr 10:fe:ed:5e:92:80
	ssid bsm_TestHostapd
	type AP
	wiphy 0
	channel 7 (2442 MHz), width: 20 MHz (no HT), center1: 2442 MHz

ifconfig..
wlp2s5: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.249.1  netmask 255.255.255.0  broadcast 192.168.249.255
        inet6 fe80::12fe:edff:fe5e:9280  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 10:fe:ed:5e:92:80  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 7  bytes 704 (704.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

iwconfig..
wlp2s5    IEEE 802.11bgn  Mode:Master  Tx-Power=19 dBm
          Retry  long limit:7   RTS thr:off   Fragment thr:off
          Power Management:off

route..
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         vavan-archlinux 0.0.0.0         UG    0      0        0 enp2s4
192.168.0.0     *               255.255.255.0   U     0      0        0 enp2s4
192.168.0.0     *               255.255.255.0   U     203    0        0 enp2s7
</code></pre>Правила firewall для точки доступа:<br /><pre><code>
iptables -t nat -A POSTROUTING -o wlp2s5 -j SNAT --to-source 192.168.249.1

iptables -A INPUT -i wlp2s5 -s 192.168.249.0/28 -j ACCEPT
iptables -A FORWARD -i wlp2s5 -s 192.168.249.0/28 -o enp2s4 -j ACCEPT
iptables -A FORWARD -i enp2s4 -o wlp2s5 -d 192.168.249.0/28 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -o wlp2s5 -d 192.168.249.0/28 -j ACCEPT

echo 1 &gt;/proc/sys/net/ipv4/conf/all/forwarding

route add -net 192.168.249.0 netmask 255.255.255.240 dev wlp2s5
</code></pre>&quot;Поднятимаю&quot; firewall, С планшета соединяюсь с точкой доступа, при этом планшет получает адрес 192.168.249.2, и проверяю доступ наружу:<br /><pre><code>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8bf9e4e4ffcbe4e7efa6f8eef9fdeef9">[email&#160;protected]</a> adapter]# ping -c 3 lib.ru
PING lib.ru (81.176.66.163) 56(84) bytes of data.
64 bytes from lib.ru (81.176.66.163): icmp_seq=1 ttl=54 time=55.4 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=2 ttl=54 time=74.5 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=3 ttl=54 time=90.1 ms

--- lib.ru ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 55.438/73.387/90.125/14.186 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="deacb1b1aa9eb1b2baf3adbbaca8bbac">[email&#160;protected]</a> adapter]# ping -c 3 lib.ru -I wlp2s5
PING lib.ru (81.176.66.163) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
From old-server (192.168.249.1) icmp_seq=1 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=2 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=3 Destination Host Unreachable

--- lib.ru ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2008ms
pipe 3

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9fedf0f0ebdff0f3fbb2ecfaede9faed">[email&#160;protected]</a> adapter]# ping -c 3 192.168.249.1 -I wlp2s5
PING 192.168.249.1 (192.168.249.1) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
64 bytes from 192.168.249.1: icmp_seq=1 ttl=64 time=0.150 ms
64 bytes from 192.168.249.1: icmp_seq=2 ttl=64 time=0.128 ms
64 bytes from 192.168.249.1: icmp_seq=3 ttl=64 time=0.120 ms

--- 192.168.249.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 1998ms
rtt min/avg/max/mdev = 0.120/0.132/0.150/0.018 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e99b86869da986858dc49a8c9b9f8c9b">[email&#160;protected]</a> adapter]# ping -c 3 192.168.249.2 -I wlp2s5
PING 192.168.249.2 (192.168.249.2) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
64 bytes from 192.168.249.2: icmp_seq=1 ttl=64 time=75.5 ms
64 bytes from 192.168.249.2: icmp_seq=2 ttl=64 time=97.6 ms
64 bytes from 192.168.249.2: icmp_seq=3 ttl=64 time=16.6 ms

--- 192.168.249.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 16.644/63.278/97.656/34.191 ms
</code></pre>ping с планшета на точку доступа выполняется. Состояние firewall для точки доступа-<br /><pre><code>
route..
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         vavan-archlinux 0.0.0.0         UG    0      0        0 enp2s4
192.168.0.0     *               255.255.255.0   U     0      0        0 enp2s4
192.168.0.0     *               255.255.255.0   U     203    0        0 enp2s7
192.168.249.0   *               255.255.255.240 U     0      0        0 wlp2s5

Table filter..
Chain INPUT (policy ACCEPT 2664 packets, 296K bytes)
 pkts bytes target     prot opt in     out     source               destination
   10  1616 ACCEPT     all  --  wlp2s5 *       192.168.249.0/28     0.0.0.0/0

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
  100  6112 ACCEPT     all  --  wlp2s5 enp2s4  192.168.249.0/28     0.0.0.0/0
    0     0 ACCEPT     all  --  enp2s4 wlp2s5  0.0.0.0/0            192.168.249.0/28     state RELATED,ESTABLISHED

Chain OUTPUT (policy ACCEPT 56 packets, 4220 bytes)
 pkts bytes target     prot opt in     out     source               destination
    9  1208 ACCEPT     all  --  *      wlp2s5  0.0.0.0/0            192.168.249.0/28

Table nat..
..
Chain POSTROUTING (policy ACCEPT 89 packets, 5892 bytes)
 pkts bytes target     prot opt in     out     source               destination
    3   216 SNAT       all  --  *      wlp2s5  0.0.0.0/0            0.0.0.0/0            to:192.168.249.1
</code></pre>Но отсутствует выход в Интернет. Какие будут рекомендации?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133686"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/domov0y/">
                <span class="post-username">domov0y</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133686/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/domov0y/topics/">
                    5
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/domov0y/posts/">
                    819
                </a>
            </div>
            <div>
                Участник с: 09 июля 2011
            </div>
            
        </td>
        <td class="post-content">
            <strike>покажите результат  iptables -S  (от рута естественно).<br />а то есть у меня нескромное подозрение что для цепочки FORWARD стоит reject.<br />проверки ради попробуйте очистить цепочку forward  и  поставить политику &quot;разрешить&quot;</strike><br />узрел что разрешено все.<br /><br />маскарадинг попробуй вместо snat (пляска с бунбом и гадание на грибах)
            
                
                    <div class="post-signature">
                        Да пребудет с вами знание ip адреса
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133687"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bsm/">
                <span class="post-username">bsm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133687/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bsm/topics/">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bsm/posts/">
                    184
                </a>
            </div>
            <div>
                Участник с: 18 января 2012
            </div>
            
        </td>
        <td class="post-content">
            [<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fd8f929289bd929199d08e988f8b988f">[email&#160;protected]</a> adapter]# iptables -S<br />-P INPUT ACCEPT<br />-P FORWARD ACCEPT<br />-P OUTPUT ACCEPT<br />-A INPUT -s 192.168.249.0/28 -i wlp2s5 -j ACCEPT<br />-A FORWARD -s 192.168.249.0/28 -i wlp2s5 -o enp2s4 -j ACCEPT<br />-A FORWARD -d 192.168.249.0/28 -i enp2s4 -o wlp2s5 -m state --state RELATED,ESTABLISHED -j ACCEPT<br />-A OUTPUT -d 192.168.249.0/28 -o wlp2s5 -j ACCEPT
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133691"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bsm/">
                <span class="post-username">bsm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133691/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bsm/topics/">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bsm/posts/">
                    184
                </a>
            </div>
            <div>
                Участник с: 18 января 2012
            </div>
            
        </td>
        <td class="post-content">
            <pre><code>
..
iptables -t nat -A POSTROUTING -o wlp2s5 -j MASQUERADE
..
Table filter..
Chain INPUT (policy ACCEPT 405 packets, 41152 bytes)
 pkts bytes target     prot opt in     out     source               destination
    8   942 ACCEPT     all  --  wlp2s5 *       192.168.249.0/28     0.0.0.0/0

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
   18  1102 ACCEPT     all  --  wlp2s5 enp2s4  192.168.249.0/28     0.0.0.0/0
    0     0 ACCEPT     all  --  enp2s4 wlp2s5  0.0.0.0/0            192.168.249.0/28     state RELATED,ESTABLISHED

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    8   916 ACCEPT     all  --  *      wlp2s5  0.0.0.0/0            192.168.249.0/28

Table nat..
Chain PREROUTING (policy ACCEPT 429 packets, 31479 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain INPUT (policy ACCEPT 114 packets, 13432 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain POSTROUTING (policy ACCEPT 10 packets, 608 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 MASQUERADE  all  --  *      wlp2s5  0.0.0.0/0            0.0.0.0/0
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3d4f5252497d5251">[email&#160;protected]</a>d-server adapter]# ping -c 3 lib.ru
PING lib.ru (81.176.66.163) 56(84) bytes of data.
64 bytes from lib.ru (81.176.66.163): icmp_seq=1 ttl=54 time=53.1 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=2 ttl=54 time=73.3 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=3 ttl=54 time=62.8 ms

--- lib.ru ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 53.191/63.129/73.336/8.228 ms
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c8baa7a7bc88a7a4ace5bbadbabeadba">[email&#160;protected]</a> adapter]# ping -c 3 lib.ru -I wlp2s5
PING lib.ru (81.176.66.163) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
From old-server (192.168.249.1) icmp_seq=1 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=2 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=3 Destination Host Unreachable

--- lib.ru ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2007ms
pipe 3
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b4954544f7b54575f16485e494d5e49">[email&#160;protected]</a> adapter]#
</code></pre>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133697"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/domov0y/">
                <span class="post-username">domov0y</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133697/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/domov0y/topics/">
                    5
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/domov0y/posts/">
                    819
                </a>
            </div>
            <div>
                Участник с: 09 июля 2011
            </div>
            
        </td>
        <td class="post-content">
            А вы уверены в строке  echo 1 &gt;/proc/sys/net/ipv4/conf/all/forwarding?<br /> вроде классический рецепт советует echo 1 &gt; /proc/sys/net/ipv4/ip_forward
            
                
                    <div class="post-signature">
                        Да пребудет с вами знание ip адреса
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133728"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bsm/">
                <span class="post-username">bsm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133728/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bsm/topics/">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bsm/posts/">
                    184
                </a>
            </div>
            <div>
                Участник с: 18 января 2012
            </div>
            
        </td>
        <td class="post-content">
            В файле /proc/sys/net/ipv4/ip_forward по умолчанию записана 1.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-133731"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bsm/">
                <span class="post-username">bsm</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/133731/">#</a>
            8 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bsm/topics/">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bsm/posts/">
                    184
                </a>
            </div>
            <div>
                Участник с: 18 января 2012
            </div>
            
        </td>
        <td class="post-content">
            При конфигурации firewall<br /><pre><code>
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="83f1ececf7c3ecefe7aef0e6f1f5e6f1">[email&#160;protected]</a> adapter]# iptables -S
-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
-A FORWARD -i wlp2s5 -o enp2s4 -j ACCEPT
-A FORWARD -i enp2s4 -o wlp2s5 -j ACCEPT

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="780a17170c3817141c550b1d0a0e1d0a">[email&#160;protected]</a> adapter]# iptables -S -t nat
-P PREROUTING ACCEPT
-P INPUT ACCEPT
-P OUTPUT ACCEPT
-P POSTROUTING ACCEPT
-A POSTROUTING -o wlp2s5 -j SNAT --to-source 192.168.249.1
</code></pre>имею-<br /><pre><code>
route..
Kernel IP routing table
Destination     Gateway         Genmask               Flags Metric Ref    Use Iface
default         vavan-archlinux  0.0.0.0                   UG   0          0        0 enp2s4
192.168.0.0        *                   255.255.255.0     U     0          0        0 enp2s4
192.168.0.0        *                   255.255.255.0     U     203     0        0 enp2s7
192.168.249.0   *                   255.255.255.240 U     0         0        0 wlp2s5

Table filter..
Chain INPUT (policy ACCEPT 1973 packets, 389K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    5   260 ACCEPT     all  --  wlp2s5 enp2s4  0.0.0.0/0            0.0.0.0/0
    0       0 ACCEPT     all  --  enp2s4 wlp2s5  0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy ACCEPT 290 packets, 28071 bytes)
 pkts bytes target     prot opt in     out     source               destination

Table nat..
..
Chain POSTROUTING (policy ACCEPT 76 packets, 5196 bytes)
 pkts bytes target     prot opt in     out     source               destination
    3   252 SNAT       all  --  *      wlp2s5  0.0.0.0/0            0.0.0.0/0            to:192.168.249.1
</code></pre>Проверка доступа во внешнюю сеть-<br /><pre><code>
192.168.249.2- компьютер, соединившийся по wi-fi с программной точкой доступа.

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7b0914140f3b14171f56081e090d1e09">[email&#160;protected]</a> adapter]# ping -c 3 192.168.249.2
PING 192.168.249.2 (192.168.249.2) 56(84) bytes of data.
64 bytes from 192.168.249.2: icmp_seq=1 ttl=64 time=3.25 ms
64 bytes from 192.168.249.2: icmp_seq=2 ttl=64 time=34.4 ms
64 bytes from 192.168.249.2: icmp_seq=3 ttl=64 time=91.1 ms

--- 192.168.249.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 3.256/42.926/91.101/36.363 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a6d4c9c9d2e6c9cac28bd5c3d4d0c3d4">[email&#160;protected]</a> adapter]# ping -c 3 192.168.249.2 -I wlp2s5
PING 192.168.249.2 (192.168.249.2) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
64 bytes from 192.168.249.2: icmp_seq=1 ttl=64 time=13.8 ms
64 bytes from 192.168.249.2: icmp_seq=2 ttl=64 time=3.04 ms
64 bytes from 192.168.249.2: icmp_seq=3 ttl=64 time=8.55 ms

--- 192.168.249.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 3.040/8.486/13.861/4.419 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ae8f5f5eedaf5f6feb7e9ffe8ecffe8">[email&#160;protected]</a> adapter]# ping -c 3 lib.ru
PING lib.ru (81.176.66.163) 56(84) bytes of data.
64 bytes from lib.ru (81.176.66.163): icmp_seq=1 ttl=54 time=53.0 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=2 ttl=54 time=53.1 ms
64 bytes from lib.ru (81.176.66.163): icmp_seq=3 ttl=54 time=54.7 ms

--- lib.ru ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2000ms
rtt min/avg/max/mdev = 53.078/53.636/54.730/0.818 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b0c2dfdfc4f0dfdcd49dc3d5c2c6d5c2">[email&#160;protected]</a> adapter]# ping -c 3 lib.ru -I wlp2s5
PING lib.ru (81.176.66.163) from 192.168.249.1 wlp2s5: 56(84) bytes of data.
From old-server (192.168.249.1) icmp_seq=1 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=2 Destination Host Unreachable
From old-server (192.168.249.1) icmp_seq=3 Destination Host Unreachable

--- lib.ru ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2008ms
pipe 3
</code></pre>Получается, что с программной точки доступа в Интернет выхода нет.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/13330/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747b7fe87fdb76ad',m:'3fjn5aCxd2TnxFSBCUjWbFl_wsRY026lCOtXX_HbjVM-1662680116-0-AefhA0u1eG4o2XZMDvzHvntr+fJG3bXEmpkrH58DeBNzAP6ZZIr6GnWHk6JBh4zRMIFXKBX8MPSfi5oPv3a99jAmjw6hTgIXRPJJArwPmo+3cdcefLnqumFDJFiAmUv5JO7hFKrsVF27w7EBjIWYcwI=',s:[0xf777637942,0xa16ec81607],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
