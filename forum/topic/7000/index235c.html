


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/7000/?page=7 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:15:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Corbina vs Arch Помогите настроить VPN
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/2/index.html">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/13/index.html">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>Corbina vs Arch Помогите настроить VPN</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Corbina vs Arch Помогите настроить VPN</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="indexc575.html?page=6" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index9ba9.html?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdb0.html?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexaf4d.html?page=5">5</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexc575.html?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="index235c.html?page=7">7 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdfa.html?page=8">8</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index0b08.html?page=9">9</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1448.html?page=10">10</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1c8b.html?page=11">11</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexce37.html?page=12">12</a>
                        </li>
                    
                
            
                
                    <li class="disabled">
                        <span>...</span>
                    </li>
                
            
                
                    
                        <li>
                            <a href="index3c09.html?page=22">22</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index89ae.html?page=23">23</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="indexfdfa.html?page=8" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67104"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/pztrn/index.html">
                <span class="post-username">pztrn</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67104/index.html">#</a>
            11 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/pztrn/topics/index.html">
                    23
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/pztrn/posts/index.html">
                    1436
                </a>
            </div>
            <div>
                Участник с: 20 сентября 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>bobart</em><br/><div class="code"><pre>#!/bin/sh
ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a> &gt; /dev/null || /etc/rc.d/network restart &amp;&amp;  
ping -c4 8.8.8.8 &amp;&gt; /dev/null
if [ ! $? -eq 0 ]
then
  /etc/rc.d/xl2tpd restart
fi
exit 0</pre></div></blockquote>Я бы сделал лучше так:<br/><div class="code"><pre>if [ $? -eq 0 ]; then
    exit 0
else
    /etc/rc.d/xl2tpd restart
fi</pre></div>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67105"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/bobart/index.html">
                <span class="post-username">bobart</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67105/index.html">#</a>
            11 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/bobart/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/bobart/posts/index.html">
                    2537
                </a>
            </div>
            <div>
                Участник с: 28 ноября 2009
            </div>
            
        </td>
        <td class="post-content">
            Спасибо, подкрутил.., последняя версия, на данном этапе (монстрам баша: спокойно, отнеситесь с юмором:)<br/><div class="code"><pre>#!/bin/sh
TCNFILE=~/.logs/conncheck.corbina.log
INETFILE=~/.logs/conncheck.internet.log
ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a> &amp; &gt; /dev/null || /etc/rc.d/network restart &amp;&amp;  
ping -c4 <a href="http://www.google.com/">www.google.com</a> &amp;&amp;
if [ $? -eq 0 ];then
echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt; $TCNFILE  
   exit 0
else
echo "[`date`] [GOOGLE.RU] not available, try again (after NETWORK daemon restart)" &gt; $INETFILE
   /etc/rc.d/xl2tpd restart
fi
exit 0</pre></div>ps. PoZiTPoN, ты понял, я твой &ldquo;суперскрипт&rdquo; немного почикал, точнее, взял из него, вставил в &ldquo;свой&rdquo;, вобщем, кручу-верчу&#8230;, да, теперь при запуске вижу вывод, что и хотел:<div class="code"><pre>bob@arch:~$ sh ~/.cron.daily/conncheck.sh
PING <a href="http://www.l.google.com/">www.l.google.com</a> (74.125.232.50) 56(84) bytes of data.
PING <a href="http://tp.corbina.net/">tp.corbina.net</a> (83.102.254.223) 56(84) bytes of data.
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=1 ttl=250 time=0.805 ms
64 bytes from 74.125.232.50: icmp_seq=1 ttl=53 time=63.1 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=2 ttl=250 time=0.832 ms
64 bytes from 74.125.232.50: icmp_seq=2 ttl=53 time=62.4 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=3 ttl=250 time=0.834 ms
64 bytes from 74.125.232.50: icmp_seq=3 ttl=53 time=60.3 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=4 ttl=250 time=1.20 ms
--- <a href="http://tp.corbina.net/">tp.corbina.net</a> ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 0.805/0.919/1.205/0.165 ms
64 bytes from 74.125.232.50: icmp_seq=4 ttl=53 time=62.6 ms
--- <a href="http://www.l.google.com/">www.l.google.com</a> ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 60.363/62.168/63.181/1.090 ms
bob@arch:~$ </pre></div>При этом не понятно, отчего вывод пинга по корбине полный, а по гуглу лишь статистика. И ещё это, <a href="http://www.%3cstrong%3el%3c/strong%3E.google.com">www.<strong>l</strong>.google.com</a> - что за <strong>l</strong>? Всё, дошло, <strong>www</strong> - не нужен.<br/>Да, лог как-то трётся, то есть автоматом переписывается, там всегда одна строка - отчёт о последнем выполнении, это так задумано?<br/><br/>А если просто сделать ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a>, то <div class="code"><pre>bob@arch:~$ ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a>
PING <a href="http://tp.corbina.net/">tp.corbina.net</a> (83.102.254.223) 56(84) bytes of data.
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=1 ttl=250 time=0.999 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=2 ttl=250 time=1.23 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=3 ttl=250 time=1.74 ms
64 bytes from <a href="http://vpnx-l0.spb.corbina.net/">vpnX-l0.spb.corbina.net</a> (83.102.254.223): icmp_seq=4 ttl=250 time=1.58 ms
--- <a href="http://tp.corbina.net/">tp.corbina.net</a> ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 0.999/1.391/1.749/0.295 ms</pre></div>остаётся только понять - почему.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67106"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/pztrn/index.html">
                <span class="post-username">pztrn</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67106/index.html">#</a>
            11 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/pztrn/topics/index.html">
                    23
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/pztrn/posts/index.html">
                    1436
                </a>
            </div>
            <div>
                Участник с: 20 сентября 2009
            </div>
            
        </td>
        <td class="post-content">
            Чтобы лог не терся - замени &ldquo;&gt;&rdquo; на &ldquo;&gt;&gt;&rdquo;
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67107"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/bobart/index.html">
                <span class="post-username">bobart</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67107/index.html">#</a>
            11 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/bobart/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/bobart/posts/index.html">
                    2537
                </a>
            </div>
            <div>
                Участник с: 28 ноября 2009
            </div>
            
        </td>
        <td class="post-content">
            &ldquo;перезапись&rdquo; и &ldquo;добавление&rdquo;? Что-то типа.. Спасибо. Скоро научусь 2+2 в уме складывать и стану виртуозом. <br/>Пару дней можно последить, что там с сетью творится для общей картины, а там можно и тереть.<br/><div class="code"><pre>#!/bin/sh
INETFILE=~/.conncheck.corbina.log
ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a> &amp;&gt; /dev/null || /etc/rc.d/network restart &amp;&amp;  
ping -c4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
if [ $? -eq 0 ];then
   echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE  
   exit 0
else
   echo "[`date`] [GOOGLE.RU] not available, try again (after NETWORK daemon restart)" &gt;&gt; $INETFILE
   /etc/rc.d/xl2tpd restart
   sleep 10
   ping -c4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
   if [ $? -eq 0 ];then
       echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE
       exit 0
   else
       echo "[`date`] [TP.CORBINA.NET] not available, [GOOGLE.RU] not available, try letter" &gt;&gt; $INETFILE
       exit 0
   fi
fi</pre></div>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67108"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/werlock/index.html">
                <span class="post-username">werlock</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67108/index.html">#</a>
            11 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/werlock/topics/index.html">
                    7
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/werlock/posts/index.html">
                    29
                </a>
            </div>
            <div>
                Участник с: 03 января 2010
            </div>
            
        </td>
        <td class="post-content">
            Господа !<br/>А никто не делал pkgbuild для <a href="http://code.google.com/p/vpnpptp/">http://code.google.com/p/vpnpptp/</a><br/>Сильно бы помог по идее с Beeline-Corbina
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67109"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/trustno1/index.html">
                <span class="post-username">trustno1</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67109/index.html">#</a>
            11 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/trustno1/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/trustno1/posts/index.html">
                    2
                </a>
            </div>
            <div>
                Участник с: 11 января 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>bobart</strong><br/>Благодарю за скрипт.<br/><div class="code"><pre>#!/bin/sh
INETFILE=~/.conncheck.corbina.log
ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a> &amp;&gt; /dev/null || /etc/rc.d/network restart &amp;&amp; 
ping -c4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
if [ $? -eq 0 ];then
   echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE 
   exit 0
else
   echo "[`date`] [GOOGLE.RU] not available, try again (after NETWORK daemon restart)" &gt;&gt; $INETFILE
   /etc/rc.d/openl2tp stop
   sleep 4
   /etc/rc.d/openl2tp stop
   sleep 1
   /etc/rc.d/openl2tp start
   sleep 15
   /etc/rc.d/udpxy restart
   sleep 1
   ping -c4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
   if [ $? -eq 0 ];then
       echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE
       exit 0
   else
       echo "[`date`] [TP.CORBINA.NET] not available, [GOOGLE.RU] not available, try letter" &gt;&gt; $INETFILE
       exit 0
   fi
fi</pre></div>На данный момент наблюдаю следующую картину, если openl2tp отваливается то восстановить соединение не представляется возможным некоторое время, похоже на проблему провайдера (у меня билайно-корбина), приходиться поднимать vpn сессию. Можете ли вы помочь корректно добавить в приведенное выше нечто вроде - если после переподнятия openl2tp и ожидания в 15 секунд соединения всё еще нет то sudo pon provider. ? Потому что получается так: он пингует хост, ответа нет, перезапускает всю сеть, перезапускает демон openl2tpd и умолкает на этом, а соединения по прежнему нет, т.е дальнейших попыток не следует.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67110"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/bobart/index.html">
                <span class="post-username">bobart</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67110/index.html">#</a>
            11 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/bobart/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/bobart/posts/index.html">
                    2537
                </a>
            </div>
            <div>
                Участник с: 28 ноября 2009
            </div>
            
        </td>
        <td class="post-content">
            <strong>PoZiTPoH</strong>'а благодарите, скорее.<br/>Подолью масла в огонь, не удержусь. Корбина, вообще - головная боль. Появилась возможность и я переключился к другому провайдеру, вот так. Сижу с IP-static и в ус не дую, без этих vpn'ов и прочей лабуды. Так что, если есть возможность &#8230;<br/><br/>По делу: почему не используете xl2tpd?<br/>Ладно. <br/>Не понял, почему в скрипте дважды openl2tp stop через sleep 4?<br/>Почему просто не<br/><div class="code"><pre>#!/bin/sh
INETFILE=~/.conncheck.corbina.log
ping -c 4 -w 10 <a href="http://tp.corbina.net/">tp.corbina.net</a> &amp;&gt; /dev/null || /etc/rc.d/network restart &amp;&amp;  
ping -c 4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
if [ $? -eq 0 ];then
   echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE  
   exit 0
else
   echo "[`date`] [GOOGLE.RU] not available, try again (after NETWORK daemon restart)" &gt;&gt; $INETFILE
   /etc/rc.d/openl2tp stop
   sleep 1
   /etc/rc.d/openl2tp start
   sleep 30
   ping -c 4 <a href="http://google.com/">google.com</a> &amp;&gt; /dev/null
   if [ $? -eq 0 ];then
       echo "[`date`] [TP.CORBINA.NET] available, [GOOGLE.RU] available" &gt;&gt; $INETFILE
       exit 0
   else
       echo "[`date`] [TP.CORBINA.NET] not available, [GOOGLE.RU] not available, try letter" &gt;&gt; $INETFILE
       exit 0
   fi
fi</pre></div>/etc/rc.d/udpxy - это кто такой?<br/>Просто с корбиной всё запущено, то ppp0 отвалится, а <a href="http://tp.corbina.net/">tp.corbina.net</a> при этом пингуется, то dns-сервера перестают отвечать и не пингуется <a href="http://tp.corbina.net/">tp.corbina.net</a> - и тогда только сеть рестартить и остаётся. <br/>Вообще, ставьте xl2tpd - выше всё описано, и вроде должно быть понятно. Кстати, после того как я прописал маршруты в /etc/rc.conf (выше в теме всё это есть), ppp0 стал подниматься быстрее и как-то стабильнее, чтоли.., или мне так показалось? Вобщем, для меня это уже не актуально.<br/><br/>ps. По скрипту: надо постоянно практиковать, а так, от случая к случаю, забывается. Может-быть, <strong>PoZiTPoH</strong> что подскажет.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67111"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/pztrn/index.html">
                <span class="post-username">pztrn</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67111/index.html">#</a>
            11 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/pztrn/topics/index.html">
                    23
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/pztrn/posts/index.html">
                    1436
                </a>
            </div>
            <div>
                Участник с: 20 сентября 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>bobart</em><br/><strong>PoZiTPoH</strong> что подскажет.</blockquote>:D стоит только написать один сложный скрипт и пару-тройку раз помочь, как о ABSG забывают :D
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67112"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/trustno1/index.html">
                <span class="post-username">trustno1</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67112/index.html">#</a>
            11 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/trustno1/topics/index.html">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/trustno1/posts/index.html">
                    2
                </a>
            </div>
            <div>
                Участник с: 11 января 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote>По делу: почему не используете xl2tpd?<br/>Ладно. <br/>Не понял, почему в скрипте дважды openl2tp stop через sleep 4?<br/>Почему просто не</blockquote><strong>bobart</strong><br/>Всё просто, xl2tpd не завелся сразу после изменений со стороны провайдера, хотя всё делалось как всегда. Потом спустя какое то был настроен openl2td, скорость выше, все работает терпимо. Udpxy это замена igmproxy по сути, работает иначе, но смысл тот же - прием и раздача IPTV в локальную сеть.<br/>Эти sleep потому что оно не выгружается как надо, иногда нужно сделать повторный stop.<br/>Возможности? Перейти на что еще? - сколько угодно в моем регионе, но пока работает, будут еще проблемы можно будет подумать и потом не думаю что при переходе не возникнет других проблем на другом провайдере(у другого провайдера). <br/>Не похоже на то чтобы <strong>PoZiTPoH</strong> горел желанием помочь, вы долго правили скрипт и поэтому была надежда что смогли бы немного допилить его.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-67113"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/bobart/index.html">
                <span class="post-username">bobart</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/67113/index.html">#</a>
            11 лет, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/bobart/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/bobart/posts/index.html">
                    2537
                </a>
            </div>
            <div>
                Участник с: 28 ноября 2009
            </div>
            
        </td>
        <td class="post-content">
            А /etc/rc.d/openl2tp restart - так работает?<br/>Вообще, перечитайте всю тему, с первой страницы, прочувствуйте, проникнитесь..<br/>Там и про IPTV есть. Не понимаю пока, как это &ldquo;xl2tpd не завелся сразу после изменений со стороны провайдера&rdquo; - что они там ещё придумали? Как я понимаю, настройки стандартные для всех, различаются только dns-сервера и районные (дефолтные) шлюзы.<br/>Отмотайте пару, или страницу назад: там рабочий конфиг для xl2tpd, плюс в начале темы <strong>h4tr3d</strong> дал совет насчёт метрик, можете воспользоваться.<br/>Но это к нашему скрипту непосредственного отношения не имеет, понятно. <br/>Повторяю, openl2td я не настраивал (в чём разница?), провайдер сейчас другой, так что играю втёмную и касательно скрипта: свою голову тоже подключайте, все команды вам известны, экспериментируйте.<br/>На пальцах: скрипт-то, по-любому, в кроне, запустилось-не запустилось - он будет каждые 5 минут тупо долбиться к корбине. Обратите внимание, sleep можно увеличить, или сколько ему там надо отсыпаться, чтобы приконнектиться, полчаса?<br/>Последнее вообще не понял: вы хотите, если не поднялся ppp0 по l2tp, просто автоматом перепрыгивать на vpn? Как-бы &ldquo;pon provider&rdquo; намекает. <br/><br/>ps. PoZiTPoH - злой следователь, bobart - добрый. Шутка.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="indexc575.html?page=6" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index9ba9.html?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdb0.html?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexaf4d.html?page=5">5</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexc575.html?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="index235c.html?page=7">7 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdfa.html?page=8">8</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index0b08.html?page=9">9</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1448.html?page=10">10</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1c8b.html?page=11">11</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexce37.html?page=12">12</a>
                        </li>
                    
                
            
                
                    <li class="disabled">
                        <span>...</span>
                    </li>
                
            
                
                    
                        <li>
                            <a href="index3c09.html?page=22">22</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index89ae.html?page=23">23</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="indexfdfa.html?page=8" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/index4b48.html?next=/forum/topic/7000/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/7000/?page=7 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:15:04 GMT -->
</html>
