


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Вопрос по lvm и luks
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/11/">Установка</a> <span class="divider">/</span></li>
            
        
        
            <li>Вопрос по lvm и luks</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Вопрос по lvm и luks</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-19054"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/kolebas/">
                <span class="post-username">kolebas</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/19054/">#</a>
            10 лет, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/kolebas/topics/">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/kolebas/posts/">
                    94
                </a>
            </div>
            <div>
                Участник с: 15 октября 2008
            </div>
            
        </td>
        <td class="post-content">
            Всем привет.  Нужен совет по lvm. Дело в следующем - при старте система не может найти корневой раздел и вываливается в шелл<br/><img src="http://ompldr.org/vZHZmcQ/lvm.jpg"></img><br/>У меня 2 диска, один зашифрован с помощью cryptsetup (sdb), второй нет(sdd)(раньше тоже был зашифрован, но поcле замены год назад не было времени на это). На картинке видно, что не находится раздел после активации lvm. Там этот диск расшифровывается ключом через /etc/crypttab. До сегодняшнего дня все это дело работало, но сегодня я решил уменьшить home раздел и увеличить root. Делал все загрузившись с livecd, вроде правильно по вики<br/><div class="code"><pre># resize2fs /dev/fs/home 1200G
# lvreduce -L 1240G fs/home
# resize2fs /dev/fs/home
# lvextend -l +100%FREE fs/root
# resize2fs /dev/fs/root</pre></div>с помощью livecd я нормально могу расшифровать раздел:<br/>cryptsetup luksOpen -y /dev/sdb fs<br/>и иницировать lvm :<br/>vgchange -ay &ndash;partial (требует &ndash;partial, но работает)<br/>разделы целы, монтируются, не переполнены<br/>Добавлю вывод df livecd<br/><div class="code"><pre>Filesystem            Size  Used Avail Use% Mounted on
none                  3.0G  4.3M  2.9G   1% /
udev                   10M  240K  9.8M   3% /dev
none                  2.0G     0  2.0G   0% /dev/shm
/dev/mapper/fs-root   151G   19G  125G  13% /mnt/root
/dev/sda1              92M   41M   46M  47% /mnt/boot
/dev/mapper/fs-home   1.2T  1.1T   34G  98% /mnt/home</pre></div>lvdisplay<br/><div class="code"><pre> --- Logical volume ---
  LV Name                /dev/fs/root
  VG Name                fs
  LV UUID                ZEGpfG-0mmR-deBg-eiKY-1O3W-y29I-Epfprf
  LV Write Access        read/write
  LV Status              available
  # open                 1
  LV Size                153.18 GiB
  Current LE             39213
  Segments               3
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           254:1
   
  --- Logical volume ---
  LV Name                /dev/fs/swap
  VG Name                fs
  LV UUID                4ZSXJo-MPGV-1LbV-JB2J-aP1S-Ki8l-wdWz5T
  LV Write Access        read/write
  LV Status              available
  # open                 0
  LV Size                4.00 GiB
  Current LE             1024
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           254:2
   
  --- Logical volume ---
  LV Name                /dev/fs/home
  VG Name                fs
  LV UUID                Ek6WUD-ku3w-TQKP-92Bl-opd1-aYQm-xDbZ3K
  LV Write Access        read/write
  LV Status              available
  # open                 1
  LV Size                1.21 TiB
  Current LE             317440
  Segments               2
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           254:4
   </pre></div>vgdisplay<br/><div class="code"><pre>  --- Volume group ---
  VG Name               fs
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  20
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                3
  Open LV               2
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               1.36 TiB
  PE Size               4.00 MiB
  Total PE              357677
  Alloc PE / Size       357677 / 1.36 TiB
  Free  PE / Size       0 / 0   
  VG UUID               drLN9f-vrXO-J6u5-sE39-6bdg-ycCS-CGOgdO</pre></div>pvdisplay<br/><div class="code"><pre>  --- Physical volume ---
  PV Name               /dev/dm-5
  VG Name               fs
  PV Size               465.76 GiB / not usable 3.02 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              119234
  Free PE               0
  Allocated PE          119234
  PV UUID               1go8iC-MAnb-9XGM-yJnI-U32e-d1Xp-owjVCD
   
  --- Physical volume ---
  PV Name               /dev/sdd2
  VG Name               fs
  PV Size               931.42 GiB / not usable 3.58 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              238443
  Free PE               0
  Allocated PE          238443
  PV UUID               haU5ze-fNLB-4WEj-9UOn-gPvX-CgDV-mN2d0o</pre></div>menu.lst<br/><div class="code"><pre># (2) Arch Linux
title  Arch Linux
root   (hd0,0)
#kernel /vmlinuz-linux root=/dev/mapper/fs-root cryptdevice=/dev/sda5:fs ro vga=773
kernel /vmlinuz-linux root=/dev/mapper/fs-root resume=/dev/mapper/fs-swap vga=773
initrd /initramfs-linux.img</pre></div>fstab<br/><div class="code"><pre># 
# /etc/fstab: static file system information
#
# &lt;file system&gt;        &lt;dir&gt;         &lt;type&gt;    &lt;options&gt;          &lt;dump&gt; &lt;pass&gt;
none                   /dev/pts      devpts    defaults            0      0
none                   /dev/shm      tmpfs     defaults            0      0
none /proc/bus/usb usbfs auto,busgid=108,busmode=0775,devgid=1000,devmode=666 0 0
tmpfs /tmp tmpfs defaults,noatime,mode=1777 0 0
tmpfs /var/lock tmpfs defaults,size=10m,mode=1777 0 0
tmpfs /var/run  tmpfs defaults,size=10m,mode=0755 0 0
/dev/sda1 /boot ext2 defaults 0 2 
/dev/mapper/fs-root / ext4 defaults 0 1
/dev/mapper/fs-swap swap swap defaults 0 0
/dev/mapper/fs-home /home ext4 rw,suid,exec,auto,nouser,async 0 2
/dev/cdrom /media/cdrom   auto    ro,user,noauto,unhide   0      0</pre></div>crypttab<br/><div class="code"><pre># NAME		SOURCE DEVICE		PASSWORD		OPTIONS
#home		/dev/hda4		mypassword
#data1		/dev/hda3		"my \"password\""
#data2		/dev/hda5		/etc/cryptfs.key
#swap		/dev/hdx4		SWAP			-c aes-cbc-essiv:sha256 -s 256
#vol		/dev/hdb7		ASK
fs2             /dev/sdb               /etc/cryptfs.key</pre></div>тут lvdisplay , pvdisplay, vgdisplay сделаны при загрузки с лайвсиди и инициализации, при загрузке обычной доступен только swap , в других пишет LV status not available при вызове lvdisplay<br/>Т.е проблема в том, что чтоб расшифровать диск и подключить надо активировать раздел root , к-й теперь не активируется
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-19055"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/kolebas/">
                <span class="post-username">kolebas</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/19055/">#</a>
            10 лет, 3 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/kolebas/topics/">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/kolebas/posts/">
                    94
                </a>
            </div>
            <div>
                Участник с: 15 октября 2008
            </div>
            
        </td>
        <td class="post-content">
            вобщем помогла вот эта тема <a href="https://bbs.archlinux.org/viewtopic.php?id=135829">https://bbs.archlinux.org/viewtopic.php?id=135829</a> 
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/1762/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script>(function(){var js = "window['__CF$cv$params']={r:'747b2949093b498d',m:'DlHUrg_w9SCJLj2QFR8FpAXMH45gvj0rEHnX0jof2_U-1662676568-0-AbrFP6nZ3XKcJW3OnwG0p82xtdHHmKMvLWzLOmOTcEOeomW3yqjLfyKy0VW21T7f+nBPdQflE2j7reP45F91tU3e/iUZMyFWebEDN7P7tVURThy3aJckB9v3+GaTjFL33Bnle0QwpoylNdssZT41Hjg=',s:[0x2c25f6d34a,0x06da86b80a],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
