


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        VPN на второй комп, или как то так...
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/13/">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>VPN на второй комп, или как то так...</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>VPN на второй комп, или как то так...</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-53471"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bultdog/">
                <span class="post-username">bultdog</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/53471/">#</a>
            11 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bultdog/topics/">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bultdog/posts/">
                    5
                </a>
            </div>
            <div>
                Участник с: 29 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            Добрый день, наконец то я поменял провайдера на Альянс Телеком. В общем имею несколько компов, соединенных через коммутатор. К одному компу с адресом 192.168.0.4 успешно подключен провайдер через VPN.<br/><br/># ifconfig<br/><div class="code"><pre>eth0      Link encap:Ethernet  HWaddr 90:FB:A6:4C:8B:F3  
          inet addr:192.168.0.4  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::92fb:a6ff:fe4c:8bf3/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4285 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2670 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:860095 (839.9 Kb)  TX bytes:2199125 (2.0 Mb)
          Interrupt:21 Base address:0x2000 
eth1      Link encap:Ethernet  HWaddr 00:80:C8:3B:A4:84  
          inet addr:172.24.216.26  Bcast:172.24.216.255  Mask:255.255.255.0
          inet6 addr: fe80::280:c8ff:fe3b:a484/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1163928 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1245165 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1436406748 (1369.8 Mb)  TX bytes:176475232 (168.2 Mb)
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:2733 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2733 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:2017116 (1.9 Mb)  TX bytes:2017116 (1.9 Mb)
ppp0      Link encap:Point-to-Point Protocol  
          inet addr:10.24.216.26  P-t-P:95.154.112.99  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1400  Metric:1
          RX packets:1163553 errors:0 dropped:0 overruns:0 frame:0
          TX packets:911509 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1392244995 (1327.7 Mb)  TX bytes:109073455 (104.0 Mb)</pre></div><br/># route -n<br/><div class="code"><pre>Kernel IP routing table
Destination        Gateway         Genmask             Flags  Metric  Ref    Use Iface
172.16.4.1        172.24.216.1    255.255.255.255   UGH   0        0        0 eth1
95.154.112.99   0.0.0.0             255.255.255.255   UH     0       0        0 ppp0
95.154.112.64   172.24.216.1    255.255.255.192   UG     204    0        0 eth1
95.154.113.0     172.24.216.1    255.255.255.128   UG     204    0        0 eth1
192.168.0.0       0.0.0.0            255.255.255.0       U        0       0        0 eth0
172.24.216.0     0.0.0.0             255.255.255.0      U       204    0        0 eth1
46.19.64.0        172.24.216.1    255.255.248.0       UG    204    0        0 eth1
94.198.216.0     172.24.216.1    255.255.248.0       UG    204    0        0 eth1
81.200.144.0     172.24.216.1    255.255.240.0       UG    204    0        0 eth1
192.168.0.0       192.168.0.4     255.255.0.0           UG    0       0        0 eth0
172.16.0.0         172.24.216.1   255.240.0.0           UG    204    0        0 eth1
0.0.0.0              0.0.0.0            0.0.0.0                  U       0       0        0 ppp0</pre></div><br/># cat /etc/rc.conf<br/><div class="code"><pre>...
lo="lo 127.0.0.1"
eth0="eth0 192.168.0.4 netmask 255.255.255.0 broadcast 192.168.0.255"
eth1="dhcp"
INTERFACES=(lo eth0 eth1)
networkroute="-net 192.168.0.0 netmask 255.255.0.0 gw 192.168.0.4"
ROUTES=(networkroute)
...
DAEMONS=(... ppp iptables ...)</pre></div><br/># cat /etc/sysctl.conf<br/><div class="code"><pre>#
# Kernel sysctl configuration
#
# Disable packet forwarding
net.ipv4.ip_forward=1
# Disable the magic-sysrq key (console security issues)
kernel.sysrq = 0
# Enable TCP SYN Cookie Protection
net.ipv4.tcp_syncookies = 1</pre></div><br/># cat /etc/iptables/iptables.rules <br/><div class="code"><pre>...
-A POSTROUTING -o ppp0 -j MASQUERADE 
...</pre></div><br/># cat /etc/resolv.conf<br/><div class="code"><pre>domain inetvl.ru
nameserver 95.154.112.74
nameserver 95.154.112.75</pre></div><br/>В общем после смены провайдера на втором компе 192.168.0.1 отвалился инет. Как выяснилось проблема кроется в ДНС.<br/>На первом днс все отлично работает ДНС пингуется.<br/>На втором днс  не пингуется, внешний инет виден только по ip.<br/>route на втором компе говорит следующее<br/><div class="code"><pre>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.0.0     *                 255.255.255.0         U     0      0        0 eth0
default            192.168.0.4     0.0.0.0               UG    0      0        0 eth0    </pre></div><br/>В чем может быть глюк?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-53472"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bultdog/">
                <span class="post-username">bultdog</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/53472/">#</a>
            11 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bultdog/topics/">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bultdog/posts/">
                    5
                </a>
            </div>
            <div>
                Участник с: 29 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            поставил на первый комп (раздающий нет) dnsmasq, а на втором указал в качестве ДНС ip первого, т.е. 192.168.0.1 и все заработало.<br/>Но все равно хочется понять в чем была проблема :(
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-53473"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/xfilx/">
                <span class="post-username">xfilx</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/53473/">#</a>
            11 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/xfilx/topics/">
                    3
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/xfilx/posts/">
                    115
                </a>
            </div>
            <div>
                Участник с: 21 сентября 2010
            </div>
            
        </td>
        <td class="post-content">
            я бы сначала на втором компе в /etc/resolv.conf ДНС'ы прописал, может и не потребовалось бы dhcp
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-53474"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bultdog/">
                <span class="post-username">bultdog</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/53474/">#</a>
            11 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bultdog/topics/">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bultdog/posts/">
                    5
                </a>
            </div>
            <div>
                Участник с: 29 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            днс естествено прописаны
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-53475"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/bultdog/">
                <span class="post-username">bultdog</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/53475/">#</a>
            11 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/bultdog/topics/">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/bultdog/posts/">
                    5
                </a>
            </div>
            <div>
                Участник с: 29 июня 2010
            </div>
            
        </td>
        <td class="post-content">
            убрал dnsmasq , днс на втором компе вернул на днс провайдера.<br/>вместо<br/>iptables  -t nat -A POSTROUTING -s 192.168.0.0/24 -d 0/0 -j MASQUERADE<br/>сделал<br/>iptables  -t nat -A POSTROUTING -s 192.168.0.0/24 -d 0/0 -j SNAT &ndash;to-source &lt;IP-который-дал-провайдер-по-DHCP&gt;<br/>и наступило мне счастье.<br/>В общем теперь вместо NAT использую SNAT. <br/>До сих пор не врубаюсь почему работает, может кто нить объяснит?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/5483/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script>(function(){var js = "window['__CF$cv$params']={r:'747bbc348cf19d76',m:'38MAcwff417huPq_Rzddp.D5akh9t5xonk5Wj8ISWQw-1662682586-0-AQMYFi1flZlxHs32u8g5HwEYi5pE2i9PDXFYkboKeq8kro7ni9ZPwHYJoj7WqQcwXQJB5FBL5Wx1VtbXbhV8Vdp8k4lyBIO+ut3tMrtigymlXkybHCUa8emXgNYzi0XArcKBZ0hMXa6srvwGDuPm+dw=',s:[0xe8897059db,0x11530b78e8],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
