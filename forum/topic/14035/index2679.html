


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Настройка Asus AcerEEE PC Fn+F7
    </title>
    <link rel="shortcut icon" href="https://archlinuxcomru.github.io/backup/src/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    

    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://archlinuxcomru.github.io/backup/src/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/8/">Блоги</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/25/">Блоги</a> <span class="divider">/</span></li>
            
        
        
            <li>Настройка Asus AcerEEE PC Fn+F7</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Настройка Asus AcerEEE PC Fn+F7</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142340"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Sheykhnur/">
                <span class="post-username">Sheykhnur</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142340/">#</a>
            7 лет, 11 месяцев назад
            
                (отредактировано
                
                    7 лет, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/d1/b6/d1b62754f45b5c4a783cd15c795c84b5.png" alt="Sheykhnur avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Sheykhnur/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Sheykhnur/posts/">
                    244
                </a>
            </div>
            <div>
                Участник с: 05 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Это заметка, но, быть может, кому-то и поможет. Должен сразу заметить, что после установки на оный нетбук (Acer EEE PC 1005 PXD) почти все Fn&#39;ки заработали сразу, за исключением Fn+F7 (на остальные мне удалось навесить хоткеи). Начало раскопок было, как водится, трудным: пришлось перечитать кучу манов, вики и вообще много буковок перебрать (в т.ч. на аглицком), прежде чем я смог понять вообще куда копать. Вначале, нужно начать с того, что в нашей вики весь процесс описывается довольно сдержанно, но хотя бы показывает дорогу. Вообще, было интересно копать от модулей клавиатуры ядра atkbd до xinput, и выяснить в итоге, что иксы не обрабатывают клавиши с кейкодами выше 255. Далее вопрос возник сам собой: а как «заставить» понимать иксы клавишу с кейкодом(keycode) 431(dec)? Из этого я узнал, что в моём Арчике существует овер 9000 слоёв абстракции, то бишь, имеем: ядерный уровень, — как правило, обрабатывает сканкод(scancode) и присваивает определённое число — кейкод(keycode); затем, — в зависимости от присвоенного значения — выполняет действия на поступившее событие (тогда я ещё не знал, что событиями от клавиатуры управляет тот же udev). Затем, данное значение передаётся дальше, т.е. иксам. Иксы данное значение просто «не видят». В итоге, в течение долгого, несколькодневного пытания настроить клавишу Fn+F7 перебрал кучу способов, как то: поставить пакет <a href="https://aur.archlinux.org/packages/evrouter">evrouter</a> — он как бы пробрасывает кейкоды, которые выше 255 на уровень ниже; например, можно пробросить кейкод 431 на более низкий, например, 253. Но этот способ мне не понравился, т.к. это требовало запускать отдельный демон, писать к нему сервис запуска с аргументами и вообще... есть и другие способы. Дальше мне пришла идея поискать патчи на сами иксы (ну, неужели у меня одного так?), и, таки, патч нашёлся! Дело в том, что в иксах за приём событий от ядра отвечает модуль xf86-evdev. Естественно, добрые люди его уже догадались <a href="https://aur.archlinux.org/packages/xf86-evdev-input-remap-git/">пропатчить</a>. Но и это меня не устроило :-) (модуль загружался и даже делал своё дело, но мне хотелось решить это штатными средствами, т.к. данный модуль давно не обновлялся и обновлять это мне потом придётся вручную). И тут я добрался до udev&#39;а. До этого момента дела у меня с ним не ладились: я не мог понять как с ним обращаться; но после долгого чтения, вникания и экспериментов, мне удалось заставить его пробрасывать события сочетания через создаваемый им /dev/input/event* EEE Pc WMI Hotkeys — хотфикс для разных ноутбучных клавиатур. Я добавил свой сканкод клавиши, узнать который можно не только через showkey (который в иксах не хочет работать, а xev не видит сочетание, т.к. сам работает через иксы), а и через кошерный evtest, и попросил ядро через правило udev присвоить <em>сканкоду</em> клавиши e9 <em>кейкод</em> равный значению display_off(245)<br />Пробуем выполнить его от рута, т.к. доступ к устройствам /dev/input/event* есть только у рута.<br /><pre><code>
$sudo evtest
No device specified, trying to scan all of /dev/input/event*
Available devices:
/dev/input/event0:      Lid Switch
/dev/input/event1:      Sleep Button
/dev/input/event2:      Power Button
/dev/input/event3:      Power Button
/dev/input/event4:      Video Bus
/dev/input/event5:      AT Translated Set 2 keyboard
/dev/input/event6:      PC Speaker
/dev/input/event7:      Eee PC WMI hotkeys
/dev/input/event8:      HDA Intel Headphone Mic
/dev/input/event9:      USB 2.0 UVC VGA WebCam
/dev/input/event10:     ETPS/2 Elantech Touchpad
Select the device event number [0-10]: 7
Input driver version is 1.0.1
Input device ID: bus 0x19 vendor 0x0 product 0x0 version 0x0
Input device name: &quot;Eee PC WMI hotkeys&quot;
Supported events:
  Event type 0 (EV_SYN)
  Event type 1 (EV_KEY)
    Event code 1 (KEY_ESC)
    Event code 113 (KEY_MUTE)
    Event code 114 (KEY_VOLUMEDOWN)
    Event code 115 (KEY_VOLUMEUP)
    Event code 139 (KEY_MENU)
    Event code 148 (KEY_PROG1)
    Event code 152 (KEY_SCREENLOCK)
    Event code 171 (KEY_CONFIG)
    Event code 172 (KEY_HOMEPAGE)
    Event code 184 (KEY_F14)
    Event code 185 (KEY_F15)
    Event code 191 (KEY_F21)
    Event code 212 (KEY_CAMERA)
    Event code 224 (KEY_BRIGHTNESSDOWN)
    Event code 225 (KEY_BRIGHTNESSUP)
    Event code 227 (KEY_SWITCHVIDEOMODE)
    Event code 238 (KEY_WLAN)
    Event code 240 (KEY_UNKNOWN)
    Event code 431 (KEY_DISPLAYTOGGLE)
    Event code 533 (KEY_CAMERA_ZOOMIN)
    Event code 534 (KEY_CAMERA_ZOOMOUT)
    Event code 535 (KEY_CAMERA_UP)
    Event code 536 (KEY_CAMERA_DOWN)
    Event code 537 (KEY_CAMERA_LEFT)
    Event code 538 (KEY_CAMERA_RIGHT)
  Event type 4 (EV_MSC)
    Event code 4 (MSC_SCAN)
Key repeat handling:
  Repeat type 20 (EV_REP)
    Repeat code 0 (REP_DELAY)
      Value    250
    Repeat code 1 (REP_PERIOD)
      Value     33
Properties:
Testing ... (interrupt to exit)
</code></pre>Пробуем нажать нашу комбинацию:<br /><pre><code>
Event: time 1412394050.771966, type 4 (EV_MSC), code 4 (MSC_SCAN), value e9
Event: time 1412394050.771966, type 1 (EV_KEY), code 431 (KEY_DISPLAYTOGGLE), value 1
Event: time 1412394050.771966, -------------- EV_SYN ------------
Event: time 1412394050.772016, type 1 (EV_KEY), code 431 (KEY_DISPLAYTOGGLE), value 0
Event: time 1412394050.772016, -------------- EV_SYN ------------
</code></pre>Итак, evtest мне показал, что сканкод моей клавиши e9(hex),  и что ядро его обрабатывает и присваивает кейкод 431(dec). Лезем в /usr/include/linux/input.h (не забудьте перевести десятичное число в шестнадцатеричное) и видим, что за этим номером у нас как раз обработка, внезапно, displaytoggle, но ядро по каким-то причинам не гасит экран (проверял в консоли, т.к. через иксы это должно выполняться по-другому). Ну и ладно, переназначим на своё событие. Лезем в /usr/lib/udev/hwdb.d — это база данных и правила как обращаться udev&#39;у с различным оборудованием. Находим там базу данных клавиатур и заглянем в неё. Как мы помним evtest выдал нам сканкод клавиши за номером e9. Поиск по данному сканкоду нам ничего не даёт. Что ж, добавим! Да только не в этот файл, ибо он перепишется при обновлении, а создадим в каталоге /etc/udev/hwdb.d/ свой файл с названием 70-keyboad.hwdb и добавим туда новую секцию (файл /usr/lib/udev/hwdb.d можно использовать как шаблон):<br /><pre><code>
###########################################################
# Asus
###########################################################

#From systemd 220 the udev ABI changed.
#keyboard:dmi:bvn*:bvr*:bd*:svnASUS:pn*
#keyboard:name:Eee PC WMI hotkeys:dmi:bvn*:bvr*:bd*:svnASUS*:pn*:pvr*

evdev:name:Eee PC WMI hotkeys:dmi:bvn*:bvr*:bd*:svnASUS*:pn*:pvr*
 KEYBOARD_KEY_e9=display_off
</code></pre>где KEYBOARD_KEY_* — добавляемое правило для определённого сканкода, а e9 — значение сканкода, который нам показал evtest. Т.к. значение display_off на порядок ниже — 245 (см. /usr/include/linux/input.h), то иксы должны его воспринять.<br />  Итак, перекомпилируем базу данных<br /><pre><code>$sudo udevadm hwdb --update</code></pre>Теперь перезагрузим компьютер, т.к. перезагрузка правил <em>udevadm trigger</em> работает лишь для вновь добавляемых правил, в то время, как изменение уже используемых (/dev/input/event7 уже используется) требует перезагрузки. Итак, по идее, теперь udev обрабатывает события сканкода и отправляет его ядру, которое в свою очередь обрабатывает его, присваивает кейкод по правилам udev&#39;а иотправляет его дальше, а именно иксам, вот такая вот бюрократия! Запускаем наш xev и видим, что событие приходит, но для него не назначено никакого символа. Конечно, ведь иксы тоже бюрократичны и там тоже имеется, как минимум, два слоя, прежде, чем событие дойдёт до самого́ приложения. Из xev&#39;а узнаё́м keycode (у меня он был 253). Затем открываем файл /usr/share/X11/xkb/symbols/inet  и ищем там строчку с описанием нашего keycode. У меня она оказалась за номером I253 и закомментированной. Что ж, раскомментируем и присвоим ей какое-либо существующее значение, например, XF86LaunchA (полный список значений доступен по адресу /usr/include/X11/XF86keysym.h). Далее, прописываем куда-нибудь в автозапуск скрипт отключения экрана и вешаем на него хоткей. В кедах это можно сделать штатно через «Параметры системы → Комбинации клавиш и росчерки → раздел Специальные действия → правым кликом мыши по списку действий → Новый → Глобальная комбинация клавиш → Команда или адрес.» Далее, во вкладке <em>Активация</em> задаём наш вновь созданный хоткей, а во вкладке <em>Действие</em> вводим команду<br /><pre><code>/bin/xset -display :0 dpms force off</code></pre>Сохраняем свою работу и перезагружаем иксы. Т.к. у меня KDE, то я перезагружаю их командой<br /><pre><code>$sudo systemctl restart kdm</code></pre>для гнома kdm, соответственно, нужно заменить на gdm.<br />====================================================<br />В блог не решился поместить, т.к. для блога заметка не викифицирована и написана, что называется, от себя. Сильно не пинайте — это моя первая заметка; если у кого есть предложения по улучшению — всегда готов вычитать :-)<br />P.S.: Обновлено правило udev&#39;а, т.к., начиная с версии 220 systemd, ABI udev&#39;а было изменено.
            
                
                    <div class="post-signature">
                        <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f785989883b7818782879c9e99">[email&#160;protected]</a># cat /dev/ass &gt; /dev/head
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142352"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vadik/">
                <span class="post-username">vadik</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142352/">#</a>
            7 лет, 11 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vadik/topics/">
                    55
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vadik/posts/">
                    5395
                </a>
            </div>
            <div>
                Участник с: 17 августа 2009
            </div>
            
        </td>
        <td class="post-content">
            Нормальная заметка. Я бы ее все равно в блоги поместил. Если надумаете - маякните, перенесу.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142357"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Sheykhnur/">
                <span class="post-username">Sheykhnur</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142357/">#</a>
            7 лет, 11 месяцев назад
            
                (отредактировано
                
                    7 лет, 11 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/d1/b6/d1b62754f45b5c4a783cd15c795c84b5.png" alt="Sheykhnur avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Sheykhnur/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Sheykhnur/posts/">
                    244
                </a>
            </div>
            <div>
                Участник с: 05 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
              Заметку обновил, уточнил модель нетбука, подправил правило udev&#39;а (признаюсь, согрешил: делал ночью и добавил правило к уже существующим :-), а при создании нового правила, путём копипаста с моей же заметки вылезла ошибка: оказывается, между описанием правила и самим правилом не должно быть пустых строк...).<br />  <strong>Теперь, у меня главный вопрос знатокам:</strong> почему ядро не обрабатывает сразу это событие? В /usr/include/linux/input.h ясно прописано же, что этой комбинации соответвствует отключение подсветки дисплея ( строка 635 явно намекает нам на это: #define KEY_DISPLAYTOGGLE	0x1af	/* Turn display (LCD) on and off */ ). В установочном LiveCD ядро каким-то образом отключает подсветку монитора через определённое время, значит, такая возможность у него есть, как её включить в штатном ядре? Если это событие ACPI, то как можно ими управлять, не устанавливая демон (не хочется лишнего демона для одного только управления подсветкой); может, посылкой сигнала в какой-нибудь /proc/sys etc?..<br />  P.S.: Если заметка соответствует критериям блога, то можете переместить.
            
                
                    <div class="post-signature">
                        <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3d4f5252497d4b4d484d565453">[email&#160;protected]</a># cat /dev/ass &gt; /dev/head
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142358"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142358/">#</a>
            7 лет, 11 месяцев назад
            
                (отредактировано
                
                    7 лет, 11 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Это первая заметка о переназначении клавиш. Похвально.<br />Попробую внести некоторые дополнения и уточнения из своей практики<br />- showkey в иксах работает, но нужно через sudo — правда это делать не рекомендуется, а бывает и так, что scancode в иксах и консоли отличаются.<br />-  showkey показывает только те scancode, которые известны ядру и пропускает scancode посылаемые клавиатурой. Чтобы это исключить, нужно загрузиться с опцией ядра  atkbd.softraw=0, что переключает ядро в режим  native scancode.<br />Из своей практики хочу добавить, что эта опция частенько изменяет все   scancode. Также хотелось бы отметить, что частенько showkey показывают совсем не те  scancode — отличаются, как правило, на 8.<br />- xev — как правило толку от нее мало при ремонте мультимедийных клавиш<br />- evtest — считаю одной из лучших утилит.<br />Насчет задействования мультимедийных клавиш - scancode является самым нижним уровнем идентификации клавиши, определен на аппаратном уровне, и вообщем то он определен всегда. Как правило, цепочка рвется на уровне keycode --- keysym, а поэтому знание  scancode не так и важно (за исключением редких случаев). Это я к тому, что нужно вначале пробовать восстановить эту цепочку, а использовать для этого лучше наиболее простые способы — утилиты  setkeycodes и xmodmap, что намного проще и удобнее, но это дело вкуса.<br />Для получения информации о keycode + keysym + keysumname (чтение текущей конфигурации XKB) лучше использовать<br />$ xmodmap -pke<br />$ xkbcomp -xkb :0 -
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142367"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/cucullus/">
                <span class="post-username">cucullus</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142367/">#</a>
            7 лет, 11 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/3e/fc/3efc5087b47b238689d6b1152d129048.png" alt="cucullus avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/cucullus/topics/">
                    257
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/cucullus/posts/">
                    3438
                </a>
            </div>
            <div>
                Участник с: 06 июня 2007
            </div>
            
        </td>
        <td class="post-content">
            можно ли повесить на клавишу скрипт, чтобы он работал и в консоли и в иксах?
            
                
                    <div class="post-signature">
                        такие дела.
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-142379"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Sheykhnur/">
                <span class="post-username">Sheykhnur</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/142379/">#</a>
            7 лет, 11 месяцев назад
            
                (отредактировано
                
                    7 лет, 11 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/d1/b6/d1b62754f45b5c4a783cd15c795c84b5.png" alt="Sheykhnur avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Sheykhnur/topics/">
                    16
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Sheykhnur/posts/">
                    244
                </a>
            </div>
            <div>
                Участник с: 05 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            vasek, всё бы хорошо, я бы и сам был бы рад через xkb настроить, но, как я уже написал, иксы не обрабатывают «сканкод» выше 255, вот и приходится плясать с бубном. А про xkb самая кошерная статья у <a href="http://pascal.tsu.ru/other/xkb/">Ивана Паскаля</a>. Здесь был вопрос в другом: ядро-то мою клавишу как раз и обрабатывает (что доказывает номер клавиши (<em>keycode</em>) - 431, если бы было необработано, то в dmesg сыпались бы ошибки, а код был бы шестнадцатеричным), но не отрабатывает <em>событие</em>. А в иксах showkey отличается потому, что, ещё раз повторюсь, — иксы обрабатывают код(<em>keycode</em>) клавиши который присваивается ядром, а приложениям иксы посылает уже обработанный символ(<em>keysym</em>); showkey через sudo в иксах такое же приложение, не более, и, поэтому, на вход оно получает другой «сканкод»(т.е. обработанный иксами keysym), и именно поэтому его и не рекомендуют запускать в иксах, т.к. сканкод не сырой, а дважды обработанный: сначала ядром, затем иксами. Xev же показывает, назначен ли keysym на определённый код и, если не назначен, то выводит nosymbol, т.к. иксы могут воспринимать клавишу, но в таблице ей может быть не назначен keysym(если интересно, загляните в /usr/share/X11/xkb/symbols/inet — вы удивитесь сколько сочетаний и клавиш остаются необработанными, в заметке я это, кстати, ммм... заметил :-). То есть, у меня цепочка рвалась как раз в месте ядро → иксы, т.к. ядро присвоило <em>кейкод</em>(keycode) (не сканкод!) 431(dec) клавише, у которой <em>сканкод</em> равен e9(hex), т.е. кейкод (в дальнейшем я буду просто писать код) 431(dec) выше кода 255(dec). Вы должны понимать, что иксы получают не голый необработанный сканкод клавиши, но её номер - кейкод, присвоенный ей ядром, что правило udev&#39;а и доказывает (ведь udev — это просто набор правил, по которым играет ядро, то я просто попросил ядро присвоить <em>код</em>(keycode) клавише <em>со сканкодом</em> e9 пониже, скажем, 253). Т.е. до иксов доходит уже обработанная клавиша (по идее, ядро должно было отработать и событие, которое навешено на него, но, как говорится, должно, но не обязано :-)), а далее иксы уже обрабатывают код(keycode) клавиши по-своему, а приложению выдают готовый символ keysym(-bol), например XF86BrightnessUP, или Cyrillic_GHE, и т.д. Это всё работа xkb. Итог: получается цепочка: физический сканкод(scancode) с порта клавиатуры → получение его драйвером atkbd и дальнейшая передача этого кода(scancode) ядру → обработка клавиши(scancode) ядром по правилам udev&#39;а; если сканкод известен, то присвоение номера кода(keycode) клавише и дальнейшая передача его(keycode) приложениям, в данном случае иксам → получение входящего <em>кода</em>(keycode) клавиши иксами через evdev и передача его(keycode) модулю xkb → обработка <em>кода</em>(keycode) модулем xkb и назначение ему <em>символа</em>(keysym) (в зависимости от номера кода клавиши(keycode), которое прислало ядро), и передача этого символа(keysym) приложениям. Т.е. сам низкоуровневый сканкод (scancode) клавиши, тот, что e9(hex) фигурирует лишь на уровне драйвера клавиатуры ядра, после него мы можем лишь оперировать <em>кодом</em>(keycode) клавиши, которое присваивает ядро (которое играет по правилам udev&#39;а 8-). Я читал вики до просветления и опыты это доказывают :-)) Если неверно, поправьте, пожалуйста :-)<br />xmodmap -pke - это лишь многомерная таблица сопоставления <em>символов</em>(keysym) <em>кодам</em>(keycode)(те, что присвоены ядром) клавиш. Она высокоуровневая по отношению к ядру. Драйвер xkb получает коды клавиш от ядра, а ядро играет по правилам udev&#39;а. Я через правила udev&#39;а смогу всю таблицу переписать ;-))<br />P.S.: Главный вопрос остаётся в силе: <strong>почему ядро не обрабатывает событие</strong>?<br /><br />P.P.S.: cucullus, можно, если вы возьмёте код(keycode) клавиши или сочетания, который одинаков везде и через правило udev зададите запуск (RUN) вашего скрипта. Udev работает и со сканкодом(scancode) и с кейкодом(keycode) клавиши или сочетания, но только не с символами(keysym) иксов, т.к. иксы на один слой абстракции выше удава. Но в иксах тоже будет отрабатывать, ведь код(keycode) сочетания или клавиши будет проходить сначала через удав, а потом уже идти в иксы, так что скрипт отработает :-) только в скрипт нужно будет добавить какое-нибудь условие на случай если запущены иксы, чтобы через d-bus, например, отправлять notify на рабочий стол, ну, или что у вас там... Удав вообще штука низкоуровневая и с помощью него много чего можно делать, почитайте <a href="https://wiki.archlinux.org/index.php/Udev">вики</a> про него или <a href="http://rus-linux.net/lib.php?name=MyLDP/sys-conf/udev.html">здесь</a>, ещё <a href="https://www.opennet.ru/base/sys/udev_review.txt.html">здесь</a>, и <a href="http://manpages.ylsoftware.com/ru/udev.7.html">ещё</a>.
            
                
                    <div class="post-signature">
                        <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e1938e8e95a1979194918a888f">[email&#160;protected]</a># cat /dev/ass &gt; /dev/head
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-214720"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/214720/">#</a>
            3 года, 6 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            А я свои клавиши так и не смог настроить даже через udev.  Пытался много раз и пробовал разные методики, но все напрасно.<br />Главное, в Ubuntu работают все комбинации Fn+FN, в ArchLinux работает только одна комбинация Fn+F1 (suspend). Все клавиши определяются, ошибок в логах нет.<br />Правда, есть один нюанс, который похоже и портит всю картину - если в <strong>evtest</strong> выбрать <strong>WMI hotkeys</strong>, то эти комбинации не определяются. Но разбираться с этим дальше не стал, надоело, а главное у меня WM и можно назначить самому любую комбинацию.<br /><br />Выкладываю 2 статейки по использованию udev <a href="https://forums.linuxmint.com/viewtopic.php?t=179803">это_1</a> и <a href="https://forums.linuxmint.com/viewtopic.php?t=153157">это_2</a>, описывают туже процедуру, описанную <strong>Sheykhnur</strong>.<br />Пусть все лежит в одном месте, может кому и пригодится.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-214721"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/indeviral/">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/214721/">#</a>
            3 года, 6 месяцев назад
            
                (отредактировано
                
                    3 года, 6 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/indeviral/topics/">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/indeviral/posts/">
                    3196
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            что за некромантия?)<br />если не ошибаюся у вас hp, а вы <a href="https://wiki.archlinux.org/index.php/HP_Pavilion_dv6018">отсюда</a> пробовали решение.<br /><br />з.ы. а если вдруг не заработает один из этих должен помочь /usr/share/X11/xkb/rules/base.lst
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-214723"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/214723/">#</a>
            3 года, 6 месяцев назад
            
                (отредактировано
                
                    3 года, 6 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br>что за некромантия?)</blockquote>Да просто сейчас отписывался в одном топике, в котором дал ссылку на этот топик, а заодно добавил ссылки на пару статеек - лучше когда все в одном месте.<br /><blockquote><em>indeviral</em><br>если не ошибаюся у вас hp, а вы отсюда пробовали решение.</blockquote>Пробовал много чего, но больше уже точно не буду - хватит, устал.<br />c udev бы возможно и сработало бы но не определяются WMI hotkeys, а если вставляешь обычные коды, то эффекта нет. Но возможно причина и не в WMI hotkeys
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-214724"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/indeviral/">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/214724/">#</a>
            3 года, 6 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/indeviral/topics/">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/indeviral/posts/">
                    3196
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vasek</em><br>Но возможно причина и не в WMI hotkeys</blockquote>да *** его знает )) <a href="https://www.thinkwiki.org/wiki/How_to_get_special_keys_to_work">ссылка</a><br />у меня на lenovo v510 тоже не все fn работают...
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/14035/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747ab338bce915fe',m:'aPHcxbcHzwXe3XL0ZwxV9RyvOgNbVzgwaZhoQK0ZsT0-1662671734-0-Ab+dASLf9HKZc0xGBDVLbDuSFjsCB+lh+0bEeIB8qqZwOwVM3iWys7AmCRZstmJzUqN24sif4BDcpvKNXApd5OG7gcH7pHiPu1uxvONRwmQduJeLE9VyH2xckeo/c+C7i2U96v1dt5Jgu/4zla5yiro=',s:[0x4c671d7304,0x8bfc36abb0],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
