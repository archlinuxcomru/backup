


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Долгая загрузка системы после установки pulseaudio.
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/10/">Мультимедиа</a> <span class="divider">/</span></li>
            
        
        
            <li>Долгая загрузка системы после установки pulseaudio.</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Долгая загрузка системы после установки pulseaudio.</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=4" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=5">5 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=7">7</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=6" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185441"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185441/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br>Проблема запуска юнита обычно не в самом systemd, а в сервисе, который запускается из этого юнита. Вот и надо попытаться запустить этот сервис просто руками, из консоли. Если он вручную не запускается, то никакой systemd не заставит его работать. Все просто...</blockquote>Может я плохо объяснил ........ я запускаю из юнита сам сервис через strace  ......... и намного больше информации - видно куда лезет и сколько времени на что уходит ...<br /><em>PS ......... возможно это и не правильно ...... но ничего другого до сих пор не находил ...... это обсуждение у нас впервые .....</em>
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185535"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185535/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br>вогнал pulse в debug походу дело в наличии или отсутствии alsa-mixer.с alsa-util.c, соответственно alsa-lib и alsa-utils, а так же количестве и типе самих звуковых устройств.</blockquote>Заметил у себя - время  запуска сервиса не постоянно и меняется в интервале 1,5 — 4с  (<u>например, сегодняшние данные — 2.955s, 1.507s</u>) …..... решил проверить, почему меняется и выявил (использовал strace) —  например, для случая загрузки с временем  2,5с ….... <strong>2с уходит на два timeout</strong> в системном вызове ppoll (по 1с два раза — timeout установлен в 1с)<br />UPD …. ppoll() позволяет приложению безопасно ждать, пока файловый дескриптор не станет готов или пока не будет получен сигнал, т. е. завершается если истекло установленное время ожидания и нет готовых файловых дескрипторов<br /><pre><code>1.003153 &lt;... ppoll resumed&gt; ) = 0 (Timeout)
где ppoll …. ppoll([{fd=17, events=POLLIN}, {fd=22, events=POLLIN|POLLERR|POLLNVAL}, {fd=18, events=POLLIN}, {fd=21, events=POLLOUT|POLLERR|POLLNVAL}], 4, {tv_sec=1, tv_nsec=978607000}, NULL, 8 &lt;unfinished ...&gt;

0.970789 &lt;... ppoll resumed&gt; ) = 0 (Timeout)
где ppoll …. ppoll([{fd=24, events=POLLIN}, {fd=27, events=POLLIN|POLLERR|POLLNVAL}, {fd=25, events=POLLIN}, {fd=28, events=POLLIN|POLLERR|POLLNVAL}], 4, {tv_sec=1, tv_nsec=979999000}, NULL, 8 &lt;unfinished ...&gt;</code></pre>PS … интересно отметить статистику по системному вызову <strong>open</strong><br />- всего вызовов — 872<br />- из них пустых (лезет в несуществующие файлы) — 238<br />- наибольшее обращение к файлу <strong>/dev/snd/controlC0</strong> —  365<br />И что интересно, этот файл как раз и являлся причиной timeout (система не дождалась данного дескриптора)<br /><br /><em>PSS ... это я к тому, что достаточно 10 timeout и получим 10с задержки ...</em>
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185561"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/indeviral/">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185561/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/indeviral/topics/">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/indeviral/posts/">
                    3196
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vasek</em><br>- всего вызовов — 872<br />- из них пустых (лезет в несуществующие файлы) — 238<br />- наибольшее обращение к файлу /dev/snd/controlC0 — 365<br />И что интересно, этот файл как раз и являлся причиной timeout (система не дождалась данного дескриптора)</blockquote>Причиной этого мракобессия скорее всего является вот это /etc/pulse/default.pa<br />Мутноватая система загрузки модулей... Надо попробовать поубирать лишнее, должно помочь.<br /><br />p.s. особенно понравился вот этот модуль<br /><blockquote>### Automatically augment property information from .desktop files<br />### stored in /usr/share/application<br />load-module module-augment-properties</blockquote><br />p.p.s ничего это не даёт, оставил только два модуля время уменьшилось на ~1-1.5 сек
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185562"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Haron_Prime/">
                <span class="post-username">Haron_Prime</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185562/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/98/c0/98c04efd47cc8aad6f697551c01c4dbd.png" alt="Haron_Prime avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Haron_Prime/topics/">
                    28
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Haron_Prime/posts/">
                    2109
                </a>
            </div>
            <div>
                Участник с: 08 июня 2014
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br>Надо попробовать поубирать лишнее, должно помочь.</blockquote>ещё два дня назад поотключал всё, без чего пульс нормально запускается и выводит звук<br />я бы не сказал, что что-то сильно изменилось<br /><pre><code>1.263s pulseaudio.service</code></pre><br />из всех оставил только<br /><pre><code>load-module module-device-restore
load-module module-card-restore
load-module module-udev-detect
load-module module-native-protocol-unix
load-module module-gconf
load-module module-systemd-login
load-module module-position-event-sounds
load-module module-filter-heuristics
load-module module-filter-apply
load-module module-dbus-protocol</code></pre><br />P.S&gt; отключил вдобавок<br /><pre><code>load-module module-device-restore
load-module module-card-restore
load-module module-gconf</code></pre><br /><pre><code>1.198s pulseaudio.service</code></pre><br />В общем, всё это как мёртвому припарки! Пульс - вещь в себе, как и другое творение того же автора ;)
            
                
                    <div class="post-signature">
                        Gnome 2 &gt;&gt; Unity &gt;&gt; KDE 4 &gt;&gt; Openbox &gt;&gt; Awesome &gt;&gt; Xmonad<br /><strong><u><a href="https://github.com/Haron-Prime">GitHub</a> ,  <a href="https://bitbucket.org/HaronPrime/">BitBuket</a></u></strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185563"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/indeviral/">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185563/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/indeviral/topics/">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/indeviral/posts/">
                    3196
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote>[pulseaudio] (alsa-lib)utils.c: could not open configuration file /usr/share/alsa/ucm/HDA Intel PCH/HDA Intel PCH.conf<br />[pulseaudio] (alsa-lib)parser.c: error: could not parse configuration for card HDA Intel PCH<br />[pulseaudio] (alsa-lib)main.c: error: failed to import HDA Intel PCH use case configuration -2<br />[pulseaudio] alsa-ucm.c: UCM not available for card HDA Intel PCH</blockquote>Может надо не pulse а alsa ковырять)))
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185564"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Haron_Prime/">
                <span class="post-username">Haron_Prime</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185564/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/98/c0/98c04efd47cc8aad6f697551c01c4dbd.png" alt="Haron_Prime avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Haron_Prime/topics/">
                    28
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Haron_Prime/posts/">
                    2109
                </a>
            </div>
            <div>
                Участник с: 08 июня 2014
            </div>
            
        </td>
        <td class="post-content">
            P.P.S&gt;<br />поотключал вообще практически всё - оставил только то, без чего он работать вообще отказывается<br /><br /><pre><code>load-module module-udev-detect
load-module module-native-protocol-unix
load-module module-systemd-login
</code></pre><br /><pre><code>1.188s pulseaudio.service</code></pre><br /><blockquote><em>indeviral</em><br>Может надо не pulse а alsa ковырять)))</blockquote><br />у меня ничего подобного нет<br /><br /><pre><code>jctlb g pulseaudio
Мар 22 22:23:24 arch rtkit-daemon[593]: Successfully made thread 592 of process 592 (/usr/bin/pulseaudio) owned by &#39;1000&#39; high priority at nice level -11.</code></pre>
            
                
                    <div class="post-signature">
                        Gnome 2 &gt;&gt; Unity &gt;&gt; KDE 4 &gt;&gt; Openbox &gt;&gt; Awesome &gt;&gt; Xmonad<br /><strong><u><a href="https://github.com/Haron-Prime">GitHub</a> ,  <a href="https://bitbucket.org/HaronPrime/">BitBuket</a></u></strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185565"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Haron_Prime/">
                <span class="post-username">Haron_Prime</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185565/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/98/c0/98c04efd47cc8aad6f697551c01c4dbd.png" alt="Haron_Prime avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Haron_Prime/topics/">
                    28
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Haron_Prime/posts/">
                    2109
                </a>
            </div>
            <div>
                Участник с: 08 июня 2014
            </div>
            
        </td>
        <td class="post-content">
            Запустил у себя с strace - ничего, подобного этому<br /><blockquote><em>vasek</em><br>1.003153 &lt;... ppoll resumed&gt; ) = 0 (Timeout)<br />где ppoll …. ppoll([{fd=17, events=POLLIN}, {fd=22, events=POLLIN|POLLERR|POLLNVAL}, {fd=18, events=POLLIN}, {fd=21, events=POLLOUT|POLLERR|POLLNVAL}], 4, {tv_sec=1, tv_nsec=978607000}, NULL, 8 &lt;unfinished ...&gt;<br /><br />0.970789 &lt;... ppoll resumed&gt; ) = 0 (Timeout)<br />где ppoll …. ppoll([{fd=24, events=POLLIN}, {fd=27, events=POLLIN|POLLERR|POLLNVAL}, {fd=25, events=POLLIN}, {fd=28, events=POLLIN|POLLERR|POLLNVAL}], 4, {tv_sec=1, tv_nsec=979999000}, NULL, 8 &lt;unfinished ...&gt;</blockquote>не обнаружил!<br />Ни одного вхождения ppoll<br /><br /><a href="https://pastebin.com/i67tZPxu">Вот</a> весь выхлоп, если кому интересно<br /><br />зато &quot;No such file or directory&quot; - аж 104 вхождения ((((<br />хрень какая-то...
            
                
                    <div class="post-signature">
                        Gnome 2 &gt;&gt; Unity &gt;&gt; KDE 4 &gt;&gt; Openbox &gt;&gt; Awesome &gt;&gt; Xmonad<br /><strong><u><a href="https://github.com/Haron-Prime">GitHub</a> ,  <a href="https://bitbucket.org/HaronPrime/">BitBuket</a></u></strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185566"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Haron_Prime/">
                <span class="post-username">Haron_Prime</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185566/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/98/c0/98c04efd47cc8aad6f697551c01c4dbd.png" alt="Haron_Prime avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Haron_Prime/topics/">
                    28
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Haron_Prime/posts/">
                    2109
                </a>
            </div>
            <div>
                Участник с: 08 июня 2014
            </div>
            
        </td>
        <td class="post-content">
            хотя время заметно уменьшилось<br /><pre><code>537ms pulseaudio.service</code></pre>
            
                
                    <div class="post-signature">
                        Gnome 2 &gt;&gt; Unity &gt;&gt; KDE 4 &gt;&gt; Openbox &gt;&gt; Awesome &gt;&gt; Xmonad<br /><strong><u><a href="https://github.com/Haron-Prime">GitHub</a> ,  <a href="https://bitbucket.org/HaronPrime/">BitBuket</a></u></strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185603"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185603/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>Haron_Prime</em><br>Вот весь выхлоп, если кому интересно</blockquote>Судя по строке<br />execve(&quot;/bin/pulseaudio&quot;, [&quot;pulseaudio&quot;], [/* 47 vars */]) = 0<br />и времени загрузки<br /><blockquote><em>Haron_Prime</em><br>хотя время заметно уменьшилось<br />537ms pulseaudio.service</blockquote>Предположу, что загрузка сервиса была не совсем правильная ...
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-185627"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/vasek/">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185627/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/vasek/topics/">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/vasek/posts/">
                    11340
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Прошу не ругаться за писанину, но решил описать как я делал … пошел простым путем, не стал редактировать системные файлы … правильно это или нет, не знаю. Для того и пишу, чтобы узнать на этот счет мнение спецов по systemd, чтобы учесть замечания на будущее<br /><br /><strike>На всякий случай делаем копию файла /<strong>usr/lib/systemd/user/pulseaudio.service</strong></strike> лишнее ... так как способ я изменил<br />$ <strong>systemctl --user edit --full pulseaudio.service</strong><br />строку …. ExecStart=/usr/bin/pulseaudio --daemonize=no … приводим к виду<br />ExecStart=<strong>/usr/bin/strace -fr -o /home/&lt;USER...&gt;/pulse_user.log</strong> /usr/bin/pulseaudio --daemonize=no<br />Вместо <strong>&lt;USER...&gt;</strong> ….. прописать свое ….<br /><u>Сохраняемся</u> …...... (<strong>имя файла не менять, сохранять так, как предложат</strong>)<br />$ <strong>sudo systemctl daemon-reload</strong><br />В итоге всего этого появится файл /home/&lt;USER&gt;/.config/systemd/user/pulseaudio.service<br /><u>Проверяем</u><br />$ <strong>systemctl --user cat pulseaudio.service | grep ExecStart</strong> .......... проверяем правильность изменения<br />(или обычным способом $ cat ~/.config/systemd/user/pulseaudio.service | grep ExecStart )<br />Если все нормально …....<strong> reboot</strong><br />В конце загрузки DE/WM <u>будет наблюдаться задержка ~ 100с</u> (это время задержки нужно будет отфильровать из лога) … причину этого не разбирал, но на анализ это не влияет ...<br /><u>Смотрим/проверяем</u><br />$ <strong>systemctl status --user pulseaudio.service</strong><br /><u>Должно быть два процесса</u><br /> 599 /usr/bin/strace -fr -o /home/&lt;USER...&gt;/pulse_user.log /usr/bin/pulseaudio --daemonize=no<br /> 601 /usr/bin/pulseaudio --daemonize=no<br />$ systemd-analyze blame --user … <u>в этом выводе pulseaudio.service не будет</u><br />И главное смотрим наличие самого лога ….... <strong>~/pulse_user.log</strong><br />Если все нормально, возвращаем все на место ...<br />$ <strong>rm /home/&lt;UESER...&gt;r/.config/systemd/user/pulseaudio.service</strong><br />$ <strong>sudo systemctl daemon-reload</strong><br /><strong>reboot</strong> …..... <u>перегрузка может занять ~ 90с …. ждите …..</u><br /><u>Смотрим/проверяем, что все в порядке</u> ….<br />$ <strong>systemd-analyze blame --use</strong>r …......<br />1.674s pulseaudio.service<br />$ <strong>systemctl --user status pulseaudio.service</strong><br /><br /><strong>АНАЛИЗ ~/pulse_user.log</strong><br />Как уже писал из лога нужно отсечь (в самом конце) записи, обусловленные задержкой загрузки<br />Если посмотреть общее время загрузки сервиса, то увидим большое значение<br />$ <strong>cat ~/pulse_user.log | awk &#39;{ SUM += $2 } END {print SUM}&#39;</strong><br /><strong>93.4936</strong><br />Открываем лог и находим последний системный вызов <strong>open</strong>, точнее  <strong>open(&quot;/run/user/1000/orcexec</strong><br /><u><em>PS ... по идее, вроде бы, можно/нужно отсечь и еще, т.е. подняться чуть чуть выше, .... но на анализ это не влияет ...</em></u><br /><pre><code>2862       0.000197 open(&quot;/run/user/1000/orcexec.WeMv5w&quot;, O_RDWR|O_CREAT|O_EXCL, 0600) = 31
2862       0.000261 umask(022)          = 066
2862       0.000081 unlink(&quot;/run/user/1000/orcexec.WeMv5w&quot;) = 0
2862       0.000092 ftruncate(31, 65536) = 0
2862       0.000075 mmap2(NULL, 65536, PROT_READ|PROT_EXEC, MAP_SHARED, 31, 0) = 0xb275d000
2862       0.000084 mmap2(NULL, 65536, PROT_READ|PROT_WRITE, MAP_SHARED, 31, 0) = 0xb274d000
2862       0.000072 close(31)           = 0</code></pre><u>1-ый столбец — PID , 2-ой столбец — время вызова (с)</u><br /><strong>Все строки, что находятся после close (закрытие открытого дескриптора — у меня 31) удаляем ...</strong><br />Сохраняем (для надежности можно сохранить как … , чтобы остался первичный лог)<br /><u>Смотрим общее время</u><br />$ <strong>cat ~/pulse_user.log | awk &#39;{ SUM += $2 } END {print SUM}&#39;</strong><br /><strong>2.36987</strong><br />Ну а дальше ищем место, где вызов занимает много времени …<br />Для начала делаем предположение, что причина в timeout ….<br />Смотрим есть ли вызовы ppoll<br />$ <strong>cat ~/pulse_user.log | grep ppoll | wc -l</strong><br /><strong>9</strong><br />Имеются …..... аж 9 шт. …..... вот и посмотрим что там …<br />Конечно, лучше посмотреть каждый вызов ppoll и внимательнее ….... но мы спешим, а потому ищем по слову <strong>Timeout</strong> …...<br />$ <strong>cat ~/pulse_user.log | grep Timeout</strong><br />2861       <strong>0.975852</strong> &lt;... ppoll resumed&gt; ) = 0 (Timeout)<br />2862       <strong>0.996905</strong> &lt;... ppoll resumed&gt; ) = 0 (Timeout)<br />…... вот они 2с …...<br />UPD … если внимательнее присмотреться к ppoll, то увидим, что данный вызов наблюдается при смене/переходе PID …......<br /><u>Но это данные моего анализа ….... у кого то они будут другие …. как и сама причина ...</u><br /><br />Как писал выше, нет 100% уверенности в правильности данного способа - нигде об этом не написано, все пришлось сочинять<br />Отработал способ несколько раз, исключив все ошибки ...... вроде сюрпризов быть не должно ...<br /><em>PSS ... забыл отметить, что так можно определить только место задержки, а не не сам источник первопричины ...</em>
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=4" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=5">5 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=7">7</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=6" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/17270/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script>(function(){var js = "window['__CF$cv$params']={r:'747b99bc5bc8162e',m:'M1Z78e6jZvxJvYNu8xUMNedMXl.7QNCLryvOElKdRVs-1662681175-0-AXYZahVY7TOWP6eNa4q4Gh6tKz61bj/WIvdWRIv0YUkg58fKMalcZUyqsz5oT4YcI6DnA8N/N40MIAJ0Fu+IQKLFqcBPH609Oi+oD3PsVFTHD0RD++1yKjTjGXJOSqBjy+/CkL/XfuvoIdrQr/SQyeE=',s:[0x35c176bba7,0x3bbfba1af4],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
