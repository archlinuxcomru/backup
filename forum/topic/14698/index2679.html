


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Зависание системы из-за xl2tpd роутингов [РЕШЕНО]
    </title>
    <link rel="shortcut icon" href="https://archlinuxcomru.github.io/backup/src/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    

    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://archlinuxcomru.github.io/backup/src/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/13/">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>Зависание системы из-за xl2tpd роутингов [РЕШЕНО]</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Зависание системы из-за xl2tpd роутингов [РЕШЕНО]</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150202"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/daggerfall/">
                <span class="post-username">daggerfall</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150202/">#</a>
            7 лет, 5 месяцев назад
            
                (отредактировано
                
                    7 лет, 4 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/e7/0b/e70b1c52b00ea4218426652cc094a0d0.png" alt="daggerfall avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/daggerfall/topics/">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/daggerfall/posts/">
                    35
                </a>
            </div>
            <div>
                Участник с: 05 сентября 2014
            </div>
            
        </td>
        <td class="post-content">
            Думал что проблема в настройках и роутингах что добавляются при старте скриптом, сейчас даже и не знаю<br />Все замечательно работало, какое то время до определенного момента(пару лет), знаю что у провайдера (пчелайн) внезапно и без каких либо уведомлений изменились настройки сети, другой диапазон ip и вероятно еще что то<br />Так вот, имею стабильное полное зависание системы при старте xl2tpd уже отбросил &quot;лишние&quot; службы, пытался запускать её без роутингов и с чистым конфигом, без роутинга до 85.21.0.0 (это подсеть с сервером tp.internet.beeline.ru -l2tp сервер) с правильным шлюзом (локальным) соединение не устанавливается, как только этот шлюз добавляю - программа в логе весело сообщает о том что адрес ip получен и соединение установлено далее - имеем полное зависание системы, в логах перед этим ничего нет что могло бы помочь, я так понимаю это из за того что оно работает на уровне ядра, я уже не знаю, но, видимо для дальнейших экспериментов придется систему на карточку переносить чтобы диски не насиловать подобными зависонами.<br />Что могло поменяться у них что приводит к таким ужасным последствиям? и куда собственно копать<br /><br />options.xl2tpd<br /><pre><code>
lcp-echo-interval 10
lcp-echo-failure 2
name login
remotename l2tp
ipparam isp
connect /bin/true
mru 1500
mtu 1460
nodeflate
nobsdcomp
persist
maxfail 0
nopcomp
noaccomp
noauth</code></pre>xl2tpd.conf<br /><pre><code>
[global]
access control = yes
auth file = /etc/ppp/chap-secrets

[lac isp]
lns = 85.21.x.x
redial = yes
redial timeout = 15
require chap = yes
require authentication = no
name = login
ppp debug = no
pppoptfile = /etc/ppp/options.xl2tpd
require pap = no
autodial = yes
tx bps = 100000000</code></pre>
            
                
                    <div class="post-signature">
                        Gentoo | ArchLinux | servers and work PC<br />W 7 - everyday usage all PC&#39;s<br />W 8.1 - Lenovo IdeaPad G500 - i3 3110, R8570M<br />spirevillage.blogspot.com
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150221"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/32reg/">
                <span class="post-username">32reg</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150221/">#</a>
            7 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/32reg/topics/">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/32reg/posts/">
                    526
                </a>
            </div>
            <div>
                Участник с: 17 мая 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>daggerfall</strong>, поддерживаю, у меня тоже самое. Правда зависания случаются не всегда. Примерно 50 на 50. Если после старта xl2tpd комп сразу не завис, то дальше все будет работать нормально.<br />Вот <a href="https://archlinux.org.ru/forum/topic/7000/?page=22#post-149620">ссылка</a> где я писал о такой же проблеме. Пока без ответа
            
                
                    <div class="post-signature">
                        <a href="http://linux32.ru">www.linux32.ru</a> - новости и статьи о Linux
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150225"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/daggerfall/">
                <span class="post-username">daggerfall</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150225/">#</a>
            7 лет, 5 месяцев назад
            
                (отредактировано
                
                    7 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/e7/0b/e70b1c52b00ea4218426652cc094a0d0.png" alt="daggerfall avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/daggerfall/topics/">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/daggerfall/posts/">
                    35
                </a>
            </div>
            <div>
                Участник с: 05 сентября 2014
            </div>
            
        </td>
        <td class="post-content">
            попробую openl2tp еще, но он как я помню не умеет даже перезвонить самостоятельно. Нагуглил еще несколько тем о полном зависании системы под другими дистрибутивами...<br />Создал тему <a href="https://bbs.archlinux.org/viewtopic.php?id=195826">тут</a><br />Все эти волшебные коробочки-роутеры работают как то? там вроде ppp+плагин обычно, скорость не такая уже да и пинги, но все же...
            
                
                    <div class="post-signature">
                        Gentoo | ArchLinux | servers and work PC<br />W 7 - everyday usage all PC&#39;s<br />W 8.1 - Lenovo IdeaPad G500 - i3 3110, R8570M<br />spirevillage.blogspot.com
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150235"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/daggerfall/">
                <span class="post-username">daggerfall</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150235/">#</a>
            7 лет, 5 месяцев назад
            
                (отредактировано
                
                    7 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/e7/0b/e70b1c52b00ea4218426652cc094a0d0.png" alt="daggerfall avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/daggerfall/topics/">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/daggerfall/posts/">
                    35
                </a>
            </div>
            <div>
                Участник с: 05 сентября 2014
            </div>
            
        </td>
        <td class="post-content">
            Похоже проблема происходит когда добавляется роутинг по умолчанию после создания тоннеля<br />похожая ситуация но с openl2tp <a href="http://forums.openl2tp.org/viewtopic.php?f=4&t=8&sid=8ec681ed31504c48dfffda5c9595acb9">http://forums.openl2tp.org/viewtopic.php?f=4&t=8&sid=8ec681ed31504c48dfffda5c9595acb9</a><br />и тут наверное это будет интересно<br /><blockquote>Some ISPs (including corbina.ru, which I use) configured servers in a manner where remote-eth-ip=remote-tunnel-ip, so after tunnel creation pppd issued<br />Code:<br />route add remote-tunnel-ip dev ppp0<br />which leads to cpu lockup I described earlier.</blockquote><blockquote>1)wrong routing leads to cpu lockup - i don&#39;t think that it&#39;s normal situation when ANY routing mismatch can cause complete system hang<br /><strong>2)the wrong route is added by default and pppd has no option to disable it</strong></blockquote>неправильный роутинг приводит к зависанию и что это вообщем то ненормально что система вешается. (как бы этого избежать?, неужели никто не заморачивался ?)<br />У xl2tpd вроде есть &quot;nodefaultroute&quot; но и с ним вроде тоже висло....<br />Туда же...<br /><blockquote>The only workaround I found is to fix routing in ip-up scripts. It&#39;s ok solution for home use with small network load, but it is unacceptable for big network loads because system can hang before executing of userspace ip-up scripts.</blockquote>скрипты помогают исправить роутинг конечно же, но система может добавить неправильный и зависнуть раньше чем сработает скрипт<br /><br />Не зависает, видимо переустановка и nodefaultroute помогло - конфигурация, статический адрес gw заменить бы на скрипт, но наверное не будет успевать определить шлюз<br />/etc/ppp/ip-down<br /><pre><code>
#!/bin/sh
#
# This script is run by pppd after the connection has ended.
#

# Execute all scripts in /etc/ppp/ip-down.d/
for ipdown in /etc/ppp/ip-down.d/*.sh; do
  if [ -x $ipdown ]; then
# Parameters: interface-name tty-device speed local-IP-address remote-IP-address ipparam
# $1 = interface name (e.g. ppp0)
# $2 = tty device
# $3 = speed
# $4 = local IP address
# $5 = remote IP address
# $6 = ipparam (user specified parameter, see man pppd)
# восстановление маршрута по умолчанию (шлюз GW изменить на свой)
GW=&quot;1x.xxx.xx.x&quot;
route del $5
route del default
route add default dev net1 gw $GW
    $ipdown &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b195f1">[email&#160;protected]</a>&quot;
  fi
done
</code></pre><br />/etc/ppp/ip-up<br /><pre><code>
#!/bin/sh
#
# This script is run by pppd when there&#39;s a successful ppp connection.
#

# Execute all scripts in /etc/ppp/ip-up.d/
for ipup in /etc/ppp/ip-up.d/*.sh; do
  if [ -x $ipup ]; then
    # Parameters: interface-name tty-device speed local-IP-address remote-IP-address ipparam
# $1 = interface name (e.g. ppp0)
# $2 = tty device
# $3 = speed
# $4 = local IP address
# $5 = remote IP address
# $6 = ipparam (user specified parameter, see man pppd)
# шлюз (изменить на свой)
GW=&quot;1x.xxx.xx.x&quot;

# роутинг до BRASа
route del $5 dev ppp0
route add -host $5 gw $GW

# подсеть с BRASами
route add -net 85.21.0.0 netmask 255.255.0.0 gw $GW
# другие
route add -host 78.107.1.254 gw $GW
route add -host 78.107.1.255 gw $GW
route add -host 78.107.1.48 gw $GW

# DNS
route add -host 195.14.50.1 gw $GW
route add -host 213.234.192.8 gw $GW
route add -host 85.21.192.3 gw $GW
route add -host 195.14.50.21 gw $GW
route add -host 85.21.192.5 gw $GW
route add -host 213.234.192.7 gw $GW

#Локальная сеть:
route add -net 10.0.0.0 netmask 255.0.0.0 gw $GW
#Почтовый сервер
route add -host 195.14.50.16 gw $GW
#Игровые сервера
route add -host 83.102.231.32 netmask 255.255.255.240 gw $GW
route add -host 83.102.146.96 gw $GW
route add -net 78.107.23.0 netmask 255.255.255.0 gw $GW
#IP-TV через VLC
route add -net 172.16.16.0 netmask 255.255.255.0 gw $GW
route add -host 78.107.1.90 gw $GW
route add -host 85.21.72.80 gw $GW
route add -net 217.118.84.0 netmask 255.255.255.0 gw $GW
route add -net 78.107.52.0 netmask 255.255.255.0 gw $GW

# смена пути по умолчанию
route del default
route add default dev ppp0
    $ipup &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b1f7b">[email&#160;protected]</a>&quot;
  fi
done
</code></pre>IP-TV убран маршрут с локальным адресом в качестве gateway, без него не работало iptv<br /><br />/etc/ppp/options.xl2tpd<br /><pre><code>
lcp-echo-interval 10
lcp-echo-failure 2
[b]nodefaultroute[/b]
name login
remotename l2tp
ipparam beeline
connect /bin/true
mru 1500
mtu 1400
nodeflate
nobsdcomp
persist
maxfail 0
nopcomp
noaccomp
noauth
</code></pre>Всё. В папках if-up.d down* должны быть только dns.sh арчевские стандартные, ну может iptables скрипт с поправкой на mtu<br />resolv.conf я не создавал, само сгенерировалось<br /><br />/etc/xl2tpd/xl2tpd.conf<br /><pre><code>
[global]
access control = yes
auth file = /etc/ppp/chap-secrets

[lac beeline]
lns = tp.internet.beeline.ru - ip адрес
redial = yes
redial timeout = 15
require chap = yes
require authentication = no
name = login
ppp debug = no
pppoptfile = /etc/ppp/options.xl2tpd
require pap = no
autodial = yes
tx bps = 100000000
</code></pre>
            
                
                    <div class="post-signature">
                        Gentoo | ArchLinux | servers and work PC<br />W 7 - everyday usage all PC&#39;s<br />W 8.1 - Lenovo IdeaPad G500 - i3 3110, R8570M<br />spirevillage.blogspot.com
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150348"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/32reg/">
                <span class="post-username">32reg</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150348/">#</a>
            7 лет, 4 месяца назад
            
                (отредактировано
                
                    7 лет, 4 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/32reg/topics/">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/32reg/posts/">
                    526
                </a>
            </div>
            <div>
                Участник с: 17 мая 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>daggerfall</strong>, попробовал добавить опцию <strong>nodefaultroute</strong> - не помогло. Полностью твои конфиги брал, кроме логина и пароля - все равно зависает.<br />Выяснил, что зависает именно после этой команды:<br /><pre><code>route add default dev ppp0</code></pre>Без нее ppp0 поднимается, но нет интернета. Каким-нибудь другим способом добиться того же результата, который должен быть после выполнения этой команды можно?<br /><br />Не может ли дуалбут с виндой XP быть причиной этих зависаний? Такие мысли появились когда в одну из &quot;удачных&quot; загрузок я посмотрел статус xl2tpd:<br /><pre><code>● xl2tpd.service - Level 2 Tunnel Protocol Daemon (L2TP)
   Loaded: loaded (/usr/lib/systemd/system/xl2tpd.service; disabled)
   Active: active (running) since Пн 2015-04-13 21:33:48 MSK; 1min 14s ago
 Main PID: 552 (xl2tpd)
   CGroup: /system.slice/xl2tpd.service
           ├─552 /usr/bin/xl2tpd -D
           └─558 /usr/sbin/pppd passive nodetach : name 0894693760 file /etc/ppp/peers/options.l2tpd plugin pppol2tp.so pppol2tp 7

апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Using interface ppp0
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Connect: ppp0 &lt;--&gt;
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Overriding mtu 1500 to 1400
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Overriding mru 1500 to mtu value 1400
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Overriding mtu 1460 to 1400
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: Overriding mru 1500 to mtu value 1400
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: CHAP authentication succeeded
апр 13 21:33:49 winxpsp3-pc.beeline pppd[558]: CHAP authentication succeeded
апр 13 21:33:51 winxpsp3-pc.beeline pppd[558]: local  IP address 1**.***.***.***
апр 13 21:33:51 winxpsp3-pc.beeline pppd[558]: remote IP address 8*.***.***.***
</code></pre>В котором часть строк <strong>winxpsp3-pc.beeline</strong> непонятно откуда появилась. Файла /etc/hostname нет, в /etc/hosts ничего подобного нет. Где еще такая информация может быть?
            
                
                    <div class="post-signature">
                        <a href="http://linux32.ru">www.linux32.ru</a> - новости и статьи о Linux
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150351"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/daggerfall/">
                <span class="post-username">daggerfall</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150351/">#</a>
            7 лет, 4 месяца назад
            
                (отредактировано
                
                    7 лет, 4 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/e7/0b/e70b1c52b00ea4218426652cc094a0d0.png" alt="daggerfall avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/daggerfall/topics/">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/daggerfall/posts/">
                    35
                </a>
            </div>
            <div>
                Участник с: 05 сентября 2014
            </div>
            
        </td>
        <td class="post-content">
            <strong>32reg</strong><br />А случаем никаких команд с использованием скажем... grep, при получении gateway не используется? пропиши статически<br />gateway правильный? получать gateway шлюз нужно при отключенном xl2tpd.<br /><br />Я поставил arch на флешку начисто, дабы не насиловать HDD, стал эксперементировать с чистыми конфигами, но, не пришлось. Не зависает, я скопировал настройки и ок. Никаких дополнительных настроек в системе не делал, что касается сети то там только dhcp через dhcpcd на интерфейсе смотрящем в локалку провайдера( сервис запущен только на net1), и статика для внутренней локалки через этот систем дэ и его костыли -скрипты. resolv.conf не создавался вручную - система создала, он ему нужен (xl2tpd)<br />Проверь, я в соседней теме писал что ничего в ip-up{down}.d кроме dns не должно быть, это так, в некоторых примерах настройки туда пхали тот самый route add default dev ppp0 , ну, у меня на исправление mtu iptables лежит скрипт еще, но это маршрутизатор<br /><pre><code>#!/bin/bash
#
PATH=/bin:/sbin:/usr/bin:/usr/sbin
iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1400:1500 -j TCPMSS --clamp-mss-to-pmtu -o ppp0</code></pre><blockquote>Без нее ppp0 поднимается, но нет интернета. Каким-нибудь другим способом добиться того же результата, который должен быть после выполнения этой команды можно?</blockquote>роутинги до 78.107.xxx.xxx подсети и локальной вашего региона еще 85.21.хххх - нужны явно,  ну и правильный резолв.конф<br />обратил внимание при старте<br />dhcpcd: net1: leased xxx.xxx.xxx.xxx for 1800 seconds [локальный адрес тут]<br />dhcpcd: net1: adding route to xxx.xxx.0.0/17 [подсеть! шлюза что ниже в скриптах с роутингами]<br />dhcpcd: net1: adding route to <a href="http://78.107.xxx.xxx/32">78.107.xxx.xxx/32</a> via xxx.xxx.xxx.xxx [xxx шлюз] - вот это еще один роутинг 78.107.... может дать dhcpcd управление получением адреса?<br />dhcpcd: net1: adding default route via шлюз<br />роутинг на всякий случай, тут нет локальной подсети региона провайдера, не скрыто, её нет в роутингах<br /><pre><code>route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         0.0.0.0         0.0.0.0         U     0      0        0 ppp0
0.0.0.0         xxx.xxx.xxx.xxx      0.0.0.0         UG    203    0        0 net1
10.0.0.0        xxx.xxx.xxx.xxx      255.0.0.0       UG    0      0        0 net1
78.107.1.48     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
78.107.1.90     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
78.107.1.254    xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
78.107.1.255    xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
78.107.23.0     xxx.xxx.xxx.xxx      255.255.255.0   UG    0      0        0 net1
78.107.52.0     xxx.xxx.xxx.xxx      255.255.255.0   UG    0      0        0 net1
83.102.146.96   xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
85.21.0.0       xxx.xxx.xxx.xxx      255.255.0.0     UG    0      0        0 net1
85.21.0.255     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
85.21.72.80     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
85.21.192.3     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
85.21.192.5     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
xxx.xxx.xxx.xxx      0.0.0.0         255.255.128.0   U     203    0        0 net1
172.16.16.0     xxx.xxx.xxx.xxx      255.255.255.0   UG    0      0        0 net1
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 net0
195.14.50.1     xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
195.14.50.16    xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
195.14.50.21    xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
213.234.192.7   xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
213.234.192.8   xxx.xxx.xxx.xxx      255.255.255.255 UGH   0      0        0 net1
217.118.84.0    xxx.xxx.xxx.xxx      255.255.255.0   UG    0      0        0 net1
</code></pre>xxx локальный шлюз<br /><br /><blockquote>winxpsp3-pc.beeline</blockquote>первое это имя компьютера?<br />beeline это домен чтоли? hosts нужно в порядок явно привести заодно и hostname чтобы совпадало, у меня лог не такой<br /><pre><code>
# /etc/hosts: static lookup table for host names
#

#&lt;ip-address&gt;   &lt;hostname.domain.org&gt;   &lt;hostname&gt;
127.0.0.1       localhost.localdomain   localhost
192.168.1.1     PCName.localdomain.org PCName
::1             localhost.localdomain   localhost

# End of file
</code></pre>в hostname одна строчка должна быть PCName<br /><br />про дуалбут помоему бредово, у меня вообще вон через UEFI загрузка арча<br /><br />вот статус тоже<br />● xl2tpd.service - Level 2 Tunnel Protocol Daemon (L2TP)<br />   Loaded: loaded (/usr/lib/systemd/system/xl2tpd.service; enabled; vendor preset: disabled)<br />   Active: active (running) since Вс 2015-04-12 MSK; 1 day 1h ago<br /> Main PID: (xl2tpd)<br />   CGroup: /system.slice/xl2tpd.service<br />           ├─ /usr/bin/xl2tpd -D<br />           └─ /usr/sbin/pppd passive nodetach : name login file /etc/ppp/options.xl2tpd plugin pppol2tp.so pppol2tp 7<br /><br />Connect: ppp0 &lt;--&gt;<br />Overriding mtu 1500 to 1400<br />Overriding mru 1500 to mtu value 1400<br />Overriding mtu 1460 to 1400<br />Overriding mru 1500 to mtu value 1400<br /> CHAP authentication succeeded<br /> CHAP authentication succeeded<br />Cannot determine ethernet address for proxy ARP<br />local  IP address<br />remote IP address 85.21.0.255 - пропиши этот адрес вместо tp.internet.beeline.ru но лучше ему (tp.internet.beeline.ru) сделать host и выбрать из списка<br />помоему не всегда резолвит<br />Не знаю чем и помочь еще...<br /><pre><code>кроме логина и пароля</code></pre>а я их и не выкладывал :)
            
                
                    <div class="post-signature">
                        Gentoo | ArchLinux | servers and work PC<br />W 7 - everyday usage all PC&#39;s<br />W 8.1 - Lenovo IdeaPad G500 - i3 3110, R8570M<br />spirevillage.blogspot.com
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150356"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/32reg/">
                <span class="post-username">32reg</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150356/">#</a>
            7 лет, 4 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/32reg/topics/">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/32reg/posts/">
                    526
                </a>
            </div>
            <div>
                Участник с: 17 мая 2011
            </div>
            
        </td>
        <td class="post-content">
            В чем разница в использовании grep при получении GW и в задании его статически? И почему нужно прописывать роутинги не в /etc/ppp/ip-up.d/*.sh скриптах, а именно в /etc/ppp/ip-up? Он раньше чем они выполняется? В hosts у меня только две строки (стандартные). Откуда у вас столько DNS адресов? У меня в файле /etc/resolv.conf только 2 адреса. Я добавляю роутинги на них с помощью grep, они нормально добавляются. Про grep не понял, почему его не желательно использовать?<br />Компьютер с билайном не рядом, опробую все при возможности и отпишусь
            
                
                    <div class="post-signature">
                        <a href="http://linux32.ru">www.linux32.ru</a> - новости и статьи о Linux
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150370"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/32reg/">
                <span class="post-username">32reg</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150370/">#</a>
            7 лет, 4 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/32reg/topics/">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/32reg/posts/">
                    526
                </a>
            </div>
            <div>
                Участник с: 17 мая 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>daggerfall</strong>, у вас локалка с помощью dhcp поднимается? если да, то каким сервисом (dhcpcd.service, netctl или NetworkManager)? Сколько адресов у вас в /etc/resolv.conf? И откуда вы брали адреса <blockquote>78.107.xxx.xxx подсети и локальной вашего региона 85.21.хххх</blockquote>?
            
                
                    <div class="post-signature">
                        <a href="http://linux32.ru">www.linux32.ru</a> - новости и статьи о Linux
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150381"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/daggerfall/">
                <span class="post-username">daggerfall</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150381/">#</a>
            7 лет, 4 месяца назад
            
                (отредактировано
                
                    7 лет, 4 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/e7/0b/e70b1c52b00ea4218426652cc094a0d0.png" alt="daggerfall avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/daggerfall/topics/">
                    11
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/daggerfall/posts/">
                    35
                </a>
            </div>
            <div>
                Участник с: 05 сентября 2014
            </div>
            
        </td>
        <td class="post-content">
            никаких NetworkManagerов, боже упаси, всегда из за них с vpn были проблемы. Внимательней мой пост пожалуйста прочти, там все написано, даже лог с работой сервиса.<br /><pre><code>Сколько адресов у вас в /etc/resolv.conf?</code></pre>два DNS, система создала еще раз повторяюсь<br />nameserver 85.21.192.3<br />nameserver 213.234.192.8<br /><br />78.107 в списке роутингов был в каком то мануале для настройки corbina под gentoo, они же фигурировали в инструкциях на сайте билайна, и в логе выше, это не с потолка адреса<br /><blockquote>В чем разница в использовании grep при получении GW и в задании его статически? И почему нужно прописывать роутинги не в /etc/ppp/ip-up.d/*.sh скриптах, а именно в /etc/ppp/ip-up? Он раньше чем они выполняется? В hosts у меня только две строки (стандартные). Откуда у вас столько DNS адресов?</blockquote>с grep у меня зависал, хотя команда вне скрипта отрабатывала. ip-up должны раньше работать же чем те что в папках. 78.107 роутинг который добавляет сервис сам
            
                
                    <div class="post-signature">
                        Gentoo | ArchLinux | servers and work PC<br />W 7 - everyday usage all PC&#39;s<br />W 8.1 - Lenovo IdeaPad G500 - i3 3110, R8570M<br />spirevillage.blogspot.com
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-150486"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/32reg/">
                <span class="post-username">32reg</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/150486/">#</a>
            7 лет, 4 месяца назад
            
                (отредактировано
                
                    7 лет, 4 месяца назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/32reg/topics/">
                    29
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/32reg/posts/">
                    526
                </a>
            </div>
            <div>
                Участник с: 17 мая 2011
            </div>
            
        </td>
        <td class="post-content">
            Попробовал еще раз: все конфиги скопировал ваши, только логин билайновский свой и chap-secret; 78.107 в таблицу роутингов добавлял;  пробовал убирать опцию <strong>tx bps = 100000000</strong> - все равно зависает. Уже не знаю что предпринять.<br />В моменты когда xl2tpd все же включался и не вешал систему, полностью обновил ее. Но и это не помогло.<br />Что еще подскажете?<br /><a href="http://homenet.beeline.ru/index.php?showtopic=321073">Тут</a> тоже тему создал
            
                
                    <div class="post-signature">
                        <a href="http://linux32.ru">www.linux32.ru</a> - новости и статьи о Linux
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous disabled">
                    <span>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </span>
                </li>
            

            
                
                    
                        <li class="active">
                            <a href="?page=1">1 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=2" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/14698/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747bb67189779d45',m:'2Q0daljXZabibX_abB9L_AH_FAxWw2pLB7yfXePFCmk-1662682356-0-AbyWeYvzlg4PNivaWfXzKLlJdpbaOypqXXHb8LsDqVgy7tOgXZZmLmG92NpGUiMYOBDBAfy6FyYspkgUvG7gn/BdkhReGBRrlZECL11x1iBZz7Y02FMqkjIma016HYNfApNb3Nm0CIHb20i5Qj2dDdg=',s:[0x016593b110,0xeefe5ef0e2],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
