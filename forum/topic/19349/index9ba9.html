


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/19349/?page=3 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:15:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        [ПРОЙДЕН] pacman: квест (драконий уровень)
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/3/index.html">Пакетная система</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/7/index.html">Pacman и обновления</a> <span class="divider">/</span></li>
            
        
        
            <li>[ПРОЙДЕН] pacman: квест (драконий уровень)</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>[ПРОЙДЕН] pacman: квест (драконий уровень)</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="index4658.html?page=2" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="index9ba9.html?page=3">3 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdb0.html?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexaf4d.html?page=5">5</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="indexfdb0.html?page=4" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218790"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218790/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <strong>vs220</strong><br />ну да, такое есть... в таком случаи я брал только первое, возможно в некоторых случаях это будет критично((<br />но таких пересечений в официальном репозитории не так уж и много.<br /><br /><blockquote><em>vs220</em><br>Не уверен но вроде есть пакеты только с конфигами</blockquote>вполне возможно, но я не встречал
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218791"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218791/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Я бы, в случае аналогичной проблемы и отсутствия файла pacman.log  проделал бы все проще.<br />Приведу подробный разбор, возможно что то похожее когда-нибудь и пригодится.<br />Делаю на системе при наличии данных папок - но если бы они были удалены и после этого ничего бы на диск не записывалось, то принцип тот же самый - <strong>информация на диске не пропала, исчезли просто имена файлов</strong>, а информация вся на месте.<br />Главное узнать начало файлов  /var/lib/pacman/local/&lt;paket&gt;/desc, у которых первые две строчки равны<br /><pre><code>%NAME%
&lt;paket&gt;</code></pre>Узнать можно используя дисковый редактор, например, <strong>DMDE</strong>, а можно и методом тыка (интуитивно) - правда не всегда все так гладко, нужен опыт и интуиция. Но мы все-таки попробуем данный способ.<br />Итак, приступим.<br /><u>Предположение</u> - так как файлы находятся в директории <strong> /var/lib/pacman/</strong>, то разумно предположить, что номера блоков с файлами будут поблизости от блока с инодой, соответствующей директории /var/lib/pacman/ - или после или до ...<br />Узнаем иноду /var/lib/pacman<br /><strong>stat /var/lib/pacman | grep Инода</strong><br />Устройство: 803h/2051d	Инода: 1835014     Ссылки: 4<br />Узнаем блок занимаемый иноде  1835014<br /><strong>sudo debugfs -R &quot;blocks &lt;1835014&gt;&quot; /dev/sda3</strong><br /><strong>7348261</strong> ….. (7348261*4096=<strong>30098477056</strong>)<br />Начинаем поиск методом тыка - начнем поиск со смещения  <strong>30098477056</strong><br /><strong>sudo hexdump -C -s 30098477056 -n 1000K /dev/sda3 | grep %NAME%</strong><br />…. <u>мимо</u> …..  пробуем увеличим выборку (добавим 1 нолик)<br /><strong>sudo hexdump -C -s 30098477056 -n 10000K /dev/sda3 | grep %NAME%</strong><br />…. <u>опять мимо</u>, пробуем опять увеличим выборку (добавим еще 1 нолик)<br /><strong>sudo hexdump -C -s 30098477056 -n 100000K /dev/sda3 | grep %NAME%</strong><br /><pre><code>708023000  25 4e 41 4d 45 25 0a 66  6f 72 65 6d 6f 73 74 0a  |%NAME%.foremost.|
708025000  25 4e 41 4d 45 25 0a 68  61 72 66 62 75 7a 7a 2d  |%NAME%.harfbuzz-|
70802a000  25 4e 41 4d 45 25 0a 6c  69 62 65 76 64 65 76 0a  |%NAME%.libevdev.|
………. и так далее ……</code></pre>Поймали, уточняем с количеством пакетов<br />sudo hexdump -C -s 0x708023000 -n 1000K /dev/sda3 | grep %NAME% | wc -l<br />44<br />sudo hexdump -C -s 0x708023000 -n 10000K /dev/sda3 | grep %NAME% | wc -l<br />361<br />sudo hexdump -C -s 0x708023000 -n 100000K /dev/sda3 | grep %NAME% | wc -l<br />661<br />sudo hexdump -C -s 0x708023000 -n 200000K /dev/sda3 | grep %NAME% | wc -l<br />661<br />Можно и остановится, значение 661 не увеличивается - ну и делаем вывод в файл<br /><strong>sudo hexdump -C -s 0x708023000 -n 100000K /dev/sda3 | grep %NAME% &gt; ~/pkg.txt</strong><br />Но неплохо бы проверить до смещения  30098477056, пробуем<br />sudo hexdump -C -s  30100000000 -n 100000K /dev/sda3 | grep %NAME%<br /><pre><code>708023000  25 4e 41 4d 45 25 0a 66  6f 72 65 6d 6f 73 74 0a  |%NAME%.foremost.|
708025000  25 4e 41 4d 45 25 0a 68  61 72 66 62 75 7a 7a 2d  |%NAME%.harfbuzz-|
70802a000  25 4e 41 4d 45 25 0a 6c  69 62 65 76 64 65 76 0a  |%NAME%.libevdev.|</code></pre>Отловили ту же самую строку<br /><strong>708023000  25 4e 41 4d 45 25 0a 66  6f 72 65 6d 6f 73 74 0a  |%NAME%.foremost.|</strong><br />Будем считать, что ДО ничего нет.<br /><br />Приступим к обработке полученного файла ~/pkg.txt - преобразуем его в удобный вид<br />Удаляем все до фразы &quot;*%NAME%.&quot;, включая саму фразу<br /><strong>sed &#39;s|.*%NAME%.||&#39; ~/pkg.txt &gt; ~/pkg1.txt</strong><br />Удаляем все после точки, включая саму точку (если точки нет, останется символ | , означающий что имя файла не полное<br /><strong>sed -r &#39;s/\..+//&#39; ~/pkg1.txt &gt; ~/pkg2.txt</strong><br />Получили файл следующего вида<br /><strong>cat ~/pkg2.txt | head -3</strong><br /><pre><code>foremost
harfbuzz-|
libevdev</code></pre><br /><strong>PS</strong> - Остается дополнить полное имя опредеденных пакетов, которых 286 штук<br />grep &quot;|&quot; ~/pkg2.txt | wc -l<br /><strong>286</strong><br />Но делается это легко - пример<br /><strong>cat ~/pkg.txt | grep harfbuzz</strong><br /><strong>708025000</strong>  25 4e 41 4d 45 25 0a 68  61 72 66 62 75 7a 7a 2d  |%NAME%.harfbuzz-|<br />7085f3000  25 4e 41 4d 45 25 0a 68  61 72 66 62 75 7a 7a 0a  |%NAME%.harfbuzz.|<br />и уточняем полное имя пакета<br /><strong>sudo hexdump -C -s 0x708025000 -n 32 /dev/sda3</strong><br />708025000  25 4e 41 4d 45 25 0a 68  61 72 66 62 75 7a 7a 2d  |%NAME%.<strong>harfbuzz-</strong>|<br />708025010  69 63 75 0a 0a 25 56 45  52 53 49 4f 4e 25 0a 32  <strong>|icu</strong>..%VERSION%.2|<br />то есть полное имя пакета <strong>harfbuzz-icu</strong><br /><br />Как то так - вообщем то и не долго.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218792"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/nafanja/index.html">
                <span class="post-username">nafanja</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218792/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8b/bf/8bbfdb897f0c37710a7d8b4dc072bea1.png" alt="nafanja avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/nafanja/topics/index.html">
                    94
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/nafanja/posts/index.html">
                    9252
                </a>
            </div>
            <div>
                Участник с: 02 июня 2012
            </div>
            
                <div class="label label-warning">заблокирован</div>
            
        </td>
        <td class="post-content">
            <strong>vasek</strong>, пакеты могут достаточно часто добавляться/удаляться, твой вариант может восстановить и то что не нужно (было удалено).
            
                
                    <div class="post-signature">
                        <a href="../10992/index.html">Псевдографический инсталлятор Arch Linux ver. 3.8.2</a><br />Благодарности принимаются на ЯД <strong>410012815723874</strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218793"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218793/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>nafanja</em><br>твой вариант может восстановить и то что не нужно (было удалено).</blockquote>Согласен, но это уже издержки. Другого простого и лучшего пути не вижу.<br />Насколько я понимаю в данном случае важна информация и, конечно не 100% , о пакетах, стоящих в системе.<br />Плюс к этому, не забываем, что здесь будут и пакеты, установленные как зависимости других пакетов.<br /><br /><strong>PS</strong> - Просто привел в качестве примера, как можно восстановить определенную информацию (и даже файлы) ручным методом.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218794"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218794/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            Погуглил на en - оказывается есть Wiki <a href="https://wiki.archlinux.org/index.php/Pacman/Restore_local_database">Pacman/Restore local database</a> - привожу цитату из нее<br /><pre><code>Firstly, make sure pacman&#39;s log file is present:
$ ls /var/log/pacman.log
If it does not exist, it is not possible to continue with this method. You may be able to use &quot;Xyne&#39;s package detection script&quot; to recreate the database. If not, then the likely solution is to re-install the entire system.</code></pre><strong>PS</strong> - скрипт <a href="https://bbs.archlinux.org/viewtopic.php?pid=670876">Xyne&#39;s package detection script</a><br /><br /><strong>EDIT 1</strong> - рекомендую заглянуть в китайскую и японскую версии Wiki - есть отличия
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218814"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/red/index.html">
                <span class="post-username">red</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218814/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fd/eb/fdeb672af87b7c02419e9c58404908a5.png" alt="red avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/red/topics/index.html">
                    30
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/red/posts/index.html">
                    1517
                </a>
            </div>
            <div>
                Участник с: 31 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br>Ну если вы уверены что в .log есть все пакеты то парсер написать в принципе не проблема.</blockquote>ну а почему бы им там не быть, на сколько я знаю если вручную его не удалять то история должна вестись от <strike>сотворения мира</strike>начала установки<br />а на счет парсера, то я так и сделал, результат выложу ниже<br /><br /><blockquote><em>vasek</em><br>У меня все работает, система 64-bit. Прога для Linux консольная (Version 3.4.4.740 (2018-08-03), запускаю командой</blockquote><pre><code>$ file dmde
dmde: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, stripped
$ pacman -Fs ld-linux.so.2
core/lib32-glibc 2.29-3
    usr/lib/ld-linux.so.2
    usr/lib32/ld-linux.so.2</code></pre>в общем заработало после установки пакета <a href="https://www.archlinux.org/packages/core/x86_64/lib32-glibc/">lib32-glibc</a><br /><br /><blockquote><em>vasek</em><br>Я бы, в случае аналогичной проблемы и отсутствия файла pacman.log проделал бы все проще.</blockquote>спасибо за подробное описание, возможно действительно когда нибудь пригодится, но так как файл pacman.log присутствует то на данный момент его разбор представляется наилучшим решением<br /><br /><blockquote><em>vasek</em><br>Погуглил на en - оказывается есть Wiki Pacman/Restore local database - привожу цитату из нее</blockquote>да, <strong>vall</strong> уже <a href="index2679.html?page=1#post-218766">упоминал об этом</a>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218815"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/red/index.html">
                <span class="post-username">red</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218815/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fd/eb/fdeb672af87b7c02419e9c58404908a5.png" alt="red avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/red/topics/index.html">
                    30
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/red/posts/index.html">
                    1517
                </a>
            </div>
            <div>
                Участник с: 31 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            привожу своё решение<br /><em>условие: должен быть в наличии файл /var/log/pacman.log  в котором содержаться непрерывная история с начала установки системы и до текущего момента (если вы его спецом не удаляли и не чистили то по умолчанию так оно есть)</em><br /><br /><strong>Первый этап</strong><br /><strike><pre><code>awk &#39;$4==&quot;installed&quot; || $4==&quot;removed&quot; {print i++,$4,$5}&#39; /var/log/pacman.log |sort -k3 -k1n |cat - &lt;&lt;&lt; &#39;&#39; |awk &#39;{if (a==&quot;installed&quot; &amp;&amp; b!=$3) print b;a=$2;b=$3}&#39; &gt; packages.all.txt</code></pre></strike><br /><pre><code>awk &#39;$4==&quot;installed&quot; || $4==&quot;removed&quot; {print i++,$4,$5}&#39; /var/log/pacman.log |sort -k3 -k1n | awk &#39;{print} END{print &quot;&quot;}&#39; |awk &#39;{if (a==&quot;installed&quot; &amp;&amp; b!=$3) print b;a=$2;b=$3}&#39; &gt; packages.all.txt</code></pre>здесь мы разбираем pacman.log и собираем список только тех пакетов которые были установлены и присутствуют в системе на  данный момент.<br /><br /><strong>Второй этап</strong><br /><pre><code>pacman -Sp $(cat packages.all.txt) 2&gt;&amp;1 | awk &#39;{print $NF}&#39; &gt; packages.aur.txt</code></pre>отделяем зерна от плевел, то есть вычленяем те пакеты которые установлены помимо репозиториев указанных в <strong>/etc/pacman.conf</strong><br /><br /><strong>Третий этап</strong><br /><pre><code>comm -3  packages.all.txt packages.aur.txt &gt; packages.txt</code></pre>пакеты которые установлены из репозиториев указанных в <strong>/etc/pacman.conf</strong><br /><br /><strong>Четвертый этап</strong><br /><pre><code>sudo pacman -S --force $(cat packages.txt)</code></pre>переустанавливаем пакеты из рапозиториев<br /><pre><code>yay -S --force $(cat packages.aur.txt)</code></pre>переустанавливаем пакеты из АУРа, для упрощения воспользуемся одним из помощников по АУРу(<a href="https://wiki.archlinux.org/index.php/AUR_helpers">AUR helper</a>) утилитой <a href="https://aur.archlinux.org/packages/yay/">yay</a><br /><br />в принципе последние три этапа можно было бы при желании объединить в<br /><pre><code>yay -S --force $(cat packages.all.txt)</code></pre>но для большего контроля и понимания я их разделил<br /><br /><strike>п.с.<br />из минусов некоторые(?) конфиги могут слететь, например .zshrc (как я понял сам пакет zsh его не трогал а задела переустановка каких-то сопутствующих пакетов, в общем надо разбираться)</strike>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218816"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/vasek/index.html">
                <span class="post-username">vasek</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218816/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/vasek/topics/index.html">
                    48
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/vasek/posts/index.html">
                    11320
                </a>
            </div>
            <div>
                Участник с: 17 февраля 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>red</em><br>Первый этап<br />awk &#39;$4==&quot;installed&quot; || $4==&quot;removed&quot; {print i++,$4,$5}&#39; /var/log/pacman.log |sort -k3 -k1n |cat - &lt;&lt;&lt; &#39;&#39; |awk &#39;{if (a==&quot;installed&quot; &amp;&amp; b!=$3) print b;a=$2;b=$3}&#39; &gt; packages.all.txt<br />здесь мы разбираем pacman.log и собираем список только тех пакетов которые были установлены и присутствуют в системе на данный момент.</blockquote><strong>awk &#39;$4==&quot;installed&quot; || $4==&quot;removed&quot; {print i++,$4,$5}&#39; /var/log/pacman.log |sort -k3 -k1n |cat</strong> - это работает (но очень много файлов, примерно 1700)<br />А вот при передаче на 2-ую часть что то у меня не сработало (пустой вывод после передачи  <strong>&lt;&lt;&lt; &#39;&#39; |awk &#39;{if (a==&quot;installed&quot; &amp;&amp; b!=$3) print b;a=$2;b=$3}&#39;</strong>)  - разбираться не стал<br /><br />Посмотрел <a href="https://wiki.archlinux.org/index.php/Pacman/Restore_local_database_(简体中文)">китайский скрипт</a> (показало около 900 файлов) - но все проверять не стал, просто посмотрел мельком - <strong>в принципе понравилось</strong>.
            
                
                    <div class="post-signature">
                        Ошибки не исчезают с опытом - они просто умнеют
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218817"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/red/index.html">
                <span class="post-username">red</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218817/index.html">#</a>
            3 года, 1 месяц назад
            
                (отредактировано
                
                    3 года, 1 месяц назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fd/eb/fdeb672af87b7c02419e9c58404908a5.png" alt="red avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/red/topics/index.html">
                    30
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/red/posts/index.html">
                    1517
                </a>
            </div>
            <div>
                Участник с: 31 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>vasek</strong><br />я тестил под zsh, ща попробовал под баш и получил пустой вывод как у тебя, чуть позже разберусь и подправлю
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-218818"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/red/index.html">
                <span class="post-username">red</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/218818/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/fd/eb/fdeb672af87b7c02419e9c58404908a5.png" alt="red avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/red/topics/index.html">
                    30
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/red/posts/index.html">
                    1517
                </a>
            </div>
            <div>
                Участник с: 31 августа 2011
            </div>
            
        </td>
        <td class="post-content">
            на баш не работает конкретно<br /><pre><code>cat - &lt;&lt;&lt; &#39;&#39;</code></pre>которая в текстовом потоке добавляет в конец пустую строку (необходима для следующего этапа действия)<br />можно заменить например на<br /><pre><code>awk &#39;{print} END{print &quot;&quot;}&#39;</code></pre>ну или что-то более красившее под башем
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="index4658.html?page=2" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="index9ba9.html?page=3">3 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdb0.html?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexaf4d.html?page=5">5</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="indexfdb0.html?page=4" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/index7a38.html?next=/forum/topic/19349/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/19349/?page=3 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:15:44 GMT -->
</html>
