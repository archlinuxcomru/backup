


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/topic/12712/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:11:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Мой юниксвейный mnt. Часть 3: укрощение сидишника и немного GUI.
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../feeds/topics/index.html" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../index.html">Форум</a></li>
    <li class=""><a href="../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../index.html">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="../../category/8/index.html">Блоги</a> <span class="divider">/</span></li>
            
                <li><a href="../../forum/25/index.html">Блоги</a> <span class="divider">/</span></li>
            
        
        
            <li>Мой юниксвейный mnt. Часть 3: укрощение сидишника и немного GUI.</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>Мой юниксвейный mnt. Часть 3: укрощение сидишника и немного GUI.</h1>
        
            <div class="text-center">
    



</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124293"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124293/index.html">#</a>
            8 лет, 9 месяцев назад
            
                (отредактировано
                
                    6 лет, 10 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            <em>Начало здесь:</em><br /><a href="../12698/index.html"><u>Часть 1: Системный диск, имена и группы.</u></a><br /><a href="../12702/index.html"><u>Часть 2: Флешки, диски и прочие карточки.</u></a><br /><br /><strong>3.1. CD/DVD и их специфика.</strong><br /><br />В прошлый раз я остановился на том, что CD/DVD-привод – устройство весьма специфическое. И это действительно так!<br /><br />С одной стороны, он всегда предсказуемо /dev/sr0 <em>(если вы вдруг не завели две штуки, что вряд ли)</em>; он уже в группе optical, и для этого не надо придумывать своих правил udev. Казалось бы, записать его в fstab с опциями &quot;user,noauto&quot; будет уже достаточно.<br /><br />Но с другой стороны, у сидишника есть свои очень неприятные особенности:<br />1) очень большое и не очень предсказуемое время опознавания диска, нередко побивающее все системные таймауты.<br />2) уже после успешного монтирования, ядро может внезапно и без объявления войны пересоздать устройство sr0, и диск снова окажется не смонтированным.<br />3) мелочь, но неприятно: на дисках могут быть разные ФС, и даже стандартные iso9660 и UDF не вполне совместимы между собой по специфическим опциям монтирования, а значит fstab уже не совсем подходит.<br /><br />В результате был написан скрипт <strong>mcd</strong> , который делает попытки монтирования диска до победного конца, а после этого ещё и проверяет, не надо ли начинать всё с начала.<br /><br />Чтобы решить проблему с разными опциями, я использовал в нём уже описанный в <a href="../12702/index.html"><u>предыдущей части</u></a> <strong>smount</strong>, который для каждой ФС берёт из конфига отдельный набор опций монтирования.<br /><br />Для отмонтирования я использую либо команду <strong>umcd</strong> (симлинк на mcd), либо (чаще) просто <strong>eject</strong><br />Поскольку диск смонтирован, <strong>eject</strong> вызывает от пользователя стандартную команду umount, а из неё, благодаря использованной при монтировании опции &quot;uhelper=smount&quot;, вызывается команда отмонтирования по симлинку /usr/bin/umount.smount -&gt; /usr/local/bin/smount , после чего eject успешно отрабатывает извлечение диска.<br /><br />Выглядит это примерно так. Вставляю и монтирую. Очевидно, это дивиди-видео, поэтому UDF: <pre><code>$ mcd
Файловая система Тип  Размер Использовано  Дост Использовано% Cмонтировано в
/dev/sr0         udf    7.5G         7.5G     0          100% /media/cdrom
$ ls /media/cdrom/
VIDEO_TS</code></pre>Можно посмотреть, с какими опциями он смонтировался: <pre><code>$ grep sr0 /proc/mounts 
/dev/sr0 /media/cdrom udf ro,nosuid,nodev,noexec,relatime,uid=1000,gid=100,mode=644,dmode=755,utf8 0 0
$ grep sr0 /run/mount/utab
SRC=/dev/sr0 TARGET=/media/cdrom ROOT=/ OPTS=user,helper=smount,uhelper=smount</code></pre>И если я сделаю eject, он нормально отмонтируется и извлечётся.<br /><br />Пробую другой диск: <pre><code>$ mcd
Файловая система Тип     Размер Использовано  Дост Использовано% Cмонтировано в
/dev/sr0         iso9660   1.6G         1.6G     0          100% /media/cdrom
$ ls -l /media/cdrom/
итого 2502
-rw-r--r-- 1 user users     134 апр 25  2012 autorun.inf
drwxr-xr-x 1 user users    2048 апр 25  2012 boot
drwxr-xr-x 1 user users    2048 апр 25  2012 casper
drwxr-xr-x 1 user users    2048 апр 25  2012 dists
drwxr-xr-x 1 user users    2048 апр 25  2012 efi
drwxr-xr-x 1 user users    2048 апр 25  2012 install
drwxr-xr-x 1 user users   18432 апр 25  2012 isolinux
-rw-r--r-- 1 user users   21922 апр 25  2012 md5sum.txt
drwxr-xr-x 1 user users    2048 апр 25  2012 pics
drwxr-xr-x 1 user users    2048 апр 25  2012 pool
drwxr-xr-x 1 user users    2048 апр 25  2012 preseed
-rw-r--r-- 1 user users     234 апр 25  2012 README.diskdefines
lr-xr-xr-x 1 user users       1 апр 25  2012 ubuntu -&gt; .
-rw-r--r-- 1 user users 2504112 апр 24  2012 wubi.exe
</code></pre>Старый установочник убунты, ISO9660 с юниксовыми расширениями RockRidge.<br />Смотрим опции: <pre><code>$ grep sr0 /proc/mounts 
/dev/sr0 /media/cdrom iso9660 ro,nosuid,nodev,noexec,relatime,mode=0644,dmode=0755,utf8,overriderockperm,uid=1000,gid=100 0 0
$ grep sr0 /run/mount/utab
SRC=/dev/sr0 TARGET=/media/cdrom ROOT=/ OPTS=user,helper=smount,uhelper=smount</code></pre>Как видите, для ISO9660 установлены уже несколько другие опции, включая overriderockperm , которая принудительно устанавливает заданные атрибуты mode=0644,dmode=0755 даже для такого диска, и если скопировать оттуда какие-то файлы, они уже НЕ будут &quot;только для чтения&quot;. Мелочь, а приятно :)<br /><br />Итак, <strong>mcd</strong> <pre><code>#!/bin/bash

#config defaults
DEV=/dev/sr0
MN=cdrom
TIMEO=30

err() {
 echo &quot;$@&quot; &gt;&amp;2
 exit 1
}

timesec() {
 TIME=`date +%s`
 [[ -n &quot;$1&quot; ]] &amp;&amp; START=$TIME
 let SEC=TIME-START
 ((SEC&gt;0)) &amp;&amp; printf &quot;%s\r&quot; $SEC
}

NAME=&quot;${0##*/}&quot;

sw=
while read -a C ; do
 c=&quot;${C[0]}&quot;
 case &quot;$c&quot; in
 \[cd\]|\[CD\])
  sw=cd
  ;;
 \[*)
  sw=
  ;;
 \#*|&#39;&#39;)
  ;;
 *)
  case &quot;$sw&quot; in
  cd)
   o=&quot;${C[1]}&quot;
   case &quot;$c&quot; in
   device)
    DEV=&quot;$o&quot;
    ;;
   mount)
    MN=&quot;$o&quot;
    ;;
   timeout)
    TIMEO=&quot;$o&quot;
    ;;
   esac
   ;;
  *)
   ;;
  esac
  ;;
 esac
done &lt; /etc/mnt.conf

MNT=&quot;smount $DEV $MN&quot;

case &quot;$NAME&quot; in
mcd)
 timesec start
 while ((SEC&lt;TIMEO)) ; do
  $MNT 2&gt;&amp;-
  sleep 0.5
  if grep -q &quot;$DEV&quot; /proc/mounts ; then
   df -hT &quot;$DEV&quot;
   exit 0
  fi
  ((SEC==0)) &amp;&amp; eject -t &quot;$DEV&quot;
  sleep 0.5
  timesec
 done
 $MNT
 ;;
umcd)
 usmount &quot;$DEV&quot;
 ;;
*)
 err Unknown command &quot;$NAME&quot;
 ;;
esac</code></pre><br /><strong>3.2. Автоматическое отмонтирование CD</strong><br /><br />Я не пользуюсь автоматическим монтированием, а автоматическое отмонтирование флешек – задача и вовсе безнадёжная, поскольку после физического выдёргивания носителя, отмонтировать его уже поздно.<br />CD/DVD-привод – фактически единственное устройство, для которого автоматическое отмонтирование действительно реализуемо, что я и сделал.<br /><br />С некоторых пор встроенное правило UDEV <u><strong><a href="http://cgit.freedesktop.org/systemd/systemd/tree/rules/60-cdrom_id.rules">60-cdrom_id.rules</a></strong></u> автоматически блокирует лоток CD, чтобы при нажатии на кнопку извлечения диска получить от привода сигнал &quot;DISK_EJECT_REQUEST&quot;. После нажатия на кнопку это же правило автоматически разблокирует и выдвигает лоток, нисколько не заботясь об отмонтировании ФС.<br /><br />Чтобы изменить такое поведение UDEV, я создал правило, дав ему номер 21, то есть расположив его в очереди <strong>раньше</strong> встроенного, чтобы перехватить сигнал от кнопки привода:<br /><blockquote><strong>/etc/udev/rules.d/21-eject-cd.rules</strong><pre><code>KERNEL==&quot;sr*&quot;, ACTION==&quot;change&quot;, ENV{DISK_EJECT_REQUEST}==&quot;?*&quot;, GOTO=&quot;cd_eject&quot;<br />GOTO=&quot;cd_end&quot;<br /><br />LABEL=&quot;cd_eject&quot;<br /># сбрасываем сигнал, чтобы встроенное правило<br />ENV{DISK_EJECT_REQUEST}=&quot;&quot; # не открыло лоток без разрешения<br />RUN+=&quot;/usr/bin/systemctl --no-block start eject-cd@%k&quot; # и вызываем собственный обработчик<br /><br />LABEL=&quot;cd_end&quot;</code></pre></blockquote>В этом же правиле я очищаю переменную DISK_EJECT_REQUEST, чтобы штатный обработчик UDEV не получил сигнал от кнопки, и не открыл лоток без отмонтирования.<br /><br />Чтобы не тормозить работу UDEV, и чтобы обойти лимит времени выполнения дочерних процессов UDEV, я вызываю свой обработчик события через systemctl. Советую этот способ для всех аналогичных случаев, когда вызываемый из правила процесс может затянуться, чтобы UDEV не счёл его &quot;зависшим&quot; и не убил раньше времени.<br /><br />Сам по себе юнит-обработчик предельно прост. Просто вызываем eject:<br /><blockquote><strong>/etc/systemd/system/eject-cd@.service</strong><pre><code>[Unit]<br />Description=Eject CD %I<br /><br />[Service]<br />Type=oneshot<br />ExecStart=/usr/bin/eject %I</code></pre></blockquote>Всё остальное делает сам eject – проверяет наличие смонтированной ФС и пытается отмонтировать.<br />Если диск смонтирован с помощью smount – этот скрипт автоматически запускается через опцию <strong>helper=smount</strong> <em>(здесь <strong>eject</strong> запускается от рута, поэтому имеет значение именно опция <strong>helper</strong>, а не uhelper)</em>, отмонтирует ФС и очищает точку монтирования..<br />Если диск не был смонтирован, или был отмонтирован успешно, <strong>eject</strong> сам разблокирует и открывает лоток, если нет – диск остаётся на месте, как и положено. <br /><br /><strong>3.3. немножко GUI.</strong><br /><br />Я не пользуюсь файл-менеджерами. Совсем. Управление серверами по ssh приучило к консоли, а некоторые эксцессы в MC отучили совмещать его с командами в консоли, что снизило для меня его ценность практически до нуля. Если надо что-то скопировать с флешки или на флешку, я просто пишу в консоли <strong>mnt</strong> , потом <strong>cp -p</strong> или <strong>cp -a</strong> что-то там куда-то там, благо автодополнение по TAB позволяет не набирать имена файлов и каталогов целиком, а потом <strong>umt</strong> и выдёргиваю.<br /><br />Тем не менее, так как настраивать линукс мне приходится не только для себя, я стал задумываться, а нельзя ли избавиться от udisks и там? К сожалению, в большинстве известных мне файлменеджеров udisks прибиты гвоздиками, но тут я вспомнил про <a href="https://www.archlinux.org/packages/community/i686/spacefm/"><strong><u>spacefm</u></strong></a> – клон pcmanfm, который позволяет настраивать команды монтирования по вкусу.<br /><br />Специально для встраивания в файлменеджер, поддерживающий только одну общую команду для монтирования только одного, но любого устройства, и одну такую же для отмонтирования, я сделал <strong>mntcmd</strong> – небольшой скрипт-обёртку для <strong>mnt</strong> и <strong>mcd</strong> , выбирающий нужную команду в зависимости от заданного устройства.<br /><br />В меню spacefm &quot;Устройства – Настройки – Команда монтирования&quot; я вписал <pre><code>mntcmd %v</code></pre> а в &quot;Устройства – Настройки – Команда размонтирования&quot; <pre><code>mntcmd -u %v</code></pre>spacefm успешно монтирует и отмонтирует флешки и CD/DVD.<br /><br />Вот сам скрипт <strong>mntcmd</strong> <pre><code>#!/bin/bash

sw=
while read -a C ; do
 c=&quot;${C[0]}&quot;
 case &quot;$c&quot; in
 \[cd\]|\[CD\])
  sw=cd
  ;;
 \[*)
  sw=
  ;;
 \#*|&#39;&#39;)
  ;;
 *)
  case &quot;$sw&quot; in
  cd)
   o=&quot;${C[1]}&quot;
   case &quot;$c&quot; in
   device)
    DEV=&quot;$o&quot;
    ;;
   esac
   ;;
  *)
   ;;
  esac
  ;;
 esac
done &lt; /etc/mnt.conf

M=m
D=f
if [[ &quot;$1&quot; = &#39;-u&#39; ]] ; then
 M=u
 shift
fi
[[ &quot;$1&quot; = &quot;$DEV&quot; ]] &amp;&amp; D=c

case &quot;$M$D&quot; in
mf)
 mnt &quot;$1&quot;
 ;;
uf)
 umt &quot;$1&quot;
 ;;
mc)
 mcd
 ;;
uc)
 umcd
 ;;
esac</code></pre><br />На этом я заканчиваю рассказ о моих скриптах монтирования. До новых скриптов :)<br />Надеюсь, вам было интересно.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124462"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/tsn/index.html">
                <span class="post-username">tsn</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124462/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/tsn/topics/index.html">
                    13
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/tsn/posts/index.html">
                    144
                </a>
            </div>
            <div>
                Участник с: 04 октября 2011
            </div>
            
        </td>
        <td class="post-content">
            <blockquote>Надеюсь, вам было интересно.</blockquote><br/>Интересно очень!<br/>И огромное спасибо за труд!
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124853"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124853/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            конечно, простите за некомпетентность, с линуксом знаком совсем недавно,  и может чуть-чуть ни к месту)). А смысл вот этого всего? Если нет толклм никакой автоматизации... какие то команды пачками, пока во всём разберёшся и так все параметры mount и umount наизусть выучишь и mount -t auto без ошибчно определяет фс.  Да и посмотреть как в /dev определилась флэшка не вижу проблемы (был казус когда фс была поямо на /dev/sdb)).<br/>Кароче вопрос почему это не работает через udev?  на вики написанно что то про защищённые фс (русская вики вобще в отрыве от жтзни), и тп. Но в интернете много примеров с ntfs и тп. Значит когда то оно работало?  Может кто нить ответить?
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124876"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/nafanja/index.html">
                <span class="post-username">nafanja</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124876/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/8b/bf/8bbfdb897f0c37710a7d8b4dc072bea1.png" alt="nafanja avatar" />
    
</div>

            <div>
                Темы:
                <a href="../../users/nafanja/topics/index.html">
                    94
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/nafanja/posts/index.html">
                    9252
                </a>
            </div>
            <div>
                Участник с: 02 июня 2012
            </div>
            
                <div class="label label-warning">заблокирован</div>
            
        </td>
        <td class="post-content">
            <blockquote>А смысл вот этого всего?</blockquote>ind.indeviral, не видишь смысла, забей, оно тебе не нужно!<br/><blockquote>и mount -t auto без ошибчно определяет фс</blockquote>зачем <strong>-t auto</strong>? оно и без этого все определяет без ошибочно (даже без прописывания в fstab, как многие это еще до сих пор делают), при условии что все правильно сделано.
            
                
                    <div class="post-signature">
                        <a href="../10992/index.html">Псевдографический инсталлятор Arch Linux ver. 3.8.2</a><br />Благодарности принимаются на ЯД <strong>410012815723874</strong>
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124879"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124879/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            Я не знал как конкретно задать вопрос поэтому трохи переборщил с ненужным текстом...<br/>Вопрос в том почему нельзя использовать udev (скорее даже почему не сделают поддержку ntfs, exfat  и тп), а не запускать самому вообще никаких скриптов (треть функционала которых это функции которые "в моём понимании" должны идти через udev), почему эту фишку никто не юзают, а парятся с написанием килотон скриптов?<br/><br/>p.s. можно даже ссылочку куда мне идти))<br/>mount -t auto это как бы значение по умолчанию ( -t auto можно неписать), когда исполняется mount  type fs используется auto если не указано другого...
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124894"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/domov0y/index.html">
                <span class="post-username">domov0y</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124894/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/domov0y/topics/index.html">
                    5
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/domov0y/posts/index.html">
                    819
                </a>
            </div>
            <div>
                Участник с: 09 июля 2011
            </div>
            
        </td>
        <td class="post-content">
            <em>"Зачем оно надо и почему не через удев."</em> Помнится Натрио где то на форуме ругался в извращенной литературной форме что удев от версии к версии работает всё хуже. Из за того что из него сделали этакого монстра. Подробностей уже не помню.  Потому и скрипт параноидально проверяющий наличие диска в приводе. И скрипт косвенными признаками проверяющий плохой контакт на флешках(стерлась позолота. Вроде в тексте все написано)
            
                
                    <div class="post-signature">
                        Да пребудет с вами знание ip адреса
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124909"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124909/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            <strong>ind.indeviral</strong>, вы, пожалуй, действительно переборщили с текстом. Вместо всего этого можно было просто спросить – почему тут нет <strong>автомонтирования</strong>?<br/><br/>Отвечаю – <strong>мне не нужно</strong> автомонтирование, потому его и нет. Не всегда мне требуется монтировать то, что я вставляю, а иногда это вообще нежелательно.<br/>Кроме того, отмонтировать <em>(или на худой конец делать sync)</em> всё равно придётся руками, потому что после физического выдёргивания из USB, отмонтировать уже поздно :)<br/>А так, в принципе, сделать автомонтирование совсем не сложно, достаточно сделать юнит для mnt, и повесить на udev запуск этого юнита. <em>(Напрямую запускать из udev монтирование нежелательно, потому что монтирование может длиться довольно долго, а в udev очень короткий таймаут.)</em><br/><br/><br/><blockquote>какие то команды пачками, пока во всём разберёшся и так все параметры mount и umount наизусть выучишь</blockquote>Это потому, что я писал не хауту для начинающих, а развернутую статью в трёх частях с полными текстами всех скриптов и объяснениями, как они работают.<br/>На самом деле весь этот набор скриптов легко можно собрать в один пакет с инсталлятором <em>(для полу/автоматического прописывания в правило udev одного или больше "системных" дисков)</em>, и на поверхности останутся в четыре коротких команды, как правило без параметров:<br/><strong>mnt</strong> монтирует все флешки и переносные винчестеры,<br/><strong>umt</strong> всё это отмонтирует,<br/><strong>mls</strong>  показывает что подключено и что смонтировано,<br/><strong>mcd</strong> монтирует сидишники, и к нему в пару eject, но он штатный и стандартный.<br/><br/>Команды намеренно сделаны такими короткими, и работающими по возможности без параметров, чтобы было удобнее набирать их в консоли.<br/>А о том, что я предпочитаю консоль всяческим файл-менеджерам, я уже писал :)<br/><br/><blockquote>mount -t auto без ошибчно определяет фс.</blockquote><blockquote><em>nafanja</em><br/>зачем -t auto? оно и без этого все определяет без ошибочно (даже без прописывания в fstab, как многие это еще до сих пор делают), при условии что все правильно сделано.</blockquote>Совершенно верно, mount отлично умеет сам определять ФС, только мне нужно определить <strong>не только</strong> ФС, но и <strong>параметры к ней</strong>, и не умолчальные, а такие, как нужно мне.<br/><br/>Поэтому мой скрипт определяет тип ФС с помощью lsblk, а потом по этому типу выбирает из списка в конфиге нужный набор опций. Список очень похож на fstab, только в нём нет устройств <em>(устройства могут быть разными)</em> и точек монтирования <em>(они создаются автоматически)</em>, а есть только ФС и опции монтирования к ним.<br/><br/>Ничего особенного в таком методе работы нет – точно так же работают и <strong>pmount</strong>, и <strong>udisks</strong>, и <strong>udevil</strong> – просто в первых двух вместо конфига список опций намертво захардкодили, что меня категорически не устраивает, а вот у udevil вполне нормальный конфиг, почти как у меня, просто мне было удобнее написать свой скрипт на замену pmount, чем приспосабливать udevil, который работает не совсем так, как мне нужно.<br/><br/>Кстати, если вам нужно автомонтирование, можете попробовать udevil, в нём оно, насколько я помню, предусмотрено.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-124928"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/indeviral/index.html">
                <span class="post-username">indeviral</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/124928/index.html">#</a>
            8 лет, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/indeviral/topics/index.html">
                    38
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/indeviral/posts/index.html">
                    3165
                </a>
            </div>
            <div>
                Участник с: 10 августа 2013
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>Natrio</em><br/>монтирование может длиться довольно долго, а в udev очень короткий таймаут</blockquote>Спасибо))
            
                
                    <div class="post-signature">
                        Ошибки в тексте-неповторимый стиль автора©
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-134288"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../../users/Natrio/index.html">
                <span class="post-username">Natrio</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../post/134288/index.html">#</a>
            8 лет, 4 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../../users/Natrio/topics/index.html">
                    47
                </a>
            </div>
            <div>
                Сообщения:
                <a href="../../users/Natrio/posts/index.html">
                    4763
                </a>
            </div>
            <div>
                Участник с: 08 января 2011
            </div>
            
        </td>
        <td class="post-content">
            Недавние раскопки в <a href="../../post/133784/http_/archlinux.org.ru/forum/post/133784/index.html">событиях ядра и UDEV, сопровождающих загрузку и извлечение CD</a>, побудили меня добавить обработку кнопки извлечения диска.<br /><br />С некоторых пор правило udev <strong><u><a href="http://cgit.freedesktop.org/systemd/systemd/tree/rules/60-cdrom_id.rules">60-cdrom_id.rules</a></u></strong> автоматически блокирует лоток CD, чтобы при нажатии на кнопку извлечения диска получить от привода сигнал &quot;DISK_EJECT_REQUEST&quot;: <pre><code># import device and media properties and lock tray to
# enable the receiving of media eject button events
IMPORT{program}=&quot;cdrom_id --lock-media $devnode&quot;</code></pre> а после нажатия на кнопку – автоматически разблокирует и выдвигает лоток, нисколько не заботясь об отмонтировании ФС: <pre><code># media eject button pressed
ENV{DISK_EJECT_REQUEST}==&quot;?*&quot;, RUN+=&quot;cdrom_id --eject-media $devnode&quot;, GOTO=&quot;cdrom_end&quot;</code></pre><br />Тем самым разработчики UDEV захватили механизм блокировки лотка, и использовав его не по назначению – всего лишь для получения сигнала от кнопки, лишили все остальные программы возможности блокировать лоток, когда диск на самом деле занят.<br /><br />Чтобы хотя бы частично исправить это давно надоевшее мне безобразие, а заодно наладить автоматическое отмонтирование диска при нажатии на кнопку, я добавил своё правило <strong>21-eject-cd.rules</strong> , которое через systemctl и юнит вызывает не cdrom_id, а нормальный eject, а переменную DISK_EJECT_REQUEST просто очищает, &quot;чтоб не досталась врагу&quot; :)<br /><br />В отличии от cdrom_id, команда eject обрабатывает запросы на извлечение правильно, то есть проверяет наличие смонтированной ФС, пытается её отмонтировать, и только в случае успеха открывает лоток.<br /><br />Обновления:<br /><a href="index.html"><strong><u>Часть 3</u></strong></a>: Добавлен раздел &quot;Автоматическое отмонтирование CD&quot; с описанием правила <strong>21-eject-cd.rules</strong> и юнита <strong>eject-cd@.service</strong><br /><a href="../12702/index.html"><strong><u>Часть 2</u></strong></a>: В <strong>smount</strong> исправлен баг, добавлена обработка umount под рутом, реализована возможность монтирования в разные каталоги вида /run/media/%u (или любые другие, к примеру /home/%u/media ) для разных юзеров с разделением доступа, см. <strong>mnt.conf</strong><br />В <strong>mnt</strong> улучшена реализация блэклиста, теперь он фильтрует устройства только при монтировании/отмонтировании всех сразу, прямое упоминание устройства позволяет обойти блэклист.<br /><a href="../12698/index.html"><strong><u>Часть 1</u></strong></a>: Правило UDEV для именования встроенных дисков почищено и разделено на два – первое <em>(зависимое от конкретных дисков)</em> именует, второе <em>(общее)</em> создаёт по именам и меткам симлинки вида hd, hd1, hd_Label и т.д.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    



</div>

        

        

        
            
<a href="../../../accounts/register/index.html">Зарегистрироваться</a> или <a href="../../../accounts/login/index0471.html?next=/forum/topic/12712/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/topic/12712/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 04:11:03 GMT -->
</html>
