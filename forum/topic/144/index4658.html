


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        tsocks
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    

    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/jquery.formset.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
        
            
                <li><a href="/forum/category/2/">Поддержка пользователей</a> <span class="divider">/</span></li>
            
                <li><a href="/forum/forum/13/">Сети, Серверы, Защита</a> <span class="divider">/</span></li>
            
        
        
            <li>tsocks</li>
        
    
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    
    <div class="topic">
        <h1>tsocks</h1>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=1" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=2">2 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        <div class="posts">
            
            
                
                




<table class="table table-bordered post post-row
       "
       id="post-1004"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Linuxman/">
                <span class="post-username">Linuxman</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/1004/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Linuxman/topics/">
                    43
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Linuxman/posts/">
                    262
                </a>
            </div>
            <div>
                Участник с: 12 февраля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br/>Ага! Стоп!<br/>А Вы не путаете ничего? Все примеры с &ldquo;export&#8230;&rdquo; относятся к HTTP-прокси. Из apt.conf либо вообще уберите все прокси и используйте tsocks, либо укажите правильный: Вроде, должно быть так (я дебианом сильно никогда не увлекался):<br/><div class="code"><pre>Acquire::socks::proxy "socks://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a5d5c4d6d6e5cdcad6d1">[email&#160;protected]</a>:port/";</pre></div>со своими, конечно, настройками.<br/>http-proxy  и socks-proxy далеко не одно и то же. Так что, относитесь к разным советам внимательнее и вдумчивее.</blockquote>Да я действительно с начала немного сам запутался и пытался пустить все через http и ftp прокси, но затем додумался и догуглился.<br/>1.Я прбовал запускать только через tsock без настроек proxy в apt.<br/>2.Создавал apt.conf и правил его на socks<br/>3. Добавлял к п.2   apt.conf.d/proxy с параметрами socks-proxy<br/>4.Пробовал только apt.conf.d/proxy<br/>5.export socks_proxy и пропись его в /etc/enviroment<br/><strong>UPD:</strong> проблема в том что у меня получается ходить через tsocks только по ip, что trace, что wget.<br/><div class="code"><pre>$ tsocks wget <a href="https://google.com">google.com</a>
--2012-12-24 18:07:44--  <a href="https://google.com/">http://google.com/</a>
Распознаётся google.com... сбой: Имя или служба не известны.
wget: unable to resolve host address «google.com»
$ tsocks wget 74.125.71.105
--2012-12-24 18:08:14--  <a href="http://74.125.71.105/">http://74.125.71.105/</a>
Устанавливается соединение с 74.125.71.105:80... соединение установлено.
Запрос HTTP послан, ожидается ответ... 200 OK
Cookie, пришедшие из 74.125.71.105, попытались установить домен в 74.125.71.105
Длина: нет информации [text/html]
Saving to: «index.html»
    [ &lt;=&gt;                                   ] 10 459      --.-K/s   в 0s       
2012-12-24 18:08:15 (80,5 MB/s) - «index.html» saved [10459]</pre></div> В /etc/resolv.conf прописал все как на сервере с и-нетом.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96772"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/kurych/">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96772/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/kurych/topics/">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/kurych/posts/">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Тогда дело ясное. &ldquo;Следите за руками&rdquo;:<br/>на сервере, через который Вы предполагаете ходить в инет, вероятно, прописаны днс сервера Вашего провайдера. Если они из другой подсети, то для компьютера, который должен выходить в инет через прокси, они недоступны. tsocks не туннелирует dns-запросы (хотя в firefox можно в настройках явно указать отправлять dns-запросы через socks-туннель).<br/>Поэтому, либо настраивайте на том же сервере какой-нибудь кеширующий dns-сервер, типа <a href="https://wiki.archlinux.org/index.php/Dnsmasq">dnsmasq</a>, что бы он был доступен внутренним хостам локалки, либо http-proxy, через который DNS туннелируется по умолчанию, либо настраивайте нормальную маршрутизацию с NAT на сервере.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96791"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Linuxman/">
                <span class="post-username">Linuxman</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96791/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Linuxman/topics/">
                    43
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Linuxman/posts/">
                    262
                </a>
            </div>
            <div>
                Участник с: 12 февраля 2010
            </div>
            
        </td>
        <td class="post-content">
            Т.е.<br/>Устанавливаю dnsmsq, прописываю<br/><div class="code"><pre>это в конфиг
listen-address=127.0.0.1
тут добавляю к своему провайдеру локалхост
echo "nameserver 127.0.0.1" &gt;&gt; /etc/resolv.conf.head</pre></div><div class="code"><pre>cat /etc/resolv.conf
Generated by dhcpcd from wlan0
nameserver 127.0.0.1
nameserver 204.194.232.200
nameserver 192.168.0.1
nameserver 8.8.8.8</pre></div>и запускаю dnsmasq.<br/><br/><div class="code"><pre>dig <a href="https://archlinux.org">archlinux.org</a> | grep "Query time"
;; Query time: 197 msec
dig <a href="https://archlinux.org">archlinux.org</a> | grep "Query time"
;; Query time: 4 msec</pre></div><br/>DHCP мне не нужен.<br/>А потом указываю на клиентской машине в resolv.conf адрес моего сервера, так?<br/>Или мне надо пройтись по всем репам, что бы они появились в кеше?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96917"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/kurych/">
                <span class="post-username">kurych</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96917/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/kurych/topics/">
                    0
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/kurych/posts/">
                    1394
                </a>
            </div>
            <div>
                Участник с: 06 ноября 2011
            </div>
            
        </td>
        <td class="post-content">
            Вам необходимо, что бы сервер с запущенным dnsmsq отвечал на запросы хостов внутренней сети. То есть, он должен слушать не только на 127.0.0.1, но и на интерфейсе, смотрящем в LAN.<br/>Рекомендую нарисовать, хотя бы на бумажке, свою схему, кто куда смотрит, кто к кому какие запросы посылает. Понятнее же будет. А то уже от socks ушли в настройку кеширующего DNS.<br/>(в русской статье про dnsmsq адрес 127.0.0.1 упоминается как достаточный для работы кеширующего сервера имен только потому, что в этом том примере dnsmsq используется на одном и том же компьютере. Не для всей сети.)
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96983"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Linuxman/">
                <span class="post-username">Linuxman</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96983/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Linuxman/topics/">
                    43
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Linuxman/posts/">
                    262
                </a>
            </div>
            <div>
                Участник с: 12 февраля 2010
            </div>
            
        </td>
        <td class="post-content">
            <a href="https://imageshack.us/photo/my-images/28/14858210.jpg/"><img src="https://img28.imageshack.us/img28/4517/14858210.jpg"></img></a><br/>dnsmasq слушает на 127.0.0.1 и <strike>192.168.0.1</strike> 192.168.0.103 <br/><br/><blockquote><em>kurych</em><br/>маршрутизацию с NAT на сервере</blockquote>Вариант с такой раздачей интернета имеет право на жизнь?<br/><blockquote>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ppp0 -j MASQUERADE</blockquote>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96994"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/sleepycat/">
                <span class="post-username">sleepycat</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96994/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/f2/c0/f2c02cdf7ab1395c1ebcd403ff0c9d53.png" alt="sleepycat avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/sleepycat/topics/">
                    98
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/sleepycat/posts/">
                    3291
                </a>
            </div>
            <div>
                Участник с: 19 июля 2011
            </div>
            
        </td>
        <td class="post-content">
            +&mdash;&mdash;&mdash;-+<br/>|   client   |<br/>+&mdash;&mdash;&mdash;-+<br/><br/><div class="code"><pre>cat /etc/resolv.conf
ip a
traceroute server
telnet server 22
^]
quit
dig <a href="http://yahoo.com">yahoo.com</a> @8.8.8.8
dig yahoo.com</pre></div>подъытожим.<br/>ЗЫ: а сквид на самом &ldquo;роутере&rdquo; не посильная нагрузка?
            
                
                    <div class="post-signature">
                        Лозунг у них был такой: &quot;Познание бесконечности требует бесконечного времени&quot;. С этим я не спорил, но они делали из этого неожиданный вывод: &quot;А потому работай не работай — все едино&quot;. И в интересах неувеличения энтропии Вселенной они не работали. (с)
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-96995"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Linuxman/">
                <span class="post-username">Linuxman</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/96995/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Linuxman/topics/">
                    43
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Linuxman/posts/">
                    262
                </a>
            </div>
            <div>
                Участник с: 12 февраля 2010
            </div>
            
        </td>
        <td class="post-content">
            <div class="code"><pre>cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 192.168.0.103
nameserver 192.168.0.1
ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000
    link/ether 00:0c:6e:d8:48:9c brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.102/24 brd 192.168.0.255 scope global eth2
    inet6 fe80::20c:6eff:fed8:489c/64 scope link
       valid_lft forever preferred_lft forever
3: pan0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN
    link/ether f6:e8:99:4b:14:5b brd ff:ff:ff:ff:ff:ff
traceroute 192.168.0.103
traceroute to 192.168.0.103 (192.168.0.103), 30 hops max, 60 byte packets
 1  192.168.0.103 (192.168.0.103)  2.685 ms  2.606 ms  2.620 ms
 telnet 192.168.0.103 22
Trying 192.168.0.103...
Connected to 192.168.0.103.
Escape character is '^]'.
SSH-2.0-OpenSSH_6.1
^]
telnet&gt; quit
Connection closed.
dig <a href="http://yahoo.com">yahoo.com</a> @8.8.8.8
; &lt;&lt;&gt;&gt; DiG 9.7.3 &lt;&lt;&gt;&gt; <a href="http://yahoo.com">yahoo.com</a> @8.8.8.8
;; global options: +cmd
;; connection timed out; no servers could be reached
dig <a href="http://yahoo.com">yahoo.com</a>
; &lt;&lt;&gt;&gt; DiG 9.7.3 &lt;&lt;&gt;&gt; <a href="http://yahoo.com">yahoo.com</a>
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 42391
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0
;; QUESTION SECTION:
;yahoo.com.			IN	A
;; ANSWER SECTION:
<a href="http://yahoo.com">yahoo.com</a>.		2193	IN	A	98.139.183.24
<a href="http://yahoo.com">yahoo.com</a>.		2193	IN	A	98.138.253.109
<a href="http://yahoo.com">yahoo.com</a>.		2193	IN	A	72.30.38.140
;; Query time: 23 msec
;; SERVER: 192.168.0.103#53(192.168.0.103)
;; WHEN: Wed Dec 26 17:56:40 2012
;; MSG SIZE  rcvd: 75</pre></div>И как бы все работает, wget и apt прошли, дальше проверить времени нету.<br/>UPD:цель достигнута, консольные утилиты через tsocks выполняются корректно. Спасибо, kurych ,за очередную решенную проблему и повышение моей, никакой, квалификации :)<br/><br/><blockquote><em>sleepycat</em><br/>ЗЫ: а сквид на самом “роутере” не посильная нагрузка?</blockquote>Даже не представляю себе =)
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
                
                




<table class="table table-bordered post post-row
       "
       id="post-97942"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Linuxman/">
                <span class="post-username">Linuxman</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/97942/">#</a>
            9 лет, 8 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Linuxman/topics/">
                    43
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Linuxman/posts/">
                    262
                </a>
            </div>
            <div>
                Участник с: 12 февраля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>kurych</em><br/>маршрутизацию с NAT на сервере</blockquote><br/>После того как с socks все заработало, решил пойти по совету kurych и попробовать более нормальный вариант.<br/><br/><strike>Но я - не я, если у меня все сразу не заводится.<br/>И по порядочку.<br/>Мой сервер.<br/>Настроив dnsmasq</strike><br/><br/>Планировал уже писать слезное полотно, но понял что <strong>удар мне показался очень знакомым и родным. Как оказались я прыгал на  те же грабли с ip_forward.</strong><br/><div class="code"><pre>listen-address=127.0.0.1, 192.168.0.101
interface=wlan0
no-dhcp-interface=ppp0
resolv-file=/etc/resolv.conf
#domain=example.local
dhcp-range=192.168.0.100,162.168.0.198,24h
cache-size=250</pre></div><br/>ifconfig<br/><div class="code"><pre>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.1.2  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::ca0a:a9ff:fef9:b422  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether c8:0a:a9:f9:b4:22  txqueuelen 1000  (Ethernet)
        RX packets 22494  bytes 16479532 (15.7 MiB)
        RX errors 0  dropped 14  overruns 0  frame 0
        TX packets 20543  bytes 3210388 (3.0 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 16436
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 0  (Local Loopback)
        RX packets 1257  bytes 44839 (43.7 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1257  bytes 44839 (43.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
ppp0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1492
        inet 109.109.210.77  netmask 255.255.255.255  destination 109.109.214.1
        ppp  txqueuelen 3  (Point-to-Point Protocol)
        RX packets 21148  bytes 15925644 (15.1 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 18793  bytes 2692035 (2.5 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
wlan0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.0.101  netmask 255.255.255.0  broadcast 192.168.0.255
        inet6 fe80::c646:19ff:fea5:a214  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether c4:46:19:a5:a2:14  txqueuelen 1000  (Ethernet)
        RX packets 190448  bytes 175992302 (167.8 MiB)
        RX errors 0  dropped 7  overruns 0  frame 0
        TX packets 135993  bytes 23795457 (22.6 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</pre></div><br/><strong>&ldquo;Моё любимое&rdquo;</strong><br/><div class="code"><pre>cat /proc/sys/net/ipv4/ip_forward
1
cat /proc/sys/net/ipv4/ip_dynaddr
1</pre></div>Собственно правило.<br/><div class="code"><pre>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ppp0 -j MASQUERADE</pre></div><br/>На клиентской машине прошлось повоевать только с NetworkManager.<br/><br/>cat /etc/network/interfaces<br/><div class="code"><pre># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).
# The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
allow-hotplug eth2
iface eth2 inet static
address 192.168.0.135
netmask 255.255.255.0
networ 192.168.0.0
broadcast 192.168.0.255
gateway 192.168.0.101
dns-nameservers 192.168.0.101
#NetworkManager#iface eth0 inet dhcp</pre></div><br/>ifconfig<br/><div class="code"><pre>eth2      Link encap:Ethernet  HWaddr 00:0c:6e:d8:48:9c
          inet addr:192.168.0.135  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:6eff:fed8:489c/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:18 errors:0 dropped:0 overruns:0 frame:0
          TX packets:58 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1883 (1.8 KiB)  TX bytes:7587 (7.4 KiB)
          Interrupt:19 Base address:0x9800</pre></div><br/>cat /etc/resolv.conf<br/><div class="code"><pre># Generated by NetworkManager
nameserver 192.168.0.101</pre></div><br/>ping -c5 google.com<br/><div class="code"><pre>PING <a href="https://google.com">google.com</a> (188.43.64.185) 56(84) bytes of data.
64 bytes from 188.43.64.185: icmp_req=1 ttl=60 time=94.3 ms
64 bytes from 188.43.64.185: icmp_req=2 ttl=60 time=95.8 ms
64 bytes from 188.43.64.185: icmp_req=3 ttl=60 time=104 ms
64 bytes from 188.43.64.185: icmp_req=4 ttl=60 time=97.4 ms
64 bytes from 188.43.64.185: icmp_req=5 ttl=60 time=95.2 ms
--- <a href="https://google.com">google.com</a> ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 20623ms
rtt min/avg/max/mdev = 94.396/97.501/104.585/3.695 ms</pre></div>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

            
        </div>
        <div>&nbsp;</div>
        
            <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=1" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=2">2 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

        

        

        
            
<a href="/accounts/register/">Зарегистрироваться</a> или <a href="/accounts/login/?next=/forum/topic/144/">войдите</a> чтобы оставить сообщение.

        

        
    </div>

        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747c0e561d249d8c',m:'b0jxwKbSWIlkbEn0pRNk.Hmsoc1zX1fumoIVAoclhrw-1662685950-0-AWI3LpLm6BEr54mjLSXg14yWR3eTuud2nX//7grYSRes+9wkQ0DjTlsXfefhKkcdO1+zMiSi+uasMnxoczej5JvGnJrijb2I+J/I6D/SN/Pf3cGNjlMWsteGAIAc20m9/0Te3xfgA5Ql/P9PPLiHs7w=',s:[0xd23a54da61,0x57207f339d],u:'/cdn-cgi/challenge-platform/h/g'};var _cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/cb/invisible.js?cb=747c0e561d249d8c',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
