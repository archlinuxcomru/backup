


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/users/Nebulosa/posts/?page=8 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 05:45:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Nebulosa Сообщения
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../../feeds/topics/index.html" title="Последние темы на форуме" >

    
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../../index.html">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../../index.html">Форум</a></li>
    <li class=""><a href="../../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../../index.html">Начало</a> <span class="divider">/</span></li>
    
    
        <li>Сообщения</li>
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    <div class="posts">
        
            




<table class="table table-bordered post post-row
       "
       id="post-226953"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/226953/index.html">#</a>
            2 года, 6 месяцев назад
            
                (отредактировано
                
                    2 года, 6 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Продолжаю настраивать vds, столкнулся с небольшой проблемой.<br /><br />Установлен и настроен <a href="https://www.rutschle.net/tech/sslh/README.html">sslh</a>  всё работает, но программы не видят внешний IP соединений.<br /><br />Например:<br /><pre><code>➤[Connected 23 Feb 2020, 09:11:18]
Last login: Sun Feb 23 08:13:05 2020 from 127.0.0.1
[nebulosa@vds ~]$</code></pre><br />В документации есть инструкция, необходимо применить следующие правила (сразу пишу с поправкой на свои реалии):<br /><pre><code>sudo iptables -t mangle -N SSLH
sudo iptables -t mangle -A  OUTPUT --protocol tcp --out-interface ens3 --sport 22 --jump SSLH
sudo iptables -t mangle -A OUTPUT --protocol tcp --out-interface ens3 --sport 443 --jump SSLH
sudo iptables -t mangle -A SSLH --jump MARK --set-mark 0x1
sudo iptables -t mangle -A SSLH --jump ACCEPT
sudo ip rule add fwmark 0x1 lookup 100
sudo ip route add local 0.0.0.0/0 dev lo table 100</code></pre><br />После применения последней команды - сервер перестаёт принимать соединения.<br />Подозреваю, что нужно как-то поменять ранг таблицы или прописать как-то ип, но для меня маршрутизация - это тёмный лес, прошу вашей помощи.<br /><br />Перед всеми действиями конфигурация сервера такая:<br /><pre><code>$ ip rule list
0:      from all lookup local
32766:  from all lookup main
32767:  from all lookup default
</code></pre><pre><code>$sudo iptables-save
*nat
:PREROUTING ACCEPT [8076:453873]
:INPUT ACCEPT [705:37884]
:OUTPUT ACCEPT [842:52367]
:POSTROUTING ACCEPT [176:9152]
-A POSTROUTING -o ens3 -j MASQUERADE
COMMIT
*filter
:INPUT DROP [7241:407167]
:FORWARD ACCEPT [44705:57871270]
:OUTPUT ACCEPT [288283:318921775]
-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8388 -j ACCEPT
-A INPUT -p udp -m udp --dport 3963 -j ACCEPT
-A INPUT -p udp -m udp --dport 8388 -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i wg0 -j ACCEPT
COMMIT
</code></pre><br /><pre><code>
$ ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq state UP group default qlen 1000
    link/ether 52:54:00:02:48:4a brd ff:ff:ff:ff:ff:ff
    inet &lt;my_IP_is_here&gt;/24 brd &lt;IP_gate_is_here&gt; scope global ens3
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe02:484a/64 scope link
       valid_lft forever preferred_lft forever
3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq state UNKNOWN group default qlen 100
    link/none
    inet 10.8.0.1/24 brd 10.8.0.255 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 fe80::be2c:6fd5:223b:842e/64 scope link stable-privacy
       valid_lft forever preferred_lft forever
4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000
    link/none
    inet 10.66.66.1/24 scope global wg0
       valid_lft forever preferred_lft forever
    inet6 fd42:42:42::1/64 scope global
       valid_lft forever preferred_lft forever
</code></pre>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-225977"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/225977/index.html">#</a>
            2 года, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>hoz</em><br>Так я не примеряю, а просто ознакомился с различными мнениями. Но.. это не столь важно т.к. своп можно файлом подключить, если что. И отключить, так же.</blockquote>Ура! Я смог донести мысль)<br /><br /><blockquote><em>hoz</em><br>Вот моя конфигурация:<br /><li>Процессор: AMD Ryzen 7 1700 Eight-Core Processor 3.00 GHz</li><li>Материнская плата: ASRock AB350 Gaming K4</li><li>Память: Corsair 16 Gb DDR4</li><li>Видеокарта: Gigabyte NVIDIA GeForce GT 710</li></blockquote><br />Так что там с диском?) А железки для Линукса вполне себе, чтобы попробовать его в полной красе.<br /><blockquote><em>hoz</em><br>Сверху Partition Type. Как я понимаю Primary, это все разделы, за исключение некоторые типа отдельных поддиректорий пользователей т.е. их домашних каталогов и тд?</blockquote><br />Не углубляясь, всегда выбирайте Primary. Extended нужен когда разделов нужно сделать больше 4-ёх при таблице разделов mbr.<br /><br /><blockquote><em>hoz</em><br>Флаги (Flags) нужно вообще устанавливать?</blockquote><br />Из каких-то важных флагов знаю только boot. <a href="https://gparted.org/display-doc.php?name=help-manual&amp;lang=ru#gparted-manage-partition-flags">Остальные специфичные.</a>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-225973"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/225973/index.html">#</a>
            2 года, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Не понимаю, правда, как, исследуя пограничные случаи, которые ещё нужно сильно постараться повторить, пытаться получить рабочую конфигурацию для себя?..<br /><br />Расскажите уже про ваши железки что-ли.. что там с памятью, процом, диском, а то какие-то разговоры &quot;в пользу бедных&quot;.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-225962"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/225962/index.html">#</a>
            2 года, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Даа... шурум бурум в голове изрядный)<br /><br />Самый простой и адекватный способ - это диск никак не делить, тогда не будет никакой дилеммы - сколько на какой раздел сколько надо выделять.Поставьте систему, посмотрите что и сколько занимает, сделайте выводы самостоятельно!<br /><br />По моей практике делим диск на: / - 10Гб (из которых по факту будет использоваться 6-7ГБ прям макс макс), /home - всё остальное. Почему так? Всё просто - если я вдруг решу снести систему полностью или вообще сменить дистрибутив на убунту там или ещё какой - форматировать буду только системный диск, а всё что накачано непосильным путём спокойно будет лежать в &quot;домашке&quot; и не нужно будет куда это бекапить и тратить время и прочее прочее. Особенно когда у тебя диск от 1ТБ, забитый любимыми хайрезами вселенной Марвел)<br /><br />Плюс ещё в такой схеме, если вдруг на системном диске вдруг закончится место система не встанет колом, т.к. на системном диске есть резерв под пользователя рута (можно будет зайти под ним и почистить например, логи) а на домашке наоборот выделить весь диск под свои нужды (sudo tune2fs -r0 -m0 /dev/sdX1 - раздел с home)<br /><br />Еще по наблюдениям - swap, да, под гибернацию, но смысла сейчас в ней особо нет. Даже на ноуте - он в спящий режим уходит. Пару раз добивался того, чтобы система начинала активно использовать swap и сразу ловил три кадра в минуту (винт был обычный, не SSD) :) НЕ ОЧЕНЬ! Поэтому для себя принял решение, что swap не использую, просто ставлю достаточно оперативки, а там святой OOM Killer меня рассудит.<br /><br />Если интересно можно включить и swap, причём, опять же, для этого раздел выделять не нужно, давно системы научились подключать его как файл +  zswap/zram (ссылка, где в паре абзацев на пальцах объясняют, что и зачем - <a href="http://linuxoidblog.blogspot.com/2015/12/zram-zswap.html">тык!</a><br /><br />Про бут могу сказать так - выделять нужно столько сколько ядер (разных версий) вам нужно будет одновременно. На одно ядро примерно нужно по 50-55Мб. Насчёт выделения /boot в отдельный раздел - <a href="https://wiki.archlinux.org/index.php/GRUB_(Русский)#Рекомендации_по_установке_загрузчика">вот конкретные инструкции</a>, т.е. практически не нужен.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-225891"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/225891/index.html">#</a>
            2 года, 7 месяцев назад
            
                (отредактировано
                
                    2 года, 7 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>gentux</em><br>Мне сегодня скинули <a href="https://youtu.be/OBCBqEC6sS8">https://youtu.be/OBCBqEC6sS8</a> чувак кеды под мак неплохо замаскировал.<br />Эх, когда то давным-давно <strike>в начале времен</strike> сидел на кедах, то сделал бы.</blockquote>Смысл скриншотов был немного в другом). Для меня арч сейчас исключительно удалённый, на VDS, а с какой системы с ним контактировать - не суть как важно
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-225826"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/225826/index.html">#</a>
            2 года, 7 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Пилю потихоньку...<br /><br /><a href="https://imgur.com/k5hQR6F"><img src="https://i.imgur.com/k5hQR6Fm.png"></a><br /><br /><a href="https://imgur.com/D2CROOe"><img src="https://i.imgur.com/D2CROOem.png"></a>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-223219"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/223219/index.html">#</a>
            2 года, 9 месяцев назад
            
                (отредактировано
                
                    2 года, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            Итак, всё решилось! Хотя и не совсем понятно как это связано.<br /><br />Смотрел на время загрузки (здесь boottime: alias boottime=&#39;sudo systemd-analyze&amp;&amp;sudo systemd-analyze blame --no-pager&#39;)<br /><pre><code>
$ boottime
[sudo] password for nebulosa:
Startup finished in 2.848s (kernel) + 17.872s (userspace) = 20.721s
graphical.target reached after 17.872s in userspace
13.373s systemd-networkd-wait-online.service
10.320s systemd-random-seed.service
 3.341s systemd-logind.service
 1.659s dev-vda1.device
 1.620s systemd-networkd.service
  979ms systemd-journald.service
  945ms systemd-udevd.service
  915ms systemd-timesyncd.service
  284ms wg-quick@wg0.service
  240ms systemd-udev-trigger.service
  229ms iptables.service
  124ms user@1000.service
   82ms systemd-user-sessions.service
   81ms systemd-journal-flush.service
   62ms systemd-sysctl.service
   42ms systemd-tmpfiles-setup-dev.service
   42ms systemd-remount-fs.service
   41ms var-lib-systemd\x2dswap-swapfc-1.swap
   36ms dev-hugepages.mount
   36ms systemd-tmpfiles-setup.service
   35ms dev-mqueue.mount
   35ms systemd-update-utmp.service
   33ms sys-kernel-debug.mount
   32ms kmod-static-nodes.service
   27ms tmp.mount
   23ms user-runtime-dir@1000.service
   21ms sys-kernel-config.mount
   20ms systemd-tmpfiles-clean.service
   10ms proc-sys-fs-binfmt_misc.mount
</code></pre><br />Решил уточнить почему сервис systemd-random-seed.service стартует так долго, нашёл данный тред: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1863155#p1863155">https://bbs.archlinux.org/viewtopic.php?pid=1863155#p1863155</a> там жаловались на низкую энтропию, у меня она была ещё меньше 122 вместо 189. Установил пакет, стартовал, активировал, перезагрузился. Всё заработало, энтропия теперь 1919, сеть поднимается.<br /><br />¯＼_(ツ)_/¯
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-223212"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/223212/index.html">#</a>
            2 года, 9 месяцев назад
            
                (отредактировано
                
                    2 года, 9 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br><blockquote><em>Nebulosa</em><br>достаточно только подключиться через VNC и уже без ввода логина</blockquote>Ну так может и проблема тогда в webui или через что вы там vnc используете</blockquote>Ммм... не понимаю как это связано..<br /><br />Без сети это единственный способ взаимодействовать с хостом. Что вебvnc что другие клиенты делают одно и то же - стучатся на tty1 - пробовал все варианты клиентов какие нашёл.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-223210"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/223210/index.html">#</a>
            2 года, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>eikoninaru</em><br><blockquote><em>Nebulosa</em><br>Uptime: 1 day, 13 hours, 51 mins</blockquote>за день аптайма обновлял ядро?<br />если да перезагрузи машину и попробуй подключиться</blockquote>Несколько раз обновлял и перезагружал, конечно же.<br /><blockquote><em>indeviral</em><br><blockquote><em>Nebulosa</em><br>При логине на tty сеть поднимается. Значит надо как-то переключить чтобы сеть поднималась сама, автоматически</blockquote>Это не проблема<br /><pre><code>loginctl enable-linger &quot;ваш user&quot;</code></pre>Но такие нюансы больше характерны для пользовательских service, системные так себя вести не должны.</blockquote>К сожалению, не помогло.<br /><br /><pre><code>
$ loginctl user-status
nebulosa (1000)
           Since: Fri 2019-11-22 21:52:08 MSK; 4min 14s ago
           State: active
        Sessions: *2
          Linger: yes
            Unit: user-1000.slice
                  ├─session-2.scope
                  │ ├─6623 sshd: nebulosa [priv]
                  │ ├─6641 sshd: nebulosa@pts/0
                  │ ├─6642 -bash
                  │ ├─8203 loginctl user-status
                  │ └─8204 less
                  └─user@1000.service
                    └─init.scope
                      ├─874 /usr/lib/systemd/systemd --user
                      └─878 (sd-pam)

Nov 22 21:52:08 vpshost systemd[874]: Listening on GnuPG cryptographic agent and passphrase cache (access for web browse&gt;
Nov 22 21:52:08 vpshost systemd[874]: Listening on GnuPG cryptographic agent and passphrase cache (restricted).
Nov 22 21:52:08 vpshost systemd[874]: Listening on GnuPG cryptographic agent (ssh-agent emulation).
Nov 22 21:52:08 vpshost systemd[874]: Listening on GnuPG cryptographic agent and passphrase cache.
Nov 22 21:52:08 vpshost systemd[874]: Listening on p11-kit server.
Nov 22 21:52:08 vpshost systemd[874]: Listening on D-Bus User Message Bus Socket.
Nov 22 21:52:08 vpshost systemd[874]: Reached target Sockets.
Nov 22 21:52:08 vpshost systemd[874]: Reached target Basic System.
Nov 22 21:52:08 vpshost systemd[874]: Reached target Main User Target.
Nov 22 21:52:08 vpshost systemd[874]: Startup finished in 87ms.
</code></pre><blockquote><em>52th</em><br>Лично меня смущают эти две подряд идущие записи:<br /><pre><code>Nov 20 09:32:44 vpshost systemd-networkd[296]: ens3: Interface name change detected, ens3 has been renamed to eth0.
Nov 20 09:32:44 vpshost systemd-networkd[296]: eth0: Interface name change detected, eth0 has been renamed to ens3.</code></pre>То есть сначала ens3 переименовывают в eth0, а затем обратно.<br />Может копнуть в эту сторону: переименовать интерфейс вручную?</blockquote><br />Также не помогло, потом вернул обратно. Оба варианта пробовал.<br /><br /><pre><code>
$ journalctl -n 30  -u systemd-networkd
-- Logs begin at Thu 2019-11-21 01:09:36 MSK, end at Fri 2019-11-22 21:40:39 MSK. --
Nov 22 21:24:11 vpshost systemd-networkd[317]: ens3: IPv6 successfully enabled
Nov 22 21:24:11 vpshost systemd-networkd[317]: ens3: Gained carrier
Nov 22 21:24:12 vpshost systemd-networkd[317]: ens3: Gained IPv6LL
Nov 22 21:24:23 vpshost systemd-networkd[317]: wg0: Gained carrier
Nov 22 21:24:23 vpshost systemd-networkd[317]: wg0: Lost carrier
Nov 22 21:34:58 vpshost systemd[1]: Stopping Network Service...
Nov 22 21:34:58 vpshost systemd[1]: systemd-networkd.service: Succeeded.
Nov 22 21:34:58 vpshost systemd[1]: Stopped Network Service.
-- Reboot --
Nov 22 21:35:14 vpshost systemd[1]: Starting Network Service...
Nov 22 21:35:15 vpshost systemd-networkd[302]: Enumeration completed
Nov 22 21:35:15 vpshost systemd[1]: Started Network Service.
Nov 22 21:35:15 vpshost systemd-networkd[302]: ens3: Interface name change detected, ens3 has been renamed to eth0.
Nov 22 21:35:15 vpshost systemd-networkd[302]: eth0: Interface name change detected, eth0 has been renamed to ens3.
Nov 22 21:37:16 vpshost systemd-networkd[302]: wg0: Gained carrier
Nov 22 21:40:07 vpshost systemd-networkd[302]: wg0: Lost carrier
Nov 22 21:40:07 vpshost systemd-networkd[302]: Could not emit changed properties: Transport endpoint is not connected
Nov 22 21:40:07 vpshost systemd-networkd[302]: Could not emit changed properties: Transport endpoint is not connected
Nov 22 21:40:07 vpshost systemd[1]: Stopping Network Service...
Nov 22 21:40:07 vpshost systemd[1]: systemd-networkd.service: Succeeded.
Nov 22 21:40:07 vpshost systemd[1]: Stopped Network Service.
-- Reboot --
Nov 22 21:40:22 vpshost systemd[1]: Starting Network Service...
Nov 22 21:40:23 vpshost systemd-networkd[302]: Enumeration completed
Nov 22 21:40:23 vpshost systemd[1]: Started Network Service.
Nov 22 21:40:23 vpshost systemd-networkd[302]: ens3: Interface name change detected, ens3 has been renamed to eth0.
Nov 22 21:40:23 vpshost systemd-networkd[302]: eth0: Interface name change detected, eth0 has been renamed to ens3.
Nov 22 21:40:23 vpshost systemd-networkd[302]: ens3: IPv6 successfully enabled
Nov 22 21:40:23 vpshost systemd-networkd[302]: ens3: Gained carrier
Nov 22 21:40:25 vpshost systemd-networkd[302]: ens3: Gained IPv6LL
Nov 22 21:40:37 vpshost systemd-networkd[302]: wg0: Gained carrier
</code></pre><br />Заметил ещё одну вещь, теперь достаточно только подключиться через VNC и уже без ввода логина поднимается сеть. Возможно и до этого работало - я не ждал вводил логин сразу, а тут отвлёкся и увидел такое поведение.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-223150"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">Nebulosa</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/223150/index.html">#</a>
            2 года, 9 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/4a/9b/4a9bd66c7a2a170b1585f3b56cdb48de.png" alt="Nebulosa avatar" />
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    10
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    830
                </a>
            </div>
            <div>
                Участник с: 05 марта 2009
            </div>
            
        </td>
        <td class="post-content">
            В логах пусто:<br /><pre><code>
$ journalctl -n 30  -u systemd-networkd
-- Logs begin at Wed 2019-11-20 01:31:42 MSK, end at Wed 2019-11-20 21:42:44 MSK. --
Nov 20 09:24:04 vpshost systemd-networkd[304]: ens3: Gained carrier
Nov 20 09:24:06 vpshost systemd-networkd[304]: ens3: Gained IPv6LL
Nov 20 09:24:17 vpshost systemd-networkd[304]: wg0: Gained carrier
Nov 20 09:24:18 vpshost systemd-networkd[304]: wg0: Lost carrier
Nov 20 09:32:27 vpshost systemd[1]: Stopping Network Service...
Nov 20 09:32:27 vpshost systemd[1]: systemd-networkd.service: Succeeded.
Nov 20 09:32:27 vpshost systemd[1]: Stopped Network Service.
-- Reboot --
Nov 20 09:32:43 vpshost systemd[1]: Starting Network Service...
Nov 20 09:32:44 vpshost systemd-networkd[296]: Enumeration completed
Nov 20 09:32:44 vpshost systemd[1]: Started Network Service.
Nov 20 09:32:44 vpshost systemd-networkd[296]: ens3: Interface name change detected, ens3 has been renamed to eth0.
Nov 20 09:32:44 vpshost systemd-networkd[296]: eth0: Interface name change detected, eth0 has been renamed to ens3.
Nov 20 09:32:44 vpshost systemd-networkd[296]: ens3: IPv6 successfully enabled
Nov 20 09:32:44 vpshost systemd-networkd[296]: ens3: Gained carrier
Nov 20 09:32:46 vpshost systemd-networkd[296]: ens3: Gained IPv6LL
Nov 20 09:32:57 vpshost systemd-networkd[296]: wg0: Gained carrier
Nov 20 09:33:35 vpshost systemd-networkd[296]: wg0: Lost carrier
Nov 20 09:33:35 vpshost systemd[1]: Stopping Network Service...
Nov 20 09:33:35 vpshost systemd[1]: systemd-networkd.service: Succeeded.
Nov 20 09:33:35 vpshost systemd[1]: Stopped Network Service.
-- Reboot --
Nov 20 09:33:52 vpshost systemd[1]: Starting Network Service...
Nov 20 09:33:53 vpshost systemd-networkd[299]: Enumeration completed
Nov 20 09:33:53 vpshost systemd[1]: Started Network Service.
Nov 20 09:33:53 vpshost systemd-networkd[299]: ens3: Interface name change detected, ens3 has been renamed to eth0.
Nov 20 09:33:53 vpshost systemd-networkd[299]: eth0: Interface name change detected, eth0 has been renamed to ens3.
Nov 20 09:33:53 vpshost systemd-networkd[299]: ens3: IPv6 successfully enabled
Nov 20 09:33:53 vpshost systemd-networkd[299]: ens3: Gained carrier
Nov 20 09:33:55 vpshost systemd-networkd[299]: ens3: Gained IPv6LL
Nov 20 09:34:07 vpshost systemd-networkd[299]: wg0: Gained carrier
Nov 20 09:34:06 vpshost systemd-networkd[299]: wg0: Lost carrier
</code></pre><br />при этом логин через SSH каждый раз проходил по схеме описанной выше:<br />пример:<br /><pre><code>➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:23:46]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:23:49]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:01]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:04]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:07]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:10]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:13]
➤ 	 [Abnormal Disconnect 20 Nov 2019, 09:24:17]
➤ 	 [Connected 20 Nov 2019, 09:24:21]</code></pre>Файлы настройки сети стандартные:<br /><br /><pre><code>cat /etc/systemd/network/default.network
[Match]
Name=ens3

[Network]
Gateway=&lt;ip_gateway&gt;
Address=&lt;ip&gt;/24
DNS=1.1.1.1</code></pre>Немного поковырялся, получается что сеть настроена через сокет и каким-то образом (видимо при логине на tty ) сеть поднимается. Значит надо как-то переключить чтобы сеть поднималась сама, автоматически. Попробовал тупо удалить файл сокета и активировать сервис, но без файла сокета ничего не активируется..<br /><br /><pre><code>$ systemctl list-unit-files | grep systemd-network
systemd-network-generator.service          disabled
systemd-networkd-wait-online.service       enabled
systemd-networkd.service                   enabled
systemd-networkd.socket                    enabled </code></pre><br />Какие мысли, в правильном направлении думаю?
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
    </div>
    <div>&nbsp;</div>
    
        <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="index235c.html?page=7" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index4658.html?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index9ba9.html?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexfdb0.html?page=4">4</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexaf4d.html?page=5">5</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexc575.html?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index235c.html?page=7">7</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="indexfdfa.html?page=8">8 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index0b08.html?page=9">9</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1448.html?page=10">10</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index1c8b.html?page=11">11</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="indexce37.html?page=12">12</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index8c93.html?page=13">13</a>
                        </li>
                    
                
            
                
                    <li class="disabled">
                        <span>...</span>
                    </li>
                
            
                
                    
                        <li>
                            <a href="indexb9f4.html?page=82">82</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="index6aff.html?page=83">83</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="index0b08.html?page=9" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

    


        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

</body>

<!-- Mirrored from archlinux.org.ru/forum/users/Nebulosa/posts/?page=8 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 05:45:34 GMT -->
</html>
