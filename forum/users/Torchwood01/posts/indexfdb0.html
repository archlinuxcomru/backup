


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Torchwood01 Сообщения
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://storage.yandexcloud.net/aor-static/static/css/default.css">
    
    
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://storage.yandexcloud.net/aor-static/static/pybb/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
    
        <li>Сообщения</li>
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    <div class="posts">
        
            




<table class="table table-bordered post post-row
       "
       id="post-185720"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185720/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>teplovoz</em><br>Эти адреса по IPv6 , в настройках соединения смотри вкладку - Параметры IPv6 , ниже в способах настройки выбери - игнорировать и сохрани .</blockquote>У меня проблема. Когда я что-то пытаюсь настроить в GUI, эти настройки не сохраняются. То бишь, я жму Ок, а когда снова их открываю - там всё по умолчанию. Использую plasma-nm.
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-185719"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185719/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            Перечитав лог и перепроверив ещё раз, заметил интересную деталь. Есть момент после перевтыкания, когда resolv.conf не обновлённый и порядок правильный. Я увидел, удивился, набрал cat ещё раз, а он уже поменялся.
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-185717"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185717/">#</a>
            5 лет, 5 месяцев назад
            
                (отредактировано
                
                    5 лет, 5 месяцев назад)
                
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>RusWolf</em><br>Torchwood01, ты уже в настройках NM определись, по IPv4 или по IPv6 нужно тебе подключение.<br />У тебя сейчас по двум протоколам шпарит.</blockquote><br />Кажется, и правда в этом проблема. Могу предположить, что два протокола конфликтуют. Потому что когда в resolv сверху ipv6-адреса - всё работает, а когда сверху ipv4 - падает.<br />Только вот я только что вкрутил NetwokManager принудительный ipv6, а он продолжает пихать ipv4... где не так сделал?<br /><br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cabea5b8a9a2bda5a5aefafb8a99818b838b">[email&#160;protected]</a> ~][<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fd89928f9e958a929299cdccbdaeb6bcb4bc">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fe8a918c9d968991919acecfbeadb5bfb7bf">[email&#160;protected]</a> ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=3.42 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=3.53 ms
^C
--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 3.428/3.481/3.534/0.053 ms
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cdb9a2bfaea5baa2a2a9fdfc8d9e868c848c">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="13677c61707b647c7c772322534058525a52">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="61150e130209160e0e05515021322a202820">[email&#160;protected]</a> ~]$ ^C
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e6928994858e91898982d6d7a6b5ada7afa7">[email&#160;protected]</a> ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
From 192.168.1.108 icmp_seq=1 Destination Host Unreachable
^C
--- 8.8.8.8 ping statistics ---
5 packets transmitted, 0 received, +1 errors, 100% packet loss, time 4013ms
pipe 3
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e2968d90818a958d8d86d2d3a2b1a9a3aba3">[email&#160;protected]</a> ~]$
</code></pre><br />NetworkManager.conf<br /><pre><code># Configuration file for NetworkManager.
# See &quot;man 5 NetworkManager.conf&quot; for details.
[main]
plugins=ifupdown,keyfile

[ifupdown]
managed=true

[connection]
ipv6.ip6-privacy=2

[connectivity]
uri=google.com
interval=60
response=Google

</code></pre><br />Конфиг соединения:<br /><pre><code>[connection]
id=Wired connection 1
uuid=b95f3863-57e1-3b2d-8cee-3d1df21012ec
type=ethernet
autoconnect-priority=-100
permissions=

[ethernet]
mac-address=B0:5A:DA:F0:CA:EF
mac-address-blacklist=

[ipv6]
addr-gen-mode=stable-privacy
dns-search=
method=auto
ip6-privacy=2

</code></pre>
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-185713"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185713/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>teplovoz</em><br><blockquote><em>Torchwood01</em><br>cat /usr/bin/resolvconf</blockquote>Не то , вот этот смотри - <pre><code>cat /etc/resolv.conf</code></pre></blockquote><br />Тогда вот такие преображения.<br /><br />Сеть работает:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ccb8a3beafa4bba3a3a8fcfd8c9f878d858d">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7e0a110c1d160911111a4e4f3e2d353f373f">[email&#160;protected]</a> ~]$
</code></pre><br />Провод выдернут (с интервалом в пару секунд):<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="33475c41505b445c5c570302736078727a72">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="53273c21303b243c3c376362130018121a12">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.8.8
</code></pre><br />Провод вставлен обратно, сеть не работает:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5a2e352839322d35353e6a6b1a09111b131b">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
</code></pre><br />Сеть отключена в GUI:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6e1a011c0d061901010a5e5f2e3d252f272f">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
</code></pre><br />Сеть включена в GUI обратно, работает:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ec98839e8f849b838388dcddacbfa7ada5ad">[email&#160;protected]</a> ~]$ sudo cat /etc/resolv.conf
# Generated by resolvconf
nameserver 2a02:2168:208:1::1
nameserver 2a02:2168:208:2::1
nameserver 77.37.251.33
nameserver 77.37.255.30
nameserver 192.168.1.1
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9de9f2effef5eaf2f2f9adacddced6dcd4dc">[email&#160;protected]</a> ~]$
</code></pre>
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-185708"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185708/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>bitrixbiz</em><br>А спустя какое время после перетыкания ты пытаешься достучаться до хостов? У тебя интервал переподключения стоит 1 минута.</blockquote>Пытался и через минуту, и через две и через несколько секунд и сразу после втыкания. Абсолютно индефферентно.<br /><br /><blockquote><em>teplovoz</em><br>Cмотри что есть в resolv.conf , возможно не генерируются DNS .</blockquote>В резолве вот такая громада. К тому же, подключиться не может именно по ip. Были проблемы с http адрессами (а значит - DNS), как починил - хоть убейте, не вспомню.<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3a4e554859524d55555e0a0b7a69717b737b">[email&#160;protected]</a> /]$ cat /usr/bin/resolvconf
#!/bin/sh
# Copyright (c) 2007-2016 Roy Marples
# All rights reserved

# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#     * Redistributions of source code must retain the above copyright
#       notice, this list of conditions and the following disclaimer.
#     * Redistributions in binary form must reproduce the above
#       copyright notice, this list of conditions and the following
#       disclaimer in the documentation and/or other materials provided
#       with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
# A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
# OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
# SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

RESOLVCONF=&quot;$0&quot;
OPENRESOLV_VERSION=&quot;3.9.0&quot;
SYSCONFDIR=/etc
LIBEXECDIR=/usr/lib/resolvconf
VARDIR=/run/resolvconf
RCDIR=
RESTARTCMD=

if [ &quot;$1&quot; = &quot;--version&quot; ]; then
        echo &quot;openresolv $OPENRESOLV_VERSION&quot;
        echo &quot;Copyright (c) 2007-2016 Roy Marples&quot;
        exit 0
fi

# Disregard dhcpcd setting
unset interface_order state_dir

# If you change this, change the test in VFLAG and libc.in as well
local_nameservers=&quot;127.* 0.0.0.0 255.255.255.255 ::1&quot;

dynamic_order=&quot;tap[0-9]* tun[0-9]* vpn vpn[0-9]* ppp[0-9]* ippp[0-9]*&quot;
interface_order=&quot;lo lo[0-9]*&quot;
name_server_blacklist=&quot;0.0.0.0&quot;

# Support original resolvconf configuration layout
# as well as the openresolv config file
if [ -f &quot;$SYSCONFDIR&quot;/resolvconf.conf ]; then
        . &quot;$SYSCONFDIR&quot;/resolvconf.conf
        [ -n &quot;$state_dir&quot; ] &amp;&amp; VARDIR=&quot;$state_dir&quot;
elif [ -d &quot;$SYSCONFDIR/resolvconf&quot; ]; then
        SYSCONFDIR=&quot;$SYSCONFDIR/resolvconf&quot;
        if [ -f &quot;$SYSCONFDIR&quot;/interface-order ]; then
                interface_order=&quot;$(cat &quot;$SYSCONFDIR&quot;/interface-order)&quot;
        fi
fi
IFACEDIR=&quot;$VARDIR/interfaces&quot;
METRICDIR=&quot;$VARDIR/metrics&quot;
PRIVATEDIR=&quot;$VARDIR/private&quot;
EXCLUSIVEDIR=&quot;$VARDIR/exclusive&quot;
LOCKDIR=&quot;$VARDIR/lock&quot;
_PWD=&quot;$PWD&quot;

warn()
{
        echo &quot;$*&quot; &gt;&amp;2
}

error_exit()
{
        echo &quot;$*&quot; &gt;&amp;2
        exit 1
}

usage()
{
        cat &lt;&lt;-EOF
        Usage: ${RESOLVCONF##*/} [options] command [argument]

        Inform the system about any DNS updates.

        Commands:
          -a \$INTERFACE    Add DNS information to the specified interface
                           (DNS supplied via stdin in resolv.conf format)
          -d \$INTERFACE    Delete DNS information from the specified interface
          -h               Show this help cruft
          -i [\$PATTERN]    Show interfaces that have supplied DNS information
                   optionally from interfaces that match the specified
                   pattern
          -l [\$PATTERN]    Show DNS information, optionally from interfaces
                           that match the specified pattern

          -u               Run updates from our current DNS information
          --version        Echo the ${RESOLVCONF##*/} version

        Options:
          -f               Ignore non existent interfaces
          -m metric        Give the added DNS information a metric
          -p               Mark the interface as private
          -x               Mark the interface as exclusive

        Subscriber and System Init Commands:
          -I               Init the state dir
          -r \$SERVICE      Restart the system service
                           (restarting a non-existent or non-running service
                            should have no output and return 0)
          -R               Show the system service restart command
          -v [\$PATTERN]    echo NEWDOMAIN, NEWSEARCH and NEWNS variables to
                           the console
          -V [\$PATTERN]    Same as -v, but only uses configuration in
                           $SYSCONFDIR/resolvconf.conf
        EOF
        [ -z &quot;$1&quot; ] &amp;&amp; exit 0
        echo
        error_exit &quot;$*&quot;
}

# Strip any trailing dot from each name as a FQDN does not belong
# in resolv.conf(5)
# If you think otherwise, capture a DNS trace and you&#39;ll see libc
# will strip it regardless.
# This also solves setting up duplicate zones in our subscribers.
strip_trailing_dots()
{
        local n= d=

        for n; do
                printf &quot;$d%s&quot; &quot;${n%.}&quot;
                d=&quot; &quot;
        done
        printf &quot;\n&quot;
}

private_iface()
{
        local p

        # Allow expansion
        cd &quot;$IFACEDIR&quot;

        # Public interfaces override private ones.
        for p in $public_interfaces; do
                case &quot;$iface&quot; in
                &quot;$p&quot;|&quot;$p&quot;:*) return 1;;
                esac
        done

        if [ -e &quot;$PRIVATEDIR/$iface&quot; ]; then
                return 0
        fi

        for p in $private_interfaces; do
                case &quot;$iface&quot; in
                &quot;$p&quot;|&quot;$p&quot;:*) return 0;;
                esac
        done

        # Not a private interface
        return 1
}

# Parse resolv.conf&#39;s and make variables
# for domain name servers, search name servers and global nameservers
parse_resolv()
{
        local line= ns= ds= search= d= n= newns=
        local new=true iface= private=false p= domain= l= islocal=

        newns=

        while read -r line; do
                case &quot;$line&quot; in
                &quot;# resolv.conf from &quot;*)
                        if ${new}; then
                                iface=&quot;${line#\# resolv.conf from *}&quot;
                                new=false
                                if private_iface &quot;$iface&quot;; then
                                        private=true
                                else
                                        private=false
                                fi
                        fi
                        ;;
                &quot;nameserver &quot;*)
                        islocal=false
                        for l in $local_nameservers; do
                                case &quot;${line#* }&quot; in
                                $l)
                                        islocal=true
                                        echo &quot;LOCALNAMESERVERS=\&quot;\$LOCALNAMESERVERS ${line#* }\&quot;&quot;
                                        break
                                        ;;
                                esac
                        done
                        $islocal || ns=&quot;$ns${line#* } &quot;
                        ;;
                &quot;domain &quot;*)
                        search=&quot;$(strip_trailing_dots ${line#* })&quot;
                        if [ -z &quot;$domain&quot; ]; then
                                domain=&quot;$search&quot;
                                echo &quot;DOMAIN=\&quot;$domain\&quot;&quot;
                        fi
                        ;;
                &quot;search &quot;*)
                        search=&quot;$(strip_trailing_dots ${line#* })&quot;
                        ;;
                *)
                        [ -n &quot;$line&quot; ] &amp;&amp; continue
                        if [ -n &quot;$ns&quot; -a -n &quot;$search&quot; ]; then
                                newns=
                                for n in $ns; do
                                        newns=&quot;$newns${newns:+,}$n&quot;
                                done
                                ds=
                                for d in $search; do
                                        ds=&quot;$ds${ds:+ }$d:$newns&quot;
                                done
                                echo &quot;DOMAINS=\&quot;\$DOMAINS $ds\&quot;&quot;
                        fi
                        echo &quot;SEARCH=\&quot;\$SEARCH $search\&quot;&quot;
                        if ! $private; then
                                echo &quot;NAMESERVERS=\&quot;\$NAMESERVERS $ns\&quot;&quot;
                        fi
                        ns=
                        search=
                        new=true
                        ;;
                esac
        done
}

uniqify()
{
        local result=
        while [ -n &quot;$1&quot; ]; do
                case &quot; $result &quot; in
                *&quot; $1 &quot;*);;
                *) result=&quot;$result $1&quot;;;
                esac
                shift
        done
        echo &quot;${result# *}&quot;
}

dirname()
{
        local dir= OIFS=&quot;$IFS&quot;
        local IFS=/
        set -- <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0b2f4b">[email&#160;protected]</a>
        IFS=&quot;$OIFS&quot;
        if [ -n &quot;$1&quot; ]; then
                printf %s .
        else
                shift
        fi
        while [ -n &quot;$2&quot; ]; do
                printf &quot;/%s&quot; &quot;$1&quot;
                shift
        done
        printf &quot;\n&quot;
}

config_mkdirs()
{
        local e=0 f d
        for f; do
                [ -n &quot;$f&quot; ] || continue
                d=&quot;$(dirname &quot;$f&quot;)&quot;
                if [ ! -d &quot;$d&quot; ]; then
                        if type install &gt;/dev/null 2&gt;&amp;1; then
                                install -d &quot;$d&quot; || e=$?
                        else
                                mkdir &quot;$d&quot; || e=$?
                        fi
                fi
        done
        return $e
}

# With the advent of alternative init systems, it&#39;s possible to have
# more than one installed. So we need to try and guess what one we&#39;re
# using unless overriden by configure.
# Note that restarting a service is a last resort - the subscribers
# should make a reasonable attempt to reconfigre the service via some
# method, normally SIGHUP.
detect_init()
{
        [ -n &quot;$RESTARTCMD&quot; ] &amp;&amp; return 0

        # Detect the running init system.
        # As systemd and OpenRC can be installed on top of legacy init
        # systems we try to detect them first.
        local status=&quot;&quot;
        : ${status:=status}
        if [ -x /bin/systemctl -a -S /run/systemd/private ]; then
                RESTARTCMD=&quot;if /bin/systemctl --quiet is-active \$1.service; then
        /bin/systemctl restart \$1.service;
fi&quot;
        elif [ -x /usr/bin/systemctl -a -S /run/systemd/private ]; then
                RESTARTCMD=&quot;if /usr/bin/systemctl --quiet is-active \$1.service; then
        /usr/bin/systemctl restart \$1.service;
fi&quot;
        elif [ -x /sbin/rc-service -a \
            -s /libexec/rc/init.d/softlevel -o -s /run/openrc/softlevel ]
        then
                RESTARTCMD=&quot;/sbin/rc-service -i \$1 -- -Ds restart&quot;
        elif [ -x /usr/sbin/invoke-rc.d ]; then
                RCDIR=/etc/init.d
                RESTARTCMD=&quot;if /usr/sbin/invoke-rc.d --quiet \$1 status 1&gt;/dev/null 2&gt;&amp;1; then
        /usr/sbin/invoke-rc.d \$1 restart;
fi&quot;
        elif [ -x /sbin/service ]; then
                # Old RedHat
                RCDIR=/etc/init.d
                RESTARTCMD=&quot;if /sbin/service \$1; then
        /sbin/service \$1 restart;
fi&quot;
        elif [ -x /usr/sbin/service ]; then
                # Could be FreeBSD
                RESTARTCMD=&quot;if /usr/sbin/service \$1 $status 1&gt;/dev/null 2&gt;&amp;1; then
        /usr/sbin/service \$1 restart;
fi&quot;
        elif [ -x /bin/sv ]; then
                RESTARTCMD=&quot;/bin/sv status \$1 &gt;/dev/null 2&gt;&amp;1 &amp;&amp; /bin/sv try-restart \$1&quot;
        elif [ -x /usr/bin/sv ]; then
                RESTARTCMD=&quot;/usr/bin/sv status \$1 &gt;/dev/null 2&gt;&amp;1 &amp;&amp; /usr/bin/sv try-restart \$1&quot;
        elif [ -e /etc/arch-release -a -d /etc/rc.d ]; then
                RCDIR=/etc/rc.d
                RESTARTCMD=&quot;if [ -e /var/run/daemons/\$1 ]; then
        /etc/rc.d/\$1 restart;
fi&quot;
        elif [ -e /etc/slackware-version -a -d /etc/rc.d ]; then
                RESTARTCMD=&quot;if /etc/rc.d/rc.\$1 status 1&gt;/dev/null 2&gt;&amp;1; then
        /etc/rc.d/rc.\$1 restart;
fi&quot;
        elif [ -e /etc/rc.d/rc.subr -a -d /etc/rc.d ]; then
                # OpenBSD
                RESTARTCMD=&quot;if /etc/rc.d/\$1 check 1&gt;/dev/null 2&gt;&amp;1; then
        /etc/rc.d/\$1 restart;
fi&quot;
        else
                for x in /etc/init.d/rc.d /etc/rc.d /etc/init.d; do
                        [ -d $x ] || continue
                        RESTARTCMD=&quot;if $x/\$1 $status 1&gt;/dev/null 2&gt;&amp;1; then
        $x/\$1 restart;
fi&quot;
                        break
                done
        fi

        if [ -z &quot;$RESTARTCMD&quot; ]; then
                if [ &quot;$NOINIT_WARNED&quot; != true ]; then
                        warn &quot;could not detect a useable init system&quot;
                        _NOINIT_WARNED=true
                fi
                return 1
        fi
        _NOINIT_WARNED=
        return 0
}

echo_resolv()
{
        local line= OIFS=&quot;$IFS&quot;

        [ -n &quot;$1&quot; -a -f &quot;$IFACEDIR/$1&quot; ] || return 1
        echo &quot;# resolv.conf from $1&quot;
        # Our variable maker works of the fact each resolv.conf per interface
        # is separated by blank lines.
        # So we remove them when echoing them.
        while read -r line; do
                IFS=&quot;$OIFS&quot;
                if [ -n &quot;$line&quot; ]; then
                        # We need to set IFS here to preserve any whitespace
                        IFS=&#39;&#39;
                        printf &quot;%s\n&quot; &quot;$line&quot;
                fi
        done &lt; &quot;$IFACEDIR/$1&quot;
        IFS=&quot;$OIFS&quot;
}

list_resolv()
{
        [ -d &quot;$IFACEDIR&quot; ] || return 0

        local report=false list= retval=0 cmd=&quot;$1&quot; excl=
        shift

        case &quot;$IF_EXCLUSIVE&quot; in
        [Yy][Ee][Ss]|[Tt][Rr][Uu][Ee]|[Oo][Nn]|1)
                if [ -d &quot;$EXCLUSIVEDIR&quot; ]; then
                        cd &quot;$EXCLUSIVEDIR&quot;
                        for i in *; do
                                if [ -f &quot;$i&quot; ]; then
                                        list=&quot;${i#* }&quot;
                                        break
                                fi
                        done
                fi
                excl=true
                cd &quot;$IFACEDIR&quot;
                for i in $inclusive_interfaces; do
                        if [ -f &quot;$i&quot; -a &quot;$list&quot; = &quot;$i&quot; ]; then
                                list=
                                excl=false
                                break
                        fi
                done
                ;;
        *)
                excl=false
                ;;
        esac

        # If we have an interface ordering list, then use that.
        # It works by just using pathname expansion in the interface directory.
        if [ -n &quot;$1&quot; ]; then
                list=&quot;$*&quot;
                $force || report=true
        elif ! $excl; then
                cd &quot;$IFACEDIR&quot;
                for i in $interface_order; do
                        [ -f &quot;$i&quot; ] &amp;&amp; list=&quot;$list $i&quot;
                        for ii in &quot;$i&quot;:* &quot;$i&quot;.*; do
                                [ -f &quot;$ii&quot; ] &amp;&amp; list=&quot;$list $ii&quot;
                        done
                done
                for i in $dynamic_order; do
                        if [ -e &quot;$i&quot; -a ! -e &quot;$METRICDIR/&quot;*&quot; $i&quot; ]; then
                                list=&quot;$list $i&quot;
                        fi
                        for ii in &quot;$i&quot;:* &quot;$i&quot;.*; do
                                if [ -f &quot;$ii&quot; -a ! -e &quot;$METRICDIR/&quot;*&quot; $ii&quot; ]; then
                                        list=&quot;$list $ii&quot;
                                fi
                        done
                done
                if [ -d &quot;$METRICDIR&quot; ]; then
                        cd &quot;$METRICDIR&quot;
                        for i in *; do
                                [ -f &quot;$i&quot; ] &amp;&amp; list=&quot;$list ${i#* }&quot;
                        done
                fi
                list=&quot;$list *&quot;
        fi

        cd &quot;$IFACEDIR&quot;
        retval=1
        for i in $(uniqify $list); do
                # Only list interfaces which we really have
                if ! [ -f &quot;$i&quot; ]; then
                        if $report; then
                                echo &quot;No resolv.conf for interface $i&quot; &gt;&amp;2
                                retval=2
                        fi
                        continue
                fi

                if [ &quot;$cmd&quot; = i -o &quot;$cmd&quot; = &quot;-i&quot; ]; then
                        printf %s &quot;$i &quot;
                else
                        echo_resolv &quot;$i&quot; &amp;&amp; echo
                fi
                [ $? = 0 -a &quot;$retval&quot; = 1 ] &amp;&amp; retval=0
        done
        [ &quot;$cmd&quot; = i -o &quot;$cmd&quot; = &quot;-i&quot; ] &amp;&amp; echo
        return $retval
}

list_remove() {
        local list= e= l= result= found= retval=0

        [ -z &quot;$2&quot; ] &amp;&amp; return 0
        eval list=\&quot;\$$1\&quot;
        shift

        set -f
        for e; do
                found=false
                for l in $list; do
                        case &quot;$e&quot; in
                        $l) found=true;;
                        esac
                        $found &amp;&amp; break
                done
                if $found; then
                        retval=$(($retval + 1))
                else
                        result=&quot;$result $e&quot;
                fi
        done
        set +f
        echo &quot;${result# *}&quot;
        return $retval
}

echo_prepend()
{
        echo &quot;# Generated by resolvconf&quot;
        if [ -n &quot;$search_domains&quot; ]; then
                echo &quot;search $search_domains&quot;
        fi
        for n in $name_servers; do
                echo &quot;nameserver $n&quot;
        done
        echo
}

echo_append()
{
        echo &quot;# Generated by resolvconf&quot;
        if [ -n &quot;$search_domains_append&quot; ]; then
                echo &quot;search $search_domains_append&quot;
        fi
        for n in $name_servers_append; do
                echo &quot;nameserver $n&quot;
        done
        echo
}

replace()
{
        local r= k= f= v= val= sub=

        while read -r keyword value; do
                for r in $replace; do
                        k=&quot;${r%%/*}&quot;
                        r=&quot;${r#*/}&quot;
                        f=&quot;${r%%/*}&quot;
                        r=&quot;${r#*/}&quot;
                        v=&quot;${r%%/*}&quot;
                        case &quot;$keyword&quot; in
                        $k)
                                case &quot;$value&quot; in
                                $f) value=&quot;$v&quot;;;
                                esac
                                ;;
                        esac
                done
                val=
                for sub in $value; do
                        for r in $replace_sub; do
                                k=&quot;${r%%/*}&quot;
                                r=&quot;${r#*/}&quot;
                                f=&quot;${r%%/*}&quot;
                                r=&quot;${r#*/}&quot;
                                v=&quot;${r%%/*}&quot;
                                case &quot;$keyword&quot; in
                                $k)
                                        case &quot;$sub&quot; in
                                        $f) sub=&quot;$v&quot;;;
                                        esac
                                        ;;
                                esac
                        done
                        val=&quot;$val${val:+ }$sub&quot;
                done
                printf &quot;%s %s\n&quot; &quot;$keyword&quot; &quot;$val&quot;
        done
}

make_vars()
{
        local newdomains= d= dn= newns= ns=

        # Clear variables
        DOMAIN=
        DOMAINS=
        SEARCH=
        NAMESERVERS=
        LOCALNAMESERVERS=

        if [ -n &quot;$name_servers&quot; -o -n &quot;$search_domains&quot; ]; then
                eval &quot;$(echo_prepend | parse_resolv)&quot;
        fi
        if [ -z &quot;$VFLAG&quot; ]; then
                IF_EXCLUSIVE=1
                list_resolv -i &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5d791d">[email&#160;protected]</a>&quot; &gt;/dev/null || IF_EXCLUSIVE=0
                eval &quot;$(list_resolv -l &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ae8aee">[email&#160;protected]</a>&quot; | replace | parse_resolv)&quot;
        fi
        if [ -n &quot;$name_servers_append&quot; -o -n &quot;$search_domains_append&quot; ]; then
                eval &quot;$(echo_append | parse_resolv)&quot;
        fi

        # Ensure that we only list each domain once
        for d in $DOMAINS; do
                dn=&quot;${d%%:*}&quot;
                list_remove domain_blacklist &quot;$dn&quot; &gt;/dev/null || continue
                case &quot; $newdomains&quot; in
                *&quot; ${dn}:&quot;*) continue;;
                esac
                newns=
                for nd in $DOMAINS; do
                        if [ &quot;$dn&quot; = &quot;${nd%%:*}&quot; ]; then
                                ns=&quot;${nd#*:}&quot;
                                while [ -n &quot;$ns&quot; ]; do
                                        case &quot;,$newns,&quot; in
                                        *,${ns%%,*},*) ;;
                                        *) list_remove name_server_blacklist \
                                                &quot;${ns%%,*}&quot; &gt;/dev/null \
                                        &amp;&amp; newns=&quot;$newns${newns:+,}${ns%%,*}&quot;;;
                                        esac
                                        [ &quot;$ns&quot; = &quot;${ns#*,}&quot; ] &amp;&amp; break
                                        ns=&quot;${ns#*,}&quot;
                                done
                        fi
                done
                if [ -n &quot;$newns&quot; ]; then
                        newdomains=&quot;$newdomains${newdomains:+ }$dn:$newns&quot;
                fi
        done
        DOMAIN=&quot;$(list_remove domain_blacklist $DOMAIN)&quot;
        SEARCH=&quot;$(uniqify $SEARCH)&quot;
        SEARCH=&quot;$(list_remove domain_blacklist $SEARCH)&quot;
        NAMESERVERS=&quot;$(uniqify $NAMESERVERS)&quot;
        NAMESERVERS=&quot;$(list_remove name_server_blacklist $NAMESERVERS)&quot;
        LOCALNAMESERVERS=&quot;$(uniqify $LOCALNAMESERVERS)&quot;
        LOCALNAMESERVERS=&quot;$(list_remove name_server_blacklist $LOCALNAMESERVERS)&quot;
        echo &quot;DOMAIN=&#39;$DOMAIN&#39;&quot;
        echo &quot;SEARCH=&#39;$SEARCH&#39;&quot;
        echo &quot;NAMESERVERS=&#39;$NAMESERVERS&#39;&quot;
        echo &quot;LOCALNAMESERVERS=&#39;$LOCALNAMESERVERS&#39;&quot;
        echo &quot;DOMAINS=&#39;$newdomains&#39;&quot;
}

force=false
VFLAG=
while getopts a:Dd:fhIilm:pRruvVx OPT; do
        case &quot;$OPT&quot; in
        f) force=true;;
        h) usage;;
        m) IF_METRIC=&quot;$OPTARG&quot;;;
        p) IF_PRIVATE=1;;
        V)
                VFLAG=1
                if [ &quot;$local_nameservers&quot; = \
                    &quot;127.* 0.0.0.0 255.255.255.255 ::1&quot; ]
                then
                        local_nameservers=
                fi
                ;;
        x) IF_EXCLUSIVE=1;;
        &#39;?&#39;) ;;
        *) cmd=&quot;$OPT&quot;; iface=&quot;$OPTARG&quot;;;
        esac
done
shift $(($OPTIND - 1))
args=&quot;$iface${iface:+ }$*&quot;

# -I inits the state dir
if [ &quot;$cmd&quot; = I ]; then
        if [ -d &quot;$VARDIR&quot; ]; then
                rm -rf &quot;$VARDIR&quot;/*
        fi
        exit $?
fi

# -D ensures that the listed config file base dirs exist
if [ &quot;$cmd&quot; = D ]; then
        config_mkdirs &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d5f195">[email&#160;protected]</a>&quot;
        exit $?
fi

# -l lists our resolv files, optionally for a specific interface
if [ &quot;$cmd&quot; = l -o &quot;$cmd&quot; = i ]; then
        list_resolv &quot;$cmd&quot; &quot;$args&quot;
        exit $?
fi

# Restart a service or echo the command to restart a service
if [ &quot;$cmd&quot; = r -o &quot;$cmd&quot; = R ]; then
        detect_init || exit 1
        if [ &quot;$cmd&quot; = r ]; then
                set -- $args
                eval $RESTARTCMD
        else
                echo &quot;$RESTARTCMD&quot;
        fi
        exit $?
fi

# Not normally needed, but subscribers should be able to run independently
if [ &quot;$cmd&quot; = v -o -n &quot;$VFLAG&quot; ]; then
        make_vars &quot;$iface&quot;
        exit $?
fi

# Test that we have valid options
if [ &quot;$cmd&quot; = a -o &quot;$cmd&quot; = d ]; then
        if [ -z &quot;$iface&quot; ]; then
                usage &quot;Interface not specified&quot;
        fi
elif [ &quot;$cmd&quot; != u ]; then
        [ -n &quot;$cmd&quot; -a &quot;$cmd&quot; != h ] &amp;&amp; usage &quot;Unknown option $cmd&quot;
        usage
fi

if [ &quot;$cmd&quot; = a ]; then
        for x in &#39;/&#39; \\ &#39; &#39; &#39;*&#39;; do
                case &quot;$iface&quot; in
                *[$x]*) error_exit &quot;$x not allowed in interface name&quot;;;
                esac
        done
        for x in &#39;.&#39; &#39;-&#39; &#39;~&#39;; do
                case &quot;$iface&quot; in
                [$x]*) error_exit \
                        &quot;$x not allowed at start of interface name&quot;;;
                esac
        done
        [ &quot;$cmd&quot; = a -a -t 0 ] &amp;&amp; error_exit &quot;No file given via stdin&quot;
fi

if [ ! -d &quot;$VARDIR&quot; ]; then
        if [ -L &quot;$VARDIR&quot; ]; then
                dir=&quot;$(readlink &quot;$VARDIR&quot;)&quot;
                # link maybe relative
                cd &quot;${VARDIR%/*}&quot;
                if ! mkdir -m 0755 -p &quot;$dir&quot;; then
                        error_exit &quot;Failed to create needed&quot; \
                                &quot;directory $dir&quot;
                fi
        else
                if ! mkdir -m 0755 -p &quot;$VARDIR&quot;; then
                        error_exit &quot;Failed to create needed&quot; \
                                &quot;directory $VARDIR&quot;
                fi
        fi
fi

if [ ! -d &quot;$IFACEDIR&quot; ]; then
        mkdir -m 0755 -p &quot;$IFACEDIR&quot; || \
                error_exit &quot;Failed to create needed directory $IFACEDIR&quot;
        if [ &quot;$cmd&quot; = d ]; then
                # Provide the same error messages as below
                if ! ${force}; then
                        cd &quot;$IFACEDIR&quot;
                        for i in $args; do
                                warn &quot;No resolv.conf for interface $i&quot;
                        done
                fi
                ${force}
                exit $?
        fi
fi

# An interface was added, changed, deleted or a general update was called.
# Due to exclusivity we need to ensure that this is an atomic operation.
# Our subscribers *may* need this as well if the init system is sub par.
# As such we spinlock at this point as best we can.
# We don&#39;t use flock(1) because it&#39;s not widely available and normally resides
# in /usr which we do our very best to operate without.
[ -w &quot;$VARDIR&quot; ] || error_exit &quot;Cannot write to $LOCKDIR&quot;
: ${lock_timeout:=10}
while true; do
        if mkdir &quot;$LOCKDIR&quot; 2&gt;/dev/null; then
                trap &#39;rm -rf &quot;$LOCKDIR&quot;;&#39; EXIT
                trap &#39;rm -rf &quot;$LOCKDIR&quot;; exit 1&#39; INT QUIT ABRT SEGV ALRM TERM
                echo $$ &gt;&quot;$LOCKDIR/pid&quot;
                break
        fi
        pid=$(cat &quot;$LOCKDIR/pid&quot;)
        if ! kill -0 &quot;$pid&quot;; then
                warn &quot;clearing stale lock pid $pid&quot;
                rm -rf &quot;$LOCKDIR&quot;
                continue
        fi
        lock_timeout=$(($lock_timeout - 1))
        if [ &quot;$lock_timeout&quot; -le 0 ]; then
                error_exit &quot;timed out waiting for lock from pid $pid&quot;
        fi
        sleep 1
done

case &quot;$cmd&quot; in
a)
        # Read resolv.conf from stdin
        resolv=&quot;$(cat)&quot;
        changed=false
        changedfile=false
        # If what we are given matches what we have, then do nothing
        if [ -e &quot;$IFACEDIR/$iface&quot; ]; then
                if [ &quot;$(echo &quot;$resolv&quot;)&quot; != \
                        &quot;$(cat &quot;$IFACEDIR/$iface&quot;)&quot; ]
                then
                        changed=true
                        changedfile=true
                fi
        else
                changed=true
                changedfile=true
        fi

        # Set metric and private before creating the interface resolv.conf file
        # to ensure that it will have the correct flags
        [ ! -d &quot;$METRICDIR&quot; ] &amp;&amp; mkdir &quot;$METRICDIR&quot;
        oldmetric=&quot;$METRICDIR/&quot;*&quot; $iface&quot;
        newmetric=
        if [ -n &quot;$IF_METRIC&quot; ]; then
                # Pad metric to 6 characters, so 5 is less than 10
                while [ ${#IF_METRIC} -le 6 ]; do
                        IF_METRIC=&quot;0$IF_METRIC&quot;
                done
                newmetric=&quot;$METRICDIR/$IF_METRIC $iface&quot;
        fi
        rm -f &quot;$METRICDIR/&quot;*&quot; $iface&quot;
        [ &quot;$oldmetric&quot; != &quot;$newmetric&quot; -a \
            &quot;$oldmetric&quot; != &quot;$METRICDIR/* $iface&quot; ] &amp;&amp;
                changed=true
        [ -n &quot;$newmetric&quot; ] &amp;&amp; echo &quot; &quot; &gt;&quot;$newmetric&quot;

        case &quot;$IF_PRIVATE&quot; in
        [Yy][Ee][Ss]|[Tt][Rr][Uu][Ee]|[Oo][Nn]|1)
                if [ ! -d &quot;$PRIVATEDIR&quot; ]; then
                        [ -e &quot;$PRIVATEDIR&quot; ] &amp;&amp; rm &quot;$PRIVATEDIR&quot;
                        mkdir &quot;$PRIVATEDIR&quot;
                fi
                [ -e &quot;$PRIVATEDIR/$iface&quot; ] || changed=true
                [ -d &quot;$PRIVATEDIR&quot; ] &amp;&amp; echo &quot; &quot; &gt;&quot;$PRIVATEDIR/$iface&quot;
                ;;
        *)
                if [ -e &quot;$PRIVATEDIR/$iface&quot; ]; then
                        rm -f &quot;$PRIVATEDIR/$iface&quot;
                        changed=true
                fi
                ;;
        esac

        oldexcl=
        for x in &quot;$EXCLUSIVEDIR/&quot;*&quot; $iface&quot;; do
                if [ -f &quot;$x&quot; ]; then
                        oldexcl=&quot;$x&quot;
                        break
                fi
        done
        case &quot;$IF_EXCLUSIVE&quot; in
        [Yy][Ee][Ss]|[Tt][Rr][Uu][Ee]|[Oo][Nn]|1)
                if [ ! -d &quot;$EXCLUSIVEDIR&quot; ]; then
                        [ -e &quot;$EXCLUSIVEDIR&quot; ] &amp;&amp; rm &quot;$EXCLUSIVEDIR&quot;
                        mkdir &quot;$EXCLUSIVEDIR&quot;
                fi
                cd &quot;$EXCLUSIVEDIR&quot;
                for x in *; do
                        [ -f &quot;$x&quot; ] &amp;&amp; break
                done
                if [ &quot;${x#* }&quot; != &quot;$iface&quot; ]; then
                        if [ &quot;$x&quot; = &quot;${x% *}&quot; ]; then
                                x=10000000
                        else
                                x=&quot;${x% *}&quot;
                        fi
                        if [ &quot;$x&quot; = &quot;0000000&quot; ]; then
                                warn &quot;exclusive underflow&quot;
                        else
                                x=$(($x - 1))
                        fi
                        if [ -d &quot;$EXCLUSIVEDIR&quot; ]; then
                                echo &quot; &quot; &gt;&quot;$EXCLUSIVEDIR/$x $iface&quot;
                        fi
                        changed=true
                fi
                ;;
        *)
                if [ -f &quot;$oldexcl&quot; ]; then
                        rm -f &quot;$oldexcl&quot;
                        changed=true
                fi
                ;;
        esac

        if $changedfile; then
                printf &quot;%s\n&quot; &quot;$resolv&quot; &gt;&quot;$IFACEDIR/$iface&quot; || exit $?
        elif ! $changed; then
                exit 0
        fi
        unset changed changedfile oldmetric newmetric x oldexcl
        ;;

d)
        # Delete any existing information about the interface
        cd &quot;$IFACEDIR&quot;
        changed=false
        for i in $args; do
                if [ -e &quot;$i&quot; ]; then
                        changed=true
                elif ! ${force}; then
                        warn &quot;No resolv.conf for interface $i&quot;
                fi
                rm -f &quot;$i&quot; &quot;$METRICDIR/&quot;*&quot; $i&quot; \
                        &quot;$PRIVATEDIR/$i&quot; \
                        &quot;$EXCLUSIVEDIR/&quot;*&quot; $i&quot; || exit $?
        done
        if ! ${changed}; then
                # Set the return code based on the forced flag
                ${force}
                exit $?
        fi
        unset changed i
        ;;
esac

case &quot;${resolvconf:-YES}&quot; in
[Yy][Ee][Ss]|[Tt][Rr][Uu][Ee]|[Oo][Nn]|1) ;;
*) exit 0;;
esac

# Try and detect a suitable init system for our scripts
detect_init
export RESTARTCMD RCDIR _NOINIT_WARNED

eval &quot;$(make_vars)&quot;
export RESOLVCONF DOMAINS SEARCH NAMESERVERS LOCALNAMESERVERS
: ${list_resolv:=list_resolv -l}
retval=0

# Run scripts in the same directory resolvconf is run from
# in case any scripts accidentally dump files in the wrong place.
cd &quot;$_PWD&quot;
for script in &quot;$LIBEXECDIR&quot;/*; do
        if [ -f &quot;$script&quot; ]; then
                eval script_enabled=&quot;\$${script##*/}&quot;
                case &quot;${script_enabled:-YES}&quot; in
                [Yy][Ee][Ss]|[Tt][Rr][Uu][Ee]|[Oo][Nn]|1) ;;
                *) continue;;
                esac
                if [ -x &quot;$script&quot; ]; then
                        &quot;$script&quot; &quot;$cmd&quot; &quot;$iface&quot;
                else
                        (set -- &quot;$cmd&quot; &quot;$iface&quot;; . &quot;$script&quot;)
                fi
                retval=$(($retval + $?))
        fi
done
exit $retval
</code></pre>
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-185698"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/Torchwood01/">
                <span class="post-username">Torchwood01</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/185698/">#</a>
            5 лет, 5 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/bd/46/bd46cd262597d3fe37d7d9f9f75ffe78.png" alt="Torchwood01 avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/Torchwood01/topics/">
                    8
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/Torchwood01/posts/">
                    36
                </a>
            </div>
            <div>
                Участник с: 24 марта 2017
            </div>
            
        </td>
        <td class="post-content">
            Как, впрочем, и любой менеджер подключений. При перезагрузке компьюетра или перевтыкании провода, связь с интернетом пропадает. До этого использовал systemd-networkd, в нём связь появлялась снова при перезапуске всей службы, в NetworkManager достаточно переподключиться в GUI (что характерно, перезапуск службы <strong>не</strong> восстанавливает связь в его случае). Оставил его.<br />Пытался решить проблему самыми разными способами - ну вот не хочет подключаться и всё тут.<br /><br />Вот так status выглядит, когда сеть работает:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="94e0fbe6f7fce3fbfbf0a4a5d4c7dfd5ddd5">[email&#160;protected]</a> run]$ sudo systemctl status NetworkManager.service
● NetworkManager.service - Network Manager
   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-03-24 09:35:39 MSK; 1h 44min ago
     Docs: man:NetworkManager(8)
 Main PID: 323 (NetworkManager)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/NetworkManager.service
           └─323 /usr/bin/NetworkManager --no-daemon

мар 24 10:12:56 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339576.1897] policy: set &#39;Wired connection 1&#39; (enp3s0) as default for IPv4 routing and DNS
мар 24 10:12:56 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339576.1898] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 10:12:56 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339576.3218] device (enp3s0): Activation: successful, device activated.
мар 24 10:12:57 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339577.3405] dhcp6 (enp3s0): activation: beginning transaction (timeout in 45 seconds)
мар 24 10:12:57 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339577.3459] policy: set &#39;Wired connection 1&#39; (enp3s0) as default for IPv6 routing and DNS
мар 24 10:12:57 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339577.3460] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;warn&gt;  [1490339622.3311] dhcp6 (enp3s0): request timed out
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3311] dhcp6 (enp3s0): state changed unknown -&gt; timeout
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3312] dhcp6 (enp3s0): canceled DHCP transaction
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3313] dhcp6 (enp3s0): state changed timeout -&gt; done
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d3a7bca1b0bba4bcbcb7e3e2938098929a92">[email&#160;protected]</a> run]$
</code></pre><br />Вот это - после вынимания провода:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0d79627f6e657a6262693d3c4d5e464c444c">[email&#160;protected]</a> run]$ sudo systemctl status NetworkManager.service
● NetworkManager.service - Network Manager
   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-03-24 09:35:39 MSK; 1h 44min ago
     Docs: man:NetworkManager(8)
 Main PID: 323 (NetworkManager)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/NetworkManager.service
           └─323 /usr/bin/NetworkManager --no-daemon

мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3311] dhcp6 (enp3s0): state changed unknown -&gt; timeout
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3312] dhcp6 (enp3s0): canceled DHCP transaction
мар 24 10:13:42 SKAIA NetworkManager[323]: &lt;info&gt;  [1490339622.3313] dhcp6 (enp3s0): state changed timeout -&gt; done
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.3263] device (enp3s0): state change: activated -&gt; unavailable (reason &#39;carrier-changed&#39;) [100 20 40]
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.3265] dhcp4 (enp3s0): canceled DHCP transaction
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.3265] dhcp4 (enp3s0): state changed bound -&gt; done
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.3291] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.4363] dns-mgr: Removing DNS information from /usr/bin/resolvconf
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.5367] manager: NetworkManager state is now CONNECTED_LOCAL
мар 24 11:20:22 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343622.5369] manager: NetworkManager state is now DISCONNECTED
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d7a3b8a5b4bfa0b8b8b3e7e697849c969e96">[email&#160;protected]</a> run]$
</code></pre><br />Втыкаю обратно и пробую достучаться до гугла:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c5b1aab7a6adb2aaaaa1f5f485968e848c84">[email&#160;protected]</a> run]$ sudo systemctl status NetworkManager.service
● NetworkManager.service - Network Manager
   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-03-24 09:35:39 MSK; 1h 45min ago
     Docs: man:NetworkManager(8)
 Main PID: 323 (NetworkManager)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/NetworkManager.service
           └─323 /usr/bin/NetworkManager --no-daemon

мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4625] dhcp4 (enp3s0):   gateway 192.168.1.1
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4629] dhcp4 (enp3s0): state changed unknown -&gt; bound
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4648] device (enp3s0): state change: ip-config -&gt; ip-check (reason &#39;none&#39;) [70 80 0]
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4659] device (enp3s0): state change: ip-check -&gt; secondaries (reason &#39;none&#39;) [80 90 0]
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4668] device (enp3s0): state change: secondaries -&gt; activated (reason &#39;none&#39;) [90 100 0]
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4670] manager: NetworkManager state is now CONNECTED_LOCAL
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4769] manager: NetworkManager state is now CONNECTED_GLOBAL
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4782] policy: set &#39;Wired connection 1&#39; (enp3s0) as default for IPv4 routing and DNS
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.4784] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 11:21:02 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343662.5816] device (enp3s0): Activation: successful, device activated.
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="27534855444f50484843171667746c666e66">[email&#160;protected]</a> run]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
From 192.168.1.107 icmp_seq=1 Destination Host Unreachable
From 192.168.1.107 icmp_seq=2 Destination Host Unreachable
^C
--- 8.8.8.8 ping statistics ---
6 packets transmitted, 0 received, +2 errors, 100% packet loss, time 5050ms
pipe 5
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b6c2d9c4d5dec1d9d9d28687f6e5fdf7fff7">[email&#160;protected]</a> run]$
</code></pre><br />Отключаюсь в GUI:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d3a7bca1b0bba4bcbcb7e3e2938098929a92">[email&#160;protected]</a> run]$ sudo systemctl status NetworkManager.service
● NetworkManager.service - Network Manager
   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-03-24 09:35:39 MSK; 1h 46min ago
     Docs: man:NetworkManager(8)
 Main PID: 323 (NetworkManager)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/NetworkManager.service
           └─323 /usr/bin/NetworkManager --no-daemon

мар 24 11:21:46 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343706.3372] dhcp6 (enp3s0): state changed timeout -&gt; done
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2363] device (enp3s0): state change: activated -&gt; deactivating (reason &#39;user-requested&#39;) [100 110 39]
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2366] manager: NetworkManager state is now DISCONNECTING
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2435] audit: op=&quot;device-disconnect&quot; interface=&quot;enp3s0&quot; ifindex=2 pid=1027 uid=1000 result=&quot;success&quot;
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2444] device (enp3s0): state change: deactivating -&gt; disconnected (reason &#39;user-requested&#39;) [110 30 39]
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2451] dhcp4 (enp3s0): canceled DHCP transaction
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2452] dhcp4 (enp3s0): state changed bound -&gt; done
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.2469] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.3752] dns-mgr: Removing DNS information from /usr/bin/resolvconf
мар 24 11:22:05 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343725.4742] manager: NetworkManager state is now DISCONNECTED
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e2968d90818a958d8d86d2d3a2b1a9a3aba3">[email&#160;protected]</a> run]$
</code></pre><br />Включаюсь обратно, гугл отвечает:<br /><pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="13677c61707b647c7c772322534058525a52">[email&#160;protected]</a> run]$ sudo systemctl status NetworkManager.service
● NetworkManager.service - Network Manager
   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2017-03-24 09:35:39 MSK; 1h 47min ago
     Docs: man:NetworkManager(8)
 Main PID: 323 (NetworkManager)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/NetworkManager.service
           └─323 /usr/bin/NetworkManager --no-daemon

мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.4922] device (enp3s0): state change: ip-check -&gt; secondaries (reason &#39;none&#39;) [80 90 0]
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.4927] device (enp3s0): state change: secondaries -&gt; activated (reason &#39;none&#39;) [90 100 0]
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.4930] manager: NetworkManager state is now CONNECTED_LOCAL
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.4998] manager: NetworkManager state is now CONNECTED_GLOBAL
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.5000] policy: set &#39;Wired connection 1&#39; (enp3s0) as default for IPv4 routing and DNS
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.5001] dns-mgr: Writing DNS information to /usr/bin/resolvconf
мар 24 11:22:41 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343761.6329] device (enp3s0): Activation: successful, device activated.
мар 24 11:22:43 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343763.3423] dhcp6 (enp3s0): activation: beginning transaction (timeout in 45 seconds)
мар 24 11:22:43 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343763.3440] policy: set &#39;Wired connection 1&#39; (enp3s0) as default for IPv6 routing and DNS
мар 24 11:22:43 SKAIA NetworkManager[323]: &lt;info&gt;  [1490343763.3441] dns-mgr: Writing DNS information to /usr/bin/resolvconf
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9de9f2effef5eaf2f2f9adacddced6dcd4dc">[email&#160;protected]</a> run]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=3.37 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=3.38 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=56 time=3.46 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 3.370/3.406/3.466/0.079 ms
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e0948f928388978f8f84d0d1a0b3aba1a9a1">[email&#160;protected]</a> run]$
</code></pre><br />Вот мой конфиг:<br /><pre><code>GNU nano 2.7.5 Файл: /etc/NetworkManager/NetworkManager.conf

# Configuration file for NetworkManager.
# See &quot;man 5 NetworkManager.conf&quot; for details.
[main]
plugins=ifupdown,keyfile

[ifupdown]
managed=true

[connectivity]
uri=google.com
interval=60
response=Google</code></pre><br />ЧЯДНТ? Пользуюсь линем четвёртый день, не бейте тапками <em>сильно</em>.
            
                
                    <div class="post-signature">
                        #### M3B1US LVM C4SC4D3 DOUBL3 R34CH4ROUND ####
                    </div>
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
    </div>
    <div>&nbsp;</div>
    
        <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=3" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=3">3</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=4">4 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

    


        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'747a5ec50d953a9b',m:'SuWRTxu8aeOsCOwWGpc7aabEBoDQIZ.VUTr566AaQog-1662668281-0-AZ8hzCYFU2huWqRRqN+1nNOD4yiMSYrDbdLycg6SuOsTl/8TkaotFg9LueW0fqtII++8THV8ZNGlLGC92ItAmcPtQbNeBI0YxMPp6VxZsx07r5bWolGbS0GJhzzBph8j/6PqwQCsQXQMqkx/+J01VcqmMyQJWn1651Wu+YNlK0Wl',s:[0x8002ec4a58,0xc70eb5f0a2],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
