


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        farwayer Сообщения
    </title>
    <link rel="shortcut icon" href="https://storage.yandexcloud.net/aor-static/static/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/posts/" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="/forum/feeds/topics/" title="Последние темы на форуме" >

    
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="/">
        <img src="https://storage.yandexcloud.net/aor-static/static/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="/news/">Новости</a></li>
    <li class="active"><a href="/forum/">Форум</a></li>
    <li class=""><a href="/blogs/">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="/irc/#chat">IRC</a></li>
      <li class="dropdown">
        <a href="/accounts/login/" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/accounts/login/">Вход</a></li>
          <li><a href="/accounts/register/">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="/messages/inbox/" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="/">ArchLinux.org.ru</a></li>


    <li><a href="/forum/">Начало</a> <span class="divider">/</span></li>
    
    
        <li>Сообщения</li>
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    <div class="posts">
        
            




<table class="table table-bordered post post-row
       "
       id="post-122688"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/122688/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>elsonador</em><br/>Путь до ядра считывает <strong>UEFI</strong>.</blockquote>Да, но efibootmngr у меня сам вставляет нужный слэш, как бы он не был написан. Возможно, в старых версиях этого не происходило.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-122629"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/122629/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Начиная с версии ядра 3.8.0 можно использовать как прямые, так и обратные слэши.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-122577"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/122577/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Кстати, для тех, кому религия не позволяет хранить ядро и initram <strong>в корне UEFI раздела</strong>, а делать костыли с systemd, cron'ом или хуком mkinitcpio для синхронизации ядра при его обновлении не хочется, есть еще один способ.<br/>Можно хранить ядро в <strong>ESP\EFI\arch</strong>, как описано в вики и спецификации UEFI, и монтировать этот путь на /boot через <strong>mount --bind</strong>.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-122575"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/122575/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>elsonador</em><br/>Ну дык ядро и встроенной поддержки <strong>FAT</strong> не имеет. Как оно будет грузить <strong>initramfs</strong>?</blockquote>Да, верно. Но подгрузкой initramfs занимается <strong>EFI STUB</strong>, который почти наверняка делает это через функции <a href="http://wiki.phoenix.com/wiki/index.php/EFI_FILE_PROTOCOL">EFI_FILE_PROTOCOL</a> в UEFI, такие как <em>Open()</em> и <em>Read()</em>. По крайней мере, я бы делал именно так. Таким образом, если в UEFI добавить драйвер чтения ext4, то загружать initram можно было бы даже с другого раздела с этой ФС. Но такой способ EFI STUB не поддерживает - initram <a href="http://lxr.free-electrons.com/source/Documentation/x86/efi-stub.txt"><strong>должен</strong></a> находиться на разделе UEFI. Да и смысла оставлять initram на другом разделе, если ядро на разделе UEFI, нет.<br/><br/><blockquote><em>elsonador</em><br/><blockquote><em>farwayer</em><br/>Так и должно быть. Там UTF-16.</blockquote>А вдруг не должно?</blockquote>Прошу прощения, там на самом деле не <strong>UTF-16</strong>, а его предшественник - <strong>UCS-2</strong>. Но смысла это не меняет.<br/>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-122432"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/122432/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>elsonador</em><br/>Автор, а автор? Ты сам-то свою инструкцию пробовал?</blockquote>Нет, это полет моей больной фантазии %)<br/><br/><blockquote><em>elsonador</em><br/>Я краем уха слышал, что UEFI does not support loading a separate initramfs. Перевод нужен?</blockquote>Что, простите? UEFI вообще знать не знает ни про какие initramfs, ядра и т.п. творения создателей ОС. Он знает, как найти и передать управление на UEFI-загрузчик с прописанными в NVRAM параметрами. Все остальное не его дело. Если имелось в виду, что ядро не может загрузить образ initramfs с другого раздела где ФС, которую не поддерживает ядро, то, отчасти, это верно. Можно собрать ядро с поддержкой этой ФС, но тогда смысла в initramfs вообще нету. Либо добавить драйвер ext4 в UEFI (но такой вариант я не пробовал и не уверен, что ядро его поддерживает).<br/><br/>Если бы внимательно читали мою заметку, то поняли бы, что и ядро, и initramfs находятся на разделе UEFI.<br/>Последовательность загрузки:<br/>1. UEFI считывает BootXXXX запись и достает из нее путь к загрузчику-ядру (/vmlinuz-linux) и параметры для него (initrd=/initramfs-linux.img root=PARTUUID=087e1626-ccc5-468a-ab8d-ca02f8f04d14 ro add_efi_memmap)<br/>2. UEFI передает управление ядру<br/>3. Ядро подгружает initramfs с раздела UEFI (initrd=/initramfs-linux.img)<br/>4. Теперь ядро спокойно может читать rootfs с ext4 (или что там у вас) и грузиться дальше<br/><br/>Хотя бы рассказали, что именно у вас не работает.<br/><br/><blockquote><em>elsonador</em><br/>Откуда там точки образовались?<br/></blockquote>Так и должно быть. Там UTF-16.<br/><br/><blockquote><em>Natrio</em><br/>Просто пересказываю, что выяснил – разработчики ядра приняли все меры к тому, чтобы ядро Linux при желании МОЖНО было даже "подсунуть вместо загрузчика" UEFI.</blockquote>Как раз про это и заметка.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-121229"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/121229/">#</a>
            8 лет, 10 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            На хабре вышла довольно подробная <a href="http://habrahabr.ru/post/197438/">статья</a> про загрузку через EFI Boot Stub.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-119404"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/119404/">#</a>
            8 лет, 11 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Первым пунктом же <a href="https://wiki.archlinux.org/index.php/Openbox_Themes_and_Apps#Application_launchers">https://wiki.archlinux.org/index.php/Openbox_Themes_and_Apps#Application_launchers</a> ...
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-119235"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/119235/">#</a>
            8 лет, 12 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            Прошу прощения, что некропощу в своей же теме, но есть дельный совет: <strong>никогда не подрубайте холодильник к тому же удлинителю, что и комп! </strong> :)
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-119234"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/119234/">#</a>
            8 лет, 12 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>Natrio</em><br/>Это правда работает быстрее?</blockquote>Если выключена обратная совместимость с BIOS - то да. У меня -3 секунды к загрузке. Но вообще это зависит от материнки и конкретной реализации UEFI. Ускорение достигается как раз за счет быстрой инициализации устройств.<br/><blockquote><em>Natrio</em><br/>И да, у вас явно деструктивная рекомендация в конце – если вы удалите каталог /boot , смонтировать в него раздел явно не получится.</blockquote>Это от недосыпа было... Когда перечитывал, понял, какую фигню написал :)<br/><blockquote><em>cucullus</em><br/>Зачем всё это, зачееееем? (песня какая-то такая была)</blockquote>А незачем. Просто новый комп настраивал и решил поковырять. Чуть быстрее загружаться стал. Минус один пакет в системе (syslinux).<br/><blockquote><em>cucullus</em><br/>Я уже :) Кто со мной?</blockquote>Вижу, ни у одного меня свободный график ;) Присоединился бы, но предпочитаю это дело real2real xD<br/>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-119202"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="/forum/users/farwayer/">
                <span class="post-username">farwayer</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="/forum/post/119202/">#</a>
            8 лет, 12 месяцев назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
        <img src="https://storage.yandexcloud.net/aor-static/media/cache/16/f5/16f5cbfb000c892f9ee33b90af9e06e0.png" alt="farwayer avatar" />
    
</div>

            <div>
                Темы:
                <a href="/forum/users/farwayer/topics/">
                    12
                </a>
            </div>
            <div>
                Сообщения:
                <a href="/forum/users/farwayer/posts/">
                    181
                </a>
            </div>
            <div>
                Участник с: 30 апреля 2010
            </div>
            
        </td>
        <td class="post-content">
            <em>*Предполагается, что ты знаком с основами UEFI и принципом загрузки ОС через него. Это не мануал, а кратко скомпонованные факты. Если не знаешь, как сделать GPT таблицу разделов или отформатировать EFI раздел - кури <a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29">вики</a>.<br/>*В заметке не будет пространных размышлений о плюсах и минусах UEFI - думайте сами, решайте сами, иметь или не иметь (с).<br/></em><br/>Итак, приступим.<br/>Что нам нужно, для того, чтобы загрузиться через UEFI (кроме совместимой материнки)?<br/><ol><li> GPT таблица разделов.<br/></li><li> Отформатированный FAT32 (FAT12, FAT16, но это - старье) раздел со специальной сигнатурой C12A7328-F81F-11D2-BA4B-00A0C93EC93B (EFI System Partition - <strong>ESP</strong>).<br/></li><li> UEFI-совместимый бинарник, расположенный на этом разделе. Почему-то считается, что он должен лежать по пути <u>\EFI\${VENDOR}\${LOADER}.efi</u>. Как мы убедимся позже - необязательное условие. Бинарник должен быть правильной платформы: загрузить x86 на x86_64 процессоре не получится.<br/></li><li> Опционально: запись <u>BootXXXX</u> в параметрах UEFI, которая указывает на нужный бинарник. По умолчанию загружается <u>\EFI\BOOT\boot[architecture name].efi</u>.<br/></li></ol>В вики <a href="https://wiki.archlinux.org/index.php/UEFI_Bootloaders">описаны</a> 3 способа загрузки linux через UEFI:<br/><ol><li> Внешний загрузчик (rEFInd, gummiboot, grub2, syslinux&gt;=6.x, ...), расположенный на ESP разделе - не наш случай. Мы ведь не хотим загрузчик, правда? ;)<br/></li><li> Через UEFI Shell - специальный шелл, который может быть уже встроен в UEFI или устанавливаться отдельно на ESP раздел (<a href="https://sourceforge.net/apps/mediawiki/tianocore/index.php?title=Welcome%29.">http://sourceforge.net/apps/mediawiki/tianocore/index.php?title=Welcome).</a> Для этого нам нужно выполнить команды:<br/><div class="code"><pre>&gt; fs0:
&gt; cd \EFI\arch
&gt; vmlinuz-arch.efi root=PARTUUID=3518bb68-d01e-45c9-b973-0b5d918aae96 ro rootfstype=ext4 add_efi_memmap initrd=EFI/arch/initramfs-arch.img</pre></div>Или создать специальный MS-DOS подобный скрипт <u>archlinux.nsh</u> в корне ESP:<div class="code"><pre>echo -on
\EFI\arch\vmlinuz-arch.efi root=PARTUUID=3518bb68-d01e-45c9-b973-0b5d918aae96 rootfstype=ext4 add_efi_memmap initrd=EFI/arch/initramfs-arch.img</pre></div>Тогда можно будет делать так:<br/><div class="code"><pre>fs0:
archlinux</pre></div>Если назвать этот скрипт <u>startup.nsh</u> (о чем вики скромно умалчивает), то скрипт будет автоматически исполнен через 5 сек (ваш Кэп).<br/>Последовательность загрузки в этом случае: UEFI -&gt; UEFI Shell -&gt; скрипт -&gt; ядро.<br/>Слишком много сущностей, тебе не кажется? Еще и ждать. А мы ведь любим <a href="https://ru.wikipedia.org/wiki/KISS_%28%D0%BF%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF%29">целоваться</a>... Вывод: в пень!<br/></li><li> Создать запись <u>BootXXXX</u> (XXXX - от 0x0000 до 0xFFFF) в EFI vars с помощью efibootmgr и напрямую передавать управление ядру.<br/></li></ol>Для того, чтобы пункты 2 и 3 работали, ядро должно быть собрано с особыми <a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29#.D0.9F.D0.BE.D0.B4.D0.B4.D0.B5.D1.80.D0.B6.D0.BA.D0.B0_UEFI_.D0.B2_.D1.8F.D0.B4.D1.80.D0.B5_Linux">параметрами</a>, т.е. прикидываться UEFI бинарником. Эти параметры были добавлены в Linux&gt;=3.3. Они включены по умолчанию в ядро archlinux и некоторые другие ядра из AUR и сторонних реп (linux-ck, например). Тут вырисовывается очевидное ограничение: таким образом не загрузишь x86 систему на x86_64 процессоре (помнишь про это ограничение бинарника UEFI?).<br/><br/>Описывать я буду как раз 3 способ. Что нам советует <a href="https://wiki.archlinux.org/index.php/UEFI_Bootloaders#Setting_up_EFISTUB">вики</a> для 2 и 3 случая? Только не спеши повторять!<br/><ol><li> Создать ESP раздел.<br/></li><li> Смонтировать его на <u>/boot/efi</u><br/></li><li> Создать директорию <u>/boot/efi/EFI/arch/</u><br/></li><li> Скопировать ядро и initramfs на ESP раздел<br/><div class="code"><pre>/boot/vmlinuz-linux -&gt; /boot/efi/EFI/arch/vmlinuz-arch.efi
/boot/initramfs-linux.img -&gt; /boot/efi/EFI/arch/initramfs-arch.img
/boot/initramfs-linux-fallback.img -&gt; /boot/efi/EFI/arch/initramfs-arch-fallback.img</pre></div></li></ol>Теперь ESP раздел у нас подготовлен. Или нет? А что будет, если ядро обновиться? Опять руками копировать? У вики есть <a href="https://wiki.archlinux.org/index.php/UEFI_Bootloaders#Sync_EFISTUB_Kernel">3 способа</a> для тебя, парень (и да простят меня милые девушки)!<br/><ol><li> Systemd юнит и path-файл для его активации (следит за изменением файла), которые зачем-то предлагают сохранить в <u>/usr/lib/systemd/system/</u>, вместо предназначенного для пользовательских файлов <u>/etc/systemd/system/</u> (святотатство-то какое!).<br/></li><li> lncron<br/></li><li> mkinitcpio hook<br/></li></ol>Вроде, теперь все хорошо. А в <u>fstab</u> кто за тебя ESP раздел прописывать будет?! Опять вики молчит, как партизанка.<br/><br/>Объединяет эти 3 способа только то, что они - <strong>костыли</strong>! Это не наш метод, бро! Ты ведь не следовали этим советам, правда? ;)<br/>А что, если сгрузить ядро в корень ESP раздела и монтировать его как <u>/boot</u>, прописав его в BootXXXX запись не как <u>\EFI\arch\vmlinuz-arch.efi</u>, а <u>\vmlinuz-linux</u>? Тогда при обновлении ядра, оно автоматически сгрузиться на ESP раздел, без каких-либо танцев с бубном. А будет ли это работать? <a href="http://www.uefi.org/specs/download">Спека по UEFI</a> (12.3.1.3 Directory Structure) говорит, что бинарники должны располагаться в <u>\EFI\${VENDOR}</u>, иначе возможны коллизии имен. Но мы-то сами знаем, что и где у нас лежит на ESP разделе! Как-нибудь уж сами разберемся с коллизиями, чай не маленькие дети. Тест на 2 материнках от разных производителей (Asus P8Z77-I DELUXE и Gigabyte B75-N) показал, что способ вполне себе рабочий. В самом деле: нафик UEFI проверять путь на валидность? Если кто-то его прописал - значит попробуем загрузить!<br/><br/>Итак, план действий:<br/><ol><li> Копируем vmlinuz-linux, initramfs-linux.img и initramfs-linux-fallback.img (по желанию) в /tmp:<br/><div class="code"><pre>cp /boot/{vmlinuz-linux,initramfs-linux.img,initramfs-linux-fallback.img} /tmp/</pre></div></li><li>Монтируем ESP раздел на <u>/boot</u>:<br/><div class="code"><pre>mount &lt;UEFI Partition&gt; /boot</pre></div></li><li>Перемещаем из /tmp на ESP:<br/><div class="code"><pre>mv /tmp/{vmlinuz-linux,initramfs-linux.img,initramfs-linux-fallback.img} /boot/</pre></div></li><li>Добавляем запись в <u>/etc/fstab</u>:<br/><div class="code"><pre>UUID=be445405-0426-4e59-8614-c9873d685419 /boot     	vfat      	rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro	0 2</pre></div>где <u>be445405-0426-4e59-8614-c9873d685419</u> - <strong>UUID</strong> раздела (узнать можно <u>ls -l /dev/disk/by-uuid/</u>).<br/></li><li> Добавляем BootXXXX запись с помощью <u>efibootmgr</u>:<br/><div class="code"><pre># modprobe efivars
# efibootmgr -c -d /dev/sdX -p Y -l /vmlinuz-linux -L "Arch Linux" -u "initrd=/initramfs-linux.img root=PARTUUID=087e1626-ccc5-468a-ab8d-ca02f8f04d14 ro add_efi_memmap"</pre></div>где sdX - диск с ESP, Y - номер ESP раздела, 087e1626-ccc5-468a-ab8d-ca02f8f04d14 - <strong>PARTUUID (≠UUID)</strong> root-раздела (<u>ls -l /dev/disk/by-partuuid</u>). Для fallback, если нужно, аналогично.<br/>Кстати, тут в вики очередной фейл: они указывают <u>"$(cat /proc/cmdline)"</u>, в качестве командной строки ядра. При загрузки в не-UEFI режиме или с флешки установщика - там будет не то, что нам нужно!<br/><strong>АХТУНГ:</strong> До версии ядра 3.8 нужно использовать <strong>обратные слэши (\)</strong> в пути к initramfs. Т.е. путь долже выглядеть так: initrd=\\initramfs-linux.img<br/></li><li> Опционально: при успешной загрузке сносим ставшие ненужными файлы с корня:<br/><div class="code"><pre>umount /boot
rm /boot/{vmlinuz-linux,initramfs-linux.img,initramfs-linux-fallback.img}
mount /boot</pre></div></li><li>Выпиваем пару литров божественного компота из хмеля и солода (или морковного сока, по желанию)<br/></li></ol>Все.<br/><br/><strong>UPD:</strong> На хабре вышла довольно подробная <a href="http://habrahabr.ru/post/197438/">статья</a> про загрузку через EFI Boot Stub.<br/><br/><strong>UPD2:</strong> Кстати, для тех, кому религия не позволяет хранить ядро и initram в корне UEFI раздела, а делать костыли с systemd, cron'ом или хуком mkinitcpio для синхронизации ядра при его обновлении не хочется, есть еще один способ.<br/>Можно хранить ядро в <strong>ESP\EFI\arch</strong>, как описано в вики и спецификации UEFI, и монтировать этот путь на /boot через <strong>mount --bind</strong>.
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
    </div>
    <div>&nbsp;</div>
    
        <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="?page=9" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=2">2</a>
                        </li>
                    
                
            
                
                    <li class="disabled">
                        <span>...</span>
                    </li>
                
            
                
                    
                        <li>
                            <a href="?page=5">5</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=6">6</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=7">7</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=8">8</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=9">9</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="?page=10">10 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=11">11</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=12">12</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=13">13</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=14">14</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=15">15</a>
                        </li>
                    
                
            
                
                    <li class="disabled">
                        <span>...</span>
                    </li>
                
            
                
                    
                        <li>
                            <a href="?page=18">18</a>
                        </li>
                    
                
            
                
                    
                        <li>
                            <a href="?page=19">19</a>
                        </li>
                    
                
            

            
                <li class="next">
                    <a href="?page=11" aria-label="следующая страница">
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            
        </ul>
    </nav>


</div>

    


        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script>(function(){var js = "window['__CF$cv$params']={r:'747a703d295a16a7',m:'vmuWwTqj1O27bAcWz8.SGtOWkj2DdHoDujkUCivKMT8-1662668993-0-ASFrMdfMUa2hvkXaYAK82dBpV1RU5eEZ0IOCGbLpv8XMB5nNi85RtUo16z+Dpf/U//RQ3Zyj5rjF3czy28+aptyP0YCO9iyNf2xo98uG7GadknozVSuqryVFgP0Xw5ORBUyJYHH+e4D7s9fMWJvlcyxWSfhxSTY1+pQWZfIZA96D',s:[0xd476f5805d,0xf3116cbd68],u:'/cdn-cgi/challenge-platform/h/g'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/h/g/scripts/alpha/invisible.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
