


<!DOCTYPE html>
<html lang="ru">

<!-- Mirrored from archlinux.org.ru/forum/users/viktor1962/posts/?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 11:32:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        viktor1962 Сообщения
    </title>
    <link rel="shortcut icon" href="https://archlinuxcomru.github.io/backup/src/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://archlinuxcomru.github.io/backup/src/css/bootstrap.css">
    
    
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://archlinuxcomru.github.io/backup/src/js/pybbjs.js"></script>
    
    
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" href="../../../feeds/posts/index.html" title="Последние сообщения на форуме" >
    <link rel="alternate" type="application/atom+xml" href="../../../feeds/topics/index.html" title="Последние темы на форуме" >

    
</head>
<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid wrapper">
        
    
<ul class="nav navbar-nav">
    <li>
      <a class="navbar-brand" href="../../../../index.html">
        <img src="https://archlinuxcomru.github.io/backup/src/logo.png" alt="" style="opacity: .7; vertical-align: top">
      </a>
    </li>
    <li class=""><a href="../../../../news/index.html">Новости</a></li>
    <li class="active"><a href="../../../index.html">Форум</a></li>
    <li class=""><a href="../../../../blogs/index.html">Блоги</a></li>
    <li><a href="https://archlinux.org/">Eng</a></li>
    <li><a href="https://wiki.archlinux.org/index.php/Main_page_(Русский)">Wiki</a></li>
    <li class="dropdown">
      <a href="https://www.archlinux.org/packages/" class="dropdown-toggle" data-toggle="dropdown">
        Пакеты
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li><a href="https://www.archlinux.org/packages/">Официальные репозитории</a></li></li>
        <li><a href="https://aur.archlinux.org/?setlang=ru">AUR</a></li>
      </ul>
    <li><a href="https://archlinux.org/download/">Скачать</a></li>
</ul>

<form class="navbar-form navbar-left" role="search" action="https://www.google.ru/cse">
    <input type="hidden" name="cx" value="018428664132160064944:ntsma9ch2ug"/>
    <input type="hidden" name="ie" value="UTF-8"/>
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Что ищем?">
      <span class="input-group-btn">
        <button type="submit" name="sa" class="btn btn-default">Найти</button>
      </span>
    </div>
</form>

<ul class="nav navbar-nav navbar-right">


    
      <li><a href="../../../../irc/index.html#chat">IRC</a></li>
      <li class="dropdown">
        <a href="../../../../accounts/login/index.html" class="dropdown-toggle" data-toggle="dropdown">
          Профиль
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="../../../../accounts/login/index.html">Вход</a></li>
          <li><a href="../../../../accounts/register/index.html">Регистрация</a></li>
        </ul>
      </li>
    
</ul>


    </div>
</nav>



<div class="modal fade" id='new_pm_notify' role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content navbar-default">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Новые личные сообщения</h4>
      </div>
      <div class="modal-body">
        <a href="../../../../messages/inbox/index.html" class="center-block btn btn-primary">Перейти в папку Входящие <span class="badge"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid wrapper">
    <div class="row">
        <div class="col-md-12">
            
    
        
<ul class="breadcrumb">
    

    <li><a href="../../../../index.html">ArchLinux.org.ru</a></li>


    <li><a href="../../../index.html">Начало</a> <span class="divider">/</span></li>
    
    
        <li>Сообщения</li>
    
</ul>

    

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            
    <div class="row">
        <div class="col-md-12 forum">
            
    <div class="posts">
        
            




<table class="table table-bordered post post-row
       "
       id="post-219623"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">viktor1962</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/219623/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    15
                </a>
            </div>
            <div>
                Участник с: 14 апреля 2019
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>vs220</em><br>python-dbus стоит?<br /><blockquote><em>viktor1962</em><br>: No module named &#39;dbus&#39;</blockquote></blockquote><br /><pre><code>#!/usr/bin/env python
# -*- Mode: Python; coding: utf-8; indent-tabs-mode: nil; tab-width: 4 -*-
#   Catfish - a versatile file searching tool
#   Copyright (C) 2007-2012 Christian Dywan &lt;<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="25464d574c56514c444b6551524a514a445651560b4140">[email&#160;protected]</a>&gt;
#   Copyright (C) 2012-2019 Sean Davis &lt;<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="d2b0bea7b7a1b3b0a0b792aab4b1b7fcbda0b5">[email&#160;protected]</a>&gt;
#
#   This program is free software: you can redistribute it and/or modify it
#   under the terms of the GNU General Public License version 2, as published
#   by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranties of
#   MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
#   PURPOSE.  See the GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License along
#   with this program.  If not, see &lt;<a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>&gt;.

import optparse
import sys

from locale import gettext as _

import gi
gi.require_version(&#39;Gtk&#39;, &#39;3.0&#39;)  # noqa

from gi.repository import Gtk

[b]from catfish import CatfishWindow[/b][u][/u] [i]Вот он ссылку даёт на[/i][u][/u]

from catfish_lib import set_up_logging, get_version, check_x11_session

import signal
def parse_options():
    &quot;&quot;&quot;Support for command line options&quot;&quot;&quot;
    usage = _(&quot;Usage: %prog [options] path query&quot;)
    parser = optparse.OptionParser(version=&quot;catfish %s&quot; % get_version(),
                                   usage=usage)
    parser.add_option(
        &quot;-v&quot;, &quot;--verbose&quot;, action=&quot;count&quot;, dest=&quot;verbose&quot;,
        help=_(&quot;Show debug messages (-vv will also debug catfish_lib)&quot;))

    parser.add_option(&#39;&#39;, &#39;--large-icons&#39;, action=&#39;store_true&#39;,
                      dest=&#39;icons_large&#39;, help=_(&#39;Use large icons&#39;))
    parser.add_option(&#39;&#39;, &#39;--thumbnails&#39;, action=&#39;store_true&#39;,
                      dest=&#39;thumbnails&#39;, help=_(&#39;Use thumbnails&#39;))
    parser.add_option(&#39;&#39;, &#39;--iso-time&#39;, action=&#39;store_true&#39;,
                      dest=&#39;time_iso&#39;, help=_(&#39;Display time in ISO format&#39;))
    # Translators: Do not translate PATH, it is a variable.
    parser.add_option(&#39;&#39;, &#39;--path&#39;, help=_(&quot;Set the default search path&quot;))
    parser.add_option(&#39;&#39;, &#39;--exact&#39;, action=&#39;store_true&#39;,
                      help=_(&#39;Perform exact match&#39;))
    parser.add_option(&#39;&#39;, &#39;--hidden&#39;, action=&#39;store_true&#39;,
                      help=_(&#39;Include hidden files&#39;))
    parser.add_option(&#39;&#39;, &#39;--fulltext&#39;, action=&#39;store_true&#39;,
                      help=_(&#39;Perform fulltext search&#39;))
    parser.add_option(&#39;&#39;, &#39;--start&#39;, action=&#39;store_true&#39;,
                      help=_(&quot;If path and query are provided, start searching &quot;
                             &quot;when the application is displayed.&quot;))
    parser.set_defaults(icons_large=0, thumbnails=0, time_iso=0,
                        path=None, start=False,
                        exact=0, hidden=0, fulltext=0, file_action=&#39;open&#39;)

    (options, args) = parser.parse_args()

    set_up_logging(options)
    return (options, args)
def main():
    &#39;constructor for your class instances&#39;
    options, args = parse_options()

    if not check_x11_session():
        sys.stderr.write(_(&#39;Try GDK_BACKEND=x11 {0}\n&#39;.format(sys.argv[0])))
        sys.exit(0)

    # Run the application.
    window = CatfishWindow.CatfishWindow()
    window.parse_options(options, args)
    window.show()

    # Allow application shutdown with Ctrl-C in terminal
    signal.signal(signal.SIGINT, signal.SIG_DFL)
    Gtk.main()</code></pre><br /><strong>И тут как бы есть</strong> <u>dbus</u><br /><pre><code>#!/usr/bin/env python
# -*- Mode: Python; coding: utf-8; indent-tabs-mode: nil; tab-width: 4 -*-
#   Catfish - a versatile file searching tool
#   Copyright (C) 2007-2012 Christian Dywan &lt;<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="90f3f8e2f9e3e4f9f1fed0e4e7ffe4fff1e3e4e3bef4f5">[email&#160;protected]</a>&gt;
#   Copyright (C) 2012-2019 Sean Davis &lt;<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="6f0d031a0a1c0e0d1d0a2f17090c0a41001d08">[email&#160;protected]</a>&gt;
#
#   This program is free software: you can redistribute it and/or modify it
#   under the terms of the GNU General Public License version 2, as published
#   by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranties of
#   MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
#   PURPOSE.  See the GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License along
#   with this program.  If not, see &lt;<a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>&gt;.

import datetime
import hashlib
import logging
import mimetypes
import os
import subprocess
import time
from locale import gettext as _
from shutil import copy2, rmtree
from xml.sax.saxutils import escape

# Thunar Integration
import dbus [b]Итут есть он((([/b]
import urllib

import pexpect
import gi
gi.require_version(&#39;GLib&#39;, &#39;2.0&#39;)
gi.require_version(&#39;GObject&#39;, &#39;2.0&#39;)
gi.require_version(&#39;Pango&#39;, &#39;1.0&#39;)
gi.require_version(&#39;Gdk&#39;, &#39;3.0&#39;)
gi.require_version(&#39;GdkPixbuf&#39;, &#39;2.0&#39;)
gi.require_version(&#39;Gtk&#39;, &#39;3.0&#39;)
from gi.repository import GLib, GObject, Pango, Gdk, GdkPixbuf, Gtk

from catfish.AboutCatfishDialog import AboutCatfishDialog
from catfish.CatfishSearchEngine import CatfishSearchEngine
from catfish_lib import catfishconfig, helpers
from catfish_lib import CatfishSettings, SudoDialog, Window
from catfish_lib import Thumbnailer

logger = logging.getLogger(&#39;catfish&#39;)
# Initialize Gtk, GObject, and mimetypes
if not helpers.check_gobject_version(3, 9, 1):
    GObject.threads_init()
    GLib.threads_init()
mimetypes.init()
def get_application_path(application_name):
    for path in os.getenv(&#39;PATH&#39;).split(&#39;:&#39;):
        if os.path.isdir(path):
            if application_name in os.listdir(path):
                return os.path.join(path, application_name)
    return None
def application_in_PATH(application_name):
    &quot;&quot;&quot;Return True if the application name is found in PATH.&quot;&quot;&quot;
    return get_application_path(application_name) is not None
def is_file_hidden(folder, filename):
    &quot;&quot;&quot;Return TRUE if file is hidden or in a hidden directory.&quot;&quot;&quot;
    folder = os.path.abspath(folder)
    filename = os.path.abspath(filename)
    relpath = os.path.relpath(filename, folder)
    for piece in relpath.split(os.sep):
        if piece.startswith(&quot;.&quot;):
            return True
    return False
def surrogate_escape(text, replace=False):
    &quot;&quot;&quot;Replace non-UTF8 characters with something displayable.
    If replace is True, display (invalid encoding) after the text.&quot;&quot;&quot;
    try:
        text.encode(&#39;utf-8&#39;)
    except UnicodeEncodeError:
        text = text.encode(&#39;utf-8&#39;, errors=&#39;surrogateescape&#39;).decode(
            &#39;utf-8&#39;, errors=&#39;replace&#39;)
        if replace:
            # Translators: this text is displayed next to
            # a filename that is not utf-8 encoded.
            text = _(&quot;%s (invalid encoding)&quot;) % text
    except UnicodeDecodeError:
        text = text.decode(&#39;utf-8&#39;, errors=&#39;replace&#39;)
    return text
# See catfish_lib.Window.py for more details about how this class works
class CatfishWindow(Window):

    &quot;&quot;&quot;The application window.&quot;&quot;&quot;
    __gtype_name__ = &quot;CatfishWindow&quot;

    filter_timerange = (0.0, 9999999999.0)
    start_date = datetime.datetime.now()
    end_date = datetime.datetime.now()

    filter_formats = {&#39;documents&#39;: False, &#39;folders&#39;: False, &#39;images&#39;: False,
                      &#39;music&#39;: False, &#39;videos&#39;: False, &#39;applications&#39;: False,
                      &#39;other&#39;: False, &#39;exact&#39;: False, &#39;hidden&#39;: False,
                      &#39;fulltext&#39;: False}

    filter_custom_extensions = []
    filter_custom_use_mimetype = False

    mimetypes = dict()
    search_in_progress = False

    def finish_initializing(self, builder):  # pylint: disable=E1002
        &quot;&quot;&quot;Set up the main window&quot;&quot;&quot;
        super(CatfishWindow, self).finish_initializing(builder)
        self.set_wmclass(&quot;Catfish&quot;, &quot;Catfish&quot;)

        self.AboutDialog = AboutCatfishDialog

        # -- Folder Chooser Combobox -- #
        self.folderchooser = builder.get_named_object(&quot;toolbar.folderchooser&quot;)

        # -- Search Entry and Completion -- #
        self.search_entry = builder.get_named_object(&quot;toolbar.search&quot;)
        self.suggestions_engine = CatfishSearchEngine([&#39;zeitgeist&#39;])
        completion = Gtk.EntryCompletion()
        self.search_entry.set_completion(completion)
        listmodel = Gtk.ListStore(str)
        completion.set_model(listmodel)
        completion.set_text_column(0)

        # -- App Menu -- #
        self.exact_match = builder.get_named_object(&quot;menus.application.exact&quot;)
        self.hidden_files = builder.get_named_object(
            &quot;menus.application.hidden&quot;)
        self.fulltext = builder.get_named_object(&quot;menus.application.fulltext&quot;)
        self.sidebar_toggle_menu = builder.get_named_object(
            &quot;menus.application.advanced&quot;)

        # -- Sidebar -- #
        self.button_time_custom = builder.get_named_object(
            &quot;sidebar.modified.options&quot;)
        self.button_format_custom = builder.get_named_object(
            &quot;sidebar.filetype.options&quot;)

        # -- Status Bar -- *
        # Create a new GtkOverlay to hold the
        # results list and Overlay Statusbar
        overlay = Gtk.Overlay()

        # Move the results list to the overlay and
        # place the overlay in the window
        scrolledwindow = builder.get_named_object(&quot;results.scrolled_window&quot;)
        parent = scrolledwindow.get_parent()
        scrolledwindow.reparent(overlay)
        parent.add(overlay)
        overlay.show()

        # Create the overlay statusbar
        self.statusbar = Gtk.EventBox()
        self.statusbar.get_style_context().add_class(&quot;background&quot;)
        self.statusbar.get_style_context().add_class(&quot;floating-bar&quot;)
        self.statusbar.connect(&quot;draw&quot;, self.on_floating_bar_draw)
        self.statusbar.connect(&quot;enter-notify-event&quot;,
                               self.on_floating_bar_enter_notify)
        self.statusbar.set_halign(Gtk.Align.START)
        self.statusbar.set_valign(Gtk.Align.END)

        # Put the statusbar in the overlay
        overlay.add_overlay(self.statusbar)

        # Pack the spinner and label
        self.spinner = Gtk.Spinner()
        self.spinner.start()
        self.statusbar_label = Gtk.Label()
        self.statusbar_label.show()

        box = Gtk.Box()
        box.set_orientation(Gtk.Orientation.HORIZONTAL)
        box.pack_start(self.spinner, False, False, 0)
        box.pack_start(self.statusbar_label, False, False, 0)
        box.set_margin_left(6)
        box.set_margin_top(3)
        box.set_margin_right(6)
        box.set_margin_bottom(3)
        self.spinner.set_margin_right(3)
        box.show()

        self.statusbar.add(box)
        self.statusbar.set_halign(Gtk.Align.END)
        self.statusbar.hide()

        self.icon_cache_size = 0

        self.list_toggle = builder.get_named_object(&quot;toolbar.view.list&quot;)
        self.thumbnail_toggle = builder.get_named_object(&quot;toolbar.view.thumbs&quot;)

        # -- Treeview -- #
        self.treeview = builder.get_named_object(&quot;results.treeview&quot;)
        self.treeview.enable_model_drag_source(
            Gdk.ModifierType.BUTTON1_MASK,
            [(&#39;text/plain&#39;, Gtk.TargetFlags.OTHER_APP, 0),
             (&#39;text/uri-list&#39;, Gtk.TargetFlags.OTHER_APP, 0)],
            Gdk.DragAction.DEFAULT | Gdk.DragAction.COPY)
        self.treeview.drag_source_add_text_targets()
        self.file_menu = builder.get_named_object(&quot;menus.file.menu&quot;)
        self.file_menu_save = builder.get_named_object(&quot;menus.file.save&quot;)
        self.file_menu_delete = builder.get_named_object(&quot;menus.file.delete&quot;)
        self.treeview_click_on = False

        # -- Update Search Index Dialog -- #
        menuitem = builder.get_named_object(&quot;menus.application.update&quot;)
        if SudoDialog.check_dependencies([&#39;locate&#39;, &#39;updatedb&#39;]):
            self.update_index_dialog = \
                builder.get_named_object(&quot;dialogs.update.dialog&quot;)
            self.update_index_database = \
                builder.get_named_object(&quot;dialogs.update.database_label&quot;)
            self.update_index_modified = \
                builder.get_named_object(&quot;dialogs.update.modified_label&quot;)
            self.update_index_infobar = \
                builder.get_named_object(&quot;dialogs.update.status_infobar&quot;)
            self.update_index_icon = \
                builder.get_named_object(&quot;dialogs.update.status_icon&quot;)
            self.update_index_label = \
                builder.get_named_object(&quot;dialogs.update.status_label&quot;)
            self.update_index_close = \
                builder.get_named_object(&quot;dialogs.update.close_button&quot;)
            self.update_index_unlock = \
                builder.get_named_object(&quot;dialogs.update.unlock_button&quot;)
            self.update_index_active = False

            self.last_modified = 0

            now = datetime.datetime.now()
            self.today = datetime.datetime(now.year, now.month, now.day)
            locate, locate_path, locate_date = self.check_locate()[:3]

            self.update_index_database.set_label(&quot;&lt;tt&gt;%s&lt;/tt&gt;&quot; % locate_path)
            if not os.access(os.path.dirname(locate_path), os.R_OK):
                modified = _(&quot;Unknown&quot;)
            elif os.path.isfile(locate_path):
                modified = locate_date.strftime(&quot;%x %X&quot;)
            else:
                modified = _(&quot;Never&quot;)
            self.update_index_modified.set_label(&quot;&lt;tt&gt;%s&lt;/tt&gt;&quot; % modified)

            if locate_date &lt; self.today - datetime.timedelta(days=7):
                infobar = builder.get_named_object(&quot;infobar.infobar&quot;)
                infobar.show()
        else:
            menuitem.hide()

        self.format_mimetype_box = \
            builder.get_named_object(&quot;dialogs.filetype.mimetypes.box&quot;)
        self.extensions_entry = \
            builder.get_named_object(&quot;dialogs.filetype.extensions.entry&quot;)

        self.search_engine = CatfishSearchEngine()

        self.icon_cache = {}
        self.icon_theme = Gtk.IconTheme.get_default()

        self.selected_filenames = []
        self.rows = []

        self.settings = CatfishSettings.CatfishSettings()
        paned = builder.get_named_object(&quot;window.paned&quot;)
        paned.set_property(&#39;height_request&#39;, self.settings.get_setting(&#39;window-height&#39;))
        paned.set_property(&#39;width_request&#39;, self.settings.get_setting(&#39;window-width&#39;))

        window_width = self.settings.get_setting(&#39;window-width&#39;)
        window_height = self.settings.get_setting(&#39;window-height&#39;)
        window_x = self.settings.get_setting(&#39;window-x&#39;)
        window_y = self.settings.get_setting(&#39;window-y&#39;)
        (screen_width, screen_height) = self.get_screen_size()
        (display_width, display_height) = self.get_display_size()

        if (window_height &gt; screen_height or window_width &gt; screen_width):
            window_width = min(display_width, 650)
            window_height = min(display_height, 470)

        paned.set_property(&#39;height_request&#39;, window_height)
        paned.set_property(&#39;width_request&#39;, window_width)

        if (window_x &gt;= 0 and window_y &gt;= 0):
            if (window_x + window_width &lt;= screen_width) and \
               (window_y + window_height &lt;= screen_height):
                self.move(window_x, window_y)

        self.refresh_search_entry()

        filetype_filters = builder.get_object(&quot;filetype_options&quot;)
        filetype_filters.connect(
            &quot;row-activated&quot;, self.on_file_filters_changed, builder)

        modified_filters = builder.get_object(&quot;modified_options&quot;)
        modified_filters.connect(
            &quot;row-activated&quot;, self.on_modified_filters_changed, builder)

        self.popovers = dict()

        extension_filter = builder.get_object(&quot;filter_extensions&quot;)
        extension_filter.connect(
            &quot;search-changed&quot;, self.on_filter_extensions_changed)

        start_calendar = self.builder.get_named_object(
            &quot;dialogs.date.start_calendar&quot;)
        end_calendar = self.builder.get_named_object(
            &quot;dialogs.date.end_calendar&quot;)
        start_calendar.connect(&quot;day-selected&quot;, self.on_calendar_day_changed)
        end_calendar.connect(&quot;day-selected&quot;, self.on_calendar_day_changed)

        self.app_menu_event = False

        self.thumbnailer = Thumbnailer.Thumbnailer()

    def get_screen_size(self):
        s = Gdk.Screen.get_default()
        return (s.get_width(), s.get_height())

    def get_display_size(self):
        d = Gdk.Display.get_default()
        w = Gdk.get_default_root_window()

        m = d.get_monitor_at_window(w)
        monitor = m.get_geometry()
        return (monitor.width, monitor.height)

    def on_calendar_day_changed(self, widget):
        start_calendar = self.builder.get_named_object(
            &quot;dialogs.date.start_calendar&quot;)
        end_calendar = self.builder.get_named_object(
            &quot;dialogs.date.end_calendar&quot;)

        start_date = start_calendar.get_date()
        self.start_date = datetime.datetime(start_date[0], start_date[1] + 1,
                                            start_date[2])

        end_date = end_calendar.get_date()
        self.end_date = datetime.datetime(end_date[0], end_date[1] + 1,
                                          end_date[2])
        self.end_date = self.end_date + datetime.timedelta(days=1, seconds=-1)

        self.filter_timerange = (time.mktime(self.start_date.timetuple()),
                                 time.mktime(self.end_date.timetuple()))

        self.refilter()

    def on_application_menu_row_activated(self, listbox, row):
        self.app_menu_event = not self.app_menu_event
        if not self.app_menu_event:
            return
        if listbox.get_row_at_index(5) == row:
            listbox.get_parent().hide()
            self.on_menu_update_index_activate(row)
        if listbox.get_row_at_index(6) == row:
            listbox.get_parent().hide()
            self.on_mnu_about_activate(row)

    def on_file_filters_changed(self, treeview, path, column, builder):
        model = treeview.get_model()
        treeiter = model.get_iter(path)
        row = model[treeiter]
        showPopup = row[2] == &quot;other&quot; and row[5] == 0
        if treeview.get_column(2) == column:
            if row[5]:
                popover = self.get_popover(row[2], builder)
                popover.show_all()
                return
            else:
                row[3], row[4] = row[4], row[3]
        else:
            row[3], row[4] = row[4], row[3]
        if row[2] == &#39;other&#39; or row[2] == &#39;custom&#39;:
            row[5] = row[3]
        if showPopup and row[5]:
            popover = self.get_popover(row[2], builder)
            popover.show_all()
        self.filter_formats[row[2]] = row[3]
        self.refilter()

    def get_popover(self, name, builder):
        if name == &quot;other&quot;:
            popover_id = &quot;filetype&quot;
        elif name == &quot;custom&quot;:
            popover_id = &quot;modified&quot;
        else:
            return False
        if popover_id not in self.popovers.keys():
            builder.get_object(popover_id + &quot;_popover&quot;)
            popover = Gtk.Popover.new()
            popover.connect(&quot;destroy&quot;, self.popover_content_destroy)
            popover.add(builder.get_object(popover_id + &quot;_popover&quot;))
            popover.set_relative_to(builder.get_object(name + &quot;_helper&quot;))
            popover.set_position(Gtk.PositionType.BOTTOM)
            self.popovers[popover_id] = popover
        return self.popovers[popover_id]

    def popover_content_destroy(self, widget):
        widget.hide()
        return False

    def on_modified_filters_changed(self, treeview, path, column, builder):
        model = treeview.get_model()
        treeiter = model.get_iter(path)
        selected = model[treeiter]
        showPopup = selected[2] == &quot;custom&quot; and selected[5] == 0
        treeiter = model.get_iter_first()
        while treeiter:
            row = model[treeiter]
            row[3], row[4], row[5] = 0, 1, 0
            treeiter = model.iter_next(treeiter)
        selected[3], selected[4] = 1, 0
        if selected[2] == &quot;custom&quot;:
            selected[5] = 1
        if treeview.get_column(2) == column:
            if selected[5]:
                showPopup = True
        if showPopup:
            popover = self.get_popover(selected[2], builder)
            popover.show_all()
        self.set_modified_range(selected[2])
        self.refilter()

    def on_update_infobar_response(self, widget, response_id):
        if response_id == Gtk.ResponseType.OK:
            self.on_menu_update_index_activate(widget)
        widget.hide()

    def on_floating_bar_enter_notify(self, widget, event):
        &quot;&quot;&quot;Move the floating statusbar when hovered.&quot;&quot;&quot;
        if widget.get_halign() == Gtk.Align.START:
            widget.set_halign(Gtk.Align.END)
        else:
            widget.set_halign(Gtk.Align.START)

    def on_floating_bar_draw(self, widget, cairo_t):
        &quot;&quot;&quot;Draw the floating statusbar.&quot;&quot;&quot;
        context = widget.get_style_context()

        context.save()
        context.set_state(widget.get_state_flags())

        Gtk.render_background(context, cairo_t, 0, 0,
                              widget.get_allocated_width(),
                              widget.get_allocated_height())

        Gtk.render_frame(context, cairo_t, 0, 0,
                         widget.get_allocated_width(),
                         widget.get_allocated_height())

        context.restore()

        return False

    def parse_path_option(self, options, args):
        # Set the selected folder path. Allow legacy --path option.
        path = None

        # New format, first argument
        if self.options.path is None:
            if len(args) &gt; 0:
                if os.path.isdir(os.path.realpath(args[0])):
                    path = args.pop(0)

        # Old format, --path
        else:
            if os.path.isdir(os.path.realpath(self.options.path)):
                path = self.options.path

        # Make sure there is a valid path.
        if path is None:
            path = os.path.expanduser(&quot;~&quot;)
            if os.path.isdir(os.path.realpath(path)):
                return path
            else:
                return &quot;/&quot;
        else:
            return path

    def parse_options(self, options, args):
        &quot;&quot;&quot;Parse commandline arguments into Catfish runtime settings.&quot;&quot;&quot;
        self.options = options
        self.options.path = self.parse_path_option(options, args)

        self.folderchooser.set_filename(self.options.path)

        # Set non-flags as search keywords.
        self.search_entry.set_text(&#39; &#39;.join(args))

        # Set the time display format.
        if self.options.time_iso:
            self.time_format = &#39;%Y-%m-%d %H:%M&#39;
        else:
            self.time_format = None

        # Set search defaults.
        self.exact_match.set_active(self.options.exact)
        self.hidden_files.set_active(
            self.options.hidden or
            self.settings.get_setting(&#39;show-hidden-files&#39;))
        self.fulltext.set_active(self.options.fulltext)
        self.sidebar_toggle_menu.set_active(
            self.settings.get_setting(&#39;show-sidebar&#39;))

        self.show_thumbnail = self.options.thumbnails

        # Set the interface to standard or preview mode.

        if self.options.icons_large:
            self.show_thumbnail = False
            self.setup_large_view()
            self.list_toggle.set_active(True)
        elif self.options.thumbnails:
            self.show_thumbnail = True
            self.setup_large_view()
            self.thumbnail_toggle.set_active(True)
        else:
            self.show_thumbnail = False
            self.setup_small_view()
            self.list_toggle.set_active(True)

        if self.options.start:
            self.on_search_entry_activate(self.search_entry)

    def preview_cell_data_func(self, col, renderer, model, treeiter, data):
        &quot;&quot;&quot;Cell Renderer Function for the preview.&quot;&quot;&quot;
        icon_name = model[treeiter][0]
        filename = model[treeiter][1]

        if os.path.isfile(icon_name):
            # Load from thumbnail file.
            if self.show_thumbnail:
                pixbuf = GdkPixbuf.Pixbuf.new_from_file(icon_name)
                icon_name = None
            else:
                # Get the mimetype image..
                mimetype, override = self.guess_mimetype(filename)
                icon_name = self.get_file_icon(filename, mimetype)

        if icon_name is not None:
            pixbuf = self.get_icon_pixbuf(icon_name)

        renderer.set_property(&#39;pixbuf&#39;, pixbuf)
        return

    def thumbnail_cell_data_func(self, col, renderer, model, treeiter, data):
        &quot;&quot;&quot;Cell Renderer Function to Thumbnails View.&quot;&quot;&quot;
        icon, name, size, path, modified, mime, hidden, exact = \
            model[treeiter][:]
        name = escape(name)
        size = self.format_size(size)
        path = escape(path)
        modified = self.get_date_string(modified)
        displayed = &#39;&lt;b&gt;%s&lt;/b&gt; %s%s%s%s%s&#39; % (name, size, os.linesep, path,
                                              os.linesep, modified)
        renderer.set_property(&#39;markup&#39;, displayed)
        return

    def load_symbolic_icon(self, icon_name, size, state=Gtk.StateFlags.ACTIVE):
        &quot;&quot;&quot;Return the symbolic version of icon_name, or the non-symbolic
        fallback if unavailable.&quot;&quot;&quot;
        context = self.sidebar.get_style_context()
        try:
            icon_lookup_flags = Gtk.IconLookupFlags.FORCE_SVG
            icon_info = self.icon_theme.choose_icon([icon_name + &#39;-symbolic&#39;],
                                                    size,
                                                    icon_lookup_flags)
            color = context.get_color(state)
            icon = icon_info.load_symbolic(color, color, color, color)[0]
        except (AttributeError, GLib.GError):
            icon_lookup_flags = Gtk.IconLookupFlags.FORCE_SVG | \
                Gtk.IconLookupFlags.USE_BUILTIN | \
                Gtk.IconLookupFlags.GENERIC_FALLBACK
            icon = self.icon_theme.load_icon(
                icon_name, size, icon_lookup_flags)
        return icon

    def check_locate(self):
        &quot;&quot;&quot;Evaluate which locate binary is in use, its path, and modification
        date. Return these values in a tuple.&quot;&quot;&quot;
        path = get_application_path(&#39;locate&#39;)
        if path is None:
            return None
        path = os.path.realpath(path)
        locate = os.path.basename(path)
        db = catfishconfig.get_locate_db_path()
        if not os.access(os.path.dirname(db), os.R_OK):
            modified = time.time()
        elif os.path.isfile(db):
            modified = os.path.getmtime(db)
        else:
            modified = 0

        changed = self.last_modified != modified
        self.last_modified = modified

        item_date = datetime.datetime.fromtimestamp(modified)
        return (locate, db, item_date, changed)

    def on_filters_changed(self, box, row, user_data=None):
        if row.is_selected():
            box.unselect_row(row)
        else:
            box.select_row(row)
        return True

    # -- Update Search Index dialog -- #
    def on_update_index_dialog_close(self, widget=None, event=None,
                                     user_data=None):
        &quot;&quot;&quot;Close the Update Search Index dialog, resetting to default.&quot;&quot;&quot;
        if not self.update_index_active:
            self.update_index_dialog.hide()

            # Restore Unlock button
            self.update_index_unlock.show()
            self.update_index_unlock.set_can_default(True)
            self.update_index_unlock.set_receives_default(True)
            self.update_index_unlock.grab_focus()
            self.update_index_unlock.grab_default()

            # Restore Cancel button
            self.update_index_close.set_label(Gtk.STOCK_CANCEL)
            self.update_index_close.set_can_default(False)
            self.update_index_close.set_receives_default(False)

            self.update_index_infobar.hide()

        return True

    def show_update_status_infobar(self, status_code):
        &quot;&quot;&quot;Display the update status infobar based on the status code.&quot;&quot;&quot;
        # Error
        if status_code in [1, 3, 127]:
            icon = &quot;dialog-error&quot;
            msg_type = Gtk.MessageType.WARNING
            if status_code == 1:
                status = _(&#39;An error occurred while updating the database.&#39;)
            elif status_code in [3, 127]:
                status = _(&quot;Authentication failed.&quot;)

        # Warning
        elif status_code in [2, 126]:
            icon = &quot;dialog-warning&quot;
            msg_type = Gtk.MessageType.WARNING
            status = _(&quot;Authentication cancelled.&quot;)

        # Info
        else:
            icon = &quot;dialog-information&quot;
            msg_type = Gtk.MessageType.INFO
            status = _(&#39;Search database updated successfully.&#39;)

        self.update_index_infobar.set_message_type(msg_type)
        self.update_index_icon.set_from_icon_name(icon, Gtk.IconSize.BUTTON)
        self.update_index_label.set_label(status)

        self.update_index_infobar.show()

    def on_update_index_unlock_clicked(self, widget): # noqa
        &quot;&quot;&quot;Unlock admin rights and perform &#39;updatedb&#39; query.&quot;&quot;&quot;
        self.update_index_active = True

        # Get the password for sudo
        if not SudoDialog.prefer_pkexec() and \
                not SudoDialog.passwordless_sudo():
            sudo_dialog = SudoDialog.SudoDialog(
                parent=self.update_index_dialog,
                icon=&#39;catfish&#39;,
                name=_(&quot;Catfish File Search&quot;),
                retries=3)
            sudo_dialog.show_all()
            response = sudo_dialog.run()
            sudo_dialog.hide()
            password = sudo_dialog.get_password()
            sudo_dialog.destroy()

            if response in [Gtk.ResponseType.NONE, Gtk.ResponseType.CANCEL]:
                self.update_index_active = False
                self.show_update_status_infobar(2)
                return False

            elif response == Gtk.ResponseType.REJECT:
                self.update_index_active = False
                self.show_update_status_infobar(3)
                return False

            if not password:
                self.update_index_active = False
                self.show_update_status_infobar(2)
                return False

        # Subprocess to check if query has completed yet, runs at end of func.
        def updatedb_subprocess():
            &quot;&quot;&quot;Subprocess run for the updatedb command.&quot;&quot;&quot;
            try:
                self.updatedb_process.expect(pexpect.EOF)
                done = True
            except pexpect.TIMEOUT:
                done = False
            if done:
                self.update_index_active = False
                locate, locate_path, locate_date, changed = self.check_locate()
                modified = locate_date.strftime(&quot;%x %X&quot;)
                self.update_index_modified.set_label(&quot;&lt;tt&gt;%s&lt;/tt&gt;&quot; % modified)

                # Hide the Unlock button
                self.update_index_unlock.set_sensitive(True)
                self.update_index_unlock.set_receives_default(False)
                self.update_index_unlock.hide()

                # Update the Cancel button to Close, make it default
                self.update_index_close.set_label(Gtk.STOCK_CLOSE)
                self.update_index_close.set_sensitive(True)
                self.update_index_close.set_can_default(True)
                self.update_index_close.set_receives_default(True)
                self.update_index_close.grab_focus()
                self.update_index_close.grab_default()

                return_code = self.updatedb_process.exitstatus
                if return_code not in [1, 2, 3, 126, 127] and not changed:
                    return_code = 1
                self.show_update_status_infobar(return_code)
            return not done

        # Set the dialog status to running.
        self.update_index_modified.set_label(&quot;&lt;tt&gt;%s&lt;/tt&gt;&quot; % _(&quot;Updating...&quot;))
        self.update_index_close.set_sensitive(False)
        self.update_index_unlock.set_sensitive(False)

        if SudoDialog.prefer_pkexec():
            self.updatedb_process = SudoDialog.env_spawn(&#39;pkexec updatedb&#39;, 1)
        else:
            self.updatedb_process = SudoDialog.env_spawn(&#39;sudo updatedb&#39;, 1)
            try:
                # Check for password prompt or program exit.
                self.updatedb_process.expect(&quot;.*ssword.*&quot;)
                self.updatedb_process.sendline(password)
                self.updatedb_process.expect(pexpect.EOF)
            except pexpect.EOF:
                # shell already has password, or its not needed
                pass
            except pexpect.TIMEOUT:
                # Poll every 1 second for completion.
                pass
        GLib.timeout_add(1000, updatedb_subprocess)

    # -- Search Entry -- #
    def refresh_search_entry(self):
        &quot;&quot;&quot;Update the appearance of the search entry based on the application&#39;s
        current state.&quot;&quot;&quot;
        # Default Appearance, used for blank entry
        query = None
        icon_name = &quot;edit-find-symbolic&quot;
        sensitive = True
        button_tooltip_text = None

        # Search running
        if self.search_in_progress:
            icon_name = &quot;process-stop&quot;
            button_tooltip_text = _(&#39;Stop Search&#39;)
            entry_tooltip_text = _(&quot;Search is in progress...\nPress the &quot;
                                   &quot;cancel button or the Escape key to stop.&quot;)

        # Search not running
        else:
            entry_text = self.search_entry.get_text()
            entry_tooltip_text = None
            # Search not running, value in terms
            if len(entry_text) &gt; 0:
                button_tooltip_text = _(&#39;Begin Search&#39;)
                query = entry_text
            else:
                sensitive = False

        self.search_entry.set_icon_from_icon_name(
            Gtk.EntryIconPosition.SECONDARY, icon_name)
        self.search_entry.set_icon_tooltip_text(
            Gtk.EntryIconPosition.SECONDARY, button_tooltip_text)
        self.search_entry.set_tooltip_text(entry_tooltip_text)
        self.search_entry.set_icon_activatable(
            Gtk.EntryIconPosition.SECONDARY, sensitive)
        self.search_entry.set_icon_sensitive(
            Gtk.EntryIconPosition.SECONDARY, sensitive)

        return query

    def on_search_entry_activate(self, widget):
        &quot;&quot;&quot;If the search entry is not empty, perform the query.&quot;&quot;&quot;
        if len(widget.get_text()) &gt; 0:
            self.statusbar.show()

            # Store search start time for displaying friendly dates
            now = datetime.datetime.now()
            self.today = datetime.datetime(now.year, now.month, now.day)
            self.yesterday = self.today - datetime.timedelta(days=1)
            self.this_week = self.today - datetime.timedelta(days=6)

            task = self.perform_query(widget.get_text())
            GLib.idle_add(next, task)

    def on_search_entry_icon_press(self, widget, event, user_data):
        &quot;&quot;&quot;If search in progress, stop the search, otherwise, start.&quot;&quot;&quot;
        if not self.search_in_progress:
            self.on_search_entry_activate(self.search_entry)
        else:
            self.stop_search = True
            self.search_engine.stop()

    def on_search_entry_changed(self, widget):
        &quot;&quot;&quot;Update the search entry icon and run suggestions.&quot;&quot;&quot;
        text = self.refresh_search_entry()

        if text is None:
            return

        task = self.get_suggestions(text)
        GLib.idle_add(next, task)

    def get_suggestions(self, keywords):
        &quot;&quot;&quot;Load suggestions from the suggestions engine into the search entry
        completion.&quot;&quot;&quot;
        self.suggestions_engine.stop()

        # Wait for an available thread.
        while Gtk.events_pending():
            Gtk.main_iteration()

        folder = self.folderchooser.get_filename()
        show_hidden = self.filter_formats[&#39;hidden&#39;]

        # If the keywords start with a hidden character, show hidden files.
        if len(keywords) != 0 and keywords[0] == &#39;.&#39;:
            show_hidden = True

        completion = self.search_entry.get_completion()
        if completion is not None:
            model = completion.get_model()
            model.clear()
        results = []

        for filename in self.suggestions_engine.run(keywords, folder, 10):
            if isinstance(filename, str):
                path, name = os.path.split(filename)
                if name not in results:
                    try:
                        # Determine if file is hidden
                        hidden = is_file_hidden(folder, filename)

                        if not hidden or show_hidden:
                            results.append(name)
                            model.append([name])
                    except OSError:
                        # file no longer exists
                        pass
            yield True
        yield False

    # -- Application Menu -- #
    def on_menu_exact_match_toggled(self, widget):
        &quot;&quot;&quot;Toggle the exact match settings, and restart the search
        if a fulltext search was previously run.&quot;&quot;&quot;
        self.filter_format_toggled(&quot;exact&quot;, widget.get_active())
        if self.filter_formats[&#39;fulltext&#39;]:
            self.on_search_entry_activate(self.search_entry)

    def on_menu_hidden_files_toggled(self, widget):
        &quot;&quot;&quot;Toggle the hidden files settings.&quot;&quot;&quot;
        active = widget.get_active()
        self.filter_format_toggled(&quot;hidden&quot;, active)
        self.settings.set_setting(&#39;show-hidden-files&#39;, active)

    def on_menu_fulltext_toggled(self, widget):
        &quot;&quot;&quot;Toggle the fulltext settings, and restart the search.&quot;&quot;&quot;
        self.filter_format_toggled(&quot;fulltext&quot;, widget.get_active())
        self.on_search_entry_activate(self.search_entry)

    def on_menu_update_index_activate(self, widget):
        &quot;&quot;&quot;Show the Update Search Index dialog.&quot;&quot;&quot;
        self.update_index_dialog.show()

    # -- Sidebar -- #
    def on_sidebar_toggle_toggled(self, widget):
        &quot;&quot;&quot;Toggle visibility of the sidebar.&quot;&quot;&quot;
        if isinstance(widget, Gtk.CheckButton):
            active = widget.get_active()
        else:
            active = not self.settings.get_setting(&#39;show-sidebar&#39;)
        self.settings.set_setting(&#39;show-sidebar&#39;, active)
        if self.sidebar_toggle_menu.get_active() != active:
            self.sidebar_toggle_menu.set_active(active)
        if active != self.sidebar.get_visible():
            self.sidebar.set_visible(active)

    def set_modified_range(self, value):
        if value == &#39;any&#39;:
            self.filter_timerange = (0.0, 9999999999.0)
            logger.debug(&quot;Time Range: Beginning of time -&gt; Eternity&quot;)
        elif value == &#39;week&#39;:
            now = datetime.datetime.now()
            week = time.mktime((
                datetime.datetime(now.year, now.month, now.day, 0, 0) -
                datetime.timedelta(7)).timetuple())
            self.filter_timerange = (week, 9999999999.0)
            logger.debug(
                &quot;Time Range: %s -&gt; Eternity&quot;,
                time.strftime(&quot;%x %X&quot;, time.localtime(int(week))))
        elif value == &#39;custom&#39;:
            self.filter_timerange = (time.mktime(self.start_date.timetuple()),
                                     time.mktime(self.end_date.timetuple()))
            logger.debug(
                &quot;Time Range: %s -&gt; %s&quot;,
                time.strftime(&quot;%x %X&quot;,
                              time.localtime(int(self.filter_timerange[0]))),
                time.strftime(&quot;%x %X&quot;,
                              time.localtime(int(self.filter_timerange[1]))))
        self.refilter()

    def on_calendar_today_button_clicked(self, calendar_widget):
        &quot;&quot;&quot;Change the calendar widget selected date to today.&quot;&quot;&quot;
        today = datetime.datetime.now()
        calendar_widget.select_month(today.month - 1, today.year)
        calendar_widget.select_day(today.day)

    # File Type toggles
    def filter_format_toggled(self, filter_format, enabled):
        &quot;&quot;&quot;Update search filter when formats are modified.&quot;&quot;&quot;
        self.filter_formats[filter_format] = enabled
        logger.debug(&quot;File type filters updated: %s&quot;, str(self.filter_formats))
        self.refilter()

    def on_filter_extensions_changed(self, widget):
        &quot;&quot;&quot;Update the results when the extensions filter changed.&quot;&quot;&quot;
        self.filter_custom_extensions = []
        extensions = widget.get_text().replace(&#39;,&#39;, &#39; &#39;)
        for ext in extensions.split():
            ext = ext.strip()
            if len(ext) &gt; 0:
                if ext[0] != &#39;.&#39;:
                    ext = &quot;.&quot; + ext
                self.filter_custom_extensions.append(ext)

        # Reload the results filter.
        self.refilter()

    def thunar_display_path(self, path):
        bus = dbus.SessionBus()
        obj = bus.get_object(&#39;org.xfce.Thunar&#39;, &#39;/org/xfce/FileManager&#39;)
        iface = dbus.Interface(obj, &#39;org.xfce.FileManager&#39;)

        path = os.path.realpath(urllib.parse.urlparse(path).path)
        url = urllib.parse.urljoin(&#39;file:&#39;, urllib.request.pathname2url(path))

        if os.path.isfile(path):
            method = iface.get_dbus_method(&#39;DisplayFolderAndSelect&#39;)
            dirname = os.path.dirname(url)
            filename = os.path.basename(url)
            method(dirname, filename, &#39;&#39;, &#39;&#39;)

        else:
            method = iface.get_dbus_method(&#39;DisplayFolder&#39;)
            method(url, &#39;&#39;, &#39;&#39;)

    def get_exo_preferred_applications(self, filename):
        apps = {}
        if os.path.exists(filename):
            with open(filename, &quot;r&quot;) as infile:
                for line in infile.readlines():
                    line = line.strip()
                    if &quot;=&quot; in line:
                        key, value = line.split(&quot;=&quot;, 2)
                        if len(value) &gt; 0:
                            apps[key] = value
        return apps

    def get_exo_preferred_file_manager(self):
        tmp = [GLib.get_user_config_dir()] + GLib.get_system_config_dirs()
        config_dirs = []
        for config_dir in tmp:
            if config_dir not in config_dirs:
                if os.path.exists(config_dir):
                    config_dirs.append(config_dir)

        for config_dir in config_dirs:
            cfg = &quot;%s/xfce4/helpers.rc&quot; % config_dir
            if os.path.exists(cfg):
                apps = self.get_exo_preferred_applications(cfg)
                if &quot;FileManager&quot; in apps:
                    return apps[&quot;FileManager&quot;]

        return &quot;Thunar&quot;

    def using_thunar_fm(self):
        if os.environ.get(&quot;XDG_CURRENT_DESKTOP&quot;, &quot;&quot;).lower() == &#39;xfce&#39;:
            fm = self.get_exo_preferred_file_manager()
            return &quot;thunar&quot; in fm.lower()

        fm = subprocess.check_output([&#39;xdg-mime&#39;,&#39;query&#39;,&#39;default&#39;, &#39;inode/directory&#39;])
        fm = fm.decode(&quot;utf-8&quot;, errors=&quot;replace&quot;)
        if &quot;thunar&quot; in fm.lower():
            return True

        if &quot;exo-file-manager&quot; in fm.lower():
            fm = self.get_exo_preferred_file_manager()
            return &quot;thunar&quot; in fm.lower()

        return False

    def open_file(self, filename):
        &quot;&quot;&quot;Open the specified filename in its default application.&quot;&quot;&quot;
        logger.debug(&quot;Opening %s&quot; % filename)
        if filename.endswith(&#39;.AppImage&#39;) and os.access(filename, os.X_OK):
            command = [filename]
        elif os.path.isdir(filename) and \
                os.environ.get(&quot;XDG_CURRENT_DESKTOP&quot;, &quot;&quot;).lower() == &#39;xfce&#39;:
            command = [&#39;exo-open&#39;, &#39;--launch&#39;, &#39;FileManager&#39;, filename]
        else:
            command = [&#39;xdg-open&#39;, filename]
        try:
            subprocess.Popen(command, shell=False)
            return
        except Exception as msg:
            logger.debug(&#39;Exception encountered while opening %s.&#39; +
                         &#39;\n  Exception: %s&#39; +
                         filename, msg)
            self.get_error_dialog(_(&#39;\&quot;%s\&quot; could not be opened.&#39;) %
                                  os.path.basename(filename), str(msg))

    # -- File Popup Menu -- #
    def on_menu_open_activate(self, widget):
        &quot;&quot;&quot;Open the selected file in its default application.&quot;&quot;&quot;
        for filename in self.selected_filenames:
            self.open_file(filename)

    def on_menu_filemanager_activate(self, widget):
        &quot;&quot;&quot;Open the selected file in the default file manager.&quot;&quot;&quot;
        logger.debug(&quot;Opening file manager for %i path(s)&quot; %
                     len(self.selected_filenames))

        if self.using_thunar_fm():
            for filename in self.selected_filenames:
                self.thunar_display_path(filename)
            return

        dirs = []
        for filename in self.selected_filenames:
            path = os.path.split(filename)[0]
            if path not in dirs:
                dirs.append(path)
        for path in dirs:
            self.open_file(path)

    def on_menu_copy_location_activate(self, widget):
        &quot;&quot;&quot;Copy the selected file name to the clipboard.&quot;&quot;&quot;
        logger.debug(&quot;Copying %i filename(s) to the clipboard&quot; %
                     len(self.selected_filenames))
        clipboard = Gtk.Clipboard.get(Gdk.SELECTION_CLIPBOARD)
        locations = []
        for filename in self.selected_filenames:
            locations.append(surrogate_escape(filename))
        text = str(os.linesep).join(locations)
        clipboard.set_text(text, -1)
        clipboard.store()

    def on_menu_save_activate(self, widget):
        &quot;&quot;&quot;Show a save dialog and possibly write the results to a file.&quot;&quot;&quot;
        filename = self.get_save_dialog(
            surrogate_escape(self.selected_filenames[0]))
        if filename:
            try:
                # Try to save the file.
                copy2(self.selected_filenames[0], filename)

            except Exception as msg:
                # If the file save fails, throw an error.
                logger.debug(&#39;Exception encountered while saving %s.&#39; +
                             &#39;\n  Exception: %s&#39;, filename, msg)
                self.get_error_dialog(_(&#39;\&quot;%s\&quot; could not be saved.&#39;) %
                                      os.path.basename(filename), str(msg))

    def delete_file(self, filename):
        try:
            # Delete the file.
            if not os.path.exists(filename):
                return True
            elif os.path.isdir(filename):
                rmtree(filename)
            else:
                os.remove(filename)
            return True
        except Exception as msg:
            # If the file cannot be deleted, throw an error.
            logger.debug(&#39;Exception encountered while deleting %s.&#39; +
                         &#39;\n  Exception: %s&#39;, filename, msg)
            self.get_error_dialog(_(&quot;\&quot;%s\&quot; could not be deleted.&quot;) %
                                  os.path.basename(filename),
                                  str(msg))
        return False

    def remove_filenames_from_treeview(self, filenames):
        removed = []
        model = self.treeview.get_model().get_model().get_model()
        treeiter = model.get_iter_first()
        while treeiter is not None:
            nextiter = model.iter_next(treeiter)
            row = model[treeiter]
            found = os.path.join(row[3], row[1])
            if found in filenames:
                model.remove(treeiter)
                removed.append(found)
            if len(removed) == len(filenames):
                return True
            treeiter = nextiter
        return False

    def on_menu_delete_activate(self, widget):
        &quot;&quot;&quot;Show a delete dialog and remove the file if accepted.&quot;&quot;&quot;
        filenames = []
        if self.get_delete_dialog(self.selected_filenames):
            delete = self.selected_filenames
            delete.sort()
            delete.reverse()
            for filename in delete:
                if self.delete_file(filename):
                    filenames.append(filename)
        self.remove_filenames_from_treeview(filenames)
        self.refilter()

    def get_save_dialog(self, filename):
        &quot;&quot;&quot;Show the Save As FileChooserDialog.

        Return the filename, or None if cancelled.&quot;&quot;&quot;
        basename = os.path.basename(filename)

        dialog = Gtk.FileChooserDialog(title=_(&#39;Save &quot;%s&quot; as...&#39;) % basename,
                                       transient_for=self,
                                       action=Gtk.FileChooserAction.SAVE)
        dialog.add_buttons(Gtk.STOCK_CANCEL, Gtk.ResponseType.REJECT,
                           Gtk.STOCK_SAVE, Gtk.ResponseType.ACCEPT)
        dialog.set_default_response(Gtk.ResponseType.REJECT)
        dialog.set_current_name(basename.replace(&#39;�&#39;, &#39;_&#39;))
        dialog.set_do_overwrite_confirmation(True)
        response = dialog.run()
        save_as = dialog.get_filename()
        dialog.destroy()
        if response == Gtk.ResponseType.ACCEPT:
            return save_as
        return None

    def get_error_dialog(self, primary, secondary):
        &quot;&quot;&quot;Show an error dialog with the specified message.&quot;&quot;&quot;
        dialog_text = &quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;\n\n%s&quot; % (escape(primary),
                                                      escape(secondary))

        dialog = Gtk.MessageDialog(transient_for=self,
                                   modal=True,
                                   destroy_with_parent=True,
                                   message_type=Gtk.MessageType.ERROR,
                                   buttons=Gtk.ButtonsType.OK,
                                   text=&quot;&quot;)

        dialog.set_markup(dialog_text)
        dialog.set_default_response(Gtk.ResponseType.OK)
        dialog.run()
        dialog.destroy()

    def get_delete_dialog(self, filenames):
        &quot;&quot;&quot;Show a delete confirmation dialog.  Return True if delete wanted.&quot;&quot;&quot;
        if len(filenames) == 1:
            primary = _(&quot;Are you sure that you want to \n&quot;
                        &quot;permanently delete \&quot;%s\&quot;?&quot;) % \
                escape(os.path.basename(filenames[0]))
        else:
            primary = _(&quot;Are you sure that you want to \n&quot;
                        &quot;permanently delete the %i selected files?&quot;) % \
                len(filenames)
        secondary = _(&quot;If you delete a file, it is permanently lost.&quot;)

        dialog_text = &quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;\n\n%s&quot; % (primary, secondary)
        dialog = Gtk.MessageDialog(transient_for=self,
                                   modal=True,
                                   destroy_with_parent=True,
                                   message_type=Gtk.MessageType.QUESTION,
                                   buttons=Gtk.ButtonsType.NONE,
                                   text=&quot;&quot;)
        dialog.set_markup(surrogate_escape(dialog_text))

        dialog.add_buttons(Gtk.STOCK_CANCEL, Gtk.ResponseType.NO,
                           Gtk.STOCK_DELETE, Gtk.ResponseType.YES)

        dialog.set_default_response(Gtk.ResponseType.NO)
        response = dialog.run()
        dialog.destroy()
        return response == Gtk.ResponseType.YES

    def setup_small_view(self):
        &quot;&quot;&quot;Prepare the list view in the results pane.&quot;&quot;&quot;
        for column in self.treeview.get_columns():
            self.treeview.remove_column(column)
        self.treeview.append_column(self.new_column(_(&#39;Filename&#39;), 1,
                                                    &#39;icon&#39;, 1))
        self.treeview.append_column(self.new_column(_(&#39;Size&#39;), 2,
                                                    &#39;filesize&#39;))
        self.treeview.append_column(self.new_column(_(&#39;Location&#39;), 3,
                                                    &#39;ellipsize&#39;))
        self.treeview.append_column(self.new_column(_(&#39;Modified&#39;), 4,
                                                    &#39;date&#39;, 1))
        self.icon_size = Gtk.IconSize.MENU

    def setup_large_view(self):
        &quot;&quot;&quot;Prepare the extended list view in the results pane.&quot;&quot;&quot;
        for column in self.treeview.get_columns():
            self.treeview.remove_column(column)
        # Make the Preview Column
        cell = Gtk.CellRendererPixbuf()
        column = Gtk.TreeViewColumn(_(&#39;Preview&#39;), cell)
        self.treeview.append_column(column)

        column.set_cell_data_func(cell, self.preview_cell_data_func, None)

        # Make the Details Column
        cell = Gtk.CellRendererText()
        cell.set_property(&quot;ellipsize&quot;, Pango.EllipsizeMode.END)
        column = Gtk.TreeViewColumn(_(&quot;Details&quot;), cell, markup=1)

        column.set_sort_column_id(1)
        column.set_resizable(True)
        column.set_expand(True)

        column.set_cell_data_func(cell, self.thumbnail_cell_data_func, None)
        self.treeview.append_column(column)
        self.icon_size = Gtk.IconSize.DIALOG

    def on_treeview_list_toggled(self, widget):
        &quot;&quot;&quot;Switch to the details view.&quot;&quot;&quot;
        if widget.get_active():
            self.show_thumbnail = False
            if self.options.icons_large:
                self.setup_large_view()
            else:
                self.setup_small_view()

    def on_treeview_thumbnails_toggled(self, widget):
        &quot;&quot;&quot;Switch to the preview view.&quot;&quot;&quot;
        if widget.get_active():
            self.show_thumbnail = True
            self.setup_large_view()

    # -- Treeview -- #
    def on_treeview_row_activated(self, treeview, path, user_data):
        &quot;&quot;&quot;Catch row activations by keyboard or mouse double-click.&quot;&quot;&quot;
        # Get the filename from the row.
        model = treeview.get_model()
        file_path = self.treemodel_get_row_filename(model, path)
        self.selected_filenames = [file_path]

        # Open the selected file.
        self.open_file(self.selected_filenames[0])

    def on_treeview_drag_begin(self, treeview, context):
        &quot;&quot;&quot;Treeview DND Begin.&quot;&quot;&quot;
        if len(self.selected_filenames) &gt; 1:
            treesel = treeview.get_selection()
            for row in self.rows:
                treesel.select_path(row)
        return True

    def on_treeview_drag_data_get(self, treeview, context, selection, info,
                                  time):
        &quot;&quot;&quot;Treeview DND Get.&quot;&quot;&quot;
        text = str(os.linesep).join(self.selected_filenames)
        selection.set_text(text, -1)

        uris = [&#39;file://&#39; + path for path in self.selected_filenames]
        selection.set_uris(uris)

        return True

    def treemodel_get_row_filename(self, model, row):
        &quot;&quot;&quot;Get the filename from a specified row.&quot;&quot;&quot;
        filename = os.path.join(model[row][3], model[row][1])
        return filename

    def treeview_get_selected_rows(self, treeview):
        &quot;&quot;&quot;Get the currently selected rows from the specified treeview.&quot;&quot;&quot;
        sel = treeview.get_selection()
        model, rows = sel.get_selected_rows()
        data = []
        for row in rows:
            data.append(self.treemodel_get_row_filename(model, row))
        return (model, rows, data)

    def check_treeview_stats(self, treeview):
        if len(self.rows) == 0:
            return -1
        model, rows, selected_filenames = \
            self.treeview_get_selected_rows(treeview)
        for row in rows:
            if row not in self.rows:
                return 2
        if self.rows != rows:
            return 1
        return 0

    def update_treeview_stats(self, treeview, event=None):
        if event:
            self.treeview_set_cursor_if_unset(treeview,
                                              int(event.x),
                                              int(event.y))
        model, self.rows, self.selected_filenames = \
            self.treeview_get_selected_rows(treeview)

    def maintain_treeview_stats(self, treeview, event=None):
        if len(self.selected_filenames) == 0:
            self.update_treeview_stats(treeview, event)
        elif self.check_treeview_stats(treeview) == 2:
            self.update_treeview_stats(treeview, event)
        else:
            treesel = treeview.get_selection()
            for row in self.rows:
                treesel.select_path(row)

    def on_treeview_cursor_changed(self, treeview):
        if &quot;Shift&quot; in self.keys_pressed or &quot;Control&quot; in self.keys_pressed:
            self.update_treeview_stats(treeview)

    def treeview_set_cursor_if_unset(self, treeview, x=0, y=0):
        if treeview.get_selection().count_selected_rows() &lt; 1:
            self.treeview_set_cursor_at_pos(treeview, x, y)

    def treeview_set_cursor_at_pos(self, treeview, x, y):
        try:
            path = treeview.get_path_at_pos(int(x), int(y))[0]
            treeview.set_cursor(path)
        except TypeError:
            return False
        return True

    def treeview_left_click(self, treeview, event=None):
        self.update_treeview_stats(treeview, event)
        return False

    def treeview_middle_click(self, treeview, event=None):
        self.maintain_treeview_stats(treeview, event)
        self.treeview_set_cursor_if_unset(treeview, int(event.x), int(event.y))
        for filename in self.selected_filenames:
            self.open_file(filename)
        return True

    def treeview_right_click(self, treeview, event=None):
        self.maintain_treeview_stats(treeview, event)
        show_save_option = len(self.selected_filenames) == 1 and not \
            os.path.isdir(self.selected_filenames[0])
        self.file_menu_save.set_visible(show_save_option)
        writeable = True
        for filename in self.selected_filenames:
            if not os.access(filename, os.W_OK):
                writeable = False
        self.file_menu_delete.set_sensitive(writeable)
        self.file_menu.popup(None, None, None, None,
                             event.button, event.time)
        return True

    def treeview_alt_clicked(self, treeview, event=None):
        self.update_treeview_stats(treeview, event)
        return False

    def on_treeview_button_press_event(self, treeview, event):
        &quot;&quot;&quot;Catch single mouse click events on the treeview and rows.

            Left Click:     Ignore.
            Middle Click:   Open the selected file.
            Right Click:    Show the popup menu.&quot;&quot;&quot;
        if &quot;Shift&quot; in self.keys_pressed or &quot;Control&quot; in self.keys_pressed:
            handled = self.treeview_alt_clicked(treeview, event)
        elif event.button == 1:
            handled = self.treeview_left_click(treeview, event)
        elif event.button == 2:
            handled = self.treeview_middle_click(treeview, event)
        elif event.button == 3:
            handled = self.treeview_right_click(treeview, event)
        else:
            handled = False
        return handled

    def new_column(self, label, id, special=None, markup=False):
        &quot;&quot;&quot;New Column function for creating TreeView columns easily.&quot;&quot;&quot;
        if special == &#39;icon&#39;:
            column = Gtk.TreeViewColumn(label)
            cell = Gtk.CellRendererPixbuf()
            column.pack_start(cell, False)
            column.set_cell_data_func(cell, self.preview_cell_data_func, None)
            cell = Gtk.CellRendererText()
            column.pack_start(cell, False)
            column.add_attribute(cell, &#39;text&#39;, id)
        else:
            cell = Gtk.CellRendererText()
            if markup:
                column = Gtk.TreeViewColumn(label, cell, markup=id)
            else:
                column = Gtk.TreeViewColumn(label, cell, text=id)
            if special == &#39;ellipsize&#39;:
                column.set_min_width(120)
                cell.set_property(&#39;ellipsize&#39;, Pango.EllipsizeMode.START)
            elif special == &#39;filesize&#39;:
                cell.set_property(&#39;xalign&#39;, 1.0)
                column.set_cell_data_func(cell,
                                          self.cell_data_func_filesize, id)
            elif special == &#39;date&#39;:
                column.set_cell_data_func(cell,
                                          self.cell_data_func_modified, id)
        column.set_sort_column_id(id)
        column.set_resizable(True)
        if id == 3:
            column.set_expand(True)
        return column

    def cell_data_func_filesize(self, column, cell_renderer,
                                tree_model, tree_iter, id):
        &quot;&quot;&quot;File size cell display function.&quot;&quot;&quot;
        if helpers.check_python_version(3, 0):
            size = int(tree_model.get_value(tree_iter, id))
        else:
            size = long(tree_model.get_value(tree_iter, id)) # noqa

        filesize = self.format_size(size)
        cell_renderer.set_property(&#39;text&#39;, filesize)
        return

    def cell_data_func_modified(self, column, cell_renderer,
                                tree_model, tree_iter, id):
        &quot;&quot;&quot;Modification date cell display function.&quot;&quot;&quot;
        modification_int = int(tree_model.get_value(tree_iter, id))
        modified = self.get_date_string(modification_int)

        cell_renderer.set_property(&#39;text&#39;, modified)
        return

    def get_date_string(self, modification_int):
        &quot;&quot;&quot;Return the date string in the preferred format.&quot;&quot;&quot;
        if self.time_format is not None:
            modified = time.strftime(self.time_format,
                                     time.localtime(modification_int))
        else:
            item_date = datetime.datetime.fromtimestamp(modification_int)
            if item_date &gt;= self.today:
                modified = _(&quot;Today&quot;)
            elif item_date &gt;= self.yesterday:
                modified = _(&quot;Yesterday&quot;)
            elif item_date &gt;= self.this_week:
                modified = time.strftime(&quot;%A&quot;,
                                         time.localtime(modification_int))
            else:
                modified = time.strftime(&quot;%x&quot;,
                                         time.localtime(modification_int))
        return modified

    def results_filter_func(self, model, iter, user_data): # noqa
        &quot;&quot;&quot;Filter function for search results.&quot;&quot;&quot;
        # hidden
        if model[iter][6]:
            if not self.filter_formats[&#39;hidden&#39;]:
                return False

        # exact
        if not self.filter_formats[&#39;fulltext&#39;]:
            if not model[iter][7]:
                if self.filter_formats[&#39;exact&#39;]:
                    return False

        # modified
        modified = model[iter][4]
        if modified &lt; self.filter_timerange[0]:
            return False
        if modified &gt; self.filter_timerange[1]:
            return False

        # mimetype
        mimetype = model[iter][5]
        use_filters = False
        if self.filter_formats[&#39;folders&#39;]:
            use_filters = True
            if mimetype == &#39;inode/directory&#39;:
                return True
        if self.filter_formats[&#39;images&#39;]:
            use_filters = True
            if mimetype.startswith(&quot;image&quot;):
                return True
        if self.filter_formats[&#39;music&#39;]:
            use_filters = True
            if mimetype.startswith(&quot;audio&quot;):
                return True
        if self.filter_formats[&#39;videos&#39;]:
            use_filters = True
            if mimetype.startswith(&quot;video&quot;):
                return True
        if self.filter_formats[&#39;documents&#39;]:
            use_filters = True
            if mimetype.startswith(&quot;text&quot;):
                return True
        if self.filter_formats[&#39;applications&#39;]:
            use_filters = True
            if mimetype.startswith(&quot;application&quot;):
                return True
        if self.filter_formats[&#39;other&#39;]:
            use_filters = True
            extension = os.path.splitext(model[iter][1])[1]
            if extension in self.filter_custom_extensions:
                return True

        if use_filters:
            return False

        return True

    def refilter(self):
        &quot;&quot;&quot;Reload the results filter, update the statusbar to reflect count.&quot;&quot;&quot;
        try:
            self.results_filter.refilter()
            n_results = len(self.treeview.get_model())
            self.show_results(n_results)
        except AttributeError:
            pass

    def show_results(self, count):
        if count == 0:
            self.builder.get_object(&quot;results_scrolledwindow&quot;).hide()
            self.builder.get_object(&quot;splash&quot;).show()
            self.builder.get_object(
                &quot;splash_title&quot;).set_text(_(&quot;No files found.&quot;))
            self.builder.get_object(&quot;splash_subtitle&quot;).set_text(
                _(&quot;Try making your search less specific\n&quot;
                  &quot;or try another directory.&quot;))
        else:
            self.builder.get_object(&quot;splash&quot;).hide()
            self.builder.get_object(&quot;results_scrolledwindow&quot;).show()
            if count == 1:
                self.statusbar_label.set_label(_(&quot;1 file found.&quot;))
            else:
                self.statusbar_label.set_label(_(&quot;%i files found.&quot;) % count)

    def format_size(self, size, precision=1):
        &quot;&quot;&quot;Make a file size human readable.&quot;&quot;&quot;
        if isinstance(size, str):
            size = int(size)
        suffixes = [_(&#39;bytes&#39;), &#39;kB&#39;, &#39;MB&#39;, &#39;GB&#39;, &#39;TB&#39;]
        suffixIndex = 0
        if size &gt; 1024:
            while size &gt; 1024:
                suffixIndex += 1
                size = size / 1024.0
            return &quot;%.*f %s&quot; % (precision, size, suffixes[suffixIndex])
        else:
            return &quot;%i %s&quot; % (size, suffixes[0])

    def guess_mimetype(self, filename):
        &quot;&quot;&quot;Guess the mimetype of the specified filename.

        Return a tuple containing (guess, override).&quot;&quot;&quot;
        override = None
        if os.path.isdir(filename):
            return (&#39;inode/directory&#39;, override)

        extension = os.path.splitext(filename)[1]
        if extension in [
                &#39;.abw&#39;, &#39;.ai&#39;, &#39;.chrt&#39;, &#39;.doc&#39;, &#39;.docm&#39;, &#39;.docx&#39;, &#39;.dot&#39;,
                &#39;.dotm&#39;, &#39;.dotx&#39;, &#39;.eps&#39;, &#39;.gnumeric&#39;, &#39;.kil&#39;, &#39;.kpr&#39;, &#39;.kpt&#39;,
                &#39;.ksp&#39;, &#39;.kwd&#39;, &#39;.kwt&#39;, &#39;.latex&#39;, &#39;.mdb&#39;, &#39;.mm&#39;, &#39;.nb&#39;, &#39;.nbp&#39;,
                &#39;.odb&#39;, &#39;.odc&#39;, &#39;.odf&#39;, &#39;.odm&#39;, &#39;.odp&#39;, &#39;.ods&#39;, &#39;.odt&#39;, &#39;.otg&#39;,
                &#39;.oth&#39;, &#39;.odp&#39;, &#39;.ots&#39;, &#39;.ott&#39;, &#39;.pdf&#39;, &#39;.php&#39;, &#39;.pht&#39;,
                &#39;.phtml&#39;, &#39;.potm&#39;, &#39;.potx&#39;, &#39;.ppa&#39;, &#39;.ppam&#39;, &#39;.pps&#39;, &#39;.ppsm&#39;,
                &#39;.ppsx&#39;, &#39;.ppt&#39;, &#39;.pptm&#39;, &#39;.pptx&#39;, &#39;.ps&#39;, &#39;.pwz&#39;, &#39;.rtf&#39;,
                &#39;.sda&#39;, &#39;.sdc&#39;, &#39;.sdd&#39;, &#39;.sds&#39;, &#39;.sdw&#39;, &#39;.stc&#39;, &#39;.std&#39;, &#39;.sti&#39;,
                &#39;.stw&#39;, &#39;.sxc&#39;, &#39;.sxd&#39;, &#39;.sxg&#39;, &#39;.sxi&#39;, &#39;.sxm&#39;, &#39;.sxw&#39;, &#39;.wiz&#39;,
                &#39;.wp5&#39;, &#39;.wpd&#39;, &#39;.xlam&#39;, &#39;.xlb&#39;, &#39;.xls&#39;, &#39;.xlsb&#39;, &#39;.xlsm&#39;,
                &#39;.xlsx&#39;, &#39;.xlt&#39;, &#39;.xltm&#39;, &#39;.xlsx&#39;, &#39;.xml&#39;]:
            override = &#39;text/plain&#39;
        elif extension in [&#39;.cdy&#39;]:
            override = &#39;video/x-generic&#39;
        elif extension in [&#39;.odg&#39;, &#39;.odi&#39;]:
            override = &#39;audio/x-generic&#39;

        guess = mimetypes.guess_type(filename)
        if guess[0] is None:
            return (&#39;text/plain&#39;, override)
        return (guess[0], override)

    def get_icon_pixbuf(self, name):
        &quot;&quot;&quot;Return a pixbuf for the icon name from the default icon theme.&quot;&quot;&quot;
        try:
            # Clear the icon cache if the current size is not the cached size.
            if self.icon_cache_size != self.icon_size:
                self.icon_cache.clear()
                self.icon_cache_size = self.icon_size
            return self.icon_cache[name]
        except KeyError:
            icon_size = Gtk.icon_size_lookup(self.icon_size)[1]
            if self.icon_theme.has_icon(name):
                icon = self.icon_theme.load_icon(name, icon_size, 0)
            else:
                icon = self.icon_theme.load_icon(&#39;image-missing&#39;, icon_size, 0)
            self.icon_cache[name] = icon
            return icon

    def get_thumbnail(self, path, mime_type=None):
        &quot;&quot;&quot;Try to fetch a thumbnail.&quot;&quot;&quot;
        thumb = self.thumbnailer.get_thumbnail(path, mime_type, self.show_thumbnail)
        if thumb:
            return thumb
        return self.get_file_icon(path, mime_type)

    def get_file_icon(self, path, mime_type=None):
        &quot;&quot;&quot;Retrieve the file icon.&quot;&quot;&quot;
        if mime_type:
            if mime_type == &#39;inode/directory&#39;:
                return &quot;folder&quot;
            else:
                mime_type = mime_type.split(&#39;/&#39;)
                if mime_type is not None:
                    # Get icon from mimetype
                    media, subtype = mime_type

                    variations = [&#39;%s-%s&#39; % (media, subtype),
                                  &#39;%s-x-%s&#39; % (media, subtype)]
                    if media == &quot;application&quot;:
                        variations.append(&#39;application-x-executable&#39;)
                    variations.append(&#39;%s-x-generic&#39; % media)

                    for icon_name in variations:
                        if self.icon_theme.has_icon(icon_name):
                            return icon_name
        return &quot;text-x-generic&quot;

    def python_three_size_sort_func(self, model, row1, row2, user_data):
        &quot;&quot;&quot;Sort function used in Python 3.&quot;&quot;&quot;
        sort_column = 2
        value1 = int(model.get_value(row1, sort_column))
        value2 = int(model.get_value(row2, sort_column))
        if value1 &lt; value2:
            return -1
        elif value1 == value2:
            return 0
        else:
            return 1

    # -- Searching -- #
    def perform_query(self, keywords): # noqa
        &quot;&quot;&quot;Run the search query with the specified keywords.&quot;&quot;&quot;
        self.stop_search = False

        # Update the interface to Search Mode
        self.builder.get_object(&quot;results_scrolledwindow&quot;).hide()
        self.builder.get_object(&quot;splash&quot;).show()
        self.builder.get_object(&quot;splash_title&quot;).set_text(_(&quot;Searching...&quot;))
        self.builder.get_object(&quot;splash_subtitle&quot;).set_text(
            _(&quot;Results will be displayed as soon as they are found.&quot;))
        self.builder.get_object(&quot;splash_hide&quot;).hide()
        show_results = False

        self.get_window().set_cursor(Gdk.Cursor(Gdk.CursorType.WATCH))
        self.set_title(_(&quot;Searching for \&quot;%s\&quot;&quot;) % keywords)
        self.spinner.show()
        self.statusbar_label.set_label(_(&quot;Searching...&quot;))

        self.search_in_progress = True
        self.refresh_search_entry()

        # Be thread friendly.
        while Gtk.events_pending():
            Gtk.main_iteration()

        # icon, name, size, path, modified, mimetype, hidden, exact
        model = Gtk.ListStore(str, str, GObject.TYPE_INT64,
                              str, float, str, bool, bool)

        # Initialize the results filter.
        self.results_filter = model.filter_new()
        self.results_filter.set_visible_func(self.results_filter_func)
        sort = Gtk.TreeModelSort(model=self.results_filter)
        if helpers.check_python_version(3, 0):
            sort.set_sort_func(2, self.python_three_size_sort_func, None)
        self.treeview.set_model(sort)
        sort.get_model().get_model().clear()
        self.treeview.columns_autosize()

        # Enable multiple-selection
        sel = self.treeview.get_selection()
        if sel is not None:
            sel.set_mode(Gtk.SelectionMode.MULTIPLE)

        folder = self.folderchooser.get_filename()

        results = []

        # Check if this is a fulltext query or standard query.
        if self.filter_formats[&#39;fulltext&#39;]:
            self.search_engine = CatfishSearchEngine([&#39;fulltext&#39;])
            self.search_engine.set_exact(self.filter_formats[&#39;exact&#39;])
        else:
            self.search_engine = CatfishSearchEngine()

        for filename in self.search_engine.run(keywords, folder, regex=True):
            if not self.stop_search and isinstance(filename, str) and \
                    filename not in results:
                try:
                    path, name = os.path.split(filename)

                    if helpers.check_python_version(3, 0):
                        size = int(os.path.getsize(filename))
                    else:
                        size = long(os.path.getsize(filename))  # noqa

                    modified = os.path.getmtime(filename)

                    mimetype, override = self.guess_mimetype(filename)
                    icon = self.get_thumbnail(filename, mimetype)
                    if override:
                        mimetype = override

                    hidden = is_file_hidden(folder, filename)

                    exact = keywords in name

                    results.append(filename)

                    displayed = surrogate_escape(name, True)
                    path = surrogate_escape(path)
                    model.append([icon, displayed, size, path, modified,
                                  mimetype, hidden, exact])

                    if not show_results:
                        if len(self.treeview.get_model()) &gt; 0:
                            show_results = True
                            self.builder.get_object(&quot;splash&quot;).hide()
                            self.builder.get_object(
                                &quot;results_scrolledwindow&quot;).show()

                except OSError:
                    # file no longer exists
                    pass
                except Exception as e:
                    logger.error(&quot;Exception encountered: &quot;, str(e))

            yield True
            continue

        # Return to Non-Search Mode.
        window = self.get_window()
        if window is not None:
            window.set_cursor(None)
        self.set_title(_(&#39;Search results for \&quot;%s\&quot;&#39;) % keywords)
        self.spinner.hide()

        n_results = 0
        if self.treeview.get_model() is not None:
            n_results = len(self.treeview.get_model())
        self.show_results(n_results)

        self.search_in_progress = False
        self.refresh_search_entry()

        self.stop_search = False
        yield False</code></pre><br />Дальше не знаю куда копать((
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-219604"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">viktor1962</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/219604/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    15
                </a>
            </div>
            <div>
                Участник с: 14 апреля 2019
            </div>
            
        </td>
        <td class="post-content">
            Подскажите, что-то перестал запускаться у меня поиск, а в терминале <em> find ~ -name &quot;catfish*&quot; -print</em> конечно работает, но мне не всегда удобно командой искать. Что ему нужно, не пойму( Всё чистил-удалял, переустановлял, как бы ни чего глобального не менял((<br /><br /><pre><code>viktor ~ $   /usr/bin/catfish
Traceback (most recent call last):
  File &quot;/usr/bin/catfish&quot;, line 41, in &lt;module&gt;
    import catfish
  File &quot;/usr/lib/python3.7/site-packages/catfish/__init__.py&quot;, line 29, in &lt;module&gt;
    from catfish import CatfishWindow
  File &quot;/usr/lib/python3.7/site-packages/catfish/CatfishWindow.py&quot;, line 31, in &lt;module&gt;
    import dbus
ModuleNotFoundError: No module named &#39;dbus&#39;
viktor ~ $
</code></pre>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-219152"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">viktor1962</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/219152/index.html">#</a>
            3 года, 1 месяц назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    15
                </a>
            </div>
            <div>
                Участник с: 14 апреля 2019
            </div>
            
        </td>
        <td class="post-content">
            Скажите пожалуйста- веб камера вообще в этой программе franz,  работает? У меня только микрофоном можно смски отправлять((
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-216475"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">viktor1962</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/216475/index.html">#</a>
            3 года, 4 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    15
                </a>
            </div>
            <div>
                Участник с: 14 апреля 2019
            </div>
            
        </td>
        <td class="post-content">
            <blockquote><em>indeviral</em><br>Environment=DISPLAY=:0</blockquote><br />Ну ведь верно!, а я всё про него DISPLAY этот перерыл и как то не то прописывал)) Удалил всё - думал тут я не правильным путём иду(<br /><u>Спасибо Огромное, всё запускается!</u>
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
            




<table class="table table-bordered post post-row
       "
       id="post-216448"
       >
    <thead>
    <tr>
        <td class="post-author">
            <a href="../index.html">
                <span class="post-username">viktor1962</span>
            </a>
        </td>
        <td class="post-date">
            <div class="post-control">
                
                    
                
            </div>
            <a class="permalink" href="../../../post/216448/index.html">#</a>
            3 года, 4 месяца назад
            
            
        </td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="post-info">
            

<div class="avatar">
    
</div>

            <div>
                Темы:
                <a href="../topics/index.html">
                    2
                </a>
            </div>
            <div>
                Сообщения:
                <a href="index.html">
                    15
                </a>
            </div>
            <div>
                Участник с: 14 апреля 2019
            </div>
            
        </td>
        <td class="post-content">
            В общем хотел создать для напоминания -на перерыв.<br /><pre><code>[Unit]
Description=Перерыв
#After=pulseaudio.service

[Service]
Type=oneshot
User=viktor
Group=wheel
RemainAfterExit=yes
#ExecStart=/usr/bin/xfce4-terminal -e --maximize --hide-menubar --command=&#39;zenity --entry --text=&quot;Пора на обед:&quot;&#39;
ExecStart=/usr/bin/xfce4-terminal -e --maximize --hide-menubar --command=&#39;whiptail --msgbox &quot;ОБЕД!&quot; 10 20&#39;

#[Timer]
#OnCalendar=*-*-* 12:00:00
#Persistent=true
#OnBootSec=15min
#OnUnitActiveSec=5days
[Install]
WantedBy=multi-user.target
</code></pre><br /><pre><code>[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="f4869b9b80b4829d9f809b86d98497">[email&#160;protected]</a> viktor]# systemctl daemon-reload
[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="14667b7b6054627d7f607b66396477">[email&#160;protected]</a> viktor]# systemctl start pereruv.service
Job for pereruv.service failed because the control process exited with error code.
See &quot;systemctl status pereruv.service&quot; and &quot;journalctl -xe&quot; for details.
[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="3d4f5252497d4b545649524f104d5e">[email&#160;protected]</a> viktor]# systemctl status pereruv.service
● pereruv.service - Перерыв
   Loaded: loaded (/etc/systemd/system/pereruv.service; enabled; vendor preset: disabled)
   Active: failed (Result: exit-code) since Sun 2019-04-14 10:07:30 +05; 12s ago
  Process: 3518 ExecStart=/usr/bin/xfce4-terminal -e --maximize --hide-menubar --command=whiptail --msgbox &quot;ОБЕД!&quot; 10 20 (code=exited,&gt;
 Main PID: 3518 (code=exited, status=1/FAILURE)

апр 14 10:07:30 viktor-pc systemd[1]: Starting Перерыв...
апр 14 10:07:30 viktor-pc xfce4-terminal[3518]: Unable to init server: Не удалось подключиться к: В соединении отказано
апр 14 10:07:30 viktor-pc xfce4-terminal[3518]: cannot open display:
апр 14 10:07:30 viktor-pc systemd[1]: pereruv.service: Main process exited, code=exited, status=1/FAILURE
апр 14 10:07:30 viktor-pc systemd[1]: pereruv.service: Failed with result &#39;exit-code&#39;.
апр 14 10:07:30 viktor-pc systemd[1]: Failed to start Перерыв.
lines 1-12/12 (END)
</code></pre><br />Создал и Timer:<br /><pre><code>[Unit]
Description=Перерыв

[Timer]
OnCalendar=*-*-* 12:00:05
Persistent=true
#Unit=/etc/systemd/system/pereruv.service
RandomizedDelaySec=15m

[Install]
WantedBy=timers.target</code></pre><br /><pre><code>[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="077568687347716e6c7368752a7764">[email&#160;protected]</a> viktor]# systemctl daemon-reload
[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="94e6fbfbe0d4e2fdffe0fbe6b9e4f7">[email&#160;protected]</a> viktor]# systemctl start pereruv.timer
[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="30425f5f447046595b445f421d4053">[email&#160;protected]</a> viktor]# systemctl status pereruv.timer
● pereruv.timer - Перерыв
   Loaded: loaded (/etc/systemd/system/pereruv.timer; enabled; vendor preset: disabled)
   Active: active (waiting) since Sun 2019-04-14 08:58:37 +05; 1h 17min ago
  Trigger: Sun 2019-04-14 12:06:18 +05; 1h 49min left

апр 14 08:58:37 viktor-pc systemd[1]: Stopped Перерыв.
апр 14 08:58:37 viktor-pc systemd[1]: Stopping Перерыв.
апр 14 08:58:37 viktor-pc systemd[1]: Started Перерыв.
[<a href="../../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="265449495266504f4d5249540b5645">[email&#160;protected]</a> viktor]#
</code></pre><br />###Вариантов было много и всё ошибки( и нет запуска((
            
                
            

            <div class="post-related">
                <div class='attachments'>
                    
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

        
    </div>
    <div>&nbsp;</div>
    
        <div class="text-center">
    


    <nav>
        <ul class="pagination">
            
                <li class="previous">
                    <a href="index2679.html?page=1" aria-label="предыдущая страница">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="hidden-xs">предыдущая страница</span>
                    </a>
                </li>
            

            
                
                    
                        <li>
                            <a href="index2679.html?page=1">1</a>
                        </li>
                    
                
            
                
                    
                        <li class="active">
                            <a href="index4658.html?page=2">2 <span class="sr-only">(текущая страница)</span></a>
                        </li>
                    
                
            

            
                <li class="next disabled">
                    <span>
                        <span class="hidden-xs">следующая страница</span>
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
            
        </ul>
    </nav>


</div>

    


        </div>
    </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-6 footer">
            
                <p class="copyright">&copy; 2006-2022, Русскоязычное сообщество
                    Arch Linux.<br>Название и логотип Arch Linux &trade;
                    являются признанными торговыми
                    марками.<br>Linux &reg; &mdash; зарегистрированная торговая
                    марка Linus Torvalds и LMI.</p>
            
        </div>
    </div>
</div>

<script data-cfasync="false" src="../../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>(function(){var js = "window['__CF$cv$params']={r:'746a621569209d69',m:'R7fOSaZfQu3K_i3fbvdc61RmY5KgA7B1XKsPdKL8hTY-1662500637-0-Adz3HkHGzyDVasuZ5CpgZhTxKYfWazwYP8o1UtwRXDGh5fX1FubnoDN50p1OofNtJivertp10hfYU1/URuBnd0ZFau4HnEF5qI/VSVa1PNiNI4OMTNs8V9RgmMuZaFQxqULoxZWmM3o/6QjOmD6AncAHqueNqCMi1Dl5XyHeKtYh',s:[0x6ccc569f0a,0x1e83194584],u:'/cdn-cgi/challenge-platform/h/b'};var now=Date.now()/1000,offset=14400,ts=''+(Math.floor(now)-Math.floor(now%offset)),_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='../../../../cdn-cgi/challenge-platform/h/b/scripts/alpha/invisible5615.js?ts='+ts,document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.nonce = '';_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>

<!-- Mirrored from archlinux.org.ru/forum/users/viktor1962/posts/?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 11:32:19 GMT -->
</html>
